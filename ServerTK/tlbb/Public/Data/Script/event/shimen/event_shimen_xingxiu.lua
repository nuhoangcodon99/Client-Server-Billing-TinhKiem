 --Ê¦ÃÅÈÎÎñ

--MisDescBegin
--½Å±¾ºÅ
x229007_g_ScriptId = 229007

--½ÓÊÜÈÎÎñNPCÊôÐÔ
x229007_g_Position_X=96.0455
x229007_g_Position_Z=92.6545
x229007_g_SceneID=16
x229007_g_AccomplishNPC_Name="Vß½ng Nhan"
      
--Ç°ÌáÈÎÎñ
--g_MissionIdPre =

--ÈÎÎñÄ¿±ênpc
x229007_g_Name	= "Vß½ng Nhan"

--ÈÎÎñºÅ
x229007_g_MissionId = 1095

--ÈÎÎñ¹éÀà
x229007_g_MissionKind = 27

--ÈÎÎñµÈ¼¶
x229007_g_MissionLevel = 10000
--ÊÇ·ñÊÇ¾«Ó¢ÈÎÎñ
x229007_g_IfMissionElite = 0

--ÏÂÃæ¼¸ÏîÊÇ¶¯Ì¬ÏÔÊ¾µÄÄÚÈÝ£¬ÓÃÓÚÔÚÈÎÎñÁÐ±íÖÐ¶¯Ì¬ÏÔÊ¾ÈÎÎñÇé¿ö**********************
--ÈÎÎñÊÇ·ñÒÑ¾­Íê³É
x229007_g_IsMissionOkFail = 0		--±äÁ¿µÄµÚ0Î»

--ÒÔÉÏÊÇ¶¯Ì¬**************************************************************

--ÈÎÎñ±äÁ¿µÚÒ»Î»ÓÃÀ´´æ´¢Ëæ»úµÃµ½µÄ½Å±¾ºÅ

--ÈÎÎñÎÄ±¾ÃèÊö
x229007_g_MissionName="Nhi®m vø sß môn"
x229007_g_MissionInfo=""  --ÈÎÎñÃèÊö
x229007_g_MissionTarget = "%f"
x229007_g_ContinueInfo="Làm t¯t l¡m"		--Î´Íê³ÉÈÎÎñµÄnpc¶Ô»°
x229007_g_MissionComplete="Vi®c ta giao ðã hoàn thành chßa?"					--Íê³ÉÈÎÎñnpcËµ»°µÄ»°
x229007_g_MissionRound=17

x229007_g_DoubleExp = 48
x229007_g_AccomplishCircumstance = 1

x229007_g_ShimenTypeIndex = 1
x229007_g_Parameter_Kill_AllRandom={{id=7,numa=3,numb=3,bytenuma=0,bytenumb=1}}
x229007_g_Parameter_Item_IDRandom={{id=6,num=5}}
x229007_g_NpcIdIndicator={{key=2,npcIdIndex=5},{key=9,npcIdIndex=7}}

--ÓÃÀ´±£´æ×Ö·û´®¸ñÊ½»¯µÄÊý¾Ý
x229007_g_FormatList = {
								"Lâu l¡m không g£p %n r°i, nh¾ quá ði. Ðây %s là chút lòng thành cüa ta, xin ngß½i hãy ðßa t¾i giúp ta. #R #e00f000Nh¡c nhö: #e000000#r Ngß½i có th¬ ðªn Tinh Túc Häi tìm #RThiên Lang TØ #W#{_INFOAIM99,150,16, Thiên Lang TØ}, hãy nh¶ ông ta ðßa ngß½i t¾i các thành th¸ l¾n.",
								"%i cüa ta sao không th¤y ðâu? Nªu ngß½i có th¬ giúp ta tìm lÕi, ta s¨ không bÕc ðãi ngß½i. #R #e00f000Nh¡c nhö: #e000000#r Ngß½i có th¬ ðªn Tinh Túc Häi tìm #RThiên Lang TØ #W#{_INFOAIM99,150,16, Thiên Lang TØ}, hãy nh¶ ông ta ðßa ngß½i t¾i các thành th¸ l¾n.",
								"%n làm ði«u ác, ta phäi ði dÕy bäo, ðáng tiªc không có th¶i gian, ngß½i có th¬ làm thay ðßþc không? #R #e00f000Nh¡c nhö: #e000000#r Ngß½i có th¬ ðªn Tinh Túc Häi tìm #RThiên Lang TØ #W#{_INFOAIM99,150,16, Thiên Lang TØ}, hãy nh¶ ông ta ðßa ngß½i t¾i các thành th¸ l¾n.",
								"Xin ngß½i hãy · Tinh Túc Häi %s tìm th¤y %s, hãy dùng %s ð¬ cho nó ån. #R #e00f000Nh¡c nhö: #e000000#r Khi ngß½i t¾i g¥n rß½ng ðµc v§t c¥n cho ån, ¤n #gfff0f0Alt+A#g000000có th¬ m· møc v§t ph¦m, ¤n vào#gfff0f0\"nhi®m vø\"#g000000giao di®n có th¬ m· ra møc v§t ph¦m nhi®m vø, nháy phím phäi#gfff0f0Ngû Ðµc Trùng#g000000, là có th¬ hoàn t¤t vi®c cho ån.",
								"Xin ngß½i hãy ði tìm %s, muµi ¤y s¨ ðßa ngß½i ði thØ chiªn %s. #R #e00f000Nh¡c nh·: #e000000#r H°ng Ng÷c sß muµi · Tinh Túc Häi #{_INFOAIM128,78,16, H°ng Ng÷c}.",
								"Xin ngß½i hãy b¡t cho ta mµt con %p v«.#e000000#r Vân Hàm Nhi · thành LÕc Dß½ng #{_INFOAIM183,155,0, Vân Hàm Nhi} có th¬ ðßa ngß½i t¾i Huy«n Vû Ðäo, nhßng Huy«n Vû Ðäo có 1 con ðß¶ng mòn thông qua Thánh Thú S½n. Ngß½i có th¬ b¡t trân thú mà ta c¥n · Huy«n Vû Ðäo ho£c · Thánh Thú S½n.",
								"Xin ngß½i hãy ki¬m tra b¯n phía · Tinh Túc Häi, tìm cho ta 5 con %s. #R #e00f000Nh¡c nhÞ: #e000000#r Ngß½i có th¬ tìm th¤y nút vàng trong bän ð° nhö · góc phäi màn hình.",
								"Hãy ðßa %s t¾i 1 cái %i, làm xong, ta s¨ h§u thß·ng cho ngß½i! #R #e00f000Nh¡c nhÞ: #e000000#r Tây Vñc Dßþc Lâu TØ · Tinh Túc Häi #{_INFOAIM131,48,16, Tây Vñc Dßþc Lâu TØ}. #R Khiªt Ðan Dßþc Lâu TØ · Tinh Túc Häi #{_INFOAIM136,48,16, Khiªt Ðan Dßþc Lâu TØ}. #R ÐÕi Lý Dßþc Lâu TØ · Tinh Túc Häi #{_INFOAIM142,48,16, ÐÕi Lý Dßþc Lâu TØ}.",
								"Ði giªt chªt %s %s %n.",
								}

--¸ñÊ½×Ö·û´®ÖÐµÄË÷Òý, ±íÊ¾´Ó4¿ªÊ¼,ºó¶àÉÙÎ»ÊÓSetMissionByIndex(...)µÄ¶àÉÙ¶ø¶¨
x229007_g_StrForePart=4
x229007_g_ShimenPet_Index = 1

x229007_g_StrList = {
						"Ngû ðµc trùng ",
						"rß½ng cóc ðµc ",
						"rß½ng rªt ðµc ",
						"rß½ng nh®n ðµc ",
						"rß½ng bò cÕp ðµc ",
						"H°ng Ng÷c",
						"Ngû Th¥n Ðµng phø bän",
						"Ðµc ngô công ",
						"Ðµc thi«m th× ",
						"Ðµc tri thù ",
						"Tây vñc Dßþc Lâu TØ",
						"Khiªt Ðan Dßþc Lâu TØ",
						"ÐÕi Lý Dßþc Lâu TØ",
						"Sài Miêu Dã Sinh",
						"Nh§t Nguy®t Cung ",
						"phß½ng trßþng ði®n ",
						"ði®n Doanh Châu ",
						"ði®n B°ng Lai ",
						"0",
						"1",
						"2",
						"3",
						"4",
						"5",
						"6",
						"7",
						"8",
						"9",
						}
--MisDescEnd


--/////////////////////////////////////////////////////////////////////////////////////////////////////

--×ÓÈÎÎñµÄÀàÐÍ´úºÅ¶¨Òå
x229007_g_SubMissionTypeEnum = {XunWu=1, SongXin=2, DingDianYinDao=3, FuBenZhanDou=4, BuZhuo=5, ShouJi=6, KaiGuang=7, otherMenpaiFuben=8,  killMonster=9,}

--¶¨µãÒýµ¼
x229007_g_DingDianYinDaoList = {
											 {menpai=MP_XINGSU   , itemId=40003034, itemName="Ngû ðµc trùng ", scene=16, AreaName="Nh§t Nguy®t Cung ", subAreaName="rß½ng cóc ðµc ", posx1=88, posz1=50, posx2=103, posz2=60},
											 {menpai=MP_XINGSU   , itemId=40003034, itemName="Ngû ðµc trùng ", scene=16, AreaName="phß½ng trßþng ði®n ", subAreaName="rß½ng rªt ðµc ", posx1=82, posz1=94, posx2=94, posz2=102},
											 {menpai=MP_XINGSU   , itemId=40003034, itemName="Ngû ðµc trùng ", scene=16, AreaName="ði®n Doanh Châu ", subAreaName="rß½ng nh®n ðµc ", posx1=98, posz1=94, posx2=110, posz2=102},
											 {menpai=MP_XINGSU   , itemId=40003034, itemName="Ngû ðµc trùng ", scene=16, AreaName="ði®n B°ng Lai ", subAreaName="rß½ng bò cÕp ðµc ", posx1=119, posz1=69, posx2=132, posz2=79},
											}


--¸±±¾ÁÐ±í
x229007_g_FuBen_List = {
								{menpai=MP_XINGSU   , NpcName="H°ng Ng÷c", scene=16, posx=128, posz=78, FubenName="Ngû Th¥n Ðµng phø bän"},
								}       

--ÊÕ¼¯
x229007_g_ShouJiList = {
								{menpai=MP_XINGSU   , scene=16, itemId=40003035, itemName="Ðµc ngô công "},-- count=5},
								{menpai=MP_XINGSU   , scene=16, itemId=40003036, itemName="Ðµc thi«m th× "},-- count=5},								
								{menpai=MP_XINGSU   , scene=16, itemId=40003037, itemName="Ðµc tri thù "},-- count=5},								
							}	



--ËÍÉú»î¼¼ÄÜnpcÁÐ±í
x229007_g_AbilityNpcList = {
                    {menpai=MP_XINGSU   ,npcList={{name="Tây vñc Dßþc Lâu TØ", scene=16, x=131, z=48},
                                                  {name="Khiªt Ðan Dßþc Lâu TØ", scene=16, x=136, z=48},
                                                  {name="ÐÕi Lý Dßþc Lâu TØ", scene=16, x=142, z=48}}
										},
									}

										
--²¶ÊÞÁÐ±í
x229007_g_PetList = {
						{petDataId=3000, petName="Sài Miêu Dã Sinh", takeLevel=10},
					}

--É±¹ÖÏà¹Ø
x229007_g_MenpaiYiWuList = {
								{menpainame="Thiªu Lâm", menpai=MP_SHAOLIN  , itemName="Ðµ ði®p cüa Thiªu Lâm ð® tØ", scene=9,  itemId=40004306},
								{menpainame="Thiên Long", menpai=MP_DALI     , itemName="„n chß½ng cüa Thiên Long ð® tØ", scene=13, itemId=40004312},
								{menpainame="Nga My", menpai=MP_EMEI     , itemName="Kiªm tu® cüa Nga My ð® tØ", scene=15, itemId=40004310},
								{menpainame="Cái Bang", menpai=MP_GAIBANG  , itemName="Túi väi cüa Cái Bang ð® tØ", scene=10, itemId=40004307},
								{menpainame="Minh Giáo", menpai=MP_MINGJIAO , itemName="Höa l®nh cüa Minh Giáo ð® tØ", scene=11, itemId=40004308},
								{menpainame="Thiên S½n", menpai=MP_TIANSHAN , itemName="Bång bài cüa Thiên S½n ð® tØ", scene=17, itemId=40004314},
								{menpainame="Võ Ðang", menpai=MP_WUDANG   , itemName="Ph¤t tr¥n cüa Võ Ðang ð® tØ", scene=12, itemId=40004309},
								{menpainame="Tiêu Dao", menpai=MP_XIAOYAO  , itemName="Tiêu trì cüa Tiêu Dao ð® tØ", scene=14, itemId=40004313},
								{menpainame="Tinh Túc", menpai=MP_XINGSU   , itemName="C± mãnh cüa Tinh Túc ð® tØ", scene=16, itemId=40004311},
							}
	
--¹ÖÎïµôÂäÒÅÎïµÄ¼¸ÂÊÅäÖÃ±í
x229007_g_RateOfDropYiWuTable = {
							{playerLevel=20, dropRate=30},
							{playerLevel=30, dropRate=30},
							{playerLevel=40, dropRate=25},
							{playerLevel=50, dropRate=25},
							{playerLevel=60, dropRate=25},
							{playerLevel=70, dropRate=20},
							{playerLevel=80, dropRate=20},
							{playerLevel=90, dropRate=20},
							{playerLevel=100, dropRate=20},
							{playerLevel=110, dropRate=20},
							{playerLevel=120, dropRate=20},
							{playerLevel=130, dropRate=20},
							{playerLevel=140, dropRate=20},
							{playerLevel=150, dropRate=20},
						}
 
x229007_g_DemandKillcountTable = 	{
							{levelBegin=10, levelEnd=19, killcount=20},
							{levelBegin=20, levelEnd=39, killcount=25},
							{levelBegin=40, levelEnd=59, killcount=30},
							{levelBegin=60, levelEnd=79, killcount=35},
							{levelBegin=80, levelEnd=99, killcount=40},
							{levelBegin=100, levelEnd=109, killcount=45},
							{levelBegin=110, levelEnd=119, killcount=50},
							{levelBegin=120, levelEnd=150, killcount=55},
}						
 
--//////////////////////////////////////////////////////
--É±¹ÖÏà¹Ø
function x229007_GetMenpaiYiWuInfo(sceneId, selfId)
	for i, v in x229007_g_MenpaiYiWuList do
		if v.menpai == GetMenPai(sceneId, selfId) then
			return v.menpainame, v.itemName, v.itemId
		end
	end
end

function x229007_GetRateOfDropYiWu(sceneId, selfId)
	local playerLevel = GetLevel(sceneId, selfId)
	for i, v in x229007_g_RateOfDropYiWuTable do
		if v.playerLevel >= playerLevel and playerLevel < v.playerLevel then
			return v.dropRate
		end
	end
end

function x229007_GetDemandKillCount(sceneId, selfId)
	local playerLevel = GetLevel(sceneId, selfId)
	for i, v in x229007_g_DemandKillcountTable do
		if playerLevel >= v.levelBegin and playerLevel <= v.levelEnd then
			return v.killcount
		end
	end
end

function x229007_KillMonster_Accept(sceneId, selfId)--É±¹Ö
	--PrintStr("x229007_KillMonster_Accept")
	
	local nMonsterId, strMonsterName, strMonsterScene, nScene, nPosX, nPosZ, strDesc, nSex, level
	local playerLevel = GetLevel(sceneId, selfId)
	--PrintStr("1")
	for i=1, 100 do
		nMonsterId, strMonsterName, strMonsterScene, nScene, nPosX, nPosZ, strDesc, nSex, level = GetOneMissionNpc(43)
		if abs(level - playerLevel) < 3  then
			--PrintStr("2")
			break
		end
		if i == 100 then
			--PrintStr("adfdasfdas")
			--Í³Í³ËÍÐÅÈ¥:((
			x229007_SongXin_Accept(sceneId, selfId)
			return
		end
	end	
	
	--PrintStr("before AddMission...")
	--¼ÓÈëÈÎÎñµ½Íæ¼ÒÁÐ±í
	local bAdd = AddMission( sceneId,selfId, x229007_g_MissionId, x229007_g_ScriptId, 1, 0, 1 )
	if bAdd < 1 then
		--PrintStr("AddMission fail...")
		return
	end	
	local killcount = x229007_GetDemandKillCount(sceneId, selfId)
	local countpart1 = x229007_GetStrIndexByStrValue(tostring(floor(killcount / 10)) )
	local countpart2 = x229007_GetStrIndexByStrValue(tostring(floor(mod(killcount, 10))) )
	
	--µÃµ½ÈÎÎñÔÚ20¸öÈÎÎñÖÐµÄÐòÁÐºÅ
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229007_g_MissionId)
	
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --ÉèÖÃÈÎÎñÊÇ·ñÍê³É£¨Î´Íê³É£©
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229007_g_SubMissionTypeEnum.killMonster)
	
	SetMissionParamByIndexEx(sceneId, selfId, misIndex, 3, 0, killcount) --ÒªÇóÉ±ËÀµÄmonster×ÜÊý£¬ ÏÖÔÚ»¹Ã»ÓÐ¸³Öµ
	SetMissionParamByIndexEx(sceneId, selfId, misIndex, 3, 1, 0) --ÒÑ¾­É±ËÀµÄmonsterÊýÁ¿
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart, 8)--formet×Ö·û´®Ë÷Òý
	SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart+1, countpart1)
	SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart+2, countpart2)
	SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart+3, nMonsterId)
		
	Msg2Player(  sceneId, selfId,"#YNh§n nhi®m vø#W: Nhi®m vø sß môn", MSG2PLAYER_PARA )
	CallScriptFunction( SCENE_SCRIPT_ID, "AskThePos", sceneId, selfId, nScene, nPosX, nPosZ, strMonsterName)	
	
	--PrintStr(strMonsterScene)
	--PrintStr(strMonsterName)
	local strMissionTarget = format("G¥n ðây · khu vñc %s %s thß¶ng qu¤y nhi­u cß dân xung quanh, ngß½i hãy nh§n l®nh ði tr×ng phÕt chúng", 
						strMonsterScene, strMonsterName)
	--PrintStr(strMissionTarget)
	AddText(sceneId, strMissionTarget)

end

--//////////////////////////////////////////////////////

function x229007_GetStrIndexByStrValue(stringV)
	for i, v in x229007_g_StrList do
		if v == stringV then
			return i-1
		end
	end
	local strText = format("C¥n phäi %s ðång kí StrList trong", stringV)
	--PrintStr(strText)
	return 0;
end

--/////////////////////////////////////////////////////////////////////////////////////////////////////
--»ñÈ¡¾ßÌåitemµÄÏêÏ¸ÐÅÏ¢
function x229007_GetItemDetailInfo(sceneId,itemId)
  local itemId1 = -1
	local itemName = ""
	local itemDesc = ""
	itemId1, itemName, itemDesc = GetItemInfoByItemId(itemId)
	if itemId1 == -1 then
		local strlog = "event_shimen_xingxiu::x229007_GetItemDetailInfo..itemId="
		 .. itemId1 .. ",itemName=" .. itemName .. ",itemDesc=" .. itemDesc
		MissionLog(sceneId, strlog)
		return
	end
	if itemId1 == -1 then
		local strText = format("%s V§t ph¦m · 'MissionItem_HashTable.txt' không tìm th¤y!!", itemName)
		PrintStr(strText)
	end
	return itemId1, itemName, itemDesc
end	
--/////////////////////////////////////////////////////////////////////////////////////////////////////
--¸ù¾ÝÍæ¼ÒµÈ¼¶µÃµ½¶ÔÓ¦MissionItem_HashTable.txtÖÐµÄµ¥ÔªË÷Òý
function x229007_GetMissionItemIndex(sceneId, selfId)
	local nPlayerLevel  = GetLevel(sceneId, selfId)
	if nPlayerLevel >= 10 and nPlayerLevel < 20 then
		return 0;
	elseif nPlayerLevel >= 20 and nPlayerLevel < 30 then
		return 1;
	elseif nPlayerLevel >= 30 and nPlayerLevel < 40 then
		return 2;
	elseif nPlayerLevel >= 40 and nPlayerLevel < 60 then
		return 3;
	elseif nPlayerLevel >= 60 and nPlayerLevel < 80 then
		return 4;
	elseif nPlayerLevel >= 80 and nPlayerLevel < 100 then
		return 5;
	elseif nPlayerLevel >= 100 and nPlayerLevel < 120 then
		return 167;
	elseif nPlayerLevel >= 100 then
		return 168;
	end
end

--¸ù¾ÝÍæ¼ÒµÈ¼¶µÃµ½¶ÔÓ¦µÄÊ¦ÃÅÈÎÎñµÄ½×¶Î
function x229007_GetShiMenPhaseByPlayerLevel(sceneId, selfId)
	local nPlayerLevel  = GetLevel(sceneId, selfId)
	if nPlayerLevel >= 10 and nPlayerLevel < 20 then
		return 0
	elseif nPlayerLevel >= 20 and nPlayerLevel < 40 then
		return 1
	elseif nPlayerLevel >= 40 and nPlayerLevel < 60 then
		return 2
	elseif nPlayerLevel >= 60 and nPlayerLevel < 80 then 
		return 3
	elseif nPlayerLevel >= 80 and nPlayerLevel < 100 then 
		return 4
	elseif nPlayerLevel >= 100 and nPlayerLevel < 120 then 
		return 243
	elseif nPlayerLevel >= 120 then
		return 244
	end
end
--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229007_RandomSubMission(sceneId, selfId)
 
	--Ñ°Îï£¨1/4£©¡¢ËÍÐÅ£¨1/16£©¡¢ÊÕ¼¯£¨1/16£©¡¢¿ª¹â£¨1/16£©¡¢¶¨µãÒýµ¼£¨1/16£©¡¢Õ½¶·¸±±¾£¨1/4£©¡¢²¶×½£¨1/4£©
	local nRet = 1 + LuaFnGetHumanShimenRandom(sceneId, selfId);
	if nRet then
		if nRet <= 4 then
			x229007_XunWu_Accept(sceneId, selfId)
		elseif nRet <= 5 then
			x229007_SongXin_Accept(sceneId, selfId)
		elseif nRet <= 6 then
			x229007_ShouJi_Accept(sceneId, selfId)
		elseif nRet <= 7 then
			x229007_SongXin_Accept(sceneId, selfId)
		elseif nRet <= 8 then
			x229007_DingDianYinDao_Accept(sceneId, selfId)
		elseif nRet <= 12 then
			x229007_FuBenZhanDou_Accept(sceneId, selfId)
		elseif nRet <= 16 then
			x229007_BuZhuo_Accept(sceneId, selfId)
		else
			return -1
		end
	else
		return -1;
	end
end
--**********************************
--¸ù¾ÝÍæ¼ÒµÈ¼¶µÃ³öÈÎÎñµÄµÈ¼¶½×¶Î(1~5)
--**********************************
function x229007_DoSomethingByPlayerLevel(sceneId, selfId)
	CallScriptFunction(229000, "DoSomethingByPlayerLevel", sceneId, selfId, x229007_g_ScriptId)
end

--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229007_XunWu_Accept(sceneId, selfId)--Ñ°Îï
	----PrintStr("XunWu_Accept..")
	--¼ÓÈëÈÎÎñµ½Íæ¼ÒÁÐ±í
	local bAdd = AddMission( sceneId,selfId, x229007_g_MissionId, x229007_g_ScriptId, 0, 0, 1 )
	if bAdd < 1 then
		return
	end	
	
	
	local nitemId, strItemName, strItemDesc = GetOneMissionItem(x229007_GetMissionItemIndex(sceneId, selfId))
	Msg2Player(sceneId, selfId, "#YNh§n nhi®m vø#W: Nhi®m vø sß môn", MSG2PLAYER_PARA )
	--print(nitemId, strItemName, strItemDesc)
	--µÃµ½ÈÎÎñÔÚ20¸öÈÎÎñÖÐµÄÐòÁÐºÅ
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229007_g_MissionId)
	
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --ÉèÖÃÈÎÎñÊÇ·ñÍê³É£¨Î´Íê³É£©
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229007_g_SubMissionTypeEnum.XunWu)
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart, 1)--formet×Ö·û´®Ë÷Òý
	SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart+1, nitemId)
	
	local strMissionTarget = format("%s cüa ta sao không th¤y ðâu? Nªu ngß½i có th¬ giúp ta tìm lÕi, ta s¨ không bÕc ðãi ngß½i", strItemName)
	AddText(sceneId, strMissionTarget)
	
	--¼ì²âÍæ¼ÒÉíÉÏµÄµÀ¾ßÊÇ·ñÒÑ¾­Âú×ãÍê³ÉÌõ¼þ
	local bHaveItem = HaveItem(sceneId, selfId, nitemId)
	if bHaveItem == 1 then
		SetMissionByIndex(sceneId,selfId,misIndex,0,1)					--°ÑÈÎÎñÍê³É±êÖ¾ÖÃÎª1
		ResetMissionEvent(sceneId, selfId, x229007_g_MissionId, 2)
	end	
	
end	

--/////////////////////////////////////////////////////////////////////////////////////////////////////

function x229007_SongXin_Accept(sceneId, selfId)--ËÍÐÅ

  local roll = random(3)
	--Ëæ»úÑ¡³ö±¾ÃÅÅÉµÄÌØ²ú±àºÅ£¬Ã¿¸öÃÅÅÉ3ÖÖÌØ²ú
	x229007_g_Xin_ItemId = x229007_g_ShouJiList[ roll ].itemId
	
	--ÈÎÎñ½±ÀøÏà¹Ø			
	BeginAddItem(sceneId)
		AddItem(sceneId, x229007_g_Xin_ItemId, 1)
	local bAdd = EndAddItem(sceneId, selfId)
	if bAdd < 1 then
		return
	end
		

	--¼ÓÈëÈÎÎñµ½Íæ¼ÒÁÐ±í
	bAdd = AddMission( sceneId,selfId, x229007_g_MissionId, x229007_g_ScriptId, 0, 0, 0 )
	if bAdd < 1 then
		return
	end	
	AddItemListToHuman(sceneId, selfId)	
	--Ñ°Îï, ËÍÐÅÔòÉèÖÃËø¶¨Ä¿±êNPCµÄÊÂ¼þFlag
	SetMissionEvent(sceneId, selfId, x229007_g_MissionId, 4)
	

	local nPhase = x229007_GetShiMenPhaseByPlayerLevel(sceneId, selfId)
	local nNpcId, strNpcName, strNpcScene, nSceneId, nPosX, nPosZ, strNPCDesc = GetOneMissionNpc(nPhase-1)
	--print(nNpcId, strNpcName, strNpcScene, nSceneId, nPosX, nPosZ, strNPCDesc)
	Msg2Player(  sceneId, selfId,"#YNh§n nhi®m vø#W: Nhi®m vø sß môn", MSG2PLAYER_PARA )
	CallScriptFunction( SCENE_SCRIPT_ID, "AskTheWay", sceneId, selfId, nSceneId, nPosX, nPosZ, strNpcName)
		
	--µÃµ½ÈÎÎñÔÚ20¸öÈÎÎñÖÐµÄÐòÁÐºÅ
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229007_g_MissionId)
	
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --ÉèÖÃÈÎÎñÊÇ·ñÍê³É£¨Î´Íê³É£©
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229007_g_SubMissionTypeEnum.SongXin)
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart, 0)--formet×Ö·û´®Ë÷Òý
	SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart+1, nNpcId)

	local ListIndex = x229007_GetStrIndexByStrValue( x229007_g_ShouJiList[ roll ].itemName )
	SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart+2, ListIndex )

  SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart+3, x229007_g_Xin_ItemId )

	local strMissionTarget = format("Lâu l¡m không g£p %s %s, ngß½i hãy giúp ta ðem %s giao cho ngß¶i ¤y", strNpcScene, strNpcName, x229007_g_ShouJiList[ roll ].itemName )
	AddText(sceneId, strMissionTarget)
	
end

--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229007_DingDianYinDao_Accept(sceneId, selfId)--¶¨µãÒýµ¼
	--»ñµÃÍæ¼ÒµÄÃÅÅÉ
	local playerMenpai = GetMenPai(sceneId, selfId)
	local a = {}
	local index = 1
	--ÓÃÒ»¸öÁÙÊ±±íÀ´´æ´¢¶ÔÓ¦ÃÅÅÉÔÚx229007_g_DingDianYinDaoListÖÐµÄÈ«²¿Ë÷Òý
	for i, v in x229007_g_DingDianYinDaoList do
		if v.menpai == playerMenpai then
			a[index] = i
			index = index + 1
		end
	end
	
	local ct = getn(a)
	if ct <= 0 then
		return 0
	end
		
	local ret = random(ct)
	BeginAddItem(sceneId)
		AddItem(sceneId, x229007_g_DingDianYinDaoList[a[ret]].itemId, 1)
	local bAdd = EndAddItem(sceneId,selfId)
	if bAdd < 1 then
		return
	end	
	
	--¼ÓÈëÈÎÎñµ½Íæ¼ÒÁÐ±í
	bAdd = AddMission( sceneId,selfId, x229007_g_MissionId, x229007_g_ScriptId, 0, 0, 0 )
	if bAdd < 1 then
		return
	end	
	AddItemListToHuman(sceneId, selfId)	
	Msg2Player(  sceneId, selfId,"#YNgß½i ðã ðÕt ðßþc 1 chiªc#W" .. x229007_g_DingDianYinDaoList[a[ret]].itemName, MSG2PLAYER_PARA )
	
	local strIndex_Area = x229007_GetStrIndexByStrValue(x229007_g_DingDianYinDaoList[a[ret]].AreaName)
	local strIndex_Item = x229007_GetStrIndexByStrValue(x229007_g_DingDianYinDaoList[a[ret]].itemName)
	local	strIndex_subArea = x229007_GetStrIndexByStrValue(x229007_g_DingDianYinDaoList[a[ret]].subAreaName)
	
	local x1 = x229007_g_DingDianYinDaoList[a[ret]].posx1
	local x2 = x229007_g_DingDianYinDaoList[a[ret]].posx2
	local z1 = x229007_g_DingDianYinDaoList[a[ret]].posz1
	local z2 = x229007_g_DingDianYinDaoList[a[ret]].posz2
	local scene = x229007_g_DingDianYinDaoList[a[ret]].scene
	local tip = x229007_g_DingDianYinDaoList[a[ret]].AreaName .. x229007_g_DingDianYinDaoList[a[ret]].subAreaName
	local x = x1 + (x2-x1)/2
	local z = z1 + (z2-z1)/2

	--µÃµ½ÈÎÎñÔÚ20¸öÈÎÎñÖÐµÄÐòÁÐºÅ
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229007_g_MissionId)
		
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --ÉèÖÃÈÎÎñÊÇ·ñÍê³É£¨Î´Íê³É£©
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229007_g_SubMissionTypeEnum.DingDianYinDao)
	SetMissionByIndex(sceneId, selfId, misIndex, 2, a[ret]) --ÉèÖÃ¶¨µãÒýµ¼ÁÐ±íÖÐµÄË÷Òý
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart, 3)--formet×Ö·û´®Ë÷Òý
	SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart+1, strIndex_Area)
	SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart+2, strIndex_subArea) 
	SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart+3, strIndex_Item)
	
	Msg2Player(  sceneId, selfId,"#YNh§n nhi®m vø#W: Nhi®m vø sß môn", MSG2PLAYER_PARA )
	CallScriptFunction( SCENE_SCRIPT_ID, "AskThePos", sceneId, selfId, scene, x, z, tip)

	local strMissionTarget = format("Xin ngß½i hãy · Tinh Túc Häi %s tìm th¤y %s, hãy dùng %s ð¬ cho nó ån", 
		x229007_g_DingDianYinDaoList[a[ret]].AreaName, 
		x229007_g_DingDianYinDaoList[a[ret]].subAreaName, 
		x229007_g_DingDianYinDaoList[a[ret]].itemName)        
		
	AddText(sceneId, strMissionTarget)
	
end

--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229007_FuBenZhanDou_Accept(sceneId, selfId)--Õ½¶·¸±±¾
	local playerMenpai = GetMenPai(sceneId, selfId)
	if playerMenpai == MP_WUMENPAI then
		return 0
	end	

	local npcName, fubenName, nSceneId, posx, posz
	for i, v in x229007_g_FuBen_List do
		if v.menpai == GetMenPai(sceneId, selfId) then
			npcName =  v.NpcName
			fubenName =  v.FubenName
			nSceneId = v.scene
			posx = v.posx
			posz = v.posz
			break
		end
	end

	--¼ÓÈëÈÎÎñµ½Íæ¼ÒÁÐ±í
	local bAdd = AddMission( sceneId,selfId, x229007_g_MissionId, x229007_g_ScriptId, 0, 0, 0 )
	if bAdd < 1 then
		return
	end	
	
	
	local nFormatIndex = GetMissionCacheData(sceneId, selfId, 0)
	local i = GetMissionCacheData(sceneId, selfId, 2)
	local NpcNameIndex = x229007_GetStrIndexByStrValue(npcName)
	local FubenNameIndex = x229007_GetStrIndexByStrValue(fubenName)
	
	--µÃµ½ÈÎÎñÔÚ20¸öÈÎÎñÖÐµÄÐòÁÐºÅ
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229007_g_MissionId)
		
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --ÉèÖÃÈÎÎñÊÇ·ñÍê³É£¨Î´Íê³É£©
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229007_g_SubMissionTypeEnum.FuBenZhanDou)
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart, 4)
	SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart+1, NpcNameIndex)
	SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart+2, FubenNameIndex)
	
	Msg2Player(  sceneId, selfId,"#YNh§n nhi®m vø#W: Nhi®m vø sß môn", MSG2PLAYER_PARA )
	CallScriptFunction( SCENE_SCRIPT_ID, "AskTheWay", sceneId, selfId, nSceneId, posx, posz, npcName)

	local strMissionTarget = format("Xin ngß½i hãy ði tìm %s, ngß¶i s¨ ðßa ngß½i ði thØ chiªn %s", npcName, fubenName)
	AddText(sceneId, strMissionTarget)
end

--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229007_BuZhuo_Accept(sceneId, selfId)--²¶×½
	local playerLevel = GetLevel(sceneId, selfId)
	local petId, petName, petDesc, takeLevel
	local petHashIndex = CallScriptFunction(229000, "GetMissionPetIndex", sceneId, selfId)
	for i = 1, 100 do
		petId, petName, petDesc = GetOneMissionPet(petHashIndex)
		takeLevel = GetPetTakeLevel(petId)
		if playerLevel > takeLevel  then
			break
		end
		if i == 100 then
			--Í³Í³ËÍÐÅÈ¥:((
			x229007_SongXin_Accept(sceneId, selfId)
		end
	end	
	--¼ÓÈëÈÎÎñµ½Íæ¼ÒÁÐ±í
	local bAdd = AddMission( sceneId,selfId, x229007_g_MissionId, x229007_g_ScriptId, 0, 0, 0 )
	if bAdd < 1 then
		return
	end	
	
	
	SetMissionEvent(sceneId, selfId, x229007_g_MissionId, 3)
	
	--µÃµ½ÈÎÎñÔÚ20¸öÈÎÎñÖÐµÄÐòÁÐºÅ
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229007_g_MissionId)
	
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --ÉèÖÃÈÎÎñÊÇ·ñÍê³É£¨Î´Íê³É£©
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229007_g_SubMissionTypeEnum.BuZhuo)
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart, 5)--formet×Ö·û´®Ë÷Òý
	SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart+1, petId)
		
	Msg2Player(  sceneId, selfId,"#YNh§n nhi®m vø#W: Nhi®m vø sß môn", MSG2PLAYER_PARA )
	
	local strMissionTarget = format("Xin ngß½i hãy b¡t cho ta mµt con %s v«", petName)
	AddText(sceneId, strMissionTarget)
	
	--¼ì²âÍæ¼ÒÉíÉÏµÄµÀ¾ßÊÇ·ñÒÑ¾­Âú×ãÍê³ÉÌõ¼þ
	for i=0, 6 do
		local petDataId = LuaFnGetPet_DataID(sceneId,selfId,i)
		if petDataId == petId then
			SetMissionByIndex(sceneId,selfId,misIndex,0,1)					--°ÑÈÎÎñÍê³É±êÖ¾ÖÃÎª1

			ResetMissionEvent(sceneId, selfId, x229007_g_MissionId, 3)
			break
		end	
	end	

end
--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229007_ShouJi_Accept(sceneId, selfId)--ÊÕ¼¯
	--PrintStr("ShouJi_Accept...")
	local playerMenpai = GetMenPai(sceneId, selfId)
	if playerMenpai == MP_WUMENPAI then
		return 0
	end	
	--PrintStr("playerMenpai="..playerMenpai)
	local a = {}
	local index = 1
	for i, v in x229007_g_ShouJiList do
		if v.menpai == playerMenpai then
			--PrintStr("find...")
			a[index] = i
			index = index + 1
		end	
	end
	local ct = getn(a)
	--PrintStr("ct="..ct)
	if ct <= 0 then
		return 0
	end
	
	local ret = random(ct)
	--¼ÓÈëÈÎÎñµ½Íæ¼ÒÁÐ±í
	local bAdd = AddMission( sceneId,selfId, x229007_g_MissionId, x229007_g_ScriptId, 0, 0, 1 )
	if bAdd < 1 then
		return
	end	

	
	local itemNameIndex = x229007_GetStrIndexByStrValue(x229007_g_ShouJiList[a[ret]].itemName)
	--µÃµ½ÈÎÎñÔÚ20¸öÈÎÎñÖÐµÄÐòÁÐºÅ
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229007_g_MissionId)
	
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --ÉèÖÃÈÎÎñÊÇ·ñÍê³É£¨Î´Íê³É£©
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229007_g_SubMissionTypeEnum.ShouJi)
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart, 6)--formet×Ö·û´®Ë÷Òý
	SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart+1, itemNameIndex)
	SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart+2, x229007_g_ShouJiList[a[ret]].itemId)
		
	Msg2Player(  sceneId, selfId,"#YNh§n nhi®m vø#W: Nhi®m vø sß môn", MSG2PLAYER_PARA )
	
	local strMissionTarget = format("Xin ngß½i hãy giúp ta kiªm 5 %s v«", x229007_g_ShouJiList[a[ret]].itemName)
	AddText(sceneId, strMissionTarget)
end
--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229007_Ability_Accept(sceneId, selfId)--¿ª¹â
	--PrintStr("Ability_Accept...")
	--local nPhase = x229007_GetShiMenPhaseByPlayerLevel(sceneId, selfId)
	--local nNpcId, strNpcName, strNpcScene, nSceneId, nPosX, nPosZ, strNPCDesc = GetOneMissionNpc(nPhase-1)
	local strNpcName, scene, x, z
	for i, v in x229007_g_AbilityNpcList do
		if v.menpai == GetMenPai(sceneId, selfId) then
			local ct = getn(v.npcList)
			local index =	random(ct)
			strNpcName = v.npcList[index].name
			scene = v.npcList[index].scene
			x = v.npcList[index].x
			z = v.npcList[index].z
		end
	end
	
	local strNpcIndex = x229007_GetStrIndexByStrValue(strNpcName)
	local itemId, itemName = GetMenpaiItem(sceneId, selfId)


	----PrintStr("itemId="..itemId.."  itemName="..itemName)
	--¼ÓÈëÈÎÎñµ½Íæ¼ÒÁÐ±í
	local bAdd = AddMission( sceneId,selfId, x229007_g_MissionId, x229007_g_ScriptId, 0, 0, 0 )
	if bAdd < 1 then
		return
	end	
	
	SetMissionEvent(sceneId, selfId, x229007_g_MissionId, 2)
	SetMissionEvent(sceneId, selfId, x229007_g_MissionId, 4)
	
	--µÃµ½ÈÎÎñÔÚ20¸öÈÎÎñÖÐµÄÐòÁÐºÅ
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229007_g_MissionId)
	
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --ÉèÖÃÈÎÎñÊÇ·ñÍê³É£¨Î´Íê³É£©
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229007_g_SubMissionTypeEnum.KaiGuang)
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart, 7)--formet×Ö·û´®Ë÷Òý
	SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart+1, strNpcIndex)
	SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart+2, itemId)
		
	Msg2Player(  sceneId, selfId,"#YNh§n nhi®m vø#W: Nhi®m vø sß môn", MSG2PLAYER_PARA )
	CallScriptFunction( SCENE_SCRIPT_ID, "AskTheWay", sceneId, selfId, scene, x, z, strNpcName)
	
	local strMissionTarget = format("Hãy ðßa %scho%s, ta s¨ h§u ðãi ngß½i!", strNpcName, itemName)
	AddText(sceneId, strMissionTarget)

end
--/////////////////////////////////////////////////////////////////////////////////////////////////////
--**********************************
--ÈÎÎñÈë¿Úº¯Êý
--**********************************
function x229007_OnDefaultEvent( sceneId, selfId, targetId )	--µã»÷¸ÃÈÎÎñºóÖ´ÐÐ´Ë½Å±¾
	----PrintStr("OnDefaultEvent...")
	--·¢ËÍÈÎÎñÐèÇóµÄÐÅÏ¢
	if IsHaveMission(sceneId,selfId,x229007_g_MissionId) > 0 then
		if GetName(sceneId, targetId) == x229007_g_Name then
			--·¢ËÍÈÎÎñÐèÇóµÄÐÅÏ¢
			BeginEvent(sceneId)
				AddText(sceneId, x229007_g_MissionName)
				AddText(sceneId, "Vi®c ta giao ðã hoàn thành chßa?")
			EndEvent( )
			bDone = x229007_CheckSubmit( sceneId, selfId )
			DispatchMissionDemandInfo(sceneId, selfId, targetId, x229007_g_ScriptId, x229007_g_MissionId, bDone)
		else
			local misIndex = GetMissionIndexByID(sceneId,selfId,x229007_g_MissionId)
			
			local demandItemId =0
			local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
			if missionType == x229007_g_SubMissionTypeEnum.SongXin then
			    demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229007_g_StrForePart+3)
			else
			    demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229007_g_StrForePart+2)
			end	
			
			local _, strDemandItemName, _ = x229007_GetItemDetailInfo(sceneId,demandItemId)
			
			local bHaveItem = HaveItem(sceneId, selfId, demandItemId)
			if bHaveItem == 1 then
				if LuaFnGetAvailableItemCount(sceneId, selfId, demandItemId) >= 1 then
				DelItem(sceneId, selfId, demandItemId, 1)
				BeginEvent(sceneId)
					AddText(sceneId, "Xin các hÕ quay v« nói v¾i Sß phø cüa các hÕ, tÕi hÕ r¤t nh¾ sß phø cüa các hÕ, r¤t cäm ½n sß phø cüa các hÕ t£ng món quà này cho tÕi hÕ, ðây là thÑ mà tÕi hÕ ðang mu¯n có ðßþc.")
				EndEvent()
				DispatchEventList(sceneId, selfId, targetId)	
				--ÉèÖÃÈÎÎñÒÑ¾­Íê³É
				SetMissionByIndex(sceneId, selfId, misIndex, 0, 1)
				ResetMissionEvent(sceneId, selfId, x229007_g_MissionId, 4)
				return 1;
			else
				BeginEvent(sceneId)
						AddText(sceneId, "V§t ph¦m cüa các hÕ hi®n không dùng ðßþc ho£c ðã b¸ khóa")
					EndEvent( )
					DispatchMissionTips(sceneId,selfId)	
					return	
				end					
			else
				BeginEvent(sceneId)
					AddText(sceneId, "Ðã mang t¾i thÑ ta c¥n chßa?")
				EndEvent()
				DispatchEventList(sceneId, selfId, targetId)	
				return 1;					
			end
		end
	elseif x229007_CheckAccept(sceneId,selfId) > 0 then
		BeginEvent(sceneId)
		
			AddText(sceneId,x229007_g_MissionName)
			AddText(sceneId,x229007_g_MissionInfo)
			AddText(sceneId,"#{M_MUBIAO}#r")
			
			x229007_DoSomethingByPlayerLevel(sceneId, selfId)
			--±£Ö¤µÚÒ»´Î½Óµ½µÄÈÎÎñ×ÜÊÇ¹Ì¶¨²»±äµÄ
			--ResetMissionCacheData(sceneId, selfId)
			--SetMissionCacheData(sceneId, selfId, 0, 0) --formet×Ö·û´®Ë÷Òý
			--SetMissionCacheData(sceneId, selfId, 1, x229007_g_SubMissionTypeEnum.SongXin)
			--SetMissionCacheData(sceneId, selfId, 2, 100001) --ÉèÖÃhumanÉíÉÏµÚ0Î»»º´æÊý¾Ý
			--SetMissionCacheData(sceneId, selfId, 7, 1) --ÊÇ·ñÊÇµÚÒ»´Î
			
			--strMissionTarget = format("ºÃ¾ÃÃ»ÓÐ¼û%sÁË£¬Çë´úÎÒÎÊºòÒ»ÏÂËûÈ¥", "frankwu")
			--AddText(sceneId, strMissionTarget)

			--¼ÓÈëÈÎÎñµ½Íæ¼ÒÁÐ±í
			--AddMission( sceneId,selfId, x229007_g_MissionId, x229007_g_ScriptId, 0, 0, 0 )
			--Ñ°Îï, ËÍÐÅÔòÉèÖÃËø¶¨Ä¿±êNPCµÄÊÂ¼þFlag
			--SetMissionEvent(sceneId, selfId, x229007_g_MissionId, 4)

			--local _, strNpcName, strNpcScene, PosX, PosZ, _ = GetNpcInfoByNpcId(sceneId,100001)
			--Msg2Player(  sceneId, selfId,"#Y½ÓÊÜÈÎÎñ£ºÊ¦ÃÅÈÎÎñ", MSG2PLAYER_PARA )
			--CallScriptFunction( SCENE_SCRIPT_ID, "AskTheWay", sceneId, selfId, nSceneId, PosX, PosZ, strNpcName)
				
			--µÃµ½ÈÎÎñÔÚ20¸öÈÎÎñÖÐµÄÐòÁÐºÅ
			--local misIndex = GetMissionIndexByID(sceneId,selfId,x229007_g_MissionId)
			
			--SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --ÉèÖÃÈÎÎñÊÇ·ñÍê³É£¨Î´Íê³É£©
			--SetMissionByIndex(sceneId, selfId, misIndex, 1, x229007_g_SubMissionTypeEnum.SongXin)
			
			--SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart, 0)--formet×Ö·û´®Ë÷Òý
			--SetMissionByIndex(sceneId, selfId, misIndex, x229007_g_StrForePart+1, 100001)
		
			
		EndEvent( )
		DispatchEventList(sceneId,selfId,targetId)
	end
	
end

--**********************************
--ÁÐ¾ÙÊÂ¼þ
--**********************************
function x229007_OnEnumerate( sceneId, selfId, targetId )
	----PrintStr("807002...OnEnumerate")
--Èç¹ûÍæ¼ÒÍê³É¹ýÕâ¸öÈÎÎñ
	if IsMissionHaveDone(sceneId,selfId,x229007_g_MissionId) > 0 then
  	return
--Âú×ãÈÎÎñ½ÓÊÕÌõ¼þ
	elseif IsHaveMission(sceneId,selfId,x229007_g_MissionId) > 0 then
		local strNpcName = x229007_g_Name -- temp code
		if GetName(sceneId,targetId) == strNpcName then
			AddNumText(sceneId, x229007_g_ScriptId,x229007_g_MissionName,4,-1);
		end
--Âú×ãÈÎÎñ½ÓÊÕÌõ¼þ
  elseif x229007_CheckAccept(sceneId,selfId) > 0 then
		if GetName(sceneId,targetId) == x229007_g_Name then
			AddNumText(sceneId,x229007_g_ScriptId,x229007_g_MissionName,3,-1);
		end
  end
end
--**********************************
--½ÓÊÜ
--**********************************
function x229007_OnAccept( sceneId, selfId )
	--PrintStr("OnAccept...")
	--local nMissionType = GetMissionCacheData(sceneId, selfId, 1)
	--if nMissionType == x229007_g_SubMissionTypeEnum.XunWu then
	--	x229007_XunWu_Accept(sceneId, selfId)
	--elseif nMissionType == x229007_g_SubMissionTypeEnum.SongXin then
	--	x229007_SongXin_Accept(sceneId, selfId)
	--elseif nMissionType == x229007_g_SubMissionTypeEnum.DingDianYinDao then
	--	x229007_DingDianYinDao_Accept(sceneId, selfId)
	--elseif nMissionType == x229007_g_SubMissionTypeEnum.FuBenZhanDou then
	--	x229007_FuBenZhanDou_Accept(sceneId, selfId)
	--elseif nMissionType == x229007_g_SubMissionTypeEnum.BuZhuo then
	--	x229007_BuZhuo_Accept(sceneId, selfId)
	--end
end

--**********************************
--¼ì²â½ÓÊÜÌõ¼þ
--**********************************
function x229007_CheckAccept( sceneId, selfId )
	local nLevel = GetLevel(sceneId, selfId)
	--Íæ¼ÒµÈ¼¶>=10¼¶
	if nLevel < 10 then
		return 0
	else
		local playerMenpai = GetMenPai(sceneId, selfId)
		if playerMenpai ~= MP_XINGSU then
			return 0
		end	
	end
	return 1;
end

--**********************************
--·ÅÆú
--**********************************
function x229007_OnAbandon( sceneId, selfId )
	----PrintStr("OnAbandon...")
	if IsHaveMission(sceneId, selfId, x229007_g_MissionId) > 0 then	
		local misIndex = GetMissionIndexByID(sceneId,selfId,x229007_g_MissionId)		--µÃµ½ÈÎÎñÔÚ20¸öÈÎÎñÖÐµÄÐòÁÐºÅ
		local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
		
		if missionType == x229007_g_SubMissionTypeEnum.SongXin then
			local missionItem = GetMissionParam(sceneId, selfId, misIndex,x229007_g_StrForePart+3)
			if HaveItem(sceneId, selfId, missionItem) == 1 then
			if LuaFnGetAvailableItemCount(sceneId, selfId, missionItem) >= 1 then
			DelItem(sceneId, selfId, missionItem, 1)		
			else
				BeginEvent(sceneId)
					AddText(sceneId, "V§t ph¦m cüa các hÕ hi®n không dùng ðßþc ho£c ðã b¸ khóa")
				EndEvent( )
				DispatchMissionTips(sceneId,selfId)	
				return	
			end				
			end	
		elseif missionType == x229007_g_SubMissionTypeEnum.DingDianYinDao	then
			local index = GetMissionParam(sceneId, selfId, misIndex,2)
			if HaveItem(sceneId, selfId, x229007_g_DingDianYinDaoList[index].itemId) == 1 then
			if LuaFnGetAvailableItemCount(sceneId, selfId, x229007_g_DingDianYinDaoList[index].itemId) >= 1 then
			DelItem(sceneId, selfId,x229007_g_DingDianYinDaoList[index].itemId,1)
			else
				BeginEvent(sceneId)
					AddText(sceneId, "V§t ph¦m cüa các hÕ hi®n không dùng ðßþc ho£c ðã b¸ khóa")
				EndEvent( )
				DispatchMissionTips(sceneId,selfId)	
				return	
			end				
			end
		elseif missionType == x229007_g_SubMissionTypeEnum.ShouJi then
			local itemId = GetMissionParam(sceneId, selfId, misIndex, x229007_g_StrForePart+2)
			if HaveItem(sceneId, selfId, itemId) == 1 then
			if LuaFnGetAvailableItemCount(sceneId, selfId, itemId) >= 5 then
			DelItem(sceneId, selfId,itemId,5)
			else	
				BeginEvent(sceneId)
					AddText(sceneId, "V§t ph¦m cüa các hÕ hi®n không dùng ðßþc ho£c ðã b¸ khóa")
				EndEvent( )
				DispatchMissionTips(sceneId,selfId)	
				return	
			end	
		end
		end
		--É¾³ýÍæ¼ÒÈÎÎñÁÐ±íÖÐ¶ÔÓ¦µÄÈÎÎñ
	  DelMission( sceneId, selfId, x229007_g_MissionId )
	  SetMissionData(sceneId,selfId,MD_SHIMEN_HUAN,0)	--»·ÊýÇå0
	end	
 	--µ÷ÓÃÍ¨ÓÃ·ÅÆú½Ó¿Ú
	------------------------------------------------------------------
	 CallScriptFunction( 500501, "Abandon_Necessary", sceneId, selfId )
	-------------------------------------------------------------------
 
end

--**********************************
--¼ÌÐø
--**********************************
function x229007_OnContinue( sceneId, selfId, targetId )
	----PrintStr("OnContinue...")
	if x229007_CheckAccept(sceneId,selfId) > 0 then
		BeginEvent(sceneId)
		
			AddText(sceneId,x229007_g_MissionName)
			AddText(sceneId,x229007_g_MissionComplete)
			
		  --x229007_DoSomethingByPlayerLevel(sceneId, selfId)
		  
		EndEvent( )
		DispatchMissionContinueInfo(sceneId, selfId, targetId, x229007_g_ScriptId, x229007_g_MissionId)
	end	
end

--**********************************
--¼ì²âÊÇ·ñ¿ÉÒÔÌá½»
--**********************************
function x229007_CheckSubmit( sceneId, selfId )
	if IsHaveMission( sceneId, selfId, x229007_g_MissionId ) <= 0 then
		return 0
	end

	--ÔÚ´ËÅÐ¶ÏÌá½»Ìõ¼þÊÇ·ñ·ûºÏ£¬²¢¸øÓèÏàÓ¦½±Àø
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229007_g_MissionId)
	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
	
	if missionType == x229007_g_SubMissionTypeEnum.XunWu then
		local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229007_g_StrForePart+1)
		if GetItemCount(sceneId,selfId,demandItemId) <= 0 then --Ã»ÓÐË÷ÒªµÄÎïÆ·
			return 0
		end
		if IsEquipItem(demandItemId) == 1 and IsWhiteEquip(demandItemId) ~= 1 then
			return 2
		else
			return 1
		end		
	elseif missionType == x229007_g_SubMissionTypeEnum.ShouJi then
	 	local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229007_g_StrForePart+2)
	 	if GetItemCount(sceneId,selfId,demandItemId) < 5 then --Ã»ÓÐË÷ÒªµÄÎïÆ·
	 		return 0
	 	else
	 		return 1		
	 	end
	elseif missionType == x229007_g_SubMissionTypeEnum.BuZhuo then
		return 2
	elseif GetMissionParam(sceneId, selfId, misIndex, 0) > 0 then	--²ì¿´ÈÎÎñÊÇ·ñÍê³É
		return 1
	end

	return 0
end

function x229007_OnLockedTarget(sceneId, selfId, objId )
	----PrintStr("OnLockedTarget...")
	if GetName(sceneId, objId) == x229007_g_Name  then
		return 0
	end
	
	-- ÅÐ¶ÏÊÇ²»ÊÇËø¶¨µÄNpc
	if IsHaveMission(sceneId, selfId, x229007_g_MissionId) > 0 then
		local misIndex = GetMissionIndexByID(sceneId,selfId,x229007_g_MissionId)		--µÃµ½ÈÎÎñÔÚ20¸öÈÎÎñÖÐµÄÐòÁÐºÅ
		local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
		
		local nNpcId, strNpcName, strNpcScene, PosX, PosZ, desc
		if missionType == x229007_g_SubMissionTypeEnum.KaiGuang then
			nNpcIndex = GetMissionParam(sceneId, selfId, misIndex, x229007_g_StrForePart+1)
			strNpcName = x229007_g_StrList[nNpcIndex+1]
		else
			nNpcId = GetMissionParam(sceneId, selfId, misIndex, x229007_g_StrForePart+1)
			nNpcId, strNpcName, strNpcScene, PosX, PosZ, desc = GetNpcInfoByNpcId(sceneId,nNpcId)
		end

		if GetName(sceneId, objId) == strNpcName then
			TAddNumText(sceneId,x229007_g_ScriptId,x229007_g_MissionName,4,-1,x229007_g_ScriptId);
		end

	end
	
	return 0;

end

function x229007_CheckCondition_UseItem( sceneId, selfId, targetId, eventId )
	------PrintStr("OnUseItem...")
	local misIndex = GetMissionIndexByID(sceneId, selfId, x229007_g_MissionId)

	--»ñµÃ¸ÃÈÎÎñµÄÈÎÎñÀàÐÍ
	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
	if missionType ~= x229007_g_SubMissionTypeEnum.DingDianYinDao then
		return 0
	end
	
	local index = GetMissionParam(sceneId, selfId, misIndex, 2)
	local targetSceneId = x229007_g_DingDianYinDaoList[index].scene
	--PrintNum(sceneId)
	if sceneId ~= targetSceneId then
		BeginEvent(sceneId)

			AddText(sceneId,"Hình nhß · ðây không ðßþc b¡n")

		EndEvent(sceneId)

		DispatchMissionTips(sceneId,selfId)

		return 0
	end
	
	local posx1 = x229007_g_DingDianYinDaoList[index].posx1
	local posz1 = x229007_g_DingDianYinDaoList[index].posz1
	local posx2 = x229007_g_DingDianYinDaoList[index].posx2
	local posz2 = x229007_g_DingDianYinDaoList[index].posz2

	--È¡µÃÍæ¼Òµ±Ç°×ø±ê

	local PlayerX = GetHumanWorldX(sceneId,selfId)

	local PlayerZ = GetHumanWorldZ(sceneId,selfId)

	
	--¼ÆËãÍæ¼ÒÓëÄ¿±êµãµÄ¾àÀë
	if PlayerX >= posx1 and PlayerX < posx2 then
		------PrintStr("PlayerX >= posx1 and PlayerX < posx2...")
		if PlayerZ >= posz1 and PlayerZ < posz2 then
			------PrintStr("PlayerZ >= posz1 and PlayerZ < posz2...")
			return 1
		end
	end	

	BeginEvent(sceneId)

		AddText(sceneId, "Chï ðßþc sØ døng trong khu vñc chï ð¸nh!")

	EndEvent(sceneId)

	DispatchMissionTips(sceneId,selfId)
	return 0

end

--**********************************
--µÀ¾ßÊ¹ÓÃ
--**********************************
function x229007_Active_UseItem( sceneId, selfId, param0 )
	local misIndex = GetMissionIndexByID(sceneId, selfId, x229007_g_MissionId)

	--»ñµÃ¸ÃÈÎÎñµÄÈÎÎñÀàÐÍ
	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
	if missionType ~= x229007_g_SubMissionTypeEnum.DingDianYinDao then
		return 0
	end
	
	local index = GetMissionParam(sceneId, selfId, misIndex, 2)
	if LuaFnGetAvailableItemCount(sceneId, selfId, x229007_g_DingDianYinDaoList[index].itemId) >= 1 then
		DelItem( sceneId, selfId, x229007_g_DingDianYinDaoList[index].itemId, 1 )
	--°ÑÈÎÎñ×´Ì¬±äÁ¿ÉèÖÃÎª1,±íÊ¾ÒÑ¾­Íê³É
	SetMissionByIndex(sceneId,selfId,misIndex,0,1)
	else
		BeginEvent(sceneId)
			AddText(sceneId, "V§t ph¦m cüa các hÕ hi®n không dùng ðßþc ho£c ðã b¸ khóa")
		EndEvent( )
		DispatchMissionTips(sceneId,selfId)	
		return	
	end		
end

--**********************************
--µÀ¾ß¸Ä±ä
--**********************************
function x229007_OnItemChanged( sceneId, selfId, itemdataId )
	----PrintStr("OnItemChanged")
	local misIndex = GetMissionIndexByID(sceneId, selfId, x229007_g_MissionId)

	--»ñµÃ¸ÃÈÎÎñµÄÈÎÎñÀàÐÍ
	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
	if missionType == x229007_g_SubMissionTypeEnum.XunWu then
		local _, strItemName, _ = x229007_GetItemDetailInfo(sceneId,itemdataId)
		local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229007_g_StrForePart+1)
		if demandItemId == nil or demandItemId < 0 then
			local strlog = "event_shimen_xingxiu::x229007_OnItemChanged..XunWu:sceneId="
				.. sceneId .. ",selfId=" .. selfId .. ",demandItemId=" .. type(demandItemId)
			MissionLog(sceneId, strlog)
			return
		end
		local _, strDemandItemName, _ = x229007_GetItemDetailInfo(sceneId,demandItemId)
		
		if strItemName == strDemandItemName then
			BeginEvent(sceneId)

				
				strText = format("Ðã ðÕt ðßþc %s", strItemName)
				AddText(sceneId,strText)
			EndEvent(sceneId)

			DispatchMissionTips(sceneId,selfId)
			SetMissionByIndex(sceneId,selfId,misIndex,0,1)
			ResetMissionEvent(sceneId, selfId, x229007_g_MissionId, 2)
		end
	elseif missionType == x229007_g_SubMissionTypeEnum.KaiGuang then
		local _, strItemName, _ = x229007_GetItemDetailInfo(sceneId,itemdataId)
		local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229007_g_StrForePart+2)
		if demandItemId == nil or demandItemId < 0 then
			local strlog = "event_shimen_xingxiu::x229007_OnItemChanged..KaiGuang:sceneId="
				.. sceneId .. ",selfId=" .. selfId .. ",demandItemId=" .. type(demandItemId)
			MissionLog(sceneId, strlog)
			return
		end
		
		local _, strDemandItemName, _ = x229007_GetItemDetailInfo(sceneId,demandItemId)
		
		if strItemName == strDemandItemName then
			BeginEvent(sceneId)
				strText = format("Ðã ðÕt ðßþc %s", strItemName)
				AddText(sceneId,strText)
			EndEvent(sceneId)
			DispatchMissionTips(sceneId,selfId)
			ResetMissionEvent(sceneId, selfId, x229007_g_MissionId, 2)
		end
		
	elseif missionType == x229007_g_SubMissionTypeEnum.ShouJi then
		local itemCount = GetItemCount(sceneId,selfId,itemdataId)
		local _, strItemName, _ = x229007_GetItemDetailInfo(sceneId,itemdataId)
		local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229007_g_StrForePart+2)
		if demandItemId == nil or demandItemId < 0 then
			local strlog = "event_shimen_xingxiu::x229007_OnItemChanged..ShouJi:sceneId="
				.. sceneId .. ",selfId=" .. selfId .. ",demandItemId=" .. type(demandItemId)
			MissionLog(sceneId, strlog)
			return
		end
		local _, strDemandItemName, _ = x229007_GetItemDetailInfo(sceneId,demandItemId)
		
		if strItemName == strDemandItemName then
			BeginEvent(sceneId)
				local _, strItemName, _ = x229007_GetItemDetailInfo(sceneId,itemdataId)
				strText = format("Ðã ðÕt ðßþc %s%d/5", strItemName, itemCount)
				AddText(sceneId,strText)
			EndEvent(sceneId)
			DispatchMissionTips(sceneId,selfId)
			
			if itemCount == 5 then
				SetMissionByIndex(sceneId,selfId,misIndex,0,1)
				ResetMissionEvent(sceneId, selfId, x229007_g_MissionId, 2)
			end	
		end
	elseif missionType == x229007_g_SubMissionTypeEnum.killMonster then
		local _, _, itemId = x229007_GetMenpaiYiWuInfo(sceneId, selfId)
		if itemdataId == itemId  then
			SetMissionByIndex(sceneId,selfId,misIndex,0,1)
			ResetMissionEvent(sceneId, selfId, x229007_g_MissionId, 0)
			ResetMissionEvent(sceneId, selfId, x229007_g_MissionId, 2)
		end
		
	end

end

--**********************************
--ÕäÊÞ¸Ä±ä
--**********************************
function x229007_OnPetChanged( sceneId, selfId, petDataId)
	----PrintStr("OnPetChanged...")
	local misIndex = GetMissionIndexByID(sceneId, selfId, x229007_g_MissionId)

	--»ñµÃ¸ÃÈÎÎñµÄÈÎÎñÀàÐÍ
	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
	if missionType == x229007_g_SubMissionTypeEnum.BuZhuo then
		local demandPetDataId = GetMissionParam(sceneId, selfId, misIndex, x229007_g_StrForePart+1)
		
		if petDataId == demandPetDataId then
			BeginEvent(sceneId)
				local strText = format("Ðã ðÕt ðßþc %s", GetPetName(petDataId))
				AddText(sceneId,strText)
			EndEvent(sceneId)

			DispatchMissionTips(sceneId,selfId)
			SetMissionByIndex(sceneId,selfId,misIndex,0,1)
			ResetMissionEvent(sceneId, selfId, x229007_g_MissionId, 3)
		end
	end
end
--**********************************
--Ìá½»
--**********************************
function x229007_OnSubmit( sceneId, selfId, targetId, selectRadioId )
	----PrintStr("OnSubmit...")
	local misIndex = GetMissionIndexByID(sceneId, selfId, x229007_g_MissionId)

	if x229007_CheckSubmit( sceneId, selfId, selectRadioId ) >= 1 then

		local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
		if missionType == x229007_g_SubMissionTypeEnum.XunWu then
			local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229007_g_StrForePart+1)
			--PrintStr("demandItemId"..demandItemId)
			if LuaFnGetAvailableItemCount(sceneId, selfId, demandItemId) >= 1 then
			local ret = DelItem(sceneId, selfId, demandItemId, 1)
			if ret <= 0 then
				BeginEvent(sceneId)
					AddText(sceneId, "Không ðü v§t ph¦m c¥n, nhi®m vø không th¬ giao")
				EndEvent()
				DispatchMissionTips(sceneId, selfId)
				return
			end
			else
				BeginEvent(sceneId)
					AddText(sceneId, "V§t ph¦m cüa các hÕ hi®n không dùng ðßþc ho£c ðã b¸ khóa")
				EndEvent( )
				DispatchMissionTips(sceneId,selfId)	
				return	
			end	
--		elseif missionType == x229007_g_SubMissionTypeEnum.killMonster then
--			local _, _, demandItemId  = x229007_GetMenpaiYiWuInfo(sceneId, selfId)
--			local ret = DelItem(sceneId, selfId, demandItemId, 1)
--			if ret <= 0 then
--				BeginEvent(sceneId)
--					AddText(sceneId, "Ã»ÓÐ×ã¹»µÄËùÐèÎïÆ·£¬ÈÎÎñÎÞ·¨Ìá½»")
--				EndEvent()
--				DispatchMissionTips(sceneId, selfId)
--				return
--			end
		elseif missionType == x229007_g_SubMissionTypeEnum.ShouJi then
			local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229007_g_StrForePart+2)
			if LuaFnGetAvailableItemCount(sceneId, selfId, demandItemId) >= 5 then
			local ret = DelItem(sceneId, selfId, demandItemId, 5)
			if ret <= 0 then
				BeginEvent(sceneId)
					AddText(sceneId, "Không ðü v§t ph¦m c¥n, nhi®m vø không th¬ giao")
				EndEvent()
				DispatchMissionTips(sceneId, selfId)
				return
			end
			else
				BeginEvent(sceneId)
					AddText(sceneId, "V§t ph¦m cüa các hÕ hi®n không dùng ðßþc ho£c ðã b¸ khóa")
				EndEvent( )
				DispatchMissionTips(sceneId,selfId)	
				return	
			end				
		end

		DelMission( sceneId, selfId, x229007_g_MissionId )
		--µ÷ÓÃÍ¨ÓÃÌá½»ÈÎÎñ½Ó¿Ú½Ó¿Ú

		------------------------------------------------------------------
		local Reward_Append, MissionRound = CallScriptFunction( 500501, "OnSubmit_Necessary", sceneId, selfId, targetId )
		if Reward_Append == 2 and MissionRound == 20 then
			CallScriptFunction(229010, "AddOtherMenpaiFubenMission", sceneId, selfId, x229007_g_MissionId, targetId)
		end
		-------------------------------------------------------------------

		--x229007_OnDefaultEvent( sceneId, selfId, targetId )
		
	end
end

function x229007_OnMissionCheck( sceneId, selfId, npcid, scriptId, index1, index2, index3, petindex )
  if x229007_CheckSubmit( sceneId, selfId) < 1 then
    return 0
  end
	--PrintStr("OnMissionCheck...")
	print(sceneId, selfId, npcid, scriptId, index1, index2, index3, petindex)
	local misIndex = GetMissionIndexByID(sceneId, selfId, x229007_g_MissionId)

	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
	if missionType == x229007_g_SubMissionTypeEnum.XunWu then
		local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229007_g_StrForePart+1)
		local _, strDemandItemName, _ = x229007_GetItemDetailInfo(sceneId,demandItemId)
		--PrintStr("strDemandItemName="..strDemandItemName)
		--µ÷ÓÃÍ¨ÓÃÌá½»ÈÎÎñ½Ó¿Ú½Ó¿Ú

		------------------------------------------------------------------

		local find = CallScriptFunction( 500501, "OnMissionCheck_NecessaryEx", sceneId, selfId, index1, index2, index3, demandItemId )

		-------------------------------------------------------------------


		if find < 0 then

			BeginEvent(sceneId)

				local strText = format("Sao ngß½i vçn chßa ðem %s v« ðßþc mà ðã quay v«?", strDemandItemName)
				AddText(sceneId,strText)
				AddItemBonus( sceneId, demandItemId, 1 )
			EndEvent(sceneId)

			DispatchEventList(sceneId,selfId,-1)

			return
		end
		
		local ret = EraseItem( sceneId, selfId, find )
		if	ret > 0 then

			DelMission( sceneId, selfId, x229007_g_MissionId )

			--µ÷ÓÃÍ¨ÓÃÌá½»ÈÎÎñ½Ó¿Ú½Ó¿Ú

			------------------------------------------------------------------
			local Reward_Append, MissionRound = CallScriptFunction( 500501, "OnSubmit_Necessary", sceneId, selfId, -1 )
			if Reward_Append == 2 and MissionRound == 20 then
				CallScriptFunction(229010, "AddOtherMenpaiFubenMission", sceneId, selfId, x229007_g_MissionId)
			end
			-------------------------------------------------------------------

		else
			BeginEvent(sceneId)

				local strText = format("Sao ngß½i vçn chßa ðem %s v« ðßþc mà ðã quay v«?", strDemandItemName)
				AddText(sceneId,strText)
				AddItemBonus( sceneId, demandItemId, 1 )
			EndEvent(sceneId)

			DispatchEventList(sceneId,selfId,-1)
		end	
	elseif missionType == x229007_g_SubMissionTypeEnum.BuZhuo then
		----PrintStr("OnMissionCheck...BuZhuo...")
		local demandPetId = GetMissionParam(sceneId, selfId, misIndex, x229007_g_StrForePart+1)
		local petId = LuaFnGetPet_DataID(sceneId, selfId, petindex)
		if petId == demandPetId then
			if LuaFnIsPetAvailable(sceneId, selfId, petindex) >= 1 then
				LuaFnDeletePet(sceneId, selfId, petindex)
				----PrintStr("DeletePet"..petId..demandPetId)
				DelMission( sceneId, selfId, x229007_g_MissionId )

				--µ÷ÓÃÍ¨ÓÃÌá½»ÈÎÎñ½Ó¿Ú½Ó¿Ú

				------------------------------------------------------------------
				local Reward_Append, MissionRound = CallScriptFunction( 500501, "OnSubmit_Necessary", sceneId, selfId, -1 )
				if Reward_Append == 2 and MissionRound == 20 then
					CallScriptFunction(229010, "AddOtherMenpaiFubenMission", sceneId, selfId, x229007_g_MissionId)
				end
				-------------------------------------------------------------------
			end	
		else
			BeginEvent(sceneId)
				AddText(sceneId, "Sao ngß½i vçn chßa ðem trân thú mà ta c¥n v« ðßþc mà ðã quay v«?")
				AddItemBonus( sceneId, demandItemId, 1 )
			EndEvent(sceneId)

			DispatchEventList(sceneId,selfId,-1)

		end

	end -- endif
	
end

--**********************************
--É±ËÀ¹ÖÎï»òÍæ¼Ò
--**********************************
function x229007_OnKillObject( sceneId, selfId, objdataId ,objId)--²ÎÊýÒâË¼£º³¡¾°ºÅ¡¢Íæ¼ÒobjId¡¢¹ÖÎï±íÎ»ÖÃºÅ¡¢¹ÖÎï
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229007_g_MissionId)
	local nMonsterId = GetMissionParam(sceneId, selfId, misIndex, x229007_g_StrForePart+3)
	local _, strMonsterName = GetNpcInfoByNpcId(sceneId,nMonsterId)
	local monsterName = GetMonsterNamebyDataId(objdataId)
	
	if strMonsterName == monsterName  then
		local num = GetMonsterOwnerCount(sceneId,objId)
		for i=0,num-1  do
			-- È¡µÃÓµÓÐ·ÖÅäÈ¨µÄÈËµÄobjId
			local humanObjId = GetMonsterOwnerID(sceneId,objId,i)
			--PrintStr("humanObjId=" .. humanObjId)
			-- ¿´Õâ¸öÈËÊÇ²»ÊÇÓÐÕâ¸öÈÎÎñ
			if IsHaveMission(sceneId, humanObjId, x229007_g_MissionId) > 0 then
				-- ÏÈÅÐ¶ÏÊÇ²»ÊÇÒÑ¾­Âú×ãÁËÍê³É±êÖ¾
				local misIndex = GetMissionIndexByID(sceneId,humanObjId,x229007_g_MissionId)
				if GetMissionParam(sceneId, humanObjId, misIndex, 0) <=0  then
					--SetMissionParamByIndexEx(sceneId, humanObjId, misIndex, 3, 0, 30)
					local demandKillCount = GetMissionParamEx(sceneId, humanObjId, misIndex, 3, 0)
					--PrintStr("demandKillCount=" .. demandKillCount)
					local killedCount =	GetMissionParamEx(sceneId, humanObjId, misIndex, 3, 1)
					killedCount = killedCount + 1
					SetMissionParamByIndexEx(sceneId, humanObjId, misIndex, 3, 1, killedCount)
					--PrintStr("killedCount=" .. killedCount)
					BeginEvent(sceneId)
						local str = format("Ðã giªt chªt %d/%d%s", killedCount, demandKillCount, monsterName)
						AddText(sceneId, str)
					EndEvent()
					DispatchMissionTips(sceneId, humanObjId)
					if killedCount == demandKillCount then
						SetMissionByIndex(sceneId, humanObjId, misIndex, 0, 1)
		end
				end --if
			end --if
		end --for				
	end

end


--**********************************
--Í¬ÃÅÏàÖú....Ö±½ÓÍê³Éµ±Ç°»·....
--**********************************
function x229007_HelpFinishOneHuan( sceneId, selfId, targetId )

	--ÊÇ·ñÊÇ±¾ÃÅÅÉµÜ×Ó....
	if MP_XINGSU ~= GetMenPai( sceneId, selfId ) then
		return
	end

	--ÊÇ·ñ½ÓÁËÊ¦ÃÅÈÎÎñ....
	if IsHaveMission(sceneId,selfId,x229007_g_MissionId) <= 0 then
		return
	end

	--¼ì²â²¢¿Û³ýÍ¬ÃÅÏàÖúËùÐèµÄÊ¦ÃÅ¹±Ï×....
	local ret = CallScriptFunction( 229011, "CheckAndDepleteHelpFinishMenPaiPoint", sceneId, selfId, targetId )
	if ret == 0 then
		return
	end

	--»ñÈ¡Ê¦ÃÅÈÎÎñµÄÀàÐÍ....
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229007_g_MissionId)
	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)

	--Çå³ýÈÎÎñÎïÆ·....
	local itemId = -1
	local itemCount = -1

	if missionType == x229007_g_SubMissionTypeEnum.SongXin then
		itemId = GetMissionParam(sceneId, selfId, misIndex,x229007_g_StrForePart+3)
		itemCount = LuaFnGetAvailableItemCount(sceneId, selfId, itemId)
		if itemCount >= 1 then
			DelItem(sceneId, selfId, itemId, 1)
		end
	elseif missionType == x229007_g_SubMissionTypeEnum.DingDianYinDao	then
		local index = GetMissionParam(sceneId, selfId, misIndex,2)
		itemId = x229007_g_DingDianYinDaoList[index].itemId
		itemCount = LuaFnGetAvailableItemCount(sceneId, selfId, itemId)
		if itemCount >= 1 then
			DelItem(sceneId, selfId, itemId, 1)	
		end
	elseif missionType == x229007_g_SubMissionTypeEnum.ShouJi then
		itemId = GetMissionParam(sceneId, selfId, misIndex, x229007_g_StrForePart+2)
		itemCount = LuaFnGetAvailableItemCount(sceneId, selfId, itemId)
		if itemCount > 5 then
			itemCount = 5
		end
		if itemCount > 0 then
			DelItem(sceneId, selfId, itemId, itemCount)
		end
	end

	--É¾³ýÍæ¼ÒÈÎÎñÁÐ±íÖÐ¶ÔÓ¦µÄÈÎÎñ....
	DelMission( sceneId, selfId, x229007_g_MissionId )

	--µ÷ÓÃÍ¨ÓÃÌá½»ÈÎÎñ½Ó¿Ú½Ó¿Ú....
	local Reward_Append, MissionRound = CallScriptFunction( 500501, "OnSubmit_Necessary", sceneId, selfId, targetId, 1 )

	if Reward_Append == 2 and MissionRound == 20 then
		--½±ÀøÍæ¼ÒÒ»¸öÈ¥±ðµÄÃÅÅÉ¸±±¾µÄÊ¦ÃÅÈÎÎñ....
		CallScriptFunction(229010, "AddOtherMenpaiFubenMission", sceneId, selfId, x229007_g_MissionId, targetId)
	end

end
