 -- ¶√≈»ŒŒÒ

--MisDescBegin
--Ω≈±æ∫≈
x229000_g_ScriptId = 229000

--Ω” ‹»ŒŒÒNPC Ù–‘
x229000_g_Position_X=96.0000
x229000_g_Position_Z=82.0000
x229000_g_SceneID=9
x229000_g_AccomplishNPC_Name="TuÆ PhﬂΩng"

--«∞Ã·»ŒŒÒ
--g_MissionIdPre =

--»ŒŒÒƒø±Ínpc
x229000_g_Name	= "TuÆ PhﬂΩng"

--»ŒŒÒ∫≈
x229000_g_MissionId = 1060

--»ŒŒÒπÈ¿‡
x229000_g_MissionKind = 20

--»ŒŒÒµ»º∂
x229000_g_MissionLevel = 10000

-- «∑Ò «æ´”¢»ŒŒÒ
x229000_g_IfMissionElite = 0

--œ¬√Êº∏œÓ «∂ØÃ¨œ‘ æµƒƒ⁄»›£¨”√”⁄‘⁄»ŒŒÒ¡–±Ì÷–∂ØÃ¨œ‘ æ»ŒŒÒ«Èøˆ**********************
--»ŒŒÒ «∑Ò“—æ≠ÕÍ≥…
x229000_g_IsMissionOkFail = 0		--±‰¡øµƒµ⁄0Œª

--“‘…œ «∂ØÃ¨**************************************************************

--»ŒŒÒ±‰¡øµ⁄“ªŒª”√¿¥¥Ê¥¢ÀÊª˙µ√µΩµƒΩ≈±æ∫≈

--»ŒŒÒŒƒ±æ√Ë ˆ
x229000_g_MissionName="NhiÆm v¯ sﬂ mÙn"
x229000_g_MissionInfo=""  --»ŒŒÒ√Ë ˆ
x229000_g_MissionTarget = "%f"
x229000_g_ContinueInfo="L‡m tØt l°m"		--Œ¥ÕÍ≥…»ŒŒÒµƒnpc∂‘ª∞
x229000_g_MissionComplete="ViÆc ta giao „ ho‡n th‡nh chﬂa?"					--ÕÍ≥…»ŒŒÒnpcÀµª∞µƒª∞
x229000_g_MissionRound=17

x229000_g_DoubleExp = 48
x229000_g_AccomplishCircumstance = 1

x229000_g_ShimenTypeIndex = 1
x229000_g_Parameter_Kill_AllRandom={{id=7,numa=3,numb=3,bytenuma=0,bytenumb=1}}
x229000_g_Parameter_Item_IDRandom={{id=6,num=5}}
x229000_g_NpcIdIndicator={{key=2,npcIdIndex=5},{key=9,npcIdIndex=7}}

--”√¿¥±£¥Ê◊÷∑˚¥Æ∏Ò ΩªØµƒ ˝æ›
x229000_g_FormatList = {
								"L‚u l°m khÙng g£p %n r∞i, nhæ qu· i. –‚y %s ch˙t lÚng th‡nh c¸a ta, xin ngﬂΩi h„y ﬂa tæi gi˙p ta. #R #e00f000Nh°c nhˆ: #e000000#r NgﬂΩi cÛ th¨ ™n Thi™u L‚m TÒ tÏm#R TuÆ Lu‚n #W#{_INFOAIM92,132,9, TuÆ Lu‚n?}, h„y nh∂ Ùng ta ﬂa ngﬂΩi tæi c·c th‡nh th∏ læn.",
								"%i c¸a ta sao khÙng th§y ‚u? N™u ngﬂΩi cÛ th¨ gi˙p ta tÏm l’i, ta s® khÙng b’c „i ngﬂΩi. #R #e00f000Nh°c nhˆ: #e000000#r NgﬂΩi cÛ th¨ ™n Thi™u L‚m TÒ tÏm#R TuÆ Lu‚n #W#{_INFOAIM92,132,9, TuÆ Lu‚n}, h„y nh∂ Ùng ta ﬂa ngﬂΩi tæi c·c th‡nh th∏ læn.",
								"%n l‡m i´u ·c, ta ph‰i i d’y b‰o, ·ng ti™c khÙng cÛ th∂i gian, ngﬂΩi cÛ th¨ l‡m thay ﬂ˛c khÙng? #R #e00f000Nh°c nhˆ: #e000000#r NgﬂΩi cÛ th¨ ™n Thi™u L‚m TÒ tÏm#R TuÆ Lu‚n #W#{_INFOAIM92,132,9, TuÆ Lu‚n}, h„y nh∂ Ùng ta ﬂa ngﬂΩi tæi c·c th‡nh th∏ læn.",
								"Xin ngﬂΩi h„y d˘ng %s, quÈt d˜n Thi™u L‚m TÒ %s c¸a %s. #R #e00f000Nh°c nhˆ: #e000000#r khi ngﬂΩi tæi khu c•n quÈt d˜n, §n #gfff0f0Alt+A#g000000cÛ th¨ m∑ m¯c vßt ph¶m, §n v‡o#gfff0f0\"nhiÆm v¯\"#g000000 giao diÆn cÛ th¨ m∑ ra m¯c vßt ph¶m nhiÆm v¯, nh§p phÌm ph‰i#gfff0f0 Ch≤i quÈt#g000000, l‡ cÛ th¨ ho‡n th‡nh quÈt d˜n.",
								"Xin ngﬂΩi h„y i tÏm th§y %s, Ùng ta s® ﬂa ngﬂΩi i thÿ chi™n %s. #R #e00f000Nh°c nhˆ: #e000000#r Huy´n Tr◊ng ’i sﬂ ∑ Thi™u L‚m TÒ #{_INFOAIM61,62,9, Huy´n Tr◊ng}. ",
								"Xin ngﬂΩi h„y b°t cho ta mµt con %p v´. #R #e00f000Nh°c nhˆ: #e000000#r V‚n H‡m Nhi ∑ th‡nh L’c DﬂΩng #{_INFOAIM183,155,0, V‚n H‡m Nhi} cÛ th¨ ﬂa ngﬂΩi tæi Huy´n V˚ –‰o, nhﬂng Huy´n V˚ –‰o cÛ 1 con ﬂ∂ng mÚn thÙng qua Th·nh Th˙ SΩn. NgﬂΩi cÛ th¨ b°t tr‚n th˙ m‡ ta c•n ∑ Huy´n V˚ –‰o ho£c ∑ Th·nh Th˙ SΩn.",
								"Xin ngﬂΩi h„y ∑ Thi™u L‚m TÒ tÏm ki™m 4 phﬂΩng, tÏm cho ta 5 %s. #R #e00f000Nh°c nhˆ: #e000000#r NgﬂΩi cÛ th¨ tÏm th§y n˙t v‡ng trong b‰n ∞ nhˆ ∑ gÛc ph‰i m‡n hÏnh.",
								"H„y ﬂa %s tæi 1 c·i %i, l‡m xong, ta s® hßu thﬂ∑ng cho ngﬂΩi! #R #e00f000Nh°c nhˆ: #e000000#r Phan ThiÍn Canh sﬂ huynh ∑ Thi™u L‚m TÒ{_INFOAIM70,105,9,Phan ThiÍn Canh}. #R VÆ ThiÍn V˜ng ∑ Thi™u L‚m TÒ{_INFOAIM61,57,9, VÆ ThiÍn V˜ng}. #R PhﬂΩng ThiÍn Lao sﬂ huynh ∑ Thi™u L‚m TÒ{_INFOAIM123,88,9, PhﬂΩng ThiÍn Lao}. ",
								"Kh· l°m...... ó b±n mÙn ta, ngﬂΩi luÙn ph·t dﬂΩng quang ’i, tßn t‚m tßn lÒc, c•n c˘ l‡m viÆc. Ta s® giao cho ngﬂΩi 1 nhiÆm v¯ kh·c. %s v◊a d˘ng b∞ c‚u ﬂa thﬂ cho ta nÛi h˜ c•n gi˙p ﬁ, ngﬂΩi h„y i tÏm %s %s, Ùng ta s® s°p x™p nhiÆm v¯ c¸a ngﬂΩi",
								"–i gi™t ch™t %s %s %n.",
							}

--∏Ò Ω◊÷∑˚¥Æ÷–µƒÀ˜“˝, ±Ì æ¥”4ø™ º,∫Û∂‡…ŸŒª ”SetMissionByIndex(...)µƒ∂‡…Ÿ∂¯∂®
x229000_g_StrForePart=4
x229000_g_ShimenPet_Index = 1

x229000_g_StrList = {
						"–’i T‰o Trÿu (chi™c ch≤i læn)",
						"–’i H˘ng B‰o –iÆn",
						"T‡ng Kinh C·c",
						"SΩn mÙn",
						"Chung l•u",
						"Huy´n TrÏnh",
						"Th·p L‚m ph¯ b‰n",
						"C¸i t‰n m·t",
						"N§m t‰n m·t",
						"Qu‰ t˘ng t‰n m·t",
						"Phan ThiÍn Canh",
						"VÆ ThiÍn V˜ng",
						"PhﬂΩng ThiÍn Lao",
						"S‡i MiÍu D„ Sinh",
						"M£t §t",
						"B‰n Tﬂæng", 
						"M’nh Thanh Thanh ",
						"Phßt Ñn", 
						"PhﬂΩng L’p", 
						"C˙c Ki™m", 
						"L‚m Linh TØ",
						"Ph˘ng A Tam",
						"H∞ng Ng˜c", 
						"Th·p ™ ph¯ b‰n",
						"–‡o Hoa Trßn ph¯ b‰n",
						"Ph¯ b‰n h•m rﬂ˛u ",
						"Quang Minh µng ph¯ b‰n",
						"Chi™t Mai Phong ph¯ b‰n",
						"Linh TÌnh Phong ph¯ b‰n",
						"CØc –∏a ph¯ b‰n",
						"Ng˚ Th•n –µng ph¯ b‰n", 
						"Thi™u L‚m",
						"ThiÍn Long",
						"Nga My",
						"C·i Bang",
						"Minh Gi·o",
						"ThiÍn SΩn",
						"Vı –ang",
						"TiÍu Dao",
						"Tinh T˙c",
						"0",
						"1",
						"2",
						"3",
						"4",
						"5",
						"6",
						"7",
						"8",
						"9",
						}
						
--MisDescEnd


--/////////////////////////////////////////////////////////////////////////////////////////////////////

--◊”»ŒŒÒµƒ¿‡–Õ¥˙∫≈∂®“Â
x229000_g_SubMissionTypeEnum = {XunWu=1, SongXin=2, DingDianYinDao=3, FuBenZhanDou=4, BuZhuo=5, ShouJi=6, KaiGuang=7, otherMenpaiFuben=8, killMonster=9, }

--∂®µ„“˝µº
x229000_g_DingDianYinDaoList = {
											 {menpai=MP_SHAOLIN  , itemId=40002124, itemName="–’i T‰o Trÿu (chi™c ch≤i læn)", scene=9, AreaName="–’i H˘ng B‰o –iÆn", subAreaName="M£t §t", posx1=84, posz1=64, posx2=108, posz2=86},
											 {menpai=MP_SHAOLIN  , itemId=40002124, itemName="–’i T‰o Trÿu (chi™c ch≤i læn)", scene=9, AreaName="T‡ng Kinh C·c", subAreaName="M£t §t", posx1=122, posz1=132, posx2=146, posz2=159},
											 {menpai=MP_SHAOLIN  , itemId=40002124, itemName="–’i T‰o Trÿu (chi™c ch≤i læn)", scene=9, AreaName="SΩn mÙn", subAreaName="M£t §t", posx1=89, posz1=110, posx2=102, posz2=137},
											 {menpai=MP_SHAOLIN  , itemId=40002124, itemName="–’i T‰o Trÿu (chi™c ch≤i læn)", scene=9, AreaName="Chung l•u", subAreaName="M£t §t", posx1=54, posz1=52, posx2=83, posz2=71},
											}


--∏±±æ¡–±Ì
x229000_g_FuBen_List = {
								{menpainame="Thi™u L‚m", menpai=MP_SHAOLIN  , NpcName="Huy´n TrÏnh", scene=9, posx=61, posz=61, FubenName="Th·p L‚m ph¯ b‰n"},
								{menpainame="ThiÍn Long", menpai=MP_DALI     , NpcName="B‰n Tﬂæng", scene=13, posx=35, posz=86, FubenName="Th·p ™ ph¯ b‰n"},
								{menpainame="Nga My", menpai=MP_EMEI     , NpcName="M’nh Thanh Thanh ", scene=15, posx=96, posz=73, FubenName="–‡o Hoa Trßn ph¯ b‰n"},
								{menpainame="C·i Bang", menpai=MP_GAIBANG  , NpcName="Phßt Ñn", scene=10, posx=41, posz=144, FubenName="Ph¯ b‰n h•m rﬂ˛u "},
								{menpainame="Minh Gi·o", menpai=MP_MINGJIAO , NpcName="PhﬂΩng L’p", scene=11, posx=89, posz=56, FubenName="Quang Minh µng ph¯ b‰n"},
								{menpainame="ThiÍn SΩn", menpai=MP_TIANSHAN , NpcName="C˙c Ki™m", scene=17, posx=99, posz=45, FubenName="Chi™t Mai Phong ph¯ b‰n"},
								{menpainame="Vı –ang", menpai=MP_WUDANG   , NpcName="L‚m Linh TØ", scene=12, posx=58, posz=73, FubenName="Linh TÌnh Phong ph¯ b‰n"},
								{menpainame="TiÍu Dao", menpai=MP_XIAOYAO  , NpcName="Ph˘ng A Tam", scene=14, posx=62, posz=68, FubenName="CØc –∏a ph¯ b‰n"},
								{menpainame="Tinh T˙c", menpai=MP_XINGSU   , NpcName="H∞ng Ng˜c", scene=16, posx=128, posz=78, FubenName="Ng˚ Th•n –µng ph¯ b‰n"},
								}       

-- ’ºØ
x229000_g_ShouJiList = {
								{menpai=MP_SHAOLIN  , scene=9, itemId=40002125, itemName="C¸i t‰n m·t"},-- count=5},
								{menpai=MP_SHAOLIN  , scene=9, itemId=40002126, itemName="N§m t‰n m·t"},-- count=5},
								{menpai=MP_SHAOLIN  , scene=9, itemId=40002127, itemName="Qu‰ t˘ng t‰n m·t"},-- count=5},
							}	



--ÀÕ…˙ªÓººƒ‹npc¡–±Ì
x229000_g_AbilityNpcList = {
										{menpai=MP_SHAOLIN  ,npcList={{name="Phan ThiÍn Canh", scene=9, x=70, z=105},
																					 				{name="VÆ ThiÍn V˜ng", scene=9, x=61, z=57},
																					 				{name="PhﬂΩng ThiÍn Lao", scene=9, x=123, z=88}}
										},
									}

										
--≤∂ ﬁ¡–±Ì
x229000_g_PetList = {
						{petDataId=3000, petName="S‡i MiÍu D„ Sinh", takeLevel=10},
					}


--…±π÷œ‡πÿ
x229000_g_MenpaiYiWuList = {
								{menpainame="Thi™u L‚m", menpai=MP_SHAOLIN  , itemName="–µ iÆp c¸a Thi™u L‚m Æ tÿ", scene=9,  itemId=40004306},
								{menpainame="ThiÍn Long", menpai=MP_DALI     , itemName="Ñn chﬂΩng c¸a ThiÍn Long Æ tÿ", scene=13, itemId=40004312},
								{menpainame="Nga My", menpai=MP_EMEI     , itemName="Ki™m tuÆ c¸a Nga My Æ tÿ", scene=15, itemId=40004310},
								{menpainame="C·i Bang", menpai=MP_GAIBANG  , itemName="T˙i v‰i c¸a C·i Bang Æ tÿ", scene=10, itemId=40004307},
								{menpainame="Minh Gi·o", menpai=MP_MINGJIAO , itemName="Hˆa lÆnh c¸a Minh Gi·o Æ tÿ", scene=11, itemId=40004308},
								{menpainame="ThiÍn SΩn", menpai=MP_TIANSHAN , itemName="BÂng b‡i c¸a ThiÍn SΩn Æ tÿ", scene=17, itemId=40004314},
								{menpainame="Vı –ang", menpai=MP_WUDANG   , itemName="Ph§t tr•n c¸a Vı –ang Æ tÿ", scene=12, itemId=40004309},
								{menpainame="TiÍu Dao", menpai=MP_XIAOYAO  , itemName="TiÍu trÏ c¸a TiÍu Dao Æ tÿ", scene=14, itemId=40004313},
								{menpainame="Tinh T˙c", menpai=MP_XINGSU   , itemName="C± m„nh c¸a Tinh T˙c Æ tÿ", scene=16, itemId=40004311},
							}
	
--π÷ŒÔµÙ¬‰“≈ŒÔµƒº∏¬ ≈‰÷√±Ì
x229000_g_RateOfDropYiWuTable = {
							{playerLevel=20, dropRate=30},
							{playerLevel=30, dropRate=30},
							{playerLevel=40, dropRate=25},
							{playerLevel=50, dropRate=25},
							{playerLevel=60, dropRate=25},
							{playerLevel=70, dropRate=20},
							{playerLevel=80, dropRate=20},
							{playerLevel=90, dropRate=20},
							{playerLevel=100, dropRate=20},
							{playerLevel=110, dropRate=20},
							{playerLevel=120, dropRate=20},
							{playerLevel=130, dropRate=20},
							{playerLevel=140, dropRate=20},
							{playerLevel=150, dropRate=20},
						}
 
x229000_g_DemandKillcountTable = 	{
							{levelBegin=10, levelEnd=19, killcount=20},
							{levelBegin=20, levelEnd=39, killcount=25},
							{levelBegin=40, levelEnd=59, killcount=30},
							{levelBegin=60, levelEnd=79, killcount=35},
							{levelBegin=80, levelEnd=99, killcount=40},
							{levelBegin=100, levelEnd=109, killcount=45},
							{levelBegin=110, levelEnd=119, killcount=50},
							{levelBegin=120, levelEnd=150, killcount=55},
}						


x229000_g_Xin_ItemId = 40002115

--//////////////////////////////////////////////////////
--…±π÷œ‡πÿ
function x229000_GetMenpaiYiWuInfo(sceneId, selfId)
	for i, v in x229000_g_MenpaiYiWuList do
		if v.menpai == GetMenPai(sceneId, selfId) then
			return v.menpainame, v.itemName, v.itemId
		end
	end
end

function x229000_GetRateOfDropYiWu(sceneId, selfId)
	local playerLevel = GetLevel(sceneId, selfId)
	for i, v in x229000_g_RateOfDropYiWuTable do
		if v.playerLevel >= playerLevel and playerLevel < v.playerLevel then
			return v.dropRate
		end
	end
end

function x229000_GetDemandKillCount(sceneId, selfId)
	local playerLevel = GetLevel(sceneId, selfId)
	for i, v in x229000_g_DemandKillcountTable do
		if playerLevel >= v.levelBegin and playerLevel <= v.levelEnd then
			return v.killcount
		end
	end
end

function x229000_KillMonster_Accept(sceneId, selfId)--…±π÷
	--PrintStr("KillMonster_Accept...")
	local nMonsterId, strMonsterName, strMonsterScene, nScene, nPosX, nPosZ, strDesc, nSex, level
	local playerLevel = GetLevel(sceneId, selfId)
	for i=1, 100 do
		nMonsterId, strMonsterName, strMonsterScene, nScene, nPosX, nPosZ, strDesc, nSex, level = GetOneMissionNpc(43)
		if abs(playerLevel - level) <= 3 then
			break
		end
		if i == 100 then
			--Õ≥Õ≥ÀÕ–≈»•:((
			x229000_SongXin_Accept(sceneId, selfId)
			return
		end
	end	
	
	--º”»Î»ŒŒÒµΩÕÊº“¡–±Ì
	local bAdd = AddMission( sceneId,selfId, x229000_g_MissionId, x229000_g_ScriptId, 1, 0, 1 )
	if bAdd < 1 then
		return
	end	
	local killcount = x229000_GetDemandKillCount(sceneId, selfId)
	
	local countpart1 = x229000_GetStrIndexByStrValue(tostring(floor(killcount / 10)) )
	local countpart2 = x229000_GetStrIndexByStrValue(tostring(floor(mod(killcount, 10))) )
	
	--µ√µΩ»ŒŒÒ‘⁄20∏ˆ»ŒŒÒ÷–µƒ–Ú¡–∫≈
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229000_g_MissionId)
	
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --…Ë÷√»ŒŒÒ «∑ÒÕÍ≥…£®Œ¥ÕÍ≥…£©
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229000_g_SubMissionTypeEnum.killMonster)
	
	SetMissionParamByIndexEx(sceneId, selfId, misIndex, 3, 0, killcount) --“™«Û…±À¿µƒmonster◊‹ ˝£¨ œ÷‘⁄ªπ√ª”–∏≥÷µ
	SetMissionParamByIndexEx(sceneId, selfId, misIndex, 3, 1, 0) --“—æ≠…±À¿µƒmonster ˝¡ø

	SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart, 9)--formet◊÷∑˚¥ÆÀ˜“˝
	SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart+1, countpart1)
	SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart+2, countpart2)
	SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart+3, nMonsterId)
		
	Msg2Player(  sceneId, selfId,"#YNhßn nhiÆm v¯#W: NhiÆm v¯ sﬂ mÙn", MSG2PLAYER_PARA )
	CallScriptFunction( SCENE_SCRIPT_ID, "AskThePos", sceneId, selfId, nScene, nPosX, nPosZ, strMonsterName)
	
	local strMissionTarget = format("G•n ‚y ∑ khu vÒc %s %s thﬂ∂ng qu§y nhi≠u cﬂ d‚n xung quanh, ngﬂΩi h„y nhßn lÆnh i tr◊ng ph’t ch˙ng", 
						strMonsterScene, strMonsterName)
	--PrintStr(strMissionTarget)	
	AddText(sceneId, strMissionTarget)

end

--//////////////////////////////////////////////////////
function x229000_GetStrIndexByStrValue(stringV)
	for i, v in x229000_g_StrList do
		if v == stringV then
			return i-1
		end
	end
	local strText = format("C•n ph‰i %s Âng kÌ StrList trong", stringV)
	--PrintStr(strText)
	return 0;
end
--/////////////////////////////////////////////////////////////////////////////////////////////////////
-- «∑Ò «∏±±æ»ŒŒÒ
function x229000_IsFubenMission(sceneId,selfId, targetId)
	local shimenMissionIdList = {1080, 1090, 1065, 1070, 1060, 1100, 1075, 1085, 1095}
	for i, v in shimenMissionIdList do
		if IsHaveMission(sceneId,selfId,v) > 0	 then
			local	misIndex = GetMissionIndexByID(sceneId,selfId,v)			--µ√µΩ»ŒŒÒµƒ–Ú¡–∫≈
			local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
			if missionType == x229000_g_SubMissionTypeEnum.FuBenZhanDou then
				local bComplete = GetMissionParam( sceneId, selfId, misIndex, 0)
				if bComplete ~= 0 then
					return 0
				else	
					return 1				
				end
			elseif	missionType == x229000_g_SubMissionTypeEnum.otherMenpaiFuben then
				local misIndex = GetMissionIndexByID(sceneId,selfId,v)
				local bComplete = GetMissionParam( sceneId, selfId, misIndex, 0)
				local npcStrIndex = GetMissionParam( sceneId, selfId, misIndex, x229000_g_StrForePart+2)
				local npcName = CallScriptFunction(229010, "GetStrValueByStrIndex",sceneId, npcStrIndex)
				if GetName(sceneId, targetId) == npcName then
					if bComplete ~= 0 then
						return 0
					else	
						return 1				
					end
				end
			end
		end
	end
	return 0
end

-- «∑Ò «∏±±æ»ŒŒÒ
function x229000_SetFubenMissionSucc(sceneId,selfId, targetId)
	local shimenMissionIdList = {1080, 1090, 1065, 1070, 1060, 1100, 1075, 1085, 1095}
	for i, v in shimenMissionIdList do
		if IsHaveMission(sceneId,selfId,v) > 0	 then
			local	misIndex = GetMissionIndexByID(sceneId,selfId,v)			--µ√µΩ»ŒŒÒµƒ–Ú¡–∫≈
			local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
			if missionType == x229000_g_SubMissionTypeEnum.FuBenZhanDou then
				local misIndex = GetMissionIndexByID(sceneId,selfId,v)
				SetMissionByIndex(sceneId,selfId,misIndex,0,1)						--∏˘æ›–Ú¡–∫≈∞—»ŒŒÒ±‰¡øµƒµ⁄0Œª÷√0 (»ŒŒÒÕÍ≥…«Èøˆ)				
			elseif	missionType == x229000_g_SubMissionTypeEnum.otherMenpaiFuben then
				local misIndex = GetMissionIndexByID(sceneId,selfId,v)
				local npcStrIndex = GetMissionParam( sceneId, selfId, misIndex, x229000_g_StrForePart+2)
				local npcName = CallScriptFunction(229010, "GetStrValueByStrIndex",sceneId, npcStrIndex)
				if GetName(sceneId, targetId) == npcName then
					local misIndex = GetMissionIndexByID(sceneId,selfId,v)
					SetMissionByIndex(sceneId,selfId,misIndex,0,1)						--∏˘æ›–Ú¡–∫≈∞—»ŒŒÒ±‰¡øµƒµ⁄0Œª÷√0 (»ŒŒÒÕÍ≥…«Èøˆ)
				end
			end
		end
	end
end

-- «∑Ò «≤…ºØ»ŒŒÒ
function x229000_IsCaiJiMission(sceneId,selfId, missionId, itemId)
	local	misIndex = GetMissionIndexByID(sceneId,selfId,missionId)			--µ√µΩ»ŒŒÒµƒ–Ú¡–∫≈
	if	IsHaveMission(sceneId,selfId,missionId) > 0	 then
		local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
		if missionType == x229000_g_SubMissionTypeEnum.ShouJi then
			local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229000_g_StrForePart+2)
			local itemCount = GetItemCount(sceneId,selfId,demandItemId)
			if itemCount == 5 then
				return 0
			end
			if demandItemId == itemId then
				return 1
			end
		end
	end
	
	BeginEvent(sceneId)
		AddText(sceneId, "C·c h’ vÁn chﬂa nhßn nhiÆm v¯ b±n ph·i, khÙng th¨ thu thßp")
	EndEvent( )
	DispatchMissionTips(sceneId,selfId)
	
	return 0
end
--/////////////////////////////////////////////////////////////////////////////////////////////////////
--ªÒ»°æﬂÃÂitemµƒœÍœ∏–≈œ¢
function x229000_GetItemDetailInfo(itemId)
	local itemId, itemName, itemDesc = GetItemInfoByItemId(itemId)
	if itemId == -1 then
		local strText = format("%s Vßt ph¶m ∑ 'MissionItem_HashTable.txt' khÙng tÏm th§y!!", itemName)
		PrintStr(strText)
	end
	return itemId, itemName, itemDesc
end	
--/////////////////////////////////////////////////////////////////////////////////////////////////////
--∏˘æ›ÕÊº“µ»º∂µ√µΩ∂‘”¶MissionItem_HashTable.txt÷–µƒµ•‘™À˜“˝
function x229000_GetMissionItemIndex(sceneId, selfId)
	local nPlayerLevel  = GetLevel(sceneId, selfId)
	if nPlayerLevel >= 10 and nPlayerLevel < 20 then
		return 0;
	elseif nPlayerLevel >= 20 and nPlayerLevel < 30 then
		return 1;
	elseif nPlayerLevel >= 30 and nPlayerLevel < 40 then
		return 2;
	elseif nPlayerLevel >= 40 and nPlayerLevel < 60 then
		return 3;
	elseif nPlayerLevel >= 60 and nPlayerLevel < 80 then
		return 4;
	elseif nPlayerLevel >= 80 and nPlayerLevel < 100 then
		return 5;
	elseif nPlayerLevel >= 100 and nPlayerLevel < 120 then
		return 167;
	elseif nPlayerLevel >= 120 then
		return 168;
	end
end

--/////////////////////////////////////////////////////////////////////////////////////////////////////
--∏˘æ›ÕÊº“µ»º∂µ√µΩ∂‘”¶MissionItem_HashTable.txt÷–µƒµ•‘™À˜“˝
function x229000_GetMissionPetIndex(sceneId, selfId)
	local nPlayerLevel  = GetLevel(sceneId, selfId)
	if nPlayerLevel >= 10 and nPlayerLevel < 20 then
		return 1
	elseif nPlayerLevel >= 20 and nPlayerLevel < 40 then
		return 2
	elseif nPlayerLevel >= 40 and nPlayerLevel < 60 then
		return 3
	elseif nPlayerLevel >= 60 and nPlayerLevel < 80 then 
		return 4
	elseif nPlayerLevel >= 80 and nPlayerLevel < 100 then
		return 5;
	elseif nPlayerLevel >= 100 and nPlayerLevel < 120 then
		return 12;
	elseif nPlayerLevel >= 120 then
		return 13;
	end
end

--∏˘æ›ÕÊº“µ»º∂µ√µΩ∂‘”¶µƒ ¶√≈»ŒŒÒµƒΩ◊∂Œ
function x229000_GetShiMenPhaseByPlayerLevel(sceneId, selfId)
	local nPlayerLevel  = GetLevel(sceneId, selfId)
	if nPlayerLevel >= 10 and nPlayerLevel < 20 then
		return 0
	elseif nPlayerLevel >= 20 and nPlayerLevel < 40 then
		return 1
	elseif nPlayerLevel >= 40 and nPlayerLevel < 60 then
		return 2
	elseif nPlayerLevel >= 60 and nPlayerLevel < 80 then 
		return 3
	elseif nPlayerLevel >= 80 and nPlayerLevel < 100 then 
		return 4
	elseif nPlayerLevel >= 100 and nPlayerLevel < 120 then 
		return 243
	elseif nPlayerLevel >= 120 then
		return 244
	end
end
--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229000_RandomSubMission(sceneId, selfId)
 
	
	--—∞ŒÔ£®1/4£©°¢ÀÕ–≈£®1/16£©°¢ ’ºØ£®1/16£©°¢ø™π‚£®1/16£©°¢∂®µ„“˝µº£®1/16£©°¢’Ω∂∑∏±±æ£®1/4£©°¢≤∂◊Ω£®1/4£©
	local nRet = 1 + LuaFnGetHumanShimenRandom(sceneId, selfId);
	if nRet then
		if nRet <= 4 then
			x229000_XunWu_Accept(sceneId, selfId)
		elseif nRet <= 5 then
			x229000_SongXin_Accept(sceneId, selfId)
		elseif nRet <= 6 then
			x229000_ShouJi_Accept(sceneId, selfId)
		elseif nRet <= 7 then
			x229000_SongXin_Accept(sceneId, selfId)
		elseif nRet <= 8 then
			x229000_DingDianYinDao_Accept(sceneId, selfId)
		elseif nRet <= 12 then
			x229000_FuBenZhanDou_Accept(sceneId, selfId)
		elseif nRet <= 16 then
			x229000_BuZhuo_Accept(sceneId, selfId)
		else
			return -1
		end
	else
		return -1;
	end
end
--**********************************
--∏˘æ›ÕÊº“µ»º∂µ√≥ˆ»ŒŒÒµƒµ»º∂Ω◊∂Œ(1~5)
--**********************************
function x229000_DoSomethingByPlayerLevel(sceneId, selfId, scriptId)
	--PrintStr("...DoSomethingByPlayerLevel")
	--if 1==1 then
	--	CallScriptFunction(scriptId, "KillMonster_Accept", sceneId, selfId)
	----µ√µΩª∑ ˝
  --
	--	local round = GetMissionData(sceneId,selfId,MD_SHIMEN_HUAN)
	--
	----PrintStr("round="..round)
	----ª∑ ˝‘ˆº”1
	--
	--	round = round + 1
	--
	--	if	round >= 21 then
	--
	--		SetMissionData(sceneId, selfId, MD_SHIMEN_HUAN, 1)
	--
	--	else
	--	--PrintStr("round="..round)
	--		SetMissionData(sceneId, selfId, MD_SHIMEN_HUAN, round)
	--
	--	end
	--	return
	--end	
	
	------------------------------------------------------------------

	local find = CallScriptFunction( 500501, "CheckAccept_Necessary", sceneId, selfId)

	-------------------------------------------------------------------
	if find == -2 then
		BeginEvent(sceneId)
			AddText(sceneId, x229000_g_MissionName)
			AddText(sceneId, "NhiÆm v¯ sﬂ mÙn 1 ng‡y chÔ cÛ th¨ l‡m 60 l•n, h„y yÍn tÓnh khÙng ﬂ˛c l‡m ∞n")
		EndEvent( )
		DispatchEventList(sceneId, selfId, -1)
		return
	elseif find == -1 then
		BeginEvent(sceneId)
			AddText(sceneId, x229000_g_MissionName)
			AddText(sceneId, "Trong 15 ph˙t, c·c h’ khÙng th¨ Nhßn nhiÆm v¯ mæi!")
		EndEvent( )
		DispatchEventList(sceneId, selfId, -1)
		return
	end
	
	local nPhase = x229000_GetShiMenPhaseByPlayerLevel(sceneId, selfId)
	if nPhase == 1 then
		--—∞ŒÔ	ÀÕ–≈	 ’ºØ	±æ√≈≈…∏±±æ	∂®µ„“˝µº	≤∂◊Ω	¥Ú“∞π÷
		--> 30	30	0	10	20	0	10
		local nRet = random(100)
		if nRet <= 30 then
			CallScriptFunction(scriptId, "XunWu_Accept", sceneId, selfId)
		elseif nRet <= 60 then
			CallScriptFunction(scriptId, "SongXin_Accept", sceneId, selfId)
		elseif nRet <= 60 then
			CallScriptFunction(scriptId, "ShouJi_Accept", sceneId, selfId)
		elseif nRet <= 70 then	
			CallScriptFunction(scriptId, "FuBenZhanDou_Accept", sceneId, selfId)
		elseif nRet <= 90 then
			CallScriptFunction(scriptId, "DingDianYinDao_Accept", sceneId, selfId)
		elseif nRet <= 90 then
			CallScriptFunction(scriptId, "BuZhuo_Accept", sceneId, selfId)	
		elseif nRet <= 100 then
			CallScriptFunction(scriptId, "KillMonster_Accept", sceneId, selfId)	
		end
	elseif nPhase == 2 then
		--—∞ŒÔ	ÀÕ–≈	 ’ºØ	±æ√≈≈…∏±±æ	∂®µ„“˝µº	≤∂◊Ω	¥Ú“∞π÷
		-->25 20 15 10 20 0 10
		local nRet = random(100)
		if nRet <= 25 then
			CallScriptFunction(scriptId, "XunWu_Accept", sceneId, selfId)
		elseif nRet <= 45 then
			CallScriptFunction(scriptId, "SongXin_Accept", sceneId, selfId)
		elseif nRet <= 60 then
			CallScriptFunction(scriptId, "ShouJi_Accept", sceneId, selfId)
		elseif nRet <= 70 then
			CallScriptFunction(scriptId, "FuBenZhanDou_Accept", sceneId, selfId)
		elseif nRet <= 90 then
			CallScriptFunction(scriptId, "DingDianYinDao_Accept", sceneId, selfId)
		elseif nRet <= 90 then
			CallScriptFunction(scriptId, "BuZhuo_Accept", sceneId, selfId)	
		elseif nRet <= 100 then
			CallScriptFunction(scriptId, "KillMonster_Accept", sceneId, selfId)	
		end
	elseif nPhase == 3 then
			--—∞ŒÔ	ÀÕ–≈	 ’ºØ	±æ√≈≈…∏±±æ	∂®µ„“˝µº	≤∂◊Ω	¥Ú“∞π÷
		-->11	9	12	21	12	30	5
		local nRet = random(100)
		if nRet <= 11 then
			CallScriptFunction(scriptId, "XunWu_Accept", sceneId, selfId)
		elseif nRet <= 20 then
			CallScriptFunction(scriptId, "SongXin_Accept", sceneId, selfId)
		elseif nRet <= 32 then
			CallScriptFunction(scriptId, "ShouJi_Accept", sceneId, selfId)
		elseif nRet <= 53 then	
			CallScriptFunction(scriptId, "FuBenZhanDou_Accept", sceneId, selfId)
		elseif nRet <= 65 then
			CallScriptFunction(scriptId, "DingDianYinDao_Accept", sceneId, selfId)
		elseif nRet <= 95 then
			CallScriptFunction(scriptId, "BuZhuo_Accept", sceneId, selfId)	
		elseif nRet <= 100 then
			CallScriptFunction(scriptId, "KillMonster_Accept", sceneId, selfId)	
		end

	elseif nPhase == 4 then
			--—∞ŒÔ	ÀÕ–≈	 ’ºØ	±æ√≈≈…∏±±æ	∂®µ„“˝µº	≤∂◊Ω	¥Ú“∞π÷
		--> 28	5	7	17	8	35	0
		local nRet = random(100)
		if nRet <= 28 then
			CallScriptFunction(scriptId, "XunWu_Accept", sceneId, selfId)
		elseif nRet <= 33 then
			CallScriptFunction(scriptId, "SongXin_Accept", sceneId, selfId)
		elseif nRet <= 40 then
			CallScriptFunction(scriptId, "ShouJi_Accept", sceneId, selfId)
		elseif nRet <= 57 then	
			CallScriptFunction(scriptId, "FuBenZhanDou_Accept", sceneId, selfId)
		elseif nRet <= 65 then
			CallScriptFunction(scriptId, "DingDianYinDao_Accept", sceneId, selfId)
		elseif nRet <= 100 then
			CallScriptFunction(scriptId, "BuZhuo_Accept", sceneId, selfId)	
		elseif nRet <= 100 then
			CallScriptFunction(scriptId, "KillMonster_Accept", sceneId, selfId)	
		end
	elseif nPhase == 5 then
		--—∞ŒÔ	ÀÕ–≈	 ’ºØ	±æ√≈≈…∏±±æ	∂®µ„“˝µº	≤∂◊Ω	¥Ú“∞π÷
		--> 32	5	5	10	8	40	0
		local nRet = random(100)
		if nRet <= 32 then
			CallScriptFunction(scriptId, "XunWu_Accept", sceneId, selfId)
		elseif nRet <= 37 then
			CallScriptFunction(scriptId, "SongXin_Accept", sceneId, selfId)
		elseif nRet <= 42 then
			CallScriptFunction(scriptId, "ShouJi_Accept", sceneId, selfId)
		elseif nRet <= 52 then	
			CallScriptFunction(scriptId, "FuBenZhanDou_Accept", sceneId, selfId)
		elseif nRet <= 60 then
			CallScriptFunction(scriptId, "DingDianYinDao_Accept", sceneId, selfId)
		elseif nRet <= 100 then
			CallScriptFunction(scriptId, "BuZhuo_Accept", sceneId, selfId)	
		elseif nRet <= 100 then
			CallScriptFunction(scriptId, "KillMonster_Accept", sceneId, selfId)	
		end
	end
	
        x229000_FixupShimenHuan(sceneId, selfId)
end

function x229000_FixupShimenHuan(sceneId, selfId)
	local round = GetMissionData(sceneId,selfId,MD_SHIMEN_HUAN)
	round = round + 1
	--10°´19º∂£¨10¥ŒŒ™1¬÷°£«∞10¥ŒΩ±¿¯Œ™À´±∂æ≠—È°£
	--20°´29º∂£¨15¥ŒŒ™1¬÷°£«∞15¥ŒΩ±¿¯Œ™À´±∂æ≠—È°£
	--30°´100º∂£¨20¥ŒŒ™1¬÷°£«∞20¥ŒΩ±¿¯Œ™À´±∂æ≠—È°£
	local playerLevel = GetLevel(sceneId, selfId)
	if playerLevel < 20 then
		if	round >= 11 then
			SetMissionData(sceneId, selfId, MD_SHIMEN_HUAN, 1)
		else
			SetMissionData(sceneId, selfId, MD_SHIMEN_HUAN, round)
		end
	elseif playerLevel < 30 then
		if	round >= 16 then
			SetMissionData(sceneId, selfId, MD_SHIMEN_HUAN, 1)
		else
			SetMissionData(sceneId, selfId, MD_SHIMEN_HUAN, round)
		end
	elseif playerLevel <= 100 then
		if	round >= 21 then
			SetMissionData(sceneId, selfId, MD_SHIMEN_HUAN, 1)
		else
			SetMissionData(sceneId, selfId, MD_SHIMEN_HUAN, round)
		end
	end
end

--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229000_XunWu_Accept(sceneId, selfId)--—∞ŒÔ
	----PrintStr("XunWu_Accept..")
	--º”»Î»ŒŒÒµΩÕÊº“¡–±Ì
	local bAdd = AddMission( sceneId,selfId, x229000_g_MissionId, x229000_g_ScriptId, 0, 0, 1 )
	if bAdd < 1 then
		return
	end	
	
	local nitemId, strItemName, strItemDesc = GetOneMissionItem(x229000_GetMissionItemIndex(sceneId, selfId))
	Msg2Player(sceneId, selfId, "#YNhßn nhiÆm v¯#W: NhiÆm v¯ sﬂ mÙn", MSG2PLAYER_PARA )
	--print(nitemId, strItemName, strItemDesc)
	--µ√µΩ»ŒŒÒ‘⁄20∏ˆ»ŒŒÒ÷–µƒ–Ú¡–∫≈
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229000_g_MissionId)
	
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --…Ë÷√»ŒŒÒ «∑ÒÕÍ≥…£®Œ¥ÕÍ≥…£©
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229000_g_SubMissionTypeEnum.XunWu)
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart, 1)--formet◊÷∑˚¥ÆÀ˜“˝
	SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart+1, nitemId)
	
	local strMissionTarget = format("%s c¸a ta sao khÙng th§y ‚u? N™u ngﬂΩi cÛ th¨ gi˙p ta tÏm l’i, ta s® khÙng b’c „i ngﬂΩi", strItemName)
	AddText(sceneId, strMissionTarget)
	
	--ºÏ≤‚ÕÊº“…Ì…œµƒµ¿æﬂ «∑Ò“—æ≠¬˙◊„ÕÍ≥…Ãıº˛
	local bHaveItem = HaveItem(sceneId, selfId, nitemId)
	if bHaveItem == 1 then
		SetMissionByIndex(sceneId,selfId,misIndex,0,1)					--∞—»ŒŒÒÕÍ≥…±Í÷æ÷√Œ™1
		ResetMissionEvent(sceneId, selfId, x229000_g_MissionId, 2)
	end	
	
end	

--/////////////////////////////////////////////////////////////////////////////////////////////////////

function x229000_SongXin_Accept(sceneId, selfId)--ÀÕ–≈

  local roll = random(3)
	--ÀÊª˙—°≥ˆ±æ√≈≈…µƒÃÿ≤˙±‡∫≈£¨√ø∏ˆ√≈≈…3÷÷Ãÿ≤˙
	local shoujiItemId = x229000_g_ShouJiList[ roll ].itemId
		
	--»ŒŒÒΩ±¿¯œ‡πÿ			
	BeginAddItem(sceneId)
		AddItem(sceneId, shoujiItemId, 1)
	local bAdd = EndAddItem(sceneId, selfId)
	if bAdd < 1 then
		return 
	end	

	--º”»Î»ŒŒÒµΩÕÊº“¡–±Ì
	bAdd = AddMission( sceneId,selfId, x229000_g_MissionId, x229000_g_ScriptId, 0, 0, 0 )
	if bAdd < 1 then
		return
	end
	AddItemListToHuman(sceneId, selfId)		
	--—∞ŒÔ, ÀÕ–≈‘Ú…Ë÷√À¯∂®ƒø±ÍNPCµƒ ¬º˛Flag
	SetMissionEvent(sceneId, selfId, x229000_g_MissionId, 4)
	
	local nPhase = x229000_GetShiMenPhaseByPlayerLevel(sceneId, selfId)
	local nNpcId, strNpcName, strNpcScene, nSceneId, nPosX, nPosZ, strNPCDesc = GetOneMissionNpc(nPhase-1)
	--print(nNpcId, strNpcName, strNpcScene, nSceneId, nPosX, nPosZ, strNPCDesc)
	Msg2Player(  sceneId, selfId,"#YNhßn nhiÆm v¯#W: NhiÆm v¯ sﬂ mÙn", MSG2PLAYER_PARA )
	CallScriptFunction( SCENE_SCRIPT_ID, "AskTheWay", sceneId, selfId, nSceneId, nPosX, nPosZ, strNpcName)
		
	--µ√µΩ»ŒŒÒ‘⁄20∏ˆ»ŒŒÒ÷–µƒ–Ú¡–∫≈
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229000_g_MissionId)
	
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --…Ë÷√»ŒŒÒ «∑ÒÕÍ≥…£®Œ¥ÕÍ≥…£©
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229000_g_SubMissionTypeEnum.SongXin)
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart, 0)--formet◊÷∑˚¥ÆÀ˜“˝
	SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart+1, nNpcId)

	local ListIndex = x229000_GetStrIndexByStrValue( x229000_g_ShouJiList[ roll ].itemName )
	SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart+2, ListIndex )

  SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart+3, shoujiItemId )

	local strMissionTarget = format("L‚u l°m khÙng g£p %s %s, ngﬂΩi h„y gi˙p ta em %s giao cho ngﬂ∂i §y", strNpcScene, strNpcName, x229000_g_ShouJiList[ roll ].itemName )
	AddText(sceneId, strMissionTarget)
	
end

--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229000_DingDianYinDao_Accept(sceneId, selfId)--∂®µ„“˝µº
	--ªÒµ√ÕÊº“µƒ√≈≈…
	local playerMenpai = GetMenPai(sceneId, selfId)
	local a = {}
	local index = 1
	--”√“ª∏ˆ¡Ÿ ±±Ì¿¥¥Ê¥¢∂‘”¶√≈≈…‘⁄x229000_g_DingDianYinDaoList÷–µƒ»´≤øÀ˜“˝
	for i, v in x229000_g_DingDianYinDaoList do
		if v.menpai == playerMenpai then
			a[index] = i
			index = index + 1
		end
	end
	
	local ct = getn(a)
	if ct <= 0 then
		return 0
	end
		
	local ret = random(ct)
	
	BeginAddItem(sceneId)
		AddItem(sceneId, x229000_g_DingDianYinDaoList[a[ret]].itemId, 1)
	local bAdd = EndAddItem(sceneId, selfId)
	if bAdd < 1 then
		return 
	end	

	--º”»Î»ŒŒÒµΩÕÊº“¡–±Ì
	bAdd = AddMission( sceneId,selfId, x229000_g_MissionId, x229000_g_ScriptId, 0, 0, 0 )
	if bAdd < 1 then
		return
	end	
	AddItemListToHuman(sceneId, selfId)
	Msg2Player(  sceneId, selfId,"#YNgﬂΩi „ ’t ﬂ˛c 1 chi™c#W" .. x229000_g_DingDianYinDaoList[a[ret]].itemName, MSG2PLAYER_PARA )
		
	local strIndex_Area = x229000_GetStrIndexByStrValue(x229000_g_DingDianYinDaoList[a[ret]].AreaName)
	local strIndex_Item = x229000_GetStrIndexByStrValue(x229000_g_DingDianYinDaoList[a[ret]].itemName)
	local strIndex_subArea = x229000_GetStrIndexByStrValue(x229000_g_DingDianYinDaoList[a[ret]].subAreaName)                                                                            
	
	local x1 = x229000_g_DingDianYinDaoList[a[ret]].posx1
	local x2 = x229000_g_DingDianYinDaoList[a[ret]].posx2
	local z1 = x229000_g_DingDianYinDaoList[a[ret]].posz1
	local z2 = x229000_g_DingDianYinDaoList[a[ret]].posz2
	local scene = x229000_g_DingDianYinDaoList[a[ret]].scene
	local tip = x229000_g_DingDianYinDaoList[a[ret]].AreaName .. x229000_g_DingDianYinDaoList[a[ret]].subAreaName
	local x = x1 + (x2-x1)/2
	local z = z1 + (z2-z1)/2
	
	--µ√µΩ»ŒŒÒ‘⁄20∏ˆ»ŒŒÒ÷–µƒ–Ú¡–∫≈
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229000_g_MissionId)
		
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --…Ë÷√»ŒŒÒ «∑ÒÕÍ≥…£®Œ¥ÕÍ≥…£©
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229000_g_SubMissionTypeEnum.DingDianYinDao)
	SetMissionByIndex(sceneId, selfId, misIndex, 2, a[ret]) --…Ë÷√∂®µ„“˝µº¡–±Ì÷–µƒÀ˜“˝
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart, 3)--formet◊÷∑˚¥ÆÀ˜“˝
	SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart+1, strIndex_Item)
	SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart+2, strIndex_Area)
	SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart+3, strIndex_subArea)
	
	Msg2Player(  sceneId, selfId,"#YNhßn nhiÆm v¯#W: NhiÆm v¯ sﬂ mÙn", MSG2PLAYER_PARA )
	CallScriptFunction( SCENE_SCRIPT_ID, "AskTheWay", sceneId, selfId, scene, x, z, tip)

	local strMissionTarget = format("C·c h’ h„y d˘ng %s, quÈt d˜n Thi™u L‚m TÒ %s c¸a %s", 
		x229000_g_DingDianYinDaoList[a[ret]].itemName,
		x229000_g_DingDianYinDaoList[a[ret]].AreaName, 
		x229000_g_DingDianYinDaoList[a[ret]].subAreaName) 
		
	AddText(sceneId, strMissionTarget)
	
end

--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229000_FuBenZhanDou_Accept(sceneId, selfId)--’Ω∂∑∏±±æ
	local playerMenpai = GetMenPai(sceneId, selfId)
	if playerMenpai == MP_WUMENPAI then
		return 0
	end	

	local npcName, fubenName, nSceneId, posx, posz
	for i, v in x229000_g_FuBen_List do
		if v.menpai == GetMenPai(sceneId, selfId) then
			npcName =  v.NpcName
			fubenName =  v.FubenName
			nSceneId = v.scene
			posx = v.posx
			posz = v.posz
			break
		end
	end

	--º”»Î»ŒŒÒµΩÕÊº“¡–±Ì
	local bAdd = AddMission( sceneId,selfId, x229000_g_MissionId, x229000_g_ScriptId, 0, 0, 0 )
	if bAdd < 1 then
		return
	end	
	
	local nFormatIndex = GetMissionCacheData(sceneId, selfId, 0)
	local i = GetMissionCacheData(sceneId, selfId, 2)
	local NpcNameIndex = x229000_GetStrIndexByStrValue(npcName)
	local FubenNameIndex = x229000_GetStrIndexByStrValue(fubenName)
	
	--µ√µΩ»ŒŒÒ‘⁄20∏ˆ»ŒŒÒ÷–µƒ–Ú¡–∫≈
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229000_g_MissionId)
		
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --…Ë÷√»ŒŒÒ «∑ÒÕÍ≥…£®Œ¥ÕÍ≥…£©
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229000_g_SubMissionTypeEnum.FuBenZhanDou)
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart, 4)
	SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart+1, NpcNameIndex)
	SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart+2, FubenNameIndex)
	
	Msg2Player(  sceneId, selfId,"#YNhßn nhiÆm v¯#W: NhiÆm v¯ sﬂ mÙn", MSG2PLAYER_PARA )
	CallScriptFunction( SCENE_SCRIPT_ID, "AskTheWay", sceneId, selfId, nSceneId, posx, posz, npcName)

	local strMissionTarget = format("Xin ngﬂΩi h„y i tÏm %s, ngﬂ∂i s® ﬂa ngﬂΩi i thÿ chi™n %s", npcName, fubenName)
	AddText(sceneId, strMissionTarget)
end

--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229000_BuZhuo_Accept(sceneId, selfId)--≤∂◊Ω
	--PrintStr("BuZhuo_Accept...")
	local playerLevel = GetLevel(sceneId, selfId)
	local petId, petName, petDesc, takeLevel
	local petHashIndex = x229000_GetMissionPetIndex(sceneId, selfId)
	for i = 1, 100 do
		petId, petName, petDesc = GetOneMissionPet(petHashIndex)
		takeLevel = GetPetTakeLevel(petId)
		--PrintNum(takeLevel)
		if playerLevel > takeLevel then
			break
		end
		if i == 100 then
			--Õ≥Õ≥ÀÕ–≈»•:((
			x229000_SongXin_Accept(sceneId, selfId)
			return
		end
	end	

	--º”»Î»ŒŒÒµΩÕÊº“¡–±Ì
	local bAdd = AddMission( sceneId,selfId, x229000_g_MissionId, x229000_g_ScriptId, 0, 0, 0 )
	if bAdd < 1 then
		return
	end	
	
	SetMissionEvent(sceneId, selfId, x229000_g_MissionId, 3)
	
	--µ√µΩ»ŒŒÒ‘⁄20∏ˆ»ŒŒÒ÷–µƒ–Ú¡–∫≈
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229000_g_MissionId)
	
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --…Ë÷√»ŒŒÒ «∑ÒÕÍ≥…£®Œ¥ÕÍ≥…£©
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229000_g_SubMissionTypeEnum.BuZhuo)
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart, 5)--formet◊÷∑˚¥ÆÀ˜“˝
	SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart+1, petId)
		
	Msg2Player(  sceneId, selfId,"#YNhßn nhiÆm v¯#W: NhiÆm v¯ sﬂ mÙn", MSG2PLAYER_PARA )
	
	local strMissionTarget = format("Xin ngﬂΩi h„y b°t cho ta mµt con %s v´", petName)
	AddText(sceneId, strMissionTarget)
	
	--ºÏ≤‚ÕÊº“…Ì…œµƒµ¿æﬂ «∑Ò“—æ≠¬˙◊„ÕÍ≥…Ãıº˛
	for i=0, 6 do
		local petDataId = LuaFnGetPet_DataID(sceneId,selfId,i)
		if petDataId == petId then
			SetMissionByIndex(sceneId,selfId,misIndex,0,1)					--∞—»ŒŒÒÕÍ≥…±Í÷æ÷√Œ™1

			ResetMissionEvent(sceneId, selfId, x229000_g_MissionId, 3)
			break
		end	
	end	

end
--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229000_ShouJi_Accept(sceneId, selfId)-- ’ºØ
	--PrintStr("ShouJi_Accept...")
	local playerMenpai = GetMenPai(sceneId, selfId)
	if playerMenpai == MP_WUMENPAI then
		return 0
	end	
	--PrintStr("playerMenpai="..playerMenpai)
	local a = {}
	local index = 1
	for i, v in x229000_g_ShouJiList do
		if v.menpai == playerMenpai then
			--PrintStr("find...")
			a[index] = i
			index = index + 1
		end	
	end
	local ct = getn(a)
	--PrintStr("ct="..ct)
	if ct <= 0 then
		return 0
	end
	
	local ret = random(ct)
	--º”»Î»ŒŒÒµΩÕÊº“¡–±Ì
	local bAdd = AddMission( sceneId,selfId, x229000_g_MissionId, x229000_g_ScriptId, 0, 0, 1 )
	if bAdd < 1 then
		return
	end	
	
	local itemNameIndex = x229000_GetStrIndexByStrValue(x229000_g_ShouJiList[a[ret]].itemName)
	--µ√µΩ»ŒŒÒ‘⁄20∏ˆ»ŒŒÒ÷–µƒ–Ú¡–∫≈
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229000_g_MissionId)
	
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --…Ë÷√»ŒŒÒ «∑ÒÕÍ≥…£®Œ¥ÕÍ≥…£©
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229000_g_SubMissionTypeEnum.ShouJi)
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart, 6)--formet◊÷∑˚¥ÆÀ˜“˝
	SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart+1, itemNameIndex)
	SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart+2, x229000_g_ShouJiList[a[ret]].itemId)
		
	Msg2Player(  sceneId, selfId,"#YNhßn nhiÆm v¯#W: NhiÆm v¯ sﬂ mÙn", MSG2PLAYER_PARA )
	
	local strMissionTarget = format("Xin ngﬂΩi h„y gi˙p ta ki™m 5 %s v´", x229000_g_ShouJiList[a[ret]].itemName)
	AddText(sceneId, strMissionTarget)
end
--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229000_Ability_Accept(sceneId, selfId)--ø™π‚
	----PrintStr("Ability_Accept...")
	--local nPhase = x229000_GetShiMenPhaseByPlayerLevel(sceneId, selfId)
	--local nNpcId, strNpcName, strNpcScene, nSceneId, nPosX, nPosZ, strNPCDesc = GetOneMissionNpc(nPhase-1)
	local strNpcName, scene, x, z
	for i, v in x229000_g_AbilityNpcList do
		if v.menpai == GetMenPai(sceneId, selfId) then
			local ct = getn(v.npcList)
			local index = random(ct)
			strNpcName = v.npcList[index].name
			scene = v.npcList[index].scene
			x = v.npcList[index].x
			z = v.npcList[index].z
		end
	end
	
	local strNpcIndex = x229000_GetStrIndexByStrValue(strNpcName)
	local itemId, itemName = GetMenpaiItem(sceneId, selfId)


	----PrintStr("itemId="..itemId.."  itemName="..itemName)
	--º”»Î»ŒŒÒµΩÕÊº“¡–±Ì
	local bAdd = AddMission( sceneId,selfId, x229000_g_MissionId, x229000_g_ScriptId, 0, 0, 0 )
	if bAdd < 1 then
		return
	end	
	
	SetMissionEvent(sceneId, selfId, x229000_g_MissionId, 2)
	SetMissionEvent(sceneId, selfId, x229000_g_MissionId, 4)
	
	--µ√µΩ»ŒŒÒ‘⁄20∏ˆ»ŒŒÒ÷–µƒ–Ú¡–∫≈
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229000_g_MissionId)
	
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --…Ë÷√»ŒŒÒ «∑ÒÕÍ≥…£®Œ¥ÕÍ≥…£©
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229000_g_SubMissionTypeEnum.KaiGuang)
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart, 7)--formet◊÷∑˚¥ÆÀ˜“˝
	SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart+1, strNpcIndex)
	SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart+2, itemId)
		
	Msg2Player(  sceneId, selfId,"#YNhßn nhiÆm v¯#W: NhiÆm v¯ sﬂ mÙn", MSG2PLAYER_PARA )
	CallScriptFunction( SCENE_SCRIPT_ID, "AskTheWay", sceneId, selfId, scene, x, z, strNpcName)
	
	local strMissionTarget = format("H„y ﬂa %scho%s, ta s® hßu „i ngﬂΩi!", strNpcName, itemName)
	AddText(sceneId, strMissionTarget)

end

--/////////////////////////////////////////////////////////////////////////////////////////////////////
--**********************************
--»ŒŒÒ»Îø⁄∫Ø ˝
--**********************************
function x229000_OnDefaultEvent( sceneId, selfId, targetId )	--µ„ª˜∏√»ŒŒÒ∫Û÷¥––¥ÀΩ≈±æ
	----PrintStr("OnDefaultEvent...")
	--∑¢ÀÕ»ŒŒÒ–Ë«Ûµƒ–≈œ¢
	if IsHaveMission(sceneId,selfId,x229000_g_MissionId) > 0 then
		if GetName(sceneId, targetId) == x229000_g_Name then
			--∑¢ÀÕ»ŒŒÒ–Ë«Ûµƒ–≈œ¢
			BeginEvent(sceneId)
				AddText(sceneId, x229000_g_MissionName)
				AddText(sceneId, "ViÆc ta giao „ ho‡n th‡nh chﬂa?")
			EndEvent( )
			bDone = x229000_CheckSubmit( sceneId, selfId )
			DispatchMissionDemandInfo(sceneId, selfId, targetId, x229000_g_ScriptId, x229000_g_MissionId, bDone)
		else
			local misIndex = GetMissionIndexByID(sceneId,selfId,x229000_g_MissionId)
			
			local demandItemId =0
			local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
			if missionType == x229000_g_SubMissionTypeEnum.SongXin then
			    demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229000_g_StrForePart+3)
			else
			    demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229000_g_StrForePart+2)
			end				
	
			
			local _, strDemandItemName, _ = x229000_GetItemDetailInfo(demandItemId)
			
			local bHaveItem = HaveItem(sceneId, selfId, demandItemId)
			if bHaveItem == 1 then
				if LuaFnGetAvailableItemCount(sceneId, selfId, demandItemId) >= 1 then
				DelItem(sceneId, selfId, demandItemId, 1)
				BeginEvent(sceneId)
					AddText(sceneId, "Xin c·c h’ quay v´ nÛi væi Sﬂ ph¯ c¸a c·c h’, t’i h’ r§t nhæ sﬂ ph¯ c¸a c·c h’, r§t c‰m Ωn sﬂ ph¯ c¸a c·c h’ t£ng mÛn qu‡ n‡y cho t’i h’, ‚y l‡ th— m‡ t’i h’ ang muØn cÛ ﬂ˛c.")
				EndEvent()
				DispatchEventList(sceneId, selfId, targetId)	
				--…Ë÷√»ŒŒÒ“—æ≠ÕÍ≥…
				SetMissionByIndex(sceneId, selfId, misIndex, 0, 1)
				ResetMissionEvent(sceneId, selfId, x229000_g_MissionId, 4)
				return 1;
			else
				BeginEvent(sceneId)
						AddText(sceneId, "Vßt ph¶m c¸a c·c h’ hiÆn khÙng d˘ng ﬂ˛c ho£c „ b∏ khÛa")
					EndEvent( )
					DispatchMissionTips(sceneId,selfId)	
					return	
				end
			else
				BeginEvent(sceneId)
					AddText(sceneId, "–„ mang tæi th— ta c•n chﬂa?")
				EndEvent()
				DispatchEventList(sceneId, selfId, targetId)	
				return 1;					
			end
		end
	elseif x229000_CheckAccept(sceneId,selfId) > 0 then
		BeginEvent(sceneId)
		
			AddText(sceneId,x229000_g_MissionName)
			AddText(sceneId,x229000_g_MissionInfo)
			AddText(sceneId,"#{M_MUBIAO}#r")
			
			x229000_DoSomethingByPlayerLevel(sceneId, selfId, x229000_g_ScriptId)
			--±£÷§µ⁄“ª¥ŒΩ”µΩµƒ»ŒŒÒ◊‹ «πÃ∂®≤ª±‰µƒ
			--ResetMissionCacheData(sceneId, selfId)
			--SetMissionCacheData(sceneId, selfId, 0, 0) --formet◊÷∑˚¥ÆÀ˜“˝
			--SetMissionCacheData(sceneId, selfId, 1, x229000_g_SubMissionTypeEnum.SongXin)
			--SetMissionCacheData(sceneId, selfId, 2, 100001) --…Ë÷√human…Ì…œµ⁄0Œªª∫¥Ê ˝æ›
			--SetMissionCacheData(sceneId, selfId, 7, 1) -- «∑Ò «µ⁄“ª¥Œ
			
			--strMissionTarget = format("∫√æ√√ª”–º˚%s¡À£¨«Î¥˙Œ“Œ ∫Ú“ªœ¬À˚»•", "frankwu")
			--AddText(sceneId, strMissionTarget)

			--º”»Î»ŒŒÒµΩÕÊº“¡–±Ì
			--AddMission( sceneId,selfId, x229000_g_MissionId, x229000_g_ScriptId, 0, 0, 0 )
			--—∞ŒÔ, ÀÕ–≈‘Ú…Ë÷√À¯∂®ƒø±ÍNPCµƒ ¬º˛Flag
			--SetMissionEvent(sceneId, selfId, x229000_g_MissionId, 4)

			--local _, strNpcName, strNpcScene, PosX, PosZ, _ = GetNpcInfoByNpcId(sceneId,100001)
			--Msg2Player(  sceneId, selfId,"#YΩ” ‹»ŒŒÒ£∫ ¶√≈»ŒŒÒ", MSG2PLAYER_PARA )
			--CallScriptFunction( SCENE_SCRIPT_ID, "AskTheWay", sceneId, selfId, nSceneId, PosX, PosZ, strNpcName)
				
			--µ√µΩ»ŒŒÒ‘⁄20∏ˆ»ŒŒÒ÷–µƒ–Ú¡–∫≈
			--local misIndex = GetMissionIndexByID(sceneId,selfId,x229000_g_MissionId)
			
			--SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --…Ë÷√»ŒŒÒ «∑ÒÕÍ≥…£®Œ¥ÕÍ≥…£©
			--SetMissionByIndex(sceneId, selfId, misIndex, 1, x229000_g_SubMissionTypeEnum.SongXin)
			
			--SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart, 0)--formet◊÷∑˚¥ÆÀ˜“˝
			--SetMissionByIndex(sceneId, selfId, misIndex, x229000_g_StrForePart+1, 100001)
		
			
		EndEvent( )
		DispatchEventList(sceneId,selfId,targetId)
	end
	
end

--**********************************
--¡–æŸ ¬º˛
--**********************************
function x229000_OnEnumerate( sceneId, selfId, targetId )
	--PrintStr("229000...OnEnumerate")
--»Áπ˚ÕÊº“ÕÍ≥…π˝’‚∏ˆ»ŒŒÒ
	if IsMissionHaveDone(sceneId,selfId,x229000_g_MissionId) > 0 then
  	return
--¬˙◊„»ŒŒÒΩ” ’Ãıº˛
	elseif IsHaveMission(sceneId,selfId,x229000_g_MissionId) > 0 then
		local strNpcName = x229000_g_Name -- temp code
		if GetName(sceneId,targetId) == strNpcName then
			AddNumText(sceneId, x229000_g_ScriptId,x229000_g_MissionName,4,-1);
		end
--¬˙◊„»ŒŒÒΩ” ’Ãıº˛
  elseif x229000_CheckAccept(sceneId,selfId) > 0 then
		if GetName(sceneId,targetId) == x229000_g_Name then
			AddNumText(sceneId,x229000_g_ScriptId,x229000_g_MissionName,3,-1);
		end
  end
end
--**********************************
--Ω” ‹
--**********************************
function x229000_OnAccept( sceneId, selfId )
	--PrintStr("OnAccept...")
	--local nMissionType = GetMissionCacheData(sceneId, selfId, 1)
	--if nMissionType == x229000_g_SubMissionTypeEnum.XunWu then
	--	x229000_XunWu_Accept(sceneId, selfId)
	--elseif nMissionType == x229000_g_SubMissionTypeEnum.SongXin then
	--	x229000_SongXin_Accept(sceneId, selfId)
	--elseif nMissionType == x229000_g_SubMissionTypeEnum.DingDianYinDao then
	--	x229000_DingDianYinDao_Accept(sceneId, selfId)
	--elseif nMissionType == x229000_g_SubMissionTypeEnum.FuBenZhanDou then
	--	x229000_FuBenZhanDou_Accept(sceneId, selfId)
	--elseif nMissionType == x229000_g_SubMissionTypeEnum.BuZhuo then
	--	x229000_BuZhuo_Accept(sceneId, selfId)
	--end
end

--**********************************
--ºÏ≤‚Ω” ‹Ãıº˛
--**********************************
function x229000_CheckAccept( sceneId, selfId )
	local nLevel = GetLevel(sceneId, selfId)
	--ÕÊº“µ»º∂>=10º∂
	if nLevel < 10 then
		return 0
	else
		local playerMenpai = GetMenPai(sceneId, selfId)
		if playerMenpai ~= MP_SHAOLIN then
			return 0
		end	
	end
	return 1;
end

--**********************************
--∑≈∆˙
--**********************************
function x229000_OnAbandon( sceneId, selfId )
	----PrintStr("OnAbandon...")
	if IsHaveMission(sceneId, selfId, x229000_g_MissionId) > 0 then	
		local misIndex = GetMissionIndexByID(sceneId,selfId,x229000_g_MissionId)		--µ√µΩ»ŒŒÒ‘⁄20∏ˆ»ŒŒÒ÷–µƒ–Ú¡–∫≈
		local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
		
		if missionType == x229000_g_SubMissionTypeEnum.SongXin then
			local missionItem = GetMissionParam(sceneId, selfId, misIndex,x229000_g_StrForePart+3)
			if HaveItem(sceneId, selfId, missionItem) == 1 then
			if LuaFnGetAvailableItemCount(sceneId, selfId, missionItem) >= 1 then
			DelItem(sceneId, selfId, missionItem, 1)		
			else
				BeginEvent(sceneId)
					AddText(sceneId, "Vßt ph¶m c¸a c·c h’ hiÆn khÙng d˘ng ﬂ˛c ho£c „ b∏ khÛa")
				EndEvent( )
				DispatchMissionTips(sceneId,selfId)	
				return	
			end	
			end
		elseif missionType == x229000_g_SubMissionTypeEnum.DingDianYinDao	then
			local index = GetMissionParam(sceneId, selfId, misIndex,2)
			if HaveItem(sceneId, selfId, x229000_g_DingDianYinDaoList[index].itemId) == 1 then
			if LuaFnGetAvailableItemCount(sceneId, selfId, x229000_g_DingDianYinDaoList[index].itemId) >= 1 then
			DelItem(sceneId, selfId,x229000_g_DingDianYinDaoList[index].itemId,1)
			else
				BeginEvent(sceneId)
					AddText(sceneId, "Vßt ph¶m c¸a c·c h’ hiÆn khÙng d˘ng ﬂ˛c ho£c „ b∏ khÛa")
				EndEvent( )
				DispatchMissionTips(sceneId,selfId)	
				return	
			end
			end	
		elseif missionType == x229000_g_SubMissionTypeEnum.ShouJi then
			local itemId = GetMissionParam(sceneId, selfId, misIndex, x229000_g_StrForePart+2)
			if HaveItem(sceneId, selfId, itemId) == 1 then
			if LuaFnGetAvailableItemCount(sceneId, selfId, itemId) >= 5 then
			DelItem(sceneId, selfId,itemId,5)
			else
				BeginEvent(sceneId)
					AddText(sceneId, "Vßt ph¶m c¸a c·c h’ hiÆn khÙng d˘ng ﬂ˛c ho£c „ b∏ khÛa")
				EndEvent( )
				DispatchMissionTips(sceneId,selfId)	
				return	
			end	
		end
		end
		--…æ≥˝ÕÊº“»ŒŒÒ¡–±Ì÷–∂‘”¶µƒ»ŒŒÒ
	  DelMission( sceneId, selfId, x229000_g_MissionId )
	  SetMissionData(sceneId,selfId,MD_SHIMEN_HUAN,0)	--ª∑ ˝«Â0
	end	
 	--µ˜”√Õ®”√∑≈∆˙Ω”ø⁄
	------------------------------------------------------------------
	 CallScriptFunction( 500501, "Abandon_Necessary", sceneId, selfId )
	-------------------------------------------------------------------
end

--**********************************
--ºÃ–¯
--**********************************
function x229000_OnContinue( sceneId, selfId, targetId )
	----PrintStr("OnContinue...")
	if x229000_CheckAccept(sceneId,selfId) > 0 then
		BeginEvent(sceneId)
		
			AddText(sceneId,x229000_g_MissionName)
			AddText(sceneId,x229000_g_MissionComplete)
			
		  --x229000_DoSomethingByPlayerLevel(sceneId, selfId)
		  
		EndEvent( )
		DispatchMissionContinueInfo(sceneId, selfId, targetId, x229000_g_ScriptId, x229000_g_MissionId)
	end	
end

--**********************************
--ºÏ≤‚ «∑Òø…“‘Ã·Ωª
--**********************************
function x229000_CheckSubmit( sceneId, selfId )
	if IsHaveMission( sceneId, selfId, x229000_g_MissionId ) <= 0 then
		return 0
	end

	--‘⁄¥À≈–∂œÃ·ΩªÃıº˛ «∑Ò∑˚∫œ£¨≤¢∏¯”Ëœ‡”¶Ω±¿¯
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229000_g_MissionId)
	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
	
	if missionType == x229000_g_SubMissionTypeEnum.XunWu then
		local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229000_g_StrForePart+1)
		if GetItemCount(sceneId,selfId,demandItemId) <= 0 then --√ª”–À˜“™µƒŒÔ∆∑
			return 0
		end
		if IsEquipItem(demandItemId) == 1 and IsWhiteEquip(demandItemId) ~= 1 then
			return 2
		else
			return 1
		end		
	elseif missionType == x229000_g_SubMissionTypeEnum.ShouJi then
	 	local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229000_g_StrForePart+2)
	 	if GetItemCount(sceneId,selfId,demandItemId) < 5 then --√ª”–À˜“™µƒŒÔ∆∑
	 		return 0
	 	else
	 		return 1	
	 	end
	elseif missionType == x229000_g_SubMissionTypeEnum.BuZhuo then
		return 2
	elseif GetMissionParam(sceneId, selfId, misIndex, 0) > 0 then	--≤Ïø¥»ŒŒÒ «∑ÒÕÍ≥…
		return 1
	end

	return 0
end

function x229000_OnLockedTarget(sceneId, selfId, objId )
	--PrintStr("OnLockedTarget...")
	if GetName(sceneId, objId) == x229000_g_Name  then
		return 0
	end
	-- ≈–∂œ «≤ª «À¯∂®µƒNpc
	if IsHaveMission(sceneId, selfId, x229000_g_MissionId) > 0 then
		local misIndex = GetMissionIndexByID(sceneId,selfId,x229000_g_MissionId)		--µ√µΩ»ŒŒÒ‘⁄20∏ˆ»ŒŒÒ÷–µƒ–Ú¡–∫≈
		local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
		
		local nNpcId, strNpcName, strNpcScene, PosX, PosZ, desc
		if missionType == x229000_g_SubMissionTypeEnum.KaiGuang then
			nNpcIndex = GetMissionParam(sceneId, selfId, misIndex, x229000_g_StrForePart+1)
			strNpcName = x229000_g_StrList[nNpcIndex+1]
		else
			nNpcId = GetMissionParam(sceneId, selfId, misIndex, x229000_g_StrForePart+1)
			nNpcId, strNpcName, strNpcScene, PosX, PosZ, desc = GetNpcInfoByNpcId(sceneId,nNpcId)
		end
		--PrintStr(strNpcName)
		--PrintStr(GetName(sceneId, objId))
		if GetName(sceneId, objId) == strNpcName then
			TAddNumText(sceneId,x229000_g_ScriptId,x229000_g_MissionName,4,-1,x229000_g_ScriptId);
		end

	end
	
	return 0;

end

function x229000_CheckCondition_UseItem( sceneId, selfId, targetId, eventId )
	------PrintStr("OnUseItem...")
	local misIndex = GetMissionIndexByID(sceneId, selfId, x229000_g_MissionId)

	--ªÒµ√∏√»ŒŒÒµƒ»ŒŒÒ¿‡–Õ
	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
	if missionType ~= x229000_g_SubMissionTypeEnum.DingDianYinDao then
		return 0
	end
	
	local index = GetMissionParam(sceneId, selfId, misIndex, 2)
	local targetSceneId = x229000_g_DingDianYinDaoList[index].scene
	--PrintNum(sceneId)
	if sceneId ~= targetSceneId then
		BeginEvent(sceneId)

			AddText(sceneId,"HÏnh nhﬂ ∑ ‚y khÙng ﬂ˛c b°n")

		EndEvent(sceneId)

		DispatchMissionTips(sceneId,selfId)

		return 0
	end
	
	local posx1 = x229000_g_DingDianYinDaoList[index].posx1
	local posz1 = x229000_g_DingDianYinDaoList[index].posz1
	local posx2 = x229000_g_DingDianYinDaoList[index].posx2
	local posz2 = x229000_g_DingDianYinDaoList[index].posz2

	--»°µ√ÕÊº“µ±«∞◊¯±Í

	local PlayerX = GetHumanWorldX(sceneId,selfId)

	local PlayerZ = GetHumanWorldZ(sceneId,selfId)

	
	--º∆À„ÕÊº“”Îƒø±Íµ„µƒæ‡¿Î
	if PlayerX >= posx1 and PlayerX < posx2 then
		------PrintStr("PlayerX >= posx1 and PlayerX < posx2...")
		if PlayerZ >= posz1 and PlayerZ < posz2 then
			------PrintStr("PlayerZ >= posz1 and PlayerZ < posz2...")
			return 1
		end
	end	

	BeginEvent(sceneId)

		AddText(sceneId, "ChÔ ﬂ˛c sÿ d¯ng trong khu vÒc chÔ ∏nh!")

	EndEvent(sceneId)

	DispatchMissionTips(sceneId,selfId)
	return 0

end

--**********************************
--µ¿æﬂ π”√
--**********************************
function x229000_Active_UseItem( sceneId, selfId, param0 )
	local misIndex = GetMissionIndexByID(sceneId, selfId, x229000_g_MissionId)

	--ªÒµ√∏√»ŒŒÒµƒ»ŒŒÒ¿‡–Õ
	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
	if missionType ~= x229000_g_SubMissionTypeEnum.DingDianYinDao then
		return 0
	end
	local index = GetMissionParam(sceneId, selfId, misIndex, 2)
	if LuaFnGetAvailableItemCount(sceneId, selfId, x229000_g_DingDianYinDaoList[index].itemId) >= 1 then
		DelItem( sceneId, selfId, x229000_g_DingDianYinDaoList[index].itemId, 1 )
	--∞—»ŒŒÒ◊¥Ã¨±‰¡ø…Ë÷√Œ™1,±Ì æ“—æ≠ÕÍ≥…
	SetMissionByIndex(sceneId,selfId,misIndex,0,1)
	else
		BeginEvent(sceneId)
		AddText(sceneId, "Vßt ph¶m c¸a c·c h’ hiÆn khÙng d˘ng ﬂ˛c ho£c „ b∏ khÛa")
		EndEvent( )
		DispatchMissionTips(sceneId,selfId)	
		return	
	end
end

--**********************************
--µ¿æﬂ∏ƒ±‰
--**********************************
function x229000_OnItemChanged( sceneId, selfId, itemdataId )
	--PrintStr("OnItemChanged")
	local misIndex = GetMissionIndexByID(sceneId, selfId, x229000_g_MissionId)

	--ªÒµ√∏√»ŒŒÒµƒ»ŒŒÒ¿‡–Õ
	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
	if missionType == x229000_g_SubMissionTypeEnum.XunWu then
		local _, strItemName, _ = x229000_GetItemDetailInfo(itemdataId)
		local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229000_g_StrForePart+1)
		local _, strDemandItemName, _ = x229000_GetItemDetailInfo(demandItemId)
		
		if strItemName == strDemandItemName then
			BeginEvent(sceneId)

				
				strText = format("–„ ’t ﬂ˛c %s", strItemName)
				AddText(sceneId,strText)
			EndEvent(sceneId)

			DispatchMissionTips(sceneId,selfId)
			SetMissionByIndex(sceneId,selfId,misIndex,0,1)
			ResetMissionEvent(sceneId, selfId, x229000_g_MissionId, 2)
		end
	elseif missionType == x229000_g_SubMissionTypeEnum.KaiGuang then
		local _, strItemName, _ = x229000_GetItemDetailInfo(itemdataId)
		local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229000_g_StrForePart+2)
		local _, strDemandItemName, _ = x229000_GetItemDetailInfo(demandItemId)
		
		if strItemName == strDemandItemName then
			BeginEvent(sceneId)
				strText = format("–„ ’t ﬂ˛c %s", strItemName)
				AddText(sceneId,strText)
			EndEvent(sceneId)
			DispatchMissionTips(sceneId,selfId)
			ResetMissionEvent(sceneId, selfId, x229000_g_MissionId, 2)
		end
	elseif missionType == x229000_g_SubMissionTypeEnum.ShouJi then
		--PrintStr("ShouJi...")
		local itemCount = GetItemCount(sceneId,selfId,itemdataId)
		local _, strItemName, _ = x229000_GetItemDetailInfo(itemdataId)
		local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229000_g_StrForePart+2)
		local _, strDemandItemName, _ = x229000_GetItemDetailInfo(demandItemId)
		
		if strItemName == strDemandItemName then
			BeginEvent(sceneId)
				local _, strItemName, _ = x229000_GetItemDetailInfo(itemdataId)
				strText = format("–„ ’t ﬂ˛c %s%d/5", strItemName, itemCount)
				AddText(sceneId,strText)
			EndEvent(sceneId)
			DispatchMissionTips(sceneId,selfId)
			
			if itemCount == 5 then
				SetMissionByIndex(sceneId,selfId,misIndex,0,1)
				ResetMissionEvent(sceneId, selfId, x229000_g_MissionId, 2)
			end
		end
	elseif missionType == x229000_g_SubMissionTypeEnum.killMonster then
		local _, _, itemId = x229000_GetMenpaiYiWuInfo(sceneId, selfId)
		if itemdataId == itemId  then
			SetMissionByIndex(sceneId,selfId,misIndex,0,1)
			ResetMissionEvent(sceneId, selfId, x229000_g_MissionId, 0)
			ResetMissionEvent(sceneId, selfId, x229000_g_MissionId, 2)
		end
	end

end

--**********************************
--’‰ ﬁ∏ƒ±‰
--**********************************
function x229000_OnPetChanged( sceneId, selfId, petDataId)
	----PrintStr("OnPetChanged...")
	local misIndex = GetMissionIndexByID(sceneId, selfId, x229000_g_MissionId)

	--ªÒµ√∏√»ŒŒÒµƒ»ŒŒÒ¿‡–Õ
	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
	if missionType == x229000_g_SubMissionTypeEnum.BuZhuo then
		local demandPetDataId = GetMissionParam(sceneId, selfId, misIndex, x229000_g_StrForePart+1)
		
		if petDataId == demandPetDataId then
			BeginEvent(sceneId)
				local strText = format("–„ ’t ﬂ˛c %s", GetPetName(petDataId))
				AddText(sceneId,strText)
			EndEvent(sceneId)

			DispatchMissionTips(sceneId,selfId)
			SetMissionByIndex(sceneId,selfId,misIndex,0,1)
			ResetMissionEvent(sceneId, selfId, x229000_g_MissionId, 3)
		end
	end
end
--**********************************
--Ã·Ωª
--**********************************
function x229000_OnSubmit( sceneId, selfId, targetId, selectRadioId )
	--PrintStr("OnSubmit...")
	local misIndex = GetMissionIndexByID(sceneId, selfId, x229000_g_MissionId)

	if x229000_CheckSubmit( sceneId, selfId, selectRadioId )>=1 then

		local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
		if missionType == x229000_g_SubMissionTypeEnum.XunWu then
			local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229000_g_StrForePart+1)
			--PrintStr("demandItemId"..demandItemId)
			if LuaFnGetAvailableItemCount(sceneId, selfId, demandItemId) >= 1 then
			local ret = DelItem(sceneId, selfId, demandItemId, 1)
			if ret <= 0 then
				BeginEvent(sceneId)
					AddText(sceneId, "KhÙng ¸ vßt ph¶m c•n, nhiÆm v¯ khÙng th¨ giao")
				EndEvent()
				DispatchMissionTips(sceneId, selfId)
				return
			end
			else
				BeginEvent(sceneId)
					AddText(sceneId, "Vßt ph¶m c¸a c·c h’ hiÆn khÙng d˘ng ﬂ˛c ho£c „ b∏ khÛa")
				EndEvent( )
				DispatchMissionTips(sceneId,selfId)	
				return	
			end
--		elseif missionType == x229000_g_SubMissionTypeEnum.killMonster then
--			local _, _, demandItemId  = x229000_GetMenpaiYiWuInfo(sceneId, selfId)
--			local ret = DelItem(sceneId, selfId, demandItemId, 1)
--			if ret <= 0 then
--				BeginEvent(sceneId)
--					AddText(sceneId, "√ª”–◊„πªµƒÀ˘–ËŒÔ∆∑£¨»ŒŒÒŒﬁ∑®Ã·Ωª")
--				EndEvent()
--				DispatchMissionTips(sceneId, selfId)
--				return
--			end
		elseif missionType == x229000_g_SubMissionTypeEnum.ShouJi then
			local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229000_g_StrForePart+2)
			if LuaFnGetAvailableItemCount(sceneId, selfId, demandItemId) >= 5 then
			local ret = DelItem(sceneId, selfId, demandItemId, 5)
			if ret <= 0 then
				BeginEvent(sceneId)
					AddText(sceneId, "KhÙng ¸ vßt ph¶m c•n, nhiÆm v¯ khÙng th¨ giao")
				EndEvent()
				DispatchMissionTips(sceneId, selfId)
				return
			end
			else
				BeginEvent(sceneId)
					AddText(sceneId, "Vßt ph¶m c¸a c·c h’ hiÆn khÙng d˘ng ﬂ˛c ho£c „ b∏ khÛa")
				EndEvent( )
				DispatchMissionTips(sceneId,selfId)	
				return	
			end
		end

		DelMission( sceneId, selfId, x229000_g_MissionId )
		--µ˜”√Õ®”√Ã·Ωª»ŒŒÒΩ”ø⁄Ω”ø⁄

		------------------------------------------------------------------
		local Reward_Append, MissionRound = CallScriptFunction( 500501, "OnSubmit_Necessary", sceneId, selfId, targetId )
		if Reward_Append == 2 and MissionRound == 20 then
			CallScriptFunction(229010, "AddOtherMenpaiFubenMission", sceneId, selfId, x229000_g_MissionId, targetId)
		end
		-------------------------------------------------------------------

		--x229000_OnDefaultEvent( sceneId, selfId, targetId )
		
	end
end

function x229000_OnMissionCheck( sceneId, selfId, targetId, scriptId, index1, index2, index3, petindex )
  if x229000_CheckSubmit( sceneId, selfId) < 1 then
    return 0
  end

	----PrintStr("OnMissionCheck...")
	local misIndex = GetMissionIndexByID(sceneId, selfId, x229000_g_MissionId)

	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
	if missionType == x229000_g_SubMissionTypeEnum.XunWu then
		local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229000_g_StrForePart+1)
		local _, strDemandItemName, _ = x229000_GetItemDetailInfo(demandItemId)
		--PrintStr("strDemandItemName="..strDemandItemName)
		--µ˜”√Õ®”√Ã·Ωª»ŒŒÒΩ”ø⁄Ω”ø⁄

		------------------------------------------------------------------

		local find = CallScriptFunction( 500501, "OnMissionCheck_NecessaryEx", sceneId, selfId, index1, index2, index3, demandItemId )

		-------------------------------------------------------------------


		if find < 0 then

			BeginEvent(sceneId)

				local strText = format("Sao ngﬂΩi vÁn chﬂa em %s v´ ﬂ˛c m‡ „ quay v´?", strDemandItemName)
				AddText(sceneId,strText)
				AddItemBonus( sceneId, demandItemId, 1 )
			EndEvent(sceneId)

			DispatchEventList(sceneId,selfId,-1)

			return
		end
		
		local ret = EraseItem( sceneId, selfId, find )
		if	ret > 0 then

			DelMission( sceneId, selfId, x229000_g_MissionId )

			--µ˜”√Õ®”√Ã·Ωª»ŒŒÒΩ”ø⁄Ω”ø⁄

			------------------------------------------------------------------
			local Reward_Append, MissionRound = CallScriptFunction( 500501, "OnSubmit_Necessary", sceneId, selfId,-1 )
			if Reward_Append == 2 and MissionRound == 20 then
				CallScriptFunction(229010, "AddOtherMenpaiFubenMission", sceneId, selfId, x229000_g_MissionId)
			end
			-------------------------------------------------------------------

		else
			BeginEvent(sceneId)

				local strText = format("Sao ngﬂΩi vÁn chﬂa em %s v´ ﬂ˛c m‡ „ quay v´?", strDemandItemName)
				AddText(sceneId,strText)
				AddItemBonus( sceneId, demandItemId, 1 )
			EndEvent(sceneId)

			DispatchEventList(sceneId,selfId,-1)
		end	
	elseif missionType == x229000_g_SubMissionTypeEnum.BuZhuo then
		----PrintStr("OnMissionCheck...BuZhuo...")
		local demandPetId = GetMissionParam(sceneId, selfId, misIndex, x229000_g_StrForePart+1)
		local petId = LuaFnGetPet_DataID(sceneId, selfId, petindex)
		if petId == demandPetId then
			if LuaFnIsPetAvailable(sceneId, selfId, petindex) >= 1 then
				LuaFnDeletePet(sceneId, selfId, petindex)
				----PrintStr("DeletePet"..petId..demandPetId)
				DelMission( sceneId, selfId, x229000_g_MissionId )

				--µ˜”√Õ®”√Ã·Ωª»ŒŒÒΩ”ø⁄Ω”ø⁄

				------------------------------------------------------------------
				local Reward_Append, MissionRound = CallScriptFunction( 500501, "OnSubmit_Necessary", sceneId, selfId,-1 )
				if Reward_Append == 2 and MissionRound == 20 then
					CallScriptFunction(229010, "AddOtherMenpaiFubenMission", sceneId, selfId, x229000_g_MissionId)
				end
				-------------------------------------------------------------------
			end	
		else
			BeginEvent(sceneId)
				AddText(sceneId, "Sao ngﬂΩi vÁn chﬂa em tr‚n th˙ m‡ ta c•n v´ ﬂ˛c m‡ „ quay v´?")
				--AddItemBonus( sceneId, demandItemId, 1 )
			EndEvent(sceneId)

			DispatchEventList(sceneId,selfId,-1)

		end

	end -- endif
	
end

--**********************************
--…±À¿π÷ŒÔªÚÕÊº“
--**********************************
function x229000_OnKillObject( sceneId, selfId, objdataId ,objId)--≤Œ ˝“‚Àº£∫≥°æ∞∫≈°¢ÕÊº“objId°¢π÷ŒÔ±ÌŒª÷√∫≈°¢π÷ŒÔ
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229000_g_MissionId)
	local nMonsterId = GetMissionParam(sceneId, selfId, misIndex, x229000_g_StrForePart+3)
	local _, strMonsterName = GetNpcInfoByNpcId(sceneId,nMonsterId)
	--PrintStr("strMonsterName" .. strMonsterName)
	local monsterName = GetMonsterNamebyDataId(objdataId)
	--PrintStr("monsterName" .. monsterName)
	
	if strMonsterName == monsterName  then
		local num = GetMonsterOwnerCount(sceneId,objId)
		for i=0,num-1  do
			-- »°µ√”µ”–∑÷≈‰»®µƒ»ÀµƒobjId
			local humanObjId = GetMonsterOwnerID(sceneId,objId,i)
			--PrintStr("humanObjId=" .. humanObjId)
			-- ø¥’‚∏ˆ»À «≤ª «”–’‚∏ˆ»ŒŒÒ
			if IsHaveMission(sceneId, humanObjId, x229000_g_MissionId) > 0 then
				-- œ»≈–∂œ «≤ª «“—æ≠¬˙◊„¡ÀÕÍ≥…±Í÷æ
				local misIndex = GetMissionIndexByID(sceneId,humanObjId,x229000_g_MissionId)
				if GetMissionParam(sceneId, humanObjId, misIndex, 0) <=0  then
					--SetMissionParamByIndexEx(sceneId, humanObjId, misIndex, 3, 0, 30)
					local demandKillCount = GetMissionParamEx(sceneId, humanObjId, misIndex, 3, 0)
					--PrintStr("demandKillCount=" .. demandKillCount)
					local killedCount =	GetMissionParamEx(sceneId, humanObjId, misIndex, 3, 1)
					killedCount = killedCount + 1
					SetMissionParamByIndexEx(sceneId, humanObjId, misIndex, 3, 1, killedCount)
					--PrintStr("killedCount=" .. killedCount)
					BeginEvent(sceneId)
						local str = format("–„ gi™t ch™t %d/%d%s", killedCount, demandKillCount, monsterName)
						AddText(sceneId, str)
					EndEvent()
					DispatchMissionTips(sceneId, humanObjId)
					if killedCount >= demandKillCount then
						SetMissionByIndex(sceneId, humanObjId, misIndex, 0, 1)
       end
				end --if
			end --if
		end --for				
  end --if
end


--**********************************
--Õ¨√≈œ‡÷˙....÷±Ω”ÕÍ≥…µ±«∞ª∑....
--**********************************
function x229000_HelpFinishOneHuan( sceneId, selfId, targetId )

	-- «∑Ò «±æ√≈≈…µ‹◊”....
	if MP_SHAOLIN ~= GetMenPai( sceneId, selfId ) then
		return
	end

	-- «∑ÒΩ”¡À ¶√≈»ŒŒÒ....
	if IsHaveMission(sceneId,selfId,x229000_g_MissionId) <= 0 then
		return
	end

	--ºÏ≤‚≤¢ø€≥˝Õ¨√≈œ‡÷˙À˘–Ëµƒ ¶√≈π±œ◊....
	local ret = CallScriptFunction( 229011, "CheckAndDepleteHelpFinishMenPaiPoint", sceneId, selfId, targetId )
	if ret == 0 then
		return
	end

	--ªÒ»° ¶√≈»ŒŒÒµƒ¿‡–Õ....
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229000_g_MissionId)
	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)

	--«Â≥˝»ŒŒÒŒÔ∆∑....
	local itemId = -1
	local itemCount = -1

	if missionType == x229000_g_SubMissionTypeEnum.SongXin then
		itemId = GetMissionParam(sceneId, selfId, misIndex,x229000_g_StrForePart+3)
		itemCount = LuaFnGetAvailableItemCount(sceneId, selfId, itemId)
		if itemCount >= 1 then
			DelItem(sceneId, selfId, itemId, 1)
		end
	elseif missionType == x229000_g_SubMissionTypeEnum.DingDianYinDao	then
		local index = GetMissionParam(sceneId, selfId, misIndex,2)
		itemId = x229000_g_DingDianYinDaoList[index].itemId
		itemCount = LuaFnGetAvailableItemCount(sceneId, selfId, itemId)
		if itemCount >= 1 then
			DelItem(sceneId, selfId, itemId, 1)
		end
	elseif missionType == x229000_g_SubMissionTypeEnum.ShouJi then
		itemId = GetMissionParam(sceneId, selfId, misIndex, x229000_g_StrForePart+2)
		itemCount = LuaFnGetAvailableItemCount(sceneId, selfId, itemId)
		if itemCount > 5 then
			itemCount = 5
		end
		if itemCount > 0 then
			DelItem(sceneId, selfId, itemId, itemCount)
		end
	end

	--…æ≥˝ÕÊº“»ŒŒÒ¡–±Ì÷–∂‘”¶µƒ»ŒŒÒ....
	DelMission( sceneId, selfId, x229000_g_MissionId )

	--µ˜”√Õ®”√Ã·Ωª»ŒŒÒΩ”ø⁄Ω”ø⁄....
	local Reward_Append, MissionRound = CallScriptFunction( 500501, "OnSubmit_Necessary", sceneId, selfId, targetId, 1 )

	if Reward_Append == 2 and MissionRound == 20 then
		--Ω±¿¯ÕÊº““ª∏ˆ»•±µƒ√≈≈…∏±±æµƒ ¶√≈»ŒŒÒ....
		CallScriptFunction(229010, "AddOtherMenpaiFubenMission", sceneId, selfId, x229000_g_MissionId, targetId)
	end

end
