-- ¾çÇéÑ­»·ÈÎÎñtoÕ ðµ ½±Àø
-- 200099

x200099_g_ScriptId = 200099
x200099_TIME_2000_01_03_ = 946828868

x200099_NpcInfo={{id=1,name="Mµc Uy¬n Thanh",		p1=92, m1=MD_JU_XUNHUAN_MUWANQING,	m2=MD_JU_XUNHUAN_MUWANQING_1, 	b1=7917, b2=7918, b3=7919, b4=7920},
								 {id=2,name="Chung Linh",			p1=93, m1=MD_JU_XUNHUAN_ZHONGLING,	m2=MD_JU_XUNHUAN_ZHONGLING_1, 	b1=7921, b2=7922, b3=7923, b4=7924},
								 {id=3,name="Ðoàn Diên Khánh",		p1=94, m1=MD_JU_XUNHUAN_DUANYANQING,m2=MD_JU_XUNHUAN_DUANYANQING_1, b1=-1, b2=7926, b3=7927, b4=7928},
								 {id=4,name="Ðoàn Chính Thu¥n",		p1=95, m1=MD_JU_XUNHUAN_DUANYU,			m2=MD_JU_XUNHUAN_DUANYU_1, 			b1=-1, b2=7930, b3=7931, b4=7932},
								 {id=5,name="Nguy­n Tinh Trúc",		p1=96, m1=MD_JU_XUNHUAN_AZHU,				m2=MD_JU_XUNHUAN_AZHU_1,				b1=-1, b2=7934, b3=7935, b4=7936},
								 {id=6,name="A Bích",			p1=97, m1=MD_JU_XUNHUAN_ABI,				m2=MD_JU_XUNHUAN_ABI_1, 				b1=7937, b2=7938, b3=7939, b4=7940},
								 {id=7,name="Vß½ng Phu Nhân",		p1=98, m1=MD_JU_XUNHUAN_WANGYUYAN,	m2=MD_JU_XUNHUAN_WANGYUYAN_1, 	b1=-1, b2=-1, b3=7943, b4=7944},
								 {id=8,name="Gia Lu§t ÐÕi ThÕch",	p1=99, m1=MD_JU_XUNHUAN_XIAOFENG,		m2=MD_JU_XUNHUAN_XIAOFENG_1, 		b1=-1, b2=-1, b3=7947, b4=7948},
								 {id=9,name="A TØ",			p1=100, m1=MD_JU_XUNHUAN_AZI,				m2=MD_JU_XUNHUAN_AZI_1, 				b1=-1, b2=7950, b3=7951, b3=7952},
								 {id=10,name="Mµ Dung Phøc",	p1=101, m1=MD_JU_XUNHUAN_MURONGFU,	m2=MD_JU_XUNHUAN_MURONGFU_1, 		b1=-1, b2=-1, b3=7955, b4=7956},
								 {id=11,name="Di®p Nh¸ Nß½ng",	p1=102, m1=MD_JU_XUNHUAN_XUZHU,			m2=MD_JU_XUNHUAN_XUZHU_1, 			b1=-1, b2=-1, b3=-1, b4=7960},
								 {id=12,name="Cßu Ma Trí",	p1=103, m1=MD_JU_XUNHUAN_JIUMOZHI,	m2=MD_JU_XUNHUAN_JIUMOZHI_1, 		b1=-1, b2=7962, b3=7963, b4=7964},
								 {id=13,name="Hách Liên Thiªt Thø",p1=104, m1=MD_JU_XUNHUAN_YINCHUAN,	m2=MD_JU_XUNHUAN_YINCHUAN_1, 		b1=-1, b2=7966, b3=7967, b4=7968}
								}
			                            
										                            
x200099_ItemInfo={{id=1,name="Mµc Uy¬n Thanh",	itn1=1, itn2=2, itn3=3, itn4=4, ItIx={30001001,30001002,30001003,30002001,30002002,
																																							30002003,30003001,30003002,30003003,30003011,
																																							30003012,30003013,30005021,30005022,30005023,
																																							30005024,30005025,30005026,30005027,30005028}},
								 {id=2,name="Chung Linh",			itn1=1, itn2=2, itn3=3, itn4=4, ItIx={30101001,30101002,30101003,30101013,30101014,30101015,30101031,30101032,30101033,
																																							30101041,30101042,30101043,30101051,30101052,30101053,30101061,30101062,30101063,
																																							30101071,30101072,30101073,30101081,30101082,30101083,30102001,30102002,30102003,
																																							30102004,30102005,30102006,30102007,30102008,30102009,30102010,30103002,30103003,
																																							30103004,30103005,30103006,30103007,30103008,30103009}},
								 {id=3,name="Ðoàn Diên Khánh",		itn1=0, itn2=1, itn3=2, itn4=3, ItIx={30005021,30005022,30005023,30005024,30005025,30005026,30005027,30005028}},
								 
								 {id=4,name="Ðoàn Chính Thu¥n",		itn1=0, itn2=1, itn3=2, itn4=3, ItIx={30102001,30102002,30102003,30102004,30102005,30102006,30102007,30102008,30102009,30102010}},
								 
								 {id=5,name="Nguy­n Tinh Trúc",		itn1=1, itn2=2, itn3=3, itn4=4, ItIx={30101004,30101005,30101006,30101016,30101017,30101018,30101034,30101035,30101036,
																																							30101044,30101045,30101046,30101054,30101055,30101056,30101064,30101065,30101066,
																																							30101074,30101075,30101076,30101084,30101085,30101086,30102011,30102012,30102013,
																																							30102014,30102015,30102016,30102017,30102018,30102019,30102020,30103001,30103010,
																																							30103011,30103012,30103013,30103014,30103015,30103016,30103017}},
								 {id=6,name="A Bích",			itn1=1, itn2=2, itn3=3, itn4=4, ItIx={30001004,30001005,30001006,30001011,30001012,30002004,30002005,30002006,30002011,
																																							30002012,30003004,30003005,30003006,30003014,30003015,30003016,30005029,30005030,
																																							30005031,30005032,30005033,30005034,30005035,30005036}},
								 {id=7,name="Vß½ng Phu Nhân",		itn1=0, itn2=1, itn3=2, itn4=3, ItIx={30102011,30102012,30102013,30102014,30102015,30102016,30102017,30102018,30102019,30102020,
																																							30103001,30103010,30103011,30103012,30103013,30103014,30103015,30103016,30103017}},
								 {id=8,name="Gia Lu§t ÐÕi ThÕch",	itn1=0, itn2=1, itn3=2, itn4=3, ItIx={30005029,30005030,30005031,30005032,30005033,30005034,30005035,30005036}},
								 
								 {id=9,name="A TØ",			itn1=1, itn2=2, itn3=3, itn4=4, ItIx={30001007,30001008,30001009,30001010,30001013,30001014,30001015,30002007,30002008,30002009,
																																							30002010,30002013,30002014,30002015,30003007,30003008,30003009,30003010,30003017,30003018,
																																							30003019,30003020,30005037,30005038,30005039,30005040,30005041,30005042,30005043,30005044}},
								 {id=10,name="Mµ Dung Phøc",	itn1=1, itn2=2, itn3=3, itn4=4, ItIx={30101007,30101008,30101009,30101010,30101011,30101012,30101019,30101020,30101021,
																																							30101022,30101023,30101024,30101037,30101038,30101039,30101040,30101047,30101048,
																																							30101049,30101050,30101057,30101058,30101059,30101060,30101067,30101068,30101069,
																																							30101070,30101077,30101078,30101079,30101080,30101087,30101088,30101089,30101090,
																																							30102021,30102022,30102023,30102024,30102025,30102026,30102027,30102028,30102029,
																																							30102030,30103018,30103019,30103020,30103021,30103022,30103023,30103024,30103025}},
								 {id=11,name="Di®p Nh¸ Nß½ng",	itn1=0, itn2=1, itn3=2, itn4=3, ItIx={30005037,30005038,30005039,30005040,30005041,30005042,30005043,30005044}},
								 
								 {id=12,name="Cßu Ma Trí",	itn1=1, itn2=2, itn3=3, itn4=4, ItIx={30001001,30001002,30001003,30001004,30001005,30001006,30001007,30001008,30001009,
																																							30001010,30001011,30001012,30001013,30001014,30001015,30002001,30002002,30002003,
																																							30002004,30002005,30002006,30002007,30002008,30002009,30002010,30002011,30002012,
																																							30002013,30002014,30002015,30003001,30003002,30003003,30003004,30003005,30003006,
																																							30003007,30003008,30003009,30003010,30003011,30003012,30003013,30003014,30003015,
																																							30003016,30003017,30003018,30003019,30003020,30005021,30005022,30005023,30005024,
																																							30005025,30005026,30005027,30005028,30005029,30005030,30005031,30005032,30005033,
																																							30005034,30005035,30005036,30005037,30005038,30005039,30005040,30005041,30005042,
																																							30005043,30005044,30101001,30101002,30101003,30101004,30101005,30101006,30101007,
																																							30101008,30101009,30101010,30101011,30101012,30101013,30101014,30101015,30101016,
																																							30101017,30101018,30101019,30101020,30101021,30101022,30101023,30101024,30101031,
																																							30101032,30101033,30101034,30101035,30101036,30101037,30101038,30101039,30101040,
																																							30101041,30101042,30101043,30101044,30101045,30101046,30101047,30101048,30101049,
																																							30101050,30101051,30101052,30101053,30101054,30101055,30101056,30101057,30101058,
																																							30101059,30101060,30101061,30101062,30101063,30101064,30101065,30101066,30101067,
																																							30101068,30101069,30101070,30101071,30101072,30101073,30101074,30101075,30101076,
																																							30101077,30101078,30101079,30101080,30101081,30101082,30101083,30101084,30101085,
																																							30101086,30101087,30101088,30101089,30101090,30102001,30102002,30102003,30102004,
																																							30102005,30102006,30102007,30102008,30102009,30102010,30102011,30102012,30102013,
																																							30102014,30102015,30102016,30102017,30102018,30102019,30102020,30102021,30102022,
																																							30102023,30102024,30102025,30102026,30102027,30102028,30102029,30102030,30103001,
																																							30103002,30103003,30103004,30103005,30103006,30103007,30103008,30103009,30103010,
																																							30103011,30103012,30103013,30103014,30103015,30103016,30103017,30103018,30103019,
																																							30103020,30103021,30103022,30103023,30103024,30103025}},
								 {id=13,name="Hách Liên Thiªt Thø",itn1=0, itn2=1, itn3=2, itn4=3, ItIx={30102021,30102022,30102023,30102024,30102025,30102026,30102027,30102028,30102029,
																																							30102030,30103018,30103019,30103020,30103021,30103022,30103023,30103024,30103025}}
								}

x200099_BonusHelp={	"#{xunhuan_help_001}", "#{xunhuan_help_002}", "#{xunhuan_help_003}",
										"#{xunhuan_help_004}", "#{xunhuan_help_005}", "#{xunhuan_help_006}",
										"#{xunhuan_help_007}", "#{xunhuan_help_008}", "#{xunhuan_help_009}",
										"#{xunhuan_help_010}", "#{xunhuan_help_011}", "#{xunhuan_help_012}",
										"#{xunhuan_help_013}", "#{xunhuan_help_014}", "#{xunhuan_help_015}",
										"#{xunhuan_help_016}", "#{xunhuan_help_017}", "#{xunhuan_help_018}",
										"#{xunhuan_help_019}", "#{xunhuan_help_020}"}

x200099_BonusCaoyao={ {20101001,20101002},
											{20101003,20101004},
											{20101005,20101006,20101007},
											{20101008,20101009,20101010},
											{20101011,20101012,20101013},
											{20101014,20101015,20101016},
											{20101017,20101018,20101019},
											{20101020,20101021,20101022},
											{20101023,20101024},
											{20101025,20101026},
											{20101027,20101028},
											{20101029,20101030} }

x200099_BonusKuangshi={ 20103001,20103002,20103003,20103004,20103005,20103006,
												20103007,20103008,20103009,20103010,20103011,20103012 }

x200099_BonusFood={ {20102001,20102013},
										{20102002,20102014},
										{20102003,20102015},
										{20102004,20102016},
										{20102005,20102017},
										{20102006,20102018},
										{20102007,20102019},
										{20102008,20102020},
										{20102009,20102021},
										{20102010,20102022},
										{20102011,20102023},
										{20102012,20102024} }
                    
x200099_BonusGrow= { {20104001,20105001},
										 {20104002,20105002},
										 {20104003,20105003},
										 {20104004,20105004},
										 {20104005,20105005},
										 {20104006,20105006},
										 {20104007,20105007},
										 {20104008,20105008},
										 {20104009,20105009},
										 {20104010,20105010},
										 {20104011,20105011},
										 {20104012,20105012} }
										
x200099_BonusChangModle={4836,4837,4838,4839,4840,4841,4842,4843,4844,4845,4861,4862}

x200099_BonusZhaoJiLing={30501001,30501002}

x200099_MenpaiRelationPoint = {
{mp=0,p1=649, p2=649, p3=539 , p4=649 ,p5=894 ,p6=649,p7=649 ,p8=1052,p9=350 ,p10=589,p11=1289,p12=679,p13=649 },
{mp=1,p1=649, p2=649, p3=774 , p4=559 ,p5=380 ,p6=649,p7=649 ,p8=315 ,p9=899 ,p10=410,p11=614 ,p12=649,p13=200 },
{mp=2,p1=649, p2=649, p3=719 , p4=709 ,p5=589 ,p6=619,p7=500 ,p8=1539,p9=500 ,p10=589,p11=529 ,p12=704,p13=500 },
{mp=3,p1=649, p2=649, p3=639 , p4=589 ,p5=619 ,p6=619,p7=500 ,p8=180 ,p9=500 ,p10=500,p11=500 ,p12=664,p13=649 },
{mp=4,p1=649, p2=649, p3=480 , p4=589 ,p5=1169,p6=619,p7=500 ,p8=514 ,p9=500 ,p10=410,p11=739 ,p12=664,p13=649 },
{mp=5,p1=649, p2=649, p3=639 , p4=549 ,p5=350 ,p6=300,p7=100 ,p8=440 ,p9=1874,p10=589,p11=927 ,p12=664,p13=649 },
{mp=6,p1=899, p2=899, p3=1179, p4=1152,p5=649 ,p6=619,p7=500 ,p8=909 ,p9=500 ,p10=589,p11=470 ,p12=802,p13=649 },
{mp=7,p1=649, p2=649, p3=500 , p4=544 ,p5=859 ,p6=619,p7=500 ,p8=834 ,p9=500 ,p10=589,p11=1484,p12=649,p13=500 },
{mp=8,p1=649, p2=649, p3=589 , p4=727 ,p5=529 ,p6=774,p7=1874,p8=574 ,p9=100 ,p10=500,p11=1047,p12=664,p13=500 },
{mp=0,p1=0, p2=0, p3=0 , p4=0 ,p5=0 ,p6=0,p7=0,p8=0 ,p9=0 ,p10=0,p11=0,p12=0,p13=0 },
}

--**********************************
--ÈÎÎñÈë¿Úº¯Êý
--**********************************
function x200099_OnDefaultEvent( sceneId, selfId, targetId )

	local nNpcId = x200099_GetNpcId( sceneId, selfId, targetId )
	if nNpcId <= 0 or nNpcId > 13 then
		return
	end
	
	--  ðÕt ðßþcNpctoÕ ðµ Index
	local nNpcIndex = 0
	for i=1, getn(x200099_NpcInfo)  do
		if nNpcId == x200099_NpcInfo[i].id  then
			nNpcIndex = i
			break
		end
	end

	if GetNumText() == 1  then
		BeginEvent( sceneId )
			AddText( sceneId, "  Chúng ta nói chuy®n gì?" )
			AddNumText( sceneId, x200099_g_ScriptId, "Võ công thiên hÕ", 0, 2 )
			AddNumText( sceneId, x200099_g_ScriptId, "DßÞng sinh chi ðÕo", 0, 3 )
			AddNumText( sceneId, x200099_g_ScriptId, "Giang h° truy«n ngôn", 0, 4 )
		EndEvent( sceneId )
		DispatchEventList( sceneId, selfId, targetId )
	end
	
	if GetNumText() == 2  then
		-- ÌìÏÂÎä¹¦
		--  ðÕt ðßþcµ±Ç°ÈÎÎñÊý¾Ý±äÁ¿
		-- ¿´Cái này Ê±¼äºÍÏÖTÕi Ðúng²»Ðúng¾­¹ýÁË1Ìì,Èç¹û¾­¹ýÁË1Ìì,¾ÍË¢ÐÂÊý¾Ý
		local nTime = GetMissionData(sceneId, selfId, x200099_NpcInfo[nNpcIndex].m2)
		local nNowTime = LuaFnGetCurrentTime()

		if (nNowTime-nTime > 60*60*24) or
		 (floor((nNowTime-x200099_TIME_2000_01_03_)/(3600*24)) ~= floor((nTime-x200099_TIME_2000_01_03_)/(3600*24)))   then
			SetMissionData(sceneId, selfId, x200099_NpcInfo[nNpcIndex].m1, 0)
		end
		
		local nData = GetMissionData(sceneId, selfId, x200099_NpcInfo[nNpcIndex].m1)
		
		-- ¼ÇÂ¼Ê±¼ä
		local f1
		local f2
		local f3
		
		f1,f2,f3 = x200099_1To3(nData)
		if f1 == 1  then
			BeginEvent( sceneId )
				AddText( sceneId, "  Hôm nay chúng ta nói chuy®n th§t vui. Nhßng chü ð« này h½i nhàm r°i, chúng ta nói sang chü ð« khác ði." )
			EndEvent( sceneId )
			DispatchEventList( sceneId, selfId, targetId )
			return
		end
		
		if nNowTime-nTime < 1800   then
			BeginEvent( sceneId )
				AddText( sceneId, "  Hôm nay chúng ta nói chuy®n th§t vui. Có ði«u bây gi¶ tÕi hÕ khát khô cä c± r°i, lát næa nói chuy®n tiªp." )
			EndEvent( sceneId )
			DispatchEventList( sceneId, selfId, targetId )
			return
		end
		
		f1 = 1
		nData = x200099_3To1(f1,f2,f3)
		
		SetMissionData(sceneId, selfId, x200099_NpcInfo[nNpcIndex].m1, nData)
		SetMissionData(sceneId, selfId, x200099_NpcInfo[nNpcIndex].m2, nNowTime)
		
		x200099_DokongFuTianxia( sceneId, selfId, nNpcId ,targetId )
		
	elseif GetNumText() == 3  then
		-- ÑøÉúÖ®µÀ
		--  ðÕt ðßþcµ±Ç°ÈÎÎñÊý¾Ý±äÁ¿
		-- ¿´Cái này Ê±¼äºÍÏÖTÕi Ðúng²»Ðúng¾­¹ýÁË1Ìì,Èç¹û¾­¹ýÁË1Ìì,¾ÍË¢ÐÂÊý¾Ý
		local nTime = GetMissionData(sceneId, selfId, x200099_NpcInfo[nNpcIndex].m2)
		local nNowTime = LuaFnGetCurrentTime()
		
		if (nNowTime-nTime > 60*60*24) or
		 (floor((nNowTime-x200099_TIME_2000_01_03_)/(3600*24)) ~= floor((nTime-x200099_TIME_2000_01_03_)/(3600*24)))   then
			SetMissionData(sceneId, selfId, x200099_NpcInfo[nNpcIndex].m1, 0)
		end
		
		local nData = GetMissionData(sceneId, selfId, x200099_NpcInfo[nNpcIndex].m1)
		
		-- ¼ÇÂ¼Ê±¼ä
		local f1
		local f2
		local f3
		
		f1,f2,f3 = x200099_1To3(nData)
		if f2 == 1  then
			BeginEvent( sceneId )
				AddText( sceneId, "  Hôm nay chúng ta nói chuy®n th§t vui. Nhßng chü ð« này h½i nhàm r°i, chúng ta nói sang chü ð« khác ði." )
			EndEvent( sceneId )
			DispatchEventList( sceneId, selfId, targetId )
			return
		end
		
		if nNowTime-nTime < 1800   then
			BeginEvent( sceneId )
				AddText( sceneId, "  Hôm nay chúng ta nói chuy®n th§t vui. Có ði«u bây gi¶ tÕi hÕ khát khô cä c± r°i, lát næa nói chuy®n tiªp." )
			EndEvent( sceneId )
			DispatchEventList( sceneId, selfId, targetId )
			return
		end
		
		f2 = 1
		nData = x200099_3To1(f1,f2,f3)
		
		SetMissionData(sceneId, selfId, x200099_NpcInfo[nNpcIndex].m1, nData)
		SetMissionData(sceneId, selfId, x200099_NpcInfo[nNpcIndex].m2, nNowTime)

		x200099_DoHealthOfLoad( sceneId, selfId, nNpcId ,targetId )

	elseif GetNumText() == 4  then
		-- ½­ºþ´«ÑÔ
		--  ðÕt ðßþcµ±Ç°ÈÎÎñÊý¾Ý±äÁ¿
		-- ¿´Cái này Ê±¼äºÍÏÖTÕi Ðúng²»Ðúng¾­¹ýÁË1Ìì,Èç¹û¾­¹ýÁË1Ìì,¾ÍË¢ÐÂÊý¾Ý
		local nTime = GetMissionData(sceneId, selfId, x200099_NpcInfo[nNpcIndex].m2)
		local nNowTime = LuaFnGetCurrentTime()
		
		if (nNowTime-nTime > 60*60*24) or
		 (floor((nNowTime-x200099_TIME_2000_01_03_)/(3600*24)) ~= floor((nTime-x200099_TIME_2000_01_03_)/(3600*24)))   then
			SetMissionData(sceneId, selfId, x200099_NpcInfo[nNpcIndex].m1, 0)
		end
		
		local nData = GetMissionData(sceneId, selfId, x200099_NpcInfo[nNpcIndex].m1)
		
		-- ¼ÇÂ¼Ê±¼ä
		local f1
		local f2
		local f3
		
		f1,f2,f3 = x200099_1To3(nData)
		if f3 == 1  then
			BeginEvent( sceneId )
				AddText( sceneId, "  Hôm nay chúng ta nói chuy®n th§t vui. Nhßng chü ð« này h½i nhàm r°i, chúng ta nói sang chü ð« khác ði." )
			EndEvent( sceneId )
			DispatchEventList( sceneId, selfId, targetId )
			return
		end
		
		if nNowTime-nTime < 1800   then
			BeginEvent( sceneId )
				AddText( sceneId, "  Hôm nay chúng ta nói chuy®n th§t vui. Có ði«u bây gi¶ tÕi hÕ khát khô cä c± r°i, lát næa nói chuy®n tiªp." )
			EndEvent( sceneId )
			DispatchEventList( sceneId, selfId, targetId )
			return
		end
		
		f3 = 1
		nData = x200099_3To1(f1,f2,f3)
		
		SetMissionData(sceneId, selfId, x200099_NpcInfo[nNpcIndex].m1, nData)
		SetMissionData(sceneId, selfId, x200099_NpcInfo[nNpcIndex].m2, nNowTime)

		x200099_DoHearsay( sceneId, selfId, nNpcId ,targetId )

	end
	
end

--**********************************
--ÁÐ¾ÙÊÂ¼þ
--**********************************
function x200099_OnEnumerate( sceneId, selfId, targetId )

	-- Íæ¼ÒÍê³ÉÏà¹Ø¾çÇéÈÎÎñºó,²ÅÄÜ¿´¼ûCái này Ñ¡Ïî
	local szNpcName = GetName(sceneId, targetId)
	local nIndex = 0
	for i=1,13   do
		if szNpcName == x200099_NpcInfo[i].name then
			nIndex = i
		end
	end
	
	if (IsMissionHaveDone(sceneId,selfId,x200099_NpcInfo[nIndex].mis) > 0 ) then
		AddNumText( sceneId, x200099_g_ScriptId, "½»Ì¸", 0, 1 )
	end
	
end

--**********************************
--targetId -> x200099_NpcInfo id
--**********************************
function x200099_GetNpcId( sceneId, selfId, targetId )
	local szNpcName = GetName(sceneId, targetId)
	local nNpcId = 0
	for i=1, 13   do
		if szNpcName == x200099_NpcInfo[i].name   then
			nNpcId = x200099_NpcInfo[i].id
			break
		end
	end
	return nNpcId
end

--**********************************
--1Î»±ä3Î»
--**********************************
function x200099_1To3( nData )
	local nTemp1 = 0
	local nTemp2 = 0
	local nTemp3 = 0
	
	nTemp3 = mod(nData, 10)
	nTemp2 = floor(mod(nData, 100) / 10)
	nTemp1 = floor(mod(nData, 1000)/100)
	
	return nTemp1,nTemp2,nTemp3
end

--**********************************
--3Î»±ä1Î»
--**********************************
function x200099_3To1( nData1, nData2, nData3 )
	local nTemp = 0
	
	if (nData1>=0 and nData1<10) and (nData2>=0 and nData2<10) and (nData3>=0 and nData3<10)   then
		nTemp = nData1*100 + nData2*10 + nData3
	end
	
	return nTemp
end

--**********************************
-- ÌìÏÂÎä¹¦
--**********************************
function x200099_DokongFuTianxia( sceneId, selfId, NpcId ,targetId )

	local nNpcIndex = 0
	for i=1, 13  do
		if x200099_NpcInfo[i].id == NpcId   then
			nNpcIndex = i
		end
	end
	
	if nNpcIndex == 0  then
		return
	end
	
	--  ðÕt ðßþc×Ô¼ººÍNPCtoÕ ðµ ¹ØÏµµÈc¤p
	local nRelationLevel = x200099_GetNpcRelationLevel( sceneId, selfId, NpcId )
	local nBuffId = -1
	
	if nRelationLevel == 1   then
		nBuffId = x200099_NpcInfo[nNpcIndex].b1
	elseif nRelationLevel == 2   then
		nBuffId = x200099_NpcInfo[nNpcIndex].b2
	elseif nRelationLevel == 3   then
		nBuffId = x200099_NpcInfo[nNpcIndex].b3
	elseif nRelationLevel == 4   then
		nBuffId = x200099_NpcInfo[nNpcIndex].b4
	end	

	if nBuffId == -1  then
		BeginEvent( sceneId )
			AddText( sceneId, "  Kiªn giäi cüa các hÕ v« võ công thiên hÕ quä th§t khiªn cho tÕi hÕ m· mang t¥m m¡t. #rTÕi hÕ cäm th¤y nªu quan h® cüa #Gchúng ta#W có th¬ tiªn thêm mµt bß¾c thì cuµc nói chuy®n cüa chúng ta m¾i càng thêm ý nghîa." )
		EndEvent( sceneId )
		DispatchEventList( sceneId, selfId, targetId )
		return
	end
	
	-- ¸øÍæ¼ÒÌí¼Ómµt cáiBUFF,Í¬Ê±¸øÍæ¼Ò¼ÇÂ¼Ïà¹ØtoÕ ðµ ¶«Î÷
	BeginEvent( sceneId )
		AddText( sceneId, "  Kiªn giäi cao thâm cüa các hÕ v« võ công thiên hÕ quä th§t khiªn tÕi hÕ m· mang r¤t nhi«u. G¥n ðây tÕi hÕ h÷c ðßþc mµt ít võ công tâm ð¡c m¾i, xin các hÕ chï ði¬m!" )
	EndEvent( sceneId )
	DispatchEventList( sceneId, selfId, targetId )
	
	LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, nBuffId, 100 )
	
end

--**********************************
-- ÑøÉúÖ®µÀ
--**********************************
function x200099_DoHealthOfLoad( sceneId, selfId, NpcId ,targetId )
	local nNpcIndex = 0
	for i=1, 13  do
		if x200099_NpcInfo[i].id == NpcId   then
			nNpcIndex = i
		end
	end
	
	if nNpcIndex == 0  then
		return
	end
	
	--  ðÕt ðßþc×Ô¼ººÍNPCtoÕ ðµ ¹ØÏµµÈc¤p
	local nRelationLevel = x200099_GetNpcRelationLevel( sceneId, selfId, NpcId )
	local nItemNum = 0
	
	if nRelationLevel == 1   then
		nItemNum = x200099_ItemInfo[nNpcIndex].itn1
	elseif nRelationLevel == 2   then
		nItemNum = x200099_ItemInfo[nNpcIndex].itn2
	elseif nRelationLevel == 3   then
		nItemNum = x200099_ItemInfo[nNpcIndex].itn3
	elseif nRelationLevel == 4   then
		nItemNum = x200099_ItemInfo[nNpcIndex].itn4
	end	
	
	if nItemNum == 0  then
		BeginEvent( sceneId )
			AddText( sceneId, "  DßÞng sinh chi ðÕo cüa các hÕ quä th§t khiªn cho tÕi hÕ m· mang t¥m m¡t. #r rTÕi hÕ cäm th¤y nªu quan h® #G cüa chúng ta #W có th¬ tiªn thêm mµt bß¾c thì cuµc nói chuy®n cüa chúng ta m¾i càng thêm ý nghîa." )
		EndEvent( sceneId )
		DispatchEventList( sceneId, selfId, targetId )
		return
	end	
	
	-- ¸øÍæ¼Ò ði¬mÐ¡¶«Î÷½±Àø
	local nItemId = 0
	local szItemName = ""
	local nItemRandIdx = random(getn(x200099_ItemInfo[nNpcIndex].ItIx))
	nItemId = x200099_ItemInfo[nNpcIndex].ItIx[nItemRandIdx]
	szItemName = GetItemName(sceneId, nItemId)
	nItemId,szItemName,_,_ = GetOneMissionBonusItem(x200099_ItemInfo[nNpcIndex].ItIx)
	
	BeginEvent( sceneId )
		local szItem = "#R#{_ITEM" .. tostring(nItemId) .. "}#W"
		AddText( sceneId, "  DßÞng sinh chi ðÕo cüa các hÕ quä th§t khiªn tÕi hÕ m· mang r¤t nhi«u. TÕi hÕ g¥n ðây sØ døng thß¶ng xuyên" .. szItem .."DßÞng sinh, xem ra không thích hþp. Cái ðó" .. tostring(nItemNum) .. "Cái" .. szItem .."Xin t£ng các hÕ" )
	-- ¸øÍæ¼Ò+Cái này ÎïÆ·
  BeginAddItem(sceneId)
		AddItem( sceneId, nItemId, nItemNum )
	local ret = EndAddItem(sceneId,selfId)

	if ret < 1  then
		AddText( sceneId, "  Tiªc là tay näi tÕi hÕ mang theo ðã ð¥y r°i, chuy®n này tÕm th¶i ð¬ ð¤y ðã." )
	else
		AddItemListToHuman(sceneId,selfId)
	end
	EndEvent( sceneId )
	DispatchEventList( sceneId, selfId, targetId )
	
end

--**********************************
-- ½­ºþ´«ÑÔ
--**********************************
function x200099_DoHearsay( sceneId, selfId, NpcId ,targetId )
	--  ðÕt ðßþc×Ô¼ººÍNPCtoÕ ðµ ¹ØÏµµÈc¤p
	local nRelationLevel = x200099_GetNpcRelationLevel( sceneId, selfId, NpcId )

	local nBonusType = 0
	
	if nRelationLevel == 0  then
		nBonusType = 1
	
	elseif nRelationLevel == 1  then
		local nTemp = random(100)
		if nTemp < 60  then
			nBonusType = 1
		elseif nTemp < 90  then
			nBonusType = 2
		else
			nBonusType = 4
		end
	elseif nRelationLevel == 2  then
		local nTemp = random(100)
		if nTemp < 20  then
			nBonusType = 1
		elseif nTemp < 50  then
			nBonusType = 2
		elseif nTemp < 60  then
			nBonusType = 4
		elseif nTemp < 68  then
			nBonusType = 5
		elseif nTemp < 76  then
			nBonusType = 6
		elseif nTemp < 84  then
			nBonusType = 7
		elseif nTemp < 92  then
			nBonusType = 8
		else
			nBonusType = 9
		end
	elseif nRelationLevel == 3  then
		local nTemp = random(100)
		
		if nTemp < 10  then
			nBonusType = 1
		elseif nTemp < 40  then
			nBonusType = 2
		elseif nTemp < 50  then
			nBonusType = 3
		elseif nTemp < 60  then
			nBonusType = 4
		elseif nTemp < 68  then
			nBonusType = 5
		elseif nTemp < 76  then
			nBonusType = 6
		elseif nTemp < 84  then
			nBonusType = 7
		elseif nTemp < 92  then
			nBonusType = 8
		else
			nBonusType = 9
		end
	elseif nRelationLevel == 4  then
		local nTemp = random(100)
		
		if nTemp < 30  then
			nBonusType = 2
		elseif nTemp < 40  then
			nBonusType = 3
		elseif nTemp < 50  then
			nBonusType = 4
		elseif nTemp < 60  then
			nBonusType = 5
		elseif nTemp < 70  then
			nBonusType = 6
		elseif nTemp < 80  then
			nBonusType = 7
		elseif nTemp < 90  then
			nBonusType = 8
		else
			nBonusType = 9
		end
	end	
	
	if nBonusType == 0  then
		-- ´íÎó,Ö±½Ó¹Ø±Õ
		return
		
	elseif nBonusType == 1   then
		-- mµt ¾ä°ïÖú
		local nRandIndex = random(getn(x200099_BonusHelp))
		BeginEvent( sceneId )
			--AddText( sceneId, "mµt ¾ä°ïÖú" )
			AddText( sceneId, x200099_BonusHelp[nRandIndex] )
		EndEvent( sceneId )
		DispatchEventList( sceneId, selfId, targetId )
		return
		
	elseif nBonusType == 2   then
		-- »Ø¸´ÂúÑªÂúÀ¶
		BeginEvent( sceneId )
			--AddText( sceneId, "»Ø¸´ÂúÑªÂúÀ¶" )
			AddText( sceneId, "  Giang h° hi¬m ác, lúc thß¶ng duy trì trÕng thái sÑc khoë r¤t quan tr÷ng." )
		EndEvent( sceneId )
		DispatchEventList( sceneId, selfId, targetId )
		-- ¸øÍæ¼mµt ØÑª»áÀ¶
		SetHp(sceneId, selfId, GetMaxHp(sceneId, selfId))
		SetMp(sceneId, selfId, GetMaxMp(sceneId, selfId))
		
	elseif nBonusType == 3   then
		-- ÂúÑªÂúÀ¶toÕ ðµ Ò©Æ·(Î¨mµt )
		BeginEvent( sceneId )
			--AddText( sceneId, "ÂúÑªÂúÀ¶toÕ ðµ Ò©Æ·" )
			AddText( sceneId, "  G¥n ðây tÕi hÕ b¤t ng¶ nh§n ðßþc mµt viên Thß½ng lang bÕch lµc hoàn, xin t£ng các hÕ." )
		
			-- ¸øÍæ¼Ò+Cái này ÎïÆ·
		  BeginAddItem(sceneId)
				AddItem( sceneId, 30001015, 1 )
			local ret = EndAddItem(sceneId,selfId)
		
			if ret < 1  then
				AddText( sceneId, "  Tiªc là tay näi tÕi hÕ mang theo ðã ð¥y r°i, chuy®n này tÕm th¶i ð¬ ð¤y ðã." )
			else
				AddItemListToHuman(sceneId,selfId)
			end
		EndEvent( sceneId )
		DispatchEventList( sceneId, selfId, targetId )
		
	elseif nBonusType == 4   then
		-- ±äÉí
		BeginEvent( sceneId )
			--AddText( sceneId, "±äÉí" )
			AddText( sceneId, "  Nào, thØ cái này xem... A, $N, sao các hÕ lÕi biªn thành thª này?" )
		EndEvent( sceneId )
		DispatchEventList( sceneId, selfId, targetId )
 		
 		local nModleIndex = random(getn(x200099_BonusChangModle))
 		local nModleId = x200099_BonusChangModle[nModleIndex]
 		
 		LuaFnSendSpecificImpactToUnit(sceneId,selfId,selfId,selfId,nModleId,1)


	elseif nBonusType == 5   then
		--  ðÕt ðßþcÃÅÅÉÕÙ¼¯Áî   30501001/30501002
		BeginEvent( sceneId )
			--AddText( sceneId, " ðÕt ðßþcÃÅÅÉÕÙ¼¯Áî" )
			AddText( sceneId, "  Nªu sß môn có vi®c g¤p, dùng l®nh tri®u t§p môn phái quä là mµt sñ lña ch÷n không t°i." )
			
			local nLingPaiIndex = random(getn(x200099_BonusZhaoJiLing))
			local nLingPaiId = x200099_BonusZhaoJiLing[nLingPaiIndex]
			local nItemNum = 0
			if nRelationLevel == 2  then
				nItemNum = 1
			elseif nRelationLevel == 3  then
				nItemNum = 5
			elseif nRelationLevel == 4  then
				nItemNum = 10
			end
			
			-- ¸øÍæ¼Ò+Cái này ÎïÆ·
			if nItemNum > 0  then
			  BeginAddItem(sceneId)
					AddItem( sceneId, nLingPaiId, nItemNum )
				local ret = EndAddItem(sceneId,selfId)
			
				if ret < 1  then
					AddText( sceneId, "  Tiªc là tay näi tÕi hÕ mang theo ðã ð¥y r°i, chuy®n này tÕm th¶i ð¬ ð¤y ðã." )
				else
					AddItemListToHuman(sceneId,selfId)
				end
			end
		EndEvent( sceneId )
		DispatchEventList( sceneId, selfId, targetId )
		
	elseif nBonusType == 6   then
		-- ²ÝÒ©
		local playerlevel = GetLevel( sceneId, selfId )
		playerlevel = floor( playerlevel / 10 )
		if playerlevel == 0 then
			playerlevel = 1
		end
		local nCaoYaoList = x200099_BonusCaoyao[playerlevel]
		local nCaoyaoIndex = random(getn(nCaoYaoList))
		local nCaoyaoId = nCaoYaoList[nCaoyaoIndex]
		
		local nCaoyaoNum = 0
		if nRelationLevel == 2  then
			nCaoyaoNum = 10
		elseif nRelationLevel == 3  then
			nCaoyaoNum = 20
		elseif nRelationLevel == 4  then
			nCaoyaoNum = 40
		end
	
		BeginEvent( sceneId )
			--AddText( sceneId, "²ÝÒ©" )
			AddText( sceneId, "  Hôm qua không có chuy®n gì, tÕi hÕ lên núi cho khuây khoä, ti®n th¬ hái mµt ít thäo dßþc, xin biªu các hÕ." )
		
			-- ¸øÍæ¼Ò+Cái này ÎïÆ·
			if nCaoyaoNum > 0 then
			  BeginAddItem(sceneId)
					AddItem( sceneId, nCaoyaoId, nCaoyaoNum )
				local ret = EndAddItem(sceneId,selfId)
			
				if ret < 1  then
					AddText( sceneId, "  Tiªc là tay näi tÕi hÕ mang theo ðã ð¥y r°i, chuy®n này tÕm th¶i ð¬ ð¤y ðã." )
				else
					AddItemListToHuman(sceneId,selfId)
				end
			end
		EndEvent( sceneId )
		DispatchEventList( sceneId, selfId, targetId )
		
	elseif nBonusType == 7   then
		-- Ê³²Ä
		local playerlevel = GetLevel( sceneId, selfId )
		playerlevel = floor( playerlevel / 10 )
		if playerlevel == 0 then
			playerlevel = 1
		end
		local nFoodList = x200099_BonusFood[playerlevel]		
		local nFoodIndex = random(getn(nFoodList))
		local nFoodId = nFoodList[nFoodIndex]
		
		local nFoodNum = 0
		if nRelationLevel == 2  then
			nFoodNum = 10
		elseif nRelationLevel == 3  then
			nFoodNum = 20
		elseif nRelationLevel == 4  then
			nFoodNum = 40
		end
	
		BeginEvent( sceneId )
			--AddText( sceneId, "Ê³²Ä" )
			AddText( sceneId, "  Hôm qua không có chuy®n gì, tÕi hÕ xu¯ng bªp cho khuây khoä, ti®n th¬ làm mµt vài nguyên li®u thÑc ån, xin biªu các hÕ." )
		
			-- ¸øÍæ¼Ò+Cái này ÎïÆ·
			if nFoodNum > 0 then
			  BeginAddItem(sceneId)
					AddItem( sceneId, nFoodId, nFoodNum )
				local ret = EndAddItem(sceneId,selfId)
			
				if ret < 1  then
					AddText( sceneId, "  Tiªc là tay näi tÕi hÕ mang theo ðã ð¥y r°i, chuy®n này tÕm th¶i ð¬ ð¤y ðã." )
				else
					AddItemListToHuman(sceneId,selfId)
				end
			end
		EndEvent( sceneId )
		DispatchEventList( sceneId, selfId, targetId )
		
	elseif nBonusType == 8   then
		-- ¿óÊ¯
		local playerlevel = GetLevel( sceneId, selfId )
		playerlevel = floor( playerlevel / 10 )
		if playerlevel == 0 then
			playerlevel = 1
		end
		local nKuangId = x200099_BonusKuangshi[playerlevel]
		local nKuangNum = 0
		if nRelationLevel == 2  then
			nKuangNum = 10
		elseif nRelationLevel == 3  then
			nKuangNum = 20
		elseif nRelationLevel == 4  then
			nKuangNum = 40
		end
	
		BeginEvent( sceneId )
			--AddText( sceneId, " ðÕt ðßþcÃÅÅÉÕÙ¼¯Áî" )
			AddText( sceneId, "  Hôm qua không có chuy®n gì, tÕi hÕ lên núi giäi cho khuây khoä, ti®n th¬ ðào ðßþc mµt ít khoáng thÕch, xin biªu các hÕ." )
		
			-- ¸øÍæ¼Ò+Cái này ÎïÆ·
			if nKuangNum > 0 then
			  BeginAddItem(sceneId)
					AddItem( sceneId, nKuangId, nKuangNum )
				local ret = EndAddItem(sceneId,selfId)
			
				if ret < 1  then
					AddText( sceneId, "  Tiªc là tay näi tÕi hÕ mang theo ðã ð¥y r°i, chuy®n này tÕm th¶i ð¬ ð¤y ðã." )
				else
					AddItemListToHuman(sceneId,selfId)
				end
			end
		EndEvent( sceneId )
		DispatchEventList( sceneId, selfId, targetId )
		
	elseif nBonusType == 9   then
		-- ÖÖÖ²ÊÕ»ñÎï
		local playerlevel = GetLevel( sceneId, selfId )
		playerlevel = floor( playerlevel / 10 )
		if playerlevel == 0 then
			playerlevel = 1
		end
		local nGrowList = x200099_BonusGrow[playerlevel]		
		local nGrowIndex = random(getn(nGrowList))
		local nGrowId = nGrowList[nGrowIndex]
		
		local nGrowNum = 0
		if nRelationLevel == 2  then
			nGrowNum = 10
		elseif nRelationLevel == 3  then
			nGrowNum = 20
		elseif nRelationLevel == 4  then
			nGrowNum = 40
		end
		BeginEvent( sceneId )
			--AddText( sceneId, " ðÕt ðßþcÃÅÅÉÕÙ¼¯Áî" )
			AddText( sceneId, "  Hôm qua không có chuy®n gì, các hÕ ra ð°ng giäi toä tâm trÕng, ti®n th¬ tr°ng ðßþc mµt vài nông sän, xin biªu các hÕ." )
			-- ¸øÍæ¼Ò+Cái này ÎïÆ·
			if nGrowNum > 0 then
			  BeginAddItem(sceneId)
					AddItem( sceneId, nGrowId, nGrowNum )
				local ret = EndAddItem(sceneId,selfId)
			
				if ret < 1  then
					AddText( sceneId, "  Tiªc là tay näi tÕi hÕ mang theo ðã ð¥y r°i, chuy®n này tÕm th¶i ð¬ ð¤y ðã." )
				else
					AddItemListToHuman(sceneId,selfId)
				end
			end
		EndEvent( sceneId )
		DispatchEventList( sceneId, selfId, targetId )
	end	
	
end

--**********************************
--  ðÕt ðßþc¹ØÏµc¤p±ð
--**********************************
function x200099_GetNpcRelationLevel( sceneId, selfId, NpcId )

	local nPointId = 0
	local nRelationPoint = 0
	local nLevel = 0
	
	for i=1, 13  do
		if x200099_NpcInfo[i].id == NpcId   then
			nPointId = x200099_NpcInfo[i].p1
		end
	end
	
	if nPointId == 0  then
		nRelationPoint = 0
	elseif nPointId>=92 and nPointId<=104   then
		nRelationPoint = GetMissionData( sceneId, selfId, nPointId )
	else
		nRelationPoint = 0
	end
	
	if nRelationPoint<=999  then
		nLevel = 0
	elseif nRelationPoint<=1999  then
		nLevel = 1
	elseif nRelationPoint<=3999  then
		nLevel = 2
	elseif nRelationPoint<=6499  then
		nLevel = 3
	elseif nRelationPoint<=9999  then
		nLevel = 4
	end
	
	return nLevel
end

--**********************************
--  ðÕt ðßþc¹ØÏµc¤p±ð
--**********************************
function x200099_InitRelation( sceneId, selfId )
	if GetMenPai(sceneId, selfId) == 9 then
		return 
	end
	
	if GetMenPai(sceneId, selfId)<0 or GetMenPai(sceneId, selfId)>8  then
		return
	end
	
	local nRelationPoint_1 = GetMissionData( sceneId, selfId, 92 )
	local nRelationPoint_2 = GetMissionData( sceneId, selfId, 93 )
	local nRelationPoint_3 = GetMissionData( sceneId, selfId, 94 )
	local nRelationPoint_4 = GetMissionData( sceneId, selfId, 95 )
	local nRelationPoint_5 = GetMissionData( sceneId, selfId, 96 )
	local nRelationPoint_6 = GetMissionData( sceneId, selfId, 97 )
	local nRelationPoint_7 = GetMissionData( sceneId, selfId, 98 )
	local nRelationPoint_8 = GetMissionData( sceneId, selfId, 99 )
	local nRelationPoint_9 = GetMissionData( sceneId, selfId, 100 )
	local nRelationPoint_10 = GetMissionData( sceneId, selfId, 101 )
	local nRelationPoint_11 = GetMissionData( sceneId, selfId, 102 )
	local nRelationPoint_12 = GetMissionData( sceneId, selfId, 103 )
	local nRelationPoint_13 = GetMissionData( sceneId, selfId, 104 )

	
	if nRelationPoint_1 == 0 and nRelationPoint_2 == 0 and
	   nRelationPoint_3 == 0 and nRelationPoint_4 == 0 and
     nRelationPoint_5 == 0 and nRelationPoint_6 == 0 and
     nRelationPoint_7 == 0 and nRelationPoint_8 == 0 and
     nRelationPoint_9 == 0 and nRelationPoint_10== 0 and
     nRelationPoint_11== 0 and nRelationPoint_12== 0 and
     nRelationPoint_13== 0       then
  
	  for i=1, 9  do
			if GetMenPai(sceneId, selfId) == x200099_MenpaiRelationPoint[i].mp then
				SetMissionData(sceneId, selfId, 92 , x200099_MenpaiRelationPoint[i].p1 )
				SetMissionData(sceneId, selfId, 93 , x200099_MenpaiRelationPoint[i].p2 )
				SetMissionData(sceneId, selfId, 94 , x200099_MenpaiRelationPoint[i].p3 )
				SetMissionData(sceneId, selfId, 95 , x200099_MenpaiRelationPoint[i].p4 )
				SetMissionData(sceneId, selfId, 96 , x200099_MenpaiRelationPoint[i].p5 )
				SetMissionData(sceneId, selfId, 97 , x200099_MenpaiRelationPoint[i].p6 )
				SetMissionData(sceneId, selfId, 98 , x200099_MenpaiRelationPoint[i].p7 )
				SetMissionData(sceneId, selfId, 99 , x200099_MenpaiRelationPoint[i].p8 )
				SetMissionData(sceneId, selfId, 100, x200099_MenpaiRelationPoint[i].p9 )
				SetMissionData(sceneId, selfId, 101, x200099_MenpaiRelationPoint[i].p10)
				SetMissionData(sceneId, selfId, 102, x200099_MenpaiRelationPoint[i].p11)
				SetMissionData(sceneId, selfId, 103, x200099_MenpaiRelationPoint[i].p12)
				SetMissionData(sceneId, selfId, 104, x200099_MenpaiRelationPoint[i].p13)
				break
			end
		end
	end
	
	local resetFlag = GetMissionFlag(sceneId, selfId, MF_AZHU_RELATION_RESET);
	if resetFlag and resetFlag == 0 then
		SetMissionData(sceneId, selfId, MD_RELATION_AZHU, 900);
		SetMissionFlag(sceneId, selfId, MF_AZHU_RELATION_RESET, 1);
	end
end

