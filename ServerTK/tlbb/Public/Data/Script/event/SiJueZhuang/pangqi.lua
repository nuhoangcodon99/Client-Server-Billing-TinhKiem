--Phø bän TÑ Tuy®t Trang
--Bàng Xí
--Author: Hoàng Steven

--******************--


x910176_Item_ttpx ={
50131001, --Bång Lam Lßu Vân (C¤p 1)
50131002,--TØ Vi Tinh Quang (C¤p 1)
50131003,--Thuý Ng÷c Tinh Tr¥n (C¤p 1)
50131004,--Tranh Änh Nhß Mµng (C¤p 1)
50131005,--Hoa LÕc H°ng Tr¥n (C¤p 1)
20503062,--Ly Höa
20503062,--Ly Höa
20503062,--Ly Höa
20503062,--Ly Höa
20503062,--Ly Höa
20503062,--Ly Höa
20503062,--Ly Höa
20503062,--Ly Höa
20503062,--Ly Höa
20503062,--Ly Höa
20503062,--Ly Höa
20503062,--Ly Höa
20503062,--Ly Höa
20503062,--Ly Höa
20503062,--Ly Höa
20503062,--Ly Höa
}

x910176_Item_ttpx_vip ={

30501361,--Công lñc ðan
30503134, --kim thoa (duc lo)
30503135, --Th¶i trang ph¯i sÑc ði¬m xuyªt phù
30503136, --Th¶i trang ph¯i sÑc thanh tr× phù
30503137, --Th¶i trang ph¯i sÑc gia công phù

30501361,--Công lñc ðan
30503134, --kim thoa (duc lo)
30503135, --Th¶i trang ph¯i sÑc ði¬m xuyªt phù
30503136, --Th¶i trang ph¯i sÑc thanh tr× phù
30503137, --Th¶i trang ph¯i sÑc gia công phù

30501361,--Công lñc ðan
30503134, --kim thoa (duc lo)
30503135, --Th¶i trang ph¯i sÑc ði¬m xuyªt phù
30503136, --Th¶i trang ph¯i sÑc thanh tr× phù
30503137, --Th¶i trang ph¯i sÑc gia công phù

30501361,--Công lñc ðan
30503134, --kim thoa (duc lo)
30503135, --Th¶i trang ph¯i sÑc ði¬m xuyªt phù
30503136, --Th¶i trang ph¯i sÑc thanh tr× phù
30503137, --Th¶i trang ph¯i sÑc gia công phù

30501361,--Công lñc ðan
30503134, --kim thoa (duc lo)
30503135, --Th¶i trang ph¯i sÑc ði¬m xuyªt phù
30503136, --Th¶i trang ph¯i sÑc thanh tr× phù
30503137, --Th¶i trang ph¯i sÑc gia công phù

30501361,--Công lñc ðan
30503134, --kim thoa (duc lo)
30503135, --Th¶i trang ph¯i sÑc ði¬m xuyªt phù
30503136, --Th¶i trang ph¯i sÑc thanh tr× phù
30503137, --Th¶i trang ph¯i sÑc gia công phù

20503061, --Trang b¸ Tinh thông phù
20503061, --Trang b¸ Tinh thông phù
20503061, --Trang b¸ Tinh thông phù

30010080, --Chân Nguyên Phách
30010081, --Chân Nguyên Tinh Phách
}
x910176_Item_ttpx_vip_rate = 50 -- ty le rot x910176_Item_ttpx_vip


--******************--

--******************--
x910176_g_ScriptId=910176
--******************--
x910176_g_Boss_Name="Bàng Xí"																	--Tên cüa BOSS
--******************--
x910176_g_Skill_Index_1=1678																	--KÛ nång Tam Phong Lßu Vân (Qu¥n th¬ ma tý + rút 20% máu)
x910176_g_Skill_1_CD=30000																		--Th¶i gian lãnh khß¾c Tam Phong Lßu Vân
x910176_g_Skill_Index_2=1679																	--KÛ nång H¡c BÕch Song Vçn (G÷i long trø)
x910176_g_Skill_2_CD=40000																		--Th¶i gian lãnh khß¾c H¡c BÕch Song Vçn
x910176_g_Skill_Index_3=																		--KÛ nång công kích thuµc tính
{	
	[1]={	Index=1681,		Impact=9761		},													--Mßu Ð¸nh Thiên HÕ
	[2]={	Index=1682,		Impact=9763		},													--Tß¾ng Quân L®nh
	[3]={	Index=1683,		Impact=9773		},													--Khí Xa Bäo Soái
	[4]={	Index=1684,		Impact=9776		},													--Th§p Bµ Nh¤t Sát
}
x910176_g_Skill_3_CD=30000																		--Th¶i gian lãnh khß¾c kÛ nång thuµc tính
x910176_g_LongZhu_Active_Time=5000																--Th¶i gian phát n± Long trø
x910176_g_Trap_Active_Time=20000																--Th¶i gian xu¤t bçy Imba m¾i
--******************--
x910176_g_Skill_Imba=1680																		--KÛ nång Tinh La KÏ B¯
--******************--
x910176_g_LostHP_Impact=9755																	--Hi®u Ñng m¤t 20% HP
x910176_g_Healing_Impact=9781																	--Hi®u Ñng phøc h°i 1% HP
--******************--
x910176_g_Skill_1_Timer=1																		--Th¶i gian kÛ nång 1
x910176_g_Skill_2_Timer=2																		--Th¶i gian kÛ nång 2
x910176_g_Skill_3_Timer=3																		--Th¶i gian kÛ nång 3
x910176_g_Skill_Imba_Step=4																		--KÛ nång Imba
x910176_g_LongZhu_Type=5																		--LoÕi Long trø
x910176_g_LongZhu_Timer=6																		--Th¶i gian phát n± Long trø
x910176_g_Trap_Timer=7																			--Th¶i gian xu¤t bçy Imba m¾i
x910176_g_AttackMode=8																			--TrÕng thái chiªn ð¤u
--******************--
x910176_g_Monster_Dialogue=
{																								--L¶i nói cüa Boss
	[1]=x910176_g_Boss_Name.." ðã xu¤t hi®n!",
	[2]="M¤y tên này cûng có chút bän lînh. Ðánh bÕi các huynh ð® cüa ta. Thù này ta nh¤t ð¸nh phäi báo...",
	[3]="Ðã giªt chªt "..x910176_g_Boss_Name..": 1/1",
	[4]="Thiên hÕ này không ai ðü bän lînh thi ðánh c¶ v¾i lão phu ðâu... Ha... Ha...",
	[5]="Nhi®m vø hoàn thành!",
}
--******************--
x910176_g_LongZhu=
{
	[1]={	Index=14147,	Name="Long trø Kim",	Pos_X=41,	Pos_Y=25,	nTalk="Thiên thiên hß¾ng thßþng. Kim gia bäo..."		},
	[2]={	Index=14148,	Name="Long trø Mµc",	Pos_X=39,	Pos_Y=37,	nTalk="Thiên thiên hß¾ng thßþng. Mµc cän thi«m..."		},
	[3]={	Index=14149,	Name="Long trø Thüy",	Pos_X=21,	Pos_Y=37,	nTalk="Thiên thiên hß¾ng thßþng. Thüy lßu giao..."		},
	[4]={	Index=14150,	Name="Long trø Höa",	Pos_X=19,	Pos_Y=25,	nTalk="Thiên thiên hß¾ng thßþng. Höa chi tinh..."		},
	[5]={	Index=14151,	Name="Long trø Th±",	Pos_X=30,	Pos_Y=18,	nTalk="Thiên thiên hß¾ng thßþng. Th± nh¤t phách..."		},
}
--******************--
x910176_g_Notify_Tips=
{
	[1]="Bàng Xí ðã tri®u t§p Long trø Kim, các hÕ hãy phá hüy nó trß¾c khi quá muµn...",
	[2]="Bàng Xí ðã tri®u t§p Long trø Mµc, các hÕ hãy phá hüy nó trß¾c khi quá muµn...",
	[3]="Bàng Xí ðã tri®u t§p Long trø Thüy, các hÕ hãy phá hüy nó trß¾c khi quá muµn...",
	[4]="Bàng Xí ðã tri®u t§p Long trø Höa, các hÕ hãy phá hüy nó trß¾c khi quá muµn...",
	[5]="Bàng Xí ðã tri®u t§p Long trø Th±, các hÕ hãy phá hüy nó trß¾c khi quá muµn...",
	[6]="Bàng Xí ðã phóng thích r¤t nhi«u cÕm bçy dß¾i chân các v¸, hãy c¦n th§n ð×ng ð¬ chÕm vào chúng...",
}
--******************--
x910176_g_Trap_Object={162,163,164,165,166,167}
--******************--
x910176_g_Guardian={Index=14164,Name="Tinh la võ sÛ"}
--******************--
x910176_g_nBoss=
{
	[1]	=	{	Index=14152,	Name="Mçn M£c",		Title="Thß Hß½ng M£c V§n",	Pos_X=17,	Pos_Y=21	},
	[2]	=	{	Index=14153,	Name="Ðào Thanh",	Title="LÕc Bút Th¥n Binh",	Pos_X=17,	Pos_Y=19	},
	[3]	=	{	Index=14154,	Name="T¥n V§n",		Title="C¥m Ý Du Trß¶ng",	Pos_X=17,	Pos_Y=17	},
}
--******************--
x910176_g_Treasure={	Index=14156,	Name="TÑ Tuy®t Bäo Sß½ng",	Pos_X=30,	Pos_Y=29,	ScriptID=910178	}
--******************--

--******************--

--**********************************--
--*             On Init            *-- 
--**********************************--
function x910176_OnInit(sceneId,selfId)

	--******************--
	MonsterTalk(sceneId,selfId,"TÑ Tuy®t Trang",x910176_g_Monster_Dialogue[2])					--Câu nói khai chiªn cüa Boss
	x910176_GlobalNews(sceneId,x910176_g_Monster_Dialogue[1])									--Thông báo Boss ðã vào chiªn ð¤u cho toàn th¬ ngß¶i ch½i
	x910176_ResetMyAI(sceneId,selfId)															--Set lÕi các thuµc tính cho Boss
	--******************--
	for i=1,getn(x910176_g_nBoss) do
		local Monster_Index=LuaFnCreateMonster(sceneId,x910176_g_nBoss[i].Index,x910176_g_nBoss[i].Pos_X,x910176_g_nBoss[i].Pos_Y,3,0,-1)
		SetCharacterName(sceneId,Monster_Index,x910176_g_nBoss[i].Name)
		SetCharacterTitle(sceneId,Monster_Index,x910176_g_nBoss[i].Title)
		SetUnitCampID(sceneId,Monster_Index,Monster_Index,109)
	end
	--******************--

end
--**********************************--
--*         On Heart Beat          *--
--**********************************--
function x910176_OnHeartBeat(sceneId,selfId,nTick)												--Hàm này s¨ check liên tøc m²i mili giây khi nào Boss còn s¯ng

	--******************--
	if LuaFnIsCharacterLiving(sceneId,selfId)~=1 then											--Nªu Boss ðã chªt thì ng×ng hoÕt ðµng cüa Script
		return
	end
	--******************--
	if MonsterAI_GetIntParamByIndex(sceneId,selfId,x910176_g_AttackMode)==0 then
		return
	end
	--******************--
	x910176_UseMyImbaSkill(sceneId,selfId,nTick)												--SØ døng cÕm bçy Imba
	--******************--
	x910176_HealingMe(sceneId,selfId)															--Bàng Xí h°i phøc máu nªu ðÑng g¥n Tinh la võ sÛ
	--******************--
	x910176_ActiveMyLongZhu(sceneId,selfId,nTick)												--Kích n± Long trø
	--******************--
	x910176_UseMySkill(sceneId,selfId,nTick)													--SØ døng kÛ nång
	--******************--

end
--**********************************--
--*        On Enter Combat         *--
--**********************************--
function x910176_OnEnterCombat(sceneId,selfId,enmeyId)

	--******************--
	x910176_ResetMyAI(sceneId,selfId)															--Set lÕi các thuµc tính cho Boss
	--******************--
	MonsterAI_SetIntParamByIndex(sceneId,selfId,x910176_g_AttackMode,1)
	--******************--

end
--**********************************--
--*        On Leave Combat         *--
--**********************************--
function x910176_OnLeaveCombat(sceneId,selfId)

	--******************--
	x910176_ResetMyAI(sceneId,selfId)															--Set lÕi các thuµc tính cho Boss
	--******************--

end
--**********************************--
--*       On Kill Character        *--
--**********************************--
function x910176_OnKillCharacter(sceneId,selfId,targetId)
	
	--******************--
	--******************--
	
end
--**********************************--
--*             On Die             *--
--**********************************--
function x910176_OnDie(sceneId,selfId,killerId)

	--******************--
	x910176_GlobalNews(sceneId,x910176_g_Monster_Dialogue[3])
	x910176_GlobalNews(sceneId,x910176_g_Monster_Dialogue[5])
	--******************--
	LuaFnSetCopySceneData_Param(sceneId,8,5)
	--******************--
	local Player=GetName(sceneId,killerId)
	local str=format("#RKÏ tr§n là tuy®t h÷c, công phu ð¡c ý cüa thiên hÕ #GH¡c BÕch Giang H° TÑ Tuy®t Trang #YBàng Xí#R. Nay b¸ #{_INFOUSR%s} cùng ðµi ngû ðánh bÕi, bän thân Bàng Xí cûng không giæ n±i tính mÕng cüa mình!",Player)
	AddGlobalCountNews(sceneId,str)
	--******************--
	x910176_DeleteMyLongZhu(sceneId)
	--******************--
	local Monster_Index=LuaFnCreateMonster(sceneId,x910176_g_Treasure.Index,x910176_g_Treasure.Pos_X,x910176_g_Treasure.Pos_Y,3,0,x910176_g_Treasure.ScriptID)
	SetCharacterName(sceneId,Monster_Index,x910176_g_Treasure.Name)
	SetUnitCampID(sceneId,Monster_Index,Monster_Index,110)
	--******************--
	for i=0,GetNearTeamCount(sceneId,killerId)-1  do
		AddMonsterDropItem(sceneId,selfId,GetNearTeamMember(sceneId,killerId,i),x910176_Item_ttpx[random(getn(x910176_Item_ttpx))])
		local ran = random(100)
		if ran < x910176_Item_ttpx_vip_rate then
			AddMonsterDropItem(sceneId,selfId,GetNearTeamMember(sceneId,killerId,i),x910176_Item_ttpx_vip[random(getn(x910176_Item_ttpx_vip))])
		end
		local Current_Activity_Point=GetMissionData(sceneId,GetNearTeamMember(sceneId,killerId,i),MD_CURRENT_ACTIVITY_POINT)
		SetMissionData(sceneId,GetNearTeamMember(sceneId,killerId,i),MD_CURRENT_ACTIVITY_POINT,Current_Activity_Point+40)
		BeginEvent(sceneId)
			AddText(sceneId,"Các hÕ ðã gia tång 40 ði¬m hoÕt ðµng!")
		EndEvent(sceneId)
		DispatchMissionTips(sceneId,GetNearTeamMember(sceneId,killerId,i))
	end
	--******************--

end
--**********************************--
--*          Reset My AI           *--
--**********************************--
function x910176_ResetMyAI(sceneId,selfId)

	--******************--
	MonsterAI_SetIntParamByIndex(sceneId,selfId,x910176_g_Skill_1_Timer,x910176_g_Skill_1_CD)	--Th¶i gian kÛ nång 1
	MonsterAI_SetIntParamByIndex(sceneId,selfId,x910176_g_Skill_2_Timer,x910176_g_Skill_2_CD)	--Th¶i gian kÛ nång 2
	MonsterAI_SetIntParamByIndex(sceneId,selfId,x910176_g_Skill_3_Timer,x910176_g_Skill_3_CD)	--Th¶i gian kÛ nång 3
	MonsterAI_SetIntParamByIndex(sceneId,selfId,x910176_g_Skill_Imba_Step,0)					--Th¶i gian kÛ nång Imba
	MonsterAI_SetIntParamByIndex(sceneId,selfId,x910176_g_LongZhu_Timer,x910176_g_LongZhu_Active_Time)--Th¶i gian kích n± H°i âm phiên
	MonsterAI_SetIntParamByIndex(sceneId,selfId,x910176_g_Trap_Timer,0)							--Th¶i gian xu¤t bçy m¾i
	MonsterAI_SetIntParamByIndex(sceneId,selfId,x910176_g_LongZhu_Type,1)						--Set loÕi Long trø
	--******************--
	x910176_DeleteMyLongZhu(sceneId)															--Xóa Long trø
	--******************--
	MonsterAI_SetIntParamByIndex(sceneId,selfId,x910176_g_AttackMode,0)
	--******************--
	
end
--**********************************--
--*           Healing Me           *--
--**********************************--
function x910176_HealingMe(sceneId,selfId)

	--******************--
	local x,y=GetWorldPos(sceneId,selfId)
	--******************--
	local nMonsterNum=GetMonsterCount(sceneId)
	for i=0,nMonsterNum-1 do
		local MonsterId=GetMonsterObjID(sceneId,i)
		local x1,y1=GetWorldPos(sceneId,MonsterId)
		if LuaFnIsCharacterLiving(sceneId,MonsterId)==1 and GetName(sceneId,MonsterId)==x910176_g_Guardian.Name 
		and floor(sqrt((x-x1)*(x-x1)+(y-y1)*(y-y1)))<=3 then
			LuaFnSendSpecificImpactToUnit(sceneId,selfId,selfId,selfId,x910176_g_Healing_Impact,0)
			break
		end
	end
	--******************--
	
end
--**********************************--
--*       Delete My Long Zhu       *--
--**********************************--
function x910176_DeleteMyLongZhu(sceneId)

	--******************--
	local nMonsterNum=GetMonsterCount(sceneId)
	for i=0,nMonsterNum-1 do
		local MonsterId=GetMonsterObjID(sceneId,i)
		for j=1,getn(x910176_g_LongZhu) do
			if LuaFnIsCharacterLiving(sceneId,MonsterId)==1 and (GetName(sceneId,MonsterId)==x910176_g_LongZhu[j].Name or GetName(sceneId,MonsterId)==x910176_g_Guardian.Name) then
				SetCharacterDieTime(sceneId,MonsterId,100)
			end
		end
	end
	--******************--
	
end
--**********************************--
--*       Use My Imba Skill        *--
--**********************************--
function x910176_UseMyImbaSkill(sceneId,selfId,nTick)

	--******************--
	local Current_HP=GetHp(sceneId,selfId)
	local Max_HP=GetMaxHp(sceneId,selfId)
	local Percent_Left=floor((Current_HP/Max_HP)*100)
	--******************--
	if Percent_Left>30 then
		return
	end
	--******************--
	local nTime=MonsterAI_GetIntParamByIndex(sceneId,selfId,x910176_g_Trap_Timer)
	MonsterAI_SetIntParamByIndex(sceneId,selfId,x910176_g_Trap_Timer,nTime-nTick)
	if nTime>0 then
		return
	end
	--******************--
	MonsterAI_SetIntParamByIndex(sceneId,selfId,x910176_g_Trap_Timer,x910176_g_Trap_Active_Time)
	--******************--
	local x,y=GetWorldPos(sceneId,selfId)
	LuaFnUnitUseSkill(sceneId,selfId,x910176_g_Skill_Imba,x,y,0,1)							--Boss sØ døng kÛ nång Imba
	--******************--
	local nHumanCount = LuaFnGetCopyScene_HumanCount(sceneId)
	for i=0,nHumanCount-1 do
		local nHumanId = LuaFnGetCopyScene_HumanObjId(sceneId,i)
		local x,y=GetWorldPos(sceneId,nHumanId)
		CreateSpecialObjByDataIndex(sceneId,selfId,x910176_g_Trap_Object[random(getn(x910176_g_Trap_Object))],x,y,0)
	end
	--******************--
	local Actived=MonsterAI_GetIntParamByIndex(sceneId,selfId,x910176_g_Skill_Imba_Step)
	MonsterAI_SetIntParamByIndex(sceneId,selfId,x910176_g_Skill_Imba_Step,1)
	--******************--
	MonsterTalk(sceneId,selfId,"TÑ Tuy®t Trang",x910176_g_Monster_Dialogue[4])
	--******************--
	if Actived==0 then
		x910176_GlobalNews(sceneId,x910176_g_Notify_Tips[6])
	end
	--******************--
	
end
--**********************************--
--*       Active My Long Zhu       *--
--**********************************--
function x910176_ActiveMyLongZhu(sceneId,selfId,nTick)

	--******************--
	local nType=MonsterAI_GetIntParamByIndex(sceneId,selfId,x910176_g_LongZhu_Type)
	local nLongZhu=0
	--******************--
	local nMonsterNum=GetMonsterCount(sceneId)
	for i=0,nMonsterNum-1 do
		local MonsterId=GetMonsterObjID(sceneId,i)
		local x1,y1=GetWorldPos(sceneId,MonsterId)
		if LuaFnIsCharacterLiving(sceneId,MonsterId)==1 and GetName(sceneId,MonsterId)==x910176_g_LongZhu[nType].Name then
			nLongZhu=1
			break
		end
	end
	--******************--
	if nLongZhu==0 then
		x910176_DeleteMyLongZhu(sceneId)
		MonsterAI_SetIntParamByIndex(sceneId,selfId,x910176_g_LongZhu_Timer,x910176_g_LongZhu_Active_Time)
		return
	end
	--******************--
	local nActive=MonsterAI_GetIntParamByIndex(sceneId,selfId,x910176_g_LongZhu_Timer)
	MonsterAI_SetIntParamByIndex(sceneId,selfId,x910176_g_LongZhu_Timer,nActive-nTick)
	--******************--
	if nActive<=0 then
		local nHumanCount = LuaFnGetCopyScene_HumanCount(sceneId)
		for i=0,nHumanCount-1 do
			local nHumanId = LuaFnGetCopyScene_HumanObjId(sceneId,i)
			local x1,y1=GetWorldPos(sceneId,nHumanId)
			if LuaFnIsObjValid(sceneId,nHumanId)==1 and LuaFnIsCanDoScriptLogic(sceneId,nHumanId)==1 and LuaFnIsCharacterLiving(sceneId,nHumanId)==1 then
				LuaFnSendSpecificImpactToUnit(sceneId,selfId,selfId,nHumanId,x910176_g_LostHP_Impact,0)
				for k=0,9 do																
					local High,Low=LuaFnGetPetGUID(sceneId,nHumanId,k)
					local Pet_Index=LuaFnGetPetObjIdByGUID(sceneId,nHumanId,High,Low)								
					if Pet_Index~=-1 and Pet_Index then											
						LuaFnSendSpecificImpactToUnit(sceneId,selfId,selfId,Pet_Index,x910176_g_LostHP_Impact,0)
						break
					end
				end
			end
		end
		MonsterAI_SetIntParamByIndex(sceneId,selfId,x910176_g_LongZhu_Timer,x910176_g_LongZhu_Active_Time)
	end
	--******************--
	
end
--**********************************--
--*          Use My Skill          *--
--**********************************--
function x910176_UseMySkill(sceneId,selfId,nTick)

	--******************--
	local Time_Skill_1=MonsterAI_GetIntParamByIndex(sceneId,selfId,x910176_g_Skill_1_Timer)		--L¤y th¶i gian lãnh khß¾c kÛ nång 1 cüa Boss
	local Time_Skill_2=MonsterAI_GetIntParamByIndex(sceneId,selfId,x910176_g_Skill_2_Timer)		--L¤y th¶i gian lãnh khß¾c kÛ nång 2 cüa Boss
	local Time_Skill_3=MonsterAI_GetIntParamByIndex(sceneId,selfId,x910176_g_Skill_3_Timer)		--L¤y th¶i gian lãnh khß¾c kÛ nång 3 cüa Boss
	MonsterAI_SetIntParamByIndex(sceneId,selfId,x910176_g_Skill_1_Timer,Time_Skill_1-nTick)		--C§p nh§t th¶i gian lãnh khß¾c cüa kÛ nång 1
	MonsterAI_SetIntParamByIndex(sceneId,selfId,x910176_g_Skill_2_Timer,Time_Skill_2-nTick)		--C§p nh§t th¶i gian lãnh khß¾c cüa kÛ nång 2
	MonsterAI_SetIntParamByIndex(sceneId,selfId,x910176_g_Skill_3_Timer,Time_Skill_3-nTick)		--C§p nh§t th¶i gian lãnh khß¾c cüa kÛ nång 3
	--******************--
	if Time_Skill_1<=0 then																		--Ðã ðªn gi¶ dùng kÛ nång 1
		local x,y=GetWorldPos(sceneId,selfId)
		LuaFnUnitUseSkill(sceneId,selfId,x910176_g_Skill_Index_1,x,y,0,1)						--Boss sØ døng kÛ nång 1
		MonsterAI_SetIntParamByIndex(sceneId,selfId,x910176_g_Skill_1_Timer,x910176_g_Skill_1_CD+5000)--C§p nh§t lÕi th¶i gian lãnh khß¾c cüa kÛ nång
	end
	--******************--
	if Time_Skill_2<=0 then																		--Ðã ðªn gi¶ dùng kÛ nång 2
		x910176_UseSkill2(sceneId,selfId)														--SØ døng kÛ nång 2
		MonsterAI_SetIntParamByIndex(sceneId,selfId,x910176_g_Skill_2_Timer,x910176_g_Skill_2_CD)--C§p nh§t lÕi th¶i gian lãnh khß¾c cüa kÛ nång
	end
	--******************--
	if Time_Skill_3<=0 then																		--Ðã ðªn gi¶ dùng kÛ nång 3
		local x,y=GetWorldPos(sceneId,selfId)
		local nRan=random(4)
		LuaFnUnitUseSkill(sceneId,selfId,x910176_g_Skill_Index_3[nRan].Index,x,y,0,1)			--Boss sØ døng kÛ nång 3
		MonsterAI_SetIntParamByIndex(sceneId,selfId,x910176_g_Skill_3_Timer,x910176_g_Skill_3_CD)--C§p nh§t lÕi th¶i gian lãnh khß¾c cüa kÛ nång
	end
	--******************--
	
end
--**********************************--
--*           Use Skill 2          *--
--**********************************--
function x910176_UseSkill2(sceneId,selfId,nTime)

	--******************--
	local nType=MonsterAI_GetIntParamByIndex(sceneId,selfId,x910176_g_LongZhu_Type)
	local nLongZhu=0
	local nMonsterNum=GetMonsterCount(sceneId)
	for i=0,nMonsterNum-1 do
		local MonsterId=GetMonsterObjID(sceneId,i)
		local x1,y1=GetWorldPos(sceneId,MonsterId)
		if LuaFnIsCharacterLiving(sceneId,MonsterId)==1 and GetName(sceneId,MonsterId)==x910176_g_LongZhu[nType].Name then
			nLongZhu=1
			break
		end
	end
	--******************--
	if nLongZhu>0 then
		x910176_DeleteMyLongZhu(sceneId)
	end
	--******************--
	local x,y=GetWorldPos(sceneId,selfId)
	LuaFnUnitUseSkill(sceneId,selfId,x910176_g_Skill_Index_2,x,y,0,1)						--Boss sØ døng kÛ nång 2
	--******************--
	for i=1,getn(x910176_g_LongZhu) do
		local LongZhu=LuaFnCreateMonster(sceneId,x910176_g_LongZhu[i].Index,x910176_g_LongZhu[i].Pos_X,x910176_g_LongZhu[i].Pos_Y,3,0,-1)
		SetCharacterName(sceneId,LongZhu,x910176_g_LongZhu[i].Name)
		SetUnitCampID(sceneId,LongZhu,LongZhu,110)
		local dd={1, 0,-1, 1,-1, 1, 0,-1}
		local dc={1, 1, 1, 0, 0,-1,-1,-1}
		for j=1,8 do
			local nDec=LuaFnGetCopySceneData_Param(sceneId,9)
			local Guardian=LuaFnCreateMonster(sceneId,x910176_g_Guardian.Index+nDec,x910176_g_LongZhu[i].Pos_X+dd[j],x910176_g_LongZhu[i].Pos_Y+dc[j],10,0,-1)
			SetCharacterName(sceneId,Guardian,x910176_g_Guardian.Name)
			SetUnitCampID(sceneId,Guardian,Guardian,110)
		end
	end
	--******************--
	local nRan=random(getn(x910176_g_LongZhu))
	MonsterAI_SetIntParamByIndex(sceneId,selfId,x910176_g_LongZhu_Type,nRan)
	x910176_GlobalNews(sceneId,x910176_g_Notify_Tips[nRan])
	--******************--
	MonsterTalk(sceneId,selfId,"TÑ Tuy®t Trang",x910176_g_LongZhu[nRan].nTalk)
	--******************--

end
--**********************************--
--*           Global News          *--
--**********************************--
function x910176_GlobalNews(sceneId,Tips)

	--******************--
	local nHumanCount = LuaFnGetCopyScene_HumanCount(sceneId)
	for i=0,nHumanCount-1 do
		local nHumanId = LuaFnGetCopyScene_HumanObjId(sceneId,i)
		if LuaFnIsObjValid(sceneId,nHumanId)==1 and LuaFnIsCanDoScriptLogic(sceneId,nHumanId)==1 and LuaFnIsCharacterLiving(sceneId,nHumanId)==1 then
			BeginEvent(sceneId)
				AddText(sceneId,Tips)
			EndEvent(sceneId)
			DispatchMissionTips(sceneId,nHumanId)
		end
	end
	--******************--

end
