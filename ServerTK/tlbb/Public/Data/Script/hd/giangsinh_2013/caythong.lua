x006969_g_scriptId = 006969

x006969_NOEL_ACTIVE =1

x006969_ThuCuoi_PET_358 ={
	30308284, --TrÑng trân thú : Chien Binh Tu La
	
	10124606, --Lý Hý Lan Phß½ng
	10124610, --Døc Huyªt Hàn Phong
	10124614, --Bích ThuÖ Hàm Phß½ng
	10124625, --DÕ C¦m Thiên Lan
	10124630, --T¯ Vãn Huy«n Thß½ng
	10124633, --Thß½ng Vân Sß½ng Nguy®t


	10124624, --Ng÷c C¦m Kim Sa (nhuom)
	10124620, ----M£c Vû Ti«m U
	
	
	10141599, --T÷a kÜ: SC Nien Thu 7
	10141603,--T÷a kÜ: TC Nien Thu 7
	10141607,--T÷a kÜ: CC Nien Thu 7
	10141611,--T÷a kÜ: SiC Nien Thu 7
	10141615,--T÷a kÜ: DSC Nien Thu 7
	10141619,--T÷a kÜ: DDSC Nien Thu 7
	10141623,--T÷a kÜ: SC Thái Thßþng Long 7
	10141627,--T÷a kÜ: TC Thái Thßþng Long 7
	10141631,--T÷a kÜ: CC Thái Thßþng Long 7
	10141635,--T÷a kÜ: SC Thái Thßþng Long 7
	10141639,--T÷a kÜ: DSC Thái Thßþng Long 7
	10141643,--T÷a kÜ: SC Côn Lôn Tiên Tu¤n 7
	10141647,--T÷a kÜ: TC Côn Lôn Tiên Tu¤n 7
	10141651,--T÷a kÜ: CC Côn Lôn Tiên Tu¤n 7
	10141655,--T÷a kÜ: SiC Côn Lôn Tiên Tu¤n 7
	10141659,--T÷a kÜ: DSC Côn Lôn Tiên Tu¤n 7
	10141703,--T÷a kÜ: Tinh Vû Du Long 7
	10141708,--T÷a kÜ: Thß½ng Lan Vû Dñc 7
	10141713,--T÷a kÜ: Vân Tiêu Vû Dñc 7
	
}

x006969_NLLongVan={
	
	30308284, --TrÑng trân thú : Chien Binh Tu La
	
	10124606, --Lý Hý Lan Phß½ng
	10124610, --Døc Huyªt Hàn Phong
	10124614, --Bích ThuÖ Hàm Phß½ng
	10124625, --DÕ C¦m Thiên Lan
	10124630, --T¯ Vãn Huy«n Thß½ng
	10124633, --Thß½ng Vân Sß½ng Nguy®t


	10124624, --Ng÷c C¦m Kim Sa (nhuom)
	10124620, ----M£c Vû Ti«m U
	
	
	10141599, --T÷a kÜ: SC Nien Thu 7
	10141603,--T÷a kÜ: TC Nien Thu 7
	10141607,--T÷a kÜ: CC Nien Thu 7
	10141611,--T÷a kÜ: SiC Nien Thu 7
	10141615,--T÷a kÜ: DSC Nien Thu 7
	10141619,--T÷a kÜ: DDSC Nien Thu 7
	10141623,--T÷a kÜ: SC Thái Thßþng Long 7
	10141627,--T÷a kÜ: TC Thái Thßþng Long 7
	10141631,--T÷a kÜ: CC Thái Thßþng Long 7
	10141635,--T÷a kÜ: SC Thái Thßþng Long 7
	10141639,--T÷a kÜ: DSC Thái Thßþng Long 7
	10141643,--T÷a kÜ: SC Côn Lôn Tiên Tu¤n 7
	10141647,--T÷a kÜ: TC Côn Lôn Tiên Tu¤n 7
	10141651,--T÷a kÜ: CC Côn Lôn Tiên Tu¤n 7
	10141655,--T÷a kÜ: SiC Côn Lôn Tiên Tu¤n 7
	10141659,--T÷a kÜ: DSC Côn Lôn Tiên Tu¤n 7
	10141703,--T÷a kÜ: Tinh Vû Du Long 7
	10141708,--T÷a kÜ: Thß½ng Lan Vû Dñc 7
	10141713,--T÷a kÜ: Vân Tiêu Vû Dñc 7
	20310180,-- T¸ch Vân Thüy
	20310180,-- T¸ch Vân Thüy
	20310180,-- T¸ch Vân Thüy
	20310180,-- T¸ch Vân Thüy
	20310180,-- T¸ch Vân Thüy
	20310181,--Xuyªt Long ThÕch_Nguyên
	20310182,--Xuyªt Long ThÕch_BÕo
	20310183,--Xuyªt Long ThÕch_Thß½ng
	--38000152,--chu van tinh ngoc +5
	38000184,--chu van tinh ngoc +5 khong co dinh
}

x006969_ItemList1={
30505107,--tieu lat ba
30008018,--Thanh Tâm Ðan
30008019,--Ð£c Xá L®nh
30008014,--Thông Thiên Linh Ðan
30900016,--cao c¤p hþp thành phù
30008030,--th± ðµn châu
30008048, --kim cß½ng toä
30501125,--Dich Dung Ðan: Cây Giáng Sinh
30501125,--Dich Dung Ðan: Cây Giáng Sinh
30501125,--Dich Dung Ðan: Cây Giáng Sinh
30501125,--Dich Dung Ðan: Cây Giáng Sinh
30501101, --D¸ dung ðan; Tuyªt nhân
30501101, --D¸ dung ðan; Tuyªt nhân
30501101, --D¸ dung ðan; Tuyªt nhân
30501101, --D¸ dung ðan; Tuyªt nhân
30501101, --D¸ dung ðan; Tuyªt nhân
30501102,--D¸ dung ðan; Bång kh¯i
30501102,--D¸ dung ðan; Bång kh¯i
30501102,--D¸ dung ðan; Bång kh¯i
30501102,--D¸ dung ðan; Bång kh¯i
30501102,--D¸ dung ðan; Bång kh¯i
30501015,--D¸ Dung Ðan: Tuyªt S½n Li®p Nhân
30501015,--D¸ Dung Ðan: Tuyªt S½n Li®p Nhân
30501015,--D¸ Dung Ðan: Tuyªt S½n Li®p Nhân
30501015,--D¸ Dung Ðan: Tuyªt S½n Li®p Nhân
 }	-- M²i l¥n trang trí s¨ nh§n ðc 1 item
x006969_g_quatang={
30505107,--tieu lat ba
30008018,--Thanh Tâm Ðan
30008019,--Ð£c Xá L®nh
30008014,--Thông Thiên Linh Ðan
30900016,--cao c¤p hþp thành phù
30008030,--th± ðµn châu
30008048, --kim cß½ng toä
30501125,--Dich Dung Ðan: Cây Giáng Sinh
30501101, --D¸ dung ðan; Tuyªt nhân
30501102,--D¸ dung ðan; Bång kh¯i
30501015,--D¸ Dung Ðan: Tuyªt S½n Li®p Nhân
}

x006969_g_yeuquyet_bt8 = {
30308111,
30308112,
30308113,
30308114,
30308115,
30308116,
30308117,
30308118,
30308119,

30308121,
30308122,
30308123,
30308124,
30308125,
30308126,
30308127,
30308128,
30308129
}
x006969_g_LucHopLenhBai ={ --6 item
30504101,
30504102,

--30504104,
30504105,
30504106,
30504103
}
x006969_ItemList2={
--yq bt 8
30308111,
30308112,
30308113,
30308114,
30308115,
30308116,
30308117,
30308118,
30308119,

30308121,
30308122,
30308123,
30308124,
30308125,
30308126,
30308127,
30308128,
30308129
}	-- List item quý h½n, khi trang trí ðªn s¯ chÇn 100 s¨ nh§n ðc
function x006969_OnDefaultEvent( sceneId, selfId, targetId )
		BeginEvent( sceneId )
			if x006969_NOEL_ACTIVE == 1 then
				strText = " Chúc các hÕ có 1 Giáng sinh th§t vui vë !!! Ta có nhi«u ph¥n quà h¤p dçn ðang ch¶ b¢ng hæu  ðó. Hãy thß¶ng xuyên ðªn trò chuy®n v¾i ta nhé!!!! "
				AddText( sceneId, strText )
				AddNumText( sceneId, x006969_g_scriptId, "#PTrang trí Cây Thông Noel", 3, 1)
				AddNumText(sceneId, x006969_g_scriptId, "#YHþp thành #GSao Trang Trí Giáng Sinh", 3, 2)
				--hd add
				AddNumText(sceneId,x006969_g_scriptId,"Ð±i ði¬m hoÕt ðµng",3,3)
				--AddNumText(sceneId,x006969_g_scriptId,"Ð±i Yªu Quyªt c¯ ð¸nh",4,5) 
				--end hd add
				AddNumText( sceneId, x006969_g_scriptId, "#PV« Trang trí Cây Thông Noel",11 , 10)
			else
				AddText( sceneId, "Sñ ki®n Giáng sinh nåm nay ðã hªt, chúc b¢ng hæu có nhæng ngày nghï vui vë!" )
			end
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)
end
function x006969_OnEventRequest( sceneId, selfId, targetId, eventId )
	if GetNumText() == 1 then --trang tri cay thong
		local number = LuaFnGetAvailableItemCount(sceneId, selfId, 30505259)
		if number <1 then
			BeginEvent( sceneId )
				strText = "Phäi có #GSao Trang Trí Giáng Sinh #Wm¾i có th¬ hoàn thành ðßþc nhi®m vø #YTrang Trí Cây Thông Noel #Wnày. B¢ng hæu hãy mau mau tìm kiªm v§t ph¦m và hoàn thành nhi®m vø ð¬ giáng sinh ðßþc thêm ¤m áp, vui vë nào!!!"
				AddText(sceneId, strText)
			EndEvent(sceneId)
			DispatchEventList(sceneId,selfId,targetId)
			return
		else
			local slot =LuaFnGetPropertyBagSpace( sceneId, selfId)
			if slot < 1 then
				BeginEvent( sceneId )
					AddText(sceneId,"Tay näi cüa b¢ng hæu không ðü ch² tr¯ng!")
				EndEvent(sceneId)
				DispatchEventList(sceneId,selfId,targetId)
			else
				LuaFnDelAvailableItem(sceneId,selfId,30505259,1)
				local solan = GetMissionData( sceneId, selfId, MD_GIANGSINH13)
				if mod(solan,100)==0 and solan ~=0 then
					local randomit = random(getn(x006969_NLLongVan))
					local BagIndex = LuaFnTryRecieveItem(sceneId,selfId,x006969_NLLongVan[randomit],QUALITY_MUST_BE_CHANGE)
						local strText = GetItemName( sceneId,x006969_NLLongVan[randomit])
					if BagIndex ~= -1 then
						--local	bindidx	=LuaFnItemBind( sceneId, selfId, BagIndex)
						--if bindidx ~= 1 then
						--	x006969_NotifyFailTips( sceneId, selfId, "C¯ ð¸nh th¤t bÕi !" )
						--else	
							x006969_Tips(sceneId,selfId,"B¢ng hæu v×a nh§n ðßþc "..strText.." !")
							local str = format("#cff99cc#{_INFOUSR%s} tham gia sñ ki®n #Y [Giáng Sinh An Lành] #cff99cc trong lúc trang trí #GCây Thông Rñc RÞ #cff99ccnh§n ðßþc #Y#{_ITEM" ..x006969_NLLongVan[randomit].. "}  #cff99cc. Th§t là may m¡n!", GetName(sceneId,selfId))
							BroadMsgByChatPipe(sceneId, selfId, str, 4)
							BeginUICommand(sceneId)
							EndUICommand(sceneId)
							DispatchUICommand(sceneId,selfId, 1000)
						--end
					end
				else
					local randomit = random(getn(x006969_ItemList1))
					local BagIndex =	LuaFnTryRecieveItem(sceneId,selfId,x006969_ItemList1[randomit],QUALITY_MUST_BE_CHANGE)
					local strText = GetItemName( sceneId,x006969_ItemList1[randomit])
					if BagIndex ~= -1 then
						local	bindidx	=LuaFnItemBind( sceneId, selfId, BagIndex)
						if bindidx ~= 1 then
							x006969_NotifyFailTips( sceneId, selfId, "C¯ ð¸nh th¤t bÕi !" )
						else
							x006969_Tips(sceneId,selfId,"B¢ng hæu v×a nh§n ðßþc "..strText.." !")
							local str = format("#cff99cc#{_INFOUSR%s} tham gia sñ ki®n #Y [Giáng Sinh An Lành] #cff99cc trong lúc trang trí #GCây Thông Rñc RÞ #cff99ccnh§n ðßþc #Y#{_ITEM" ..x006969_ItemList1[randomit].. "}  #cff99cc. Th§t là may m¡n!", GetName(sceneId,selfId))
							BroadMsgByChatPipe(sceneId, selfId, str, 0)
							BeginUICommand(sceneId)
							EndUICommand(sceneId)
							DispatchUICommand(sceneId,selfId, 1000)
						end
					end
				end
				SetMissionData( sceneId, selfId, MD_GIANGSINH13,solan+1)
				--add diem hoat dong
				local pointadd = 1; --so diem hoat dong duoc thuong
				local trungthu2013_point = 0;
				local trungthu2013_point = GetMissionData(sceneId,selfId,MD_TRUNGTHU_POINT)
				SetMissionData(sceneId,selfId,MD_TRUNGTHU_POINT,trungthu2013_point+pointadd ) --add diem
				x006969_Tips( sceneId, selfId,  "Ði¬m hoÕt ðµng tích luÛ hi®n tÕi : "..trungthu2013_point+pointadd.." ði¬m hoÕt ðµng!" )
				--end add diem hoat dong
			end
		end
		return
	end
	if GetNumText() == 10 then -- gioi thieu event
		BeginEvent( sceneId )
			AddText(sceneId,"Thu th§p #PSao Trang Trí Giáng Sinh #Wð¬ treo lên #GCây Thông Noel. #WM²i l¥n treo 1 sao, b¢ng hæu s¨ ðßþc 1 ph¥n thß·ng bí m§t là quà ð«n ðáp t× #GCây Thông Noel")
			AddText(sceneId,"#P Sao Trang Trí Giáng Sinh #Wcó ðßþc b¢ng cách tiêu di®t quái v§t · các phø bän: #GÁc T£c, Ác Bá, Nhi®m vø Tu¥n hoàn Tô Châu")
			AddText(sceneId,"#W ho£c ðßþc ð±i b¢ng 20 #GÐ° ch½i b¸ cß¾p#W(Ð° ch½i b¸ cß¾p có ðßþc khi tiêu di®t quái v§t · các bän ð°)")
			AddText(sceneId,"#W Khi s¯ lßþng #PSao Trang Trí Giáng Sinh #Wmà b¢ng hæu treo lên #GCây Thông Noel #WðÕt ðªn 1 s¯ lßþng nh¤t ð¸nh thì ")
			AddText(sceneId,"1 ph¥n quà cñc kì h¤p dçn s¨ ðßþc #GCây Thông Noel #Wtrao t¾i b¢ng hæu. #r#Y Chúc b¢ng hæu có 1 mùa giáng sinh th§t vui vë và ¤m áp!")
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)
		return
	end
	if GetNumText()==2 then -- hop thanh sao giang sinh
		
		local soitem=LuaFnGetAvailableItemCount(sceneId, selfId, 20310192)
		local slot =LuaFnGetPropertyBagSpace( sceneId, selfId)
		if soitem<20 then
			BeginEvent( sceneId )
				AddText(sceneId,"B¢ng hæu không có ðü s¯ #GÐ° ch½i b¸ cß¾p#W. Phäi thu th§p ðü 20 cái m¾i tiªn hành ð±i ðßþc!")
			EndEvent(sceneId)
			DispatchEventList(sceneId,selfId,targetId)
		elseif slot<1 then
				BeginEvent( sceneId )
						AddText(sceneId,"Tay näi cüa b¢ng hæu không ðü ch² tr¯ng!")
				EndEvent(sceneId)
				DispatchEventList(sceneId,selfId,targetId)
		else
			LuaFnDelAvailableItem(sceneId,selfId,20310192,20)
			LuaFnTryRecieveItem(sceneId,selfId,30505259,QUALITY_MUST_BE_CHANGE)
			x006969_Tips(sceneId,selfId,"B¢ng hæu ðã nh§n 1 Sao Trang Trí Giáng Sinh !")
			
		end
	end
	--hd add
	if GetNumText() == 3 then -- doi diem hoat dong
		BeginEvent(sceneId)
			strText = " Chúc các hÕ có 1 Giáng sinh th§t vui vë !!! Ta có nhi«u ph¥n quà h¤p dçn ðang ch¶ b¢ng hæu  ðó. Hãy thß¶ng xuyên ðªn trò chuy®n v¾i ta nhé!!!! "
			AddText( sceneId, strText )
			AddNumText(sceneId,x006969_g_scriptId,"Nh§n quà t£ng ngçu nhiên",3,1000)
			AddNumText(sceneId,x006969_g_scriptId,"Ð±i yªu quyªt môn phái",3,2000)
			AddNumText(sceneId,x006969_g_scriptId,"Ð±i th¶i trang, thú cßÞi",3,3000)
			AddNumText(sceneId,x006969_g_scriptId,"Ð±i NL Long Vån, th¶i trang, thú cßÞi",3,4000)
			--AddNumText(sceneId,x006969_g_scriptId,"Ð±i #YLøc hþp l®nh bài",3,5000)
			AddNumText(sceneId,x006969_g_scriptId,"Ta chï ghé qua thôi",3,0)
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)
	end
	local diemhd = 100000; --khai bao
	diemhd = 100;
	if GetNumText() == 1000 then --Nh§n quà t£ng ngçu nhiên
		BeginEvent(sceneId)
			strText = " Chúc các hÕ có 1 Giáng sinh th§t vui vë !!! Ta có nhi«u ph¥n quà h¤p dçn ðang ch¶ b¢ng hæu  ðó. Hãy thß¶ng xuyên ðªn trò chuy®n v¾i ta nhé!!!! "
			AddText( sceneId, strText )
			AddText(sceneId,"C¥n t¯n "..diemhd.." ði¬m hoÕt ðµng ð¬ nh§n quà. Các hÕ có ð°ng ý không ?")
			AddNumText(sceneId,x006969_g_scriptId,"Ð°ng ý",3,1001)
			AddNumText(sceneId,x006969_g_scriptId,"Ta chï ghé qua thôi",3,0)
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)
	end
	if GetNumText() == 1001 then 
		local check_diemhd_ok =0;
		check_diemhd_ok = x006969_check_diemhd(sceneId,selfId,targetId,diemhd )
		if check_diemhd_ok >=1 then
			x006969_NhanQuaNgauNhien( sceneId, selfId, targetId )
		else	
			x006969_NotifyFailBox( sceneId, selfId, targetId, "Không ðü ði¬m hoÕt ðµng c¥n thiªt !" )
			x006969_NotifyFailTips( sceneId, selfId, "Không ðü ði¬m hoÕt ðµng c¥n thiªt !" )
		end
	end
	diemhd = 300;
	if GetNumText() == 2000 then --Ð±i yªu quyªt môn phái
		BeginEvent(sceneId)
			strText = " Chúc các hÕ có 1 Giáng sinh th§t vui vë !!! Ta có nhi«u ph¥n quà h¤p dçn ðang ch¶ b¢ng hæu  ðó. Hãy thß¶ng xuyên ðªn trò chuy®n v¾i ta nhé!!!! "
			AddText( sceneId, strText )
			AddText(sceneId,"C¥n t¯n "..diemhd.." ði¬m hoÕt ðµng ð¬ nh§n quà. Các hÕ có ð°ng ý không ?")
			AddNumText(sceneId,x006969_g_scriptId,"Ð°ng ý",3,2001)
			AddNumText(sceneId,x006969_g_scriptId,"Ta chï ghé qua thôi",3,0)
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)
	end
	if GetNumText() == 2001 then 
		local check_diemhd_ok =0;
		check_diemhd_ok = x006969_check_diemhd(sceneId,selfId,targetId,diemhd )
		if check_diemhd_ok >=1 then
			x006969_YeuQuyetMP( sceneId, selfId, targetId )
		else	
			x006969_NotifyFailBox( sceneId, selfId, targetId, "Không ðü ði¬m hoÕt ðµng c¥n thiªt !" )
			x006969_NotifyFailTips( sceneId, selfId, "Không ðü ði¬m hoÕt ðµng c¥n thiªt !" )
		end
	end
	
	diemhd = 500;
	if GetNumText() == 3000 then --thoi trang, thu cuoi
		BeginEvent(sceneId)
			strText = " Chúc các hÕ có 1 Giáng sinh th§t vui vë !!! Ta có nhi«u ph¥n quà h¤p dçn ðang ch¶ b¢ng hæu  ðó. Hãy thß¶ng xuyên ðªn trò chuy®n v¾i ta nhé!!!! "
			AddText( sceneId, strText )
			AddText(sceneId,"C¥n t¯n "..diemhd.." ði¬m hoÕt ðµng ð¬ nh§n quà. Các hÕ có ð°ng ý không ?")
			AddNumText(sceneId,x006969_g_scriptId,"Ð°ng ý",3,3001)
			AddNumText(sceneId,x006969_g_scriptId,"Ta chï ghé qua thôi",3,0)
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)
	end
	if GetNumText() == 3001 then 
		local check_diemhd_ok =0;
		check_diemhd_ok = x006969_check_diemhd(sceneId,selfId,targetId,diemhd )
		if check_diemhd_ok >=1 then
			x006969_Doi_TT_TC( sceneId, selfId, targetId )
		else	
			x006969_NotifyFailBox( sceneId, selfId, targetId, "Không ðü ði¬m hoÕt ðµng c¥n thiªt !" )
			x006969_NotifyFailTips( sceneId, selfId, "Không ðü ði¬m hoÕt ðµng c¥n thiªt !" )
		end
	end
	diemhd = 700;
	if GetNumText() == 4000 then --thoi trang, thu cuoi, nl longvan
		BeginEvent(sceneId)
			strText = " Chúc các hÕ có 1 Giáng sinh th§t vui vë !!! Ta có nhi«u ph¥n quà h¤p dçn ðang ch¶ b¢ng hæu  ðó. Hãy thß¶ng xuyên ðªn trò chuy®n v¾i ta nhé!!!! "
			AddText( sceneId, strText )
			AddText(sceneId,"C¥n t¯n "..diemhd.." ði¬m hoÕt ðµng ð¬ nh§n quà. Các hÕ có ð°ng ý không ?")
			AddNumText(sceneId,x006969_g_scriptId,"Ð°ng ý",3,4001)
			AddNumText(sceneId,x006969_g_scriptId,"Ta chï ghé qua thôi",3,0)
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)
	end
	if GetNumText() == 4001 then 
		local check_diemhd_ok =0;
		check_diemhd_ok = x006969_check_diemhd(sceneId,selfId,targetId,diemhd )
		if check_diemhd_ok >=1 then
			x006969_Doi_NLLV_TT_TC( sceneId, selfId, targetId )
		else	
			x006969_NotifyFailBox( sceneId, selfId, targetId, "Không ðü ði¬m hoÕt ðµng c¥n thiªt !" )
			x006969_NotifyFailTips( sceneId, selfId, "Không ðü ði¬m hoÕt ðµng c¥n thiªt !" )
		end
	end
	
	
	diemhd = 2000;
	if GetNumText() == 5000 then --Ð±i #YLøc hþp l®nh bài
		BeginEvent(sceneId)
			strText = " Chúc các hÕ có 1 Giáng sinh th§t vui vë !!! Ta có nhi«u ph¥n quà h¤p dçn ðang ch¶ b¢ng hæu  ðó. Hãy thß¶ng xuyên ðªn trò chuy®n v¾i ta nhé!!!! "
			AddText( sceneId, strText )
			AddText(sceneId,"C¥n t¯n "..diemhd.." ði¬m hoÕt ðµng ð¬ nh§n quà. Các hÕ có ð°ng ý không ?")
			AddNumText(sceneId,x006969_g_scriptId,"Ð°ng ý",3,5001)
			AddNumText(sceneId,x006969_g_scriptId,"Ta chï ghé qua thôi",3,0)
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)
	end
	if GetNumText() == 5001 then 
		local check_diemhd_ok =0;
		check_diemhd_ok = x006969_check_diemhd(sceneId,selfId,targetId,diemhd )
		if check_diemhd_ok >=1 then
			x006969_LucHopLenhBai( sceneId, selfId, targetId )
		else	
			x006969_NotifyFailBox( sceneId, selfId, targetId, "Không ðü ði¬m hoÕt ðµng c¥n thiªt !" )
			x006969_NotifyFailTips( sceneId, selfId, "Không ðü ði¬m hoÕt ðµng c¥n thiªt !" )
		end
	end
	
	if GetNumText() == 5 then --doi yeu quyet co dinh
		BeginEvent(sceneId)
			strText = " Chúc các hÕ có 1 Giáng sinh th§t vui vë !!! Ta có nhi«u ph¥n quà h¤p dçn ðang ch¶ b¢ng hæu  ðó. Hãy thß¶ng xuyên ðªn trò chuy®n v¾i ta nhé!!!! "
			AddText( sceneId, strText )
			AddText(sceneId,"Hãy mang Yªu Quyªt ph¥n thß·ng b¸ c¯ ð¸nh ðªn ðây, ta s¨ giúp các hÕ ð±i lÕi. Các hÕ có ð°ng ý không ?")
			AddNumText(sceneId,x006969_g_scriptId,"Ð°ng ý",4,6)
			AddNumText(sceneId,x006969_g_scriptId,"Ta chï ghé qua thôi",4,0)
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)
	end
	if GetNumText() == 6 then
		x006969_DoiYeuQuyetbt8( sceneId, selfId, targetId )
	end
	if GetNumText() == 0 then --kªt thúc
		BeginUICommand(sceneId)
		EndUICommand(sceneId)
		DispatchUICommand(sceneId,selfId, 1000)
		return
	end
	--end hd add

end
function x006969_Tips(sceneId, selfId,Tips)
 			BeginEvent(sceneId)
				AddText(sceneId, Tips)
			EndEvent(sceneId)
			DispatchMissionTips(sceneId, selfId)
end


function x006969_DoiYeuQuyetbt8( sceneId, selfId, targetId )
	local ok =0
	for i=1,getn(x006969_g_yeuquyet_bt8) do
		local num = LuaFnGetAvailableItemCount( sceneId, selfId, x006969_g_yeuquyet_bt8[i] ) --check so luong
		if num >=1 then --neu co
			LuaFnDelAvailableItem(sceneId,selfId, x006969_g_yeuquyet_bt8[i], num ) --thi xoa
			for j=1,num do
				local BagIndex =  TryRecieveItem( sceneId, selfId, x006969_g_yeuquyet_bt8[i], 1 ) --add lai
				if BagIndex <0 then
					x006969_NotifyFailTips( sceneId, selfId,  "Túi ðñng ð° ðã ð¥y !" )
				else
					x006969_NotifyFailTips( sceneId, selfId,  "Hoán ð±i thành công  #Y#{_ITEM" ..x006969_g_yeuquyet_bt8[i].. "}")
				end
			end
			ok =1;
		end
	end
	if ok==0 then
		x006969_NotifyFailTips( sceneId, selfId,  "Thiªu v§t ph¦m c¥n thiªt ho£c v§t ph¦m b¸ khoá !" )
	else
		x006969_NotifyFailTips( sceneId, selfId,  "Hoán ð±i hoàn t¤t !" )
	end
	BeginUICommand(sceneId)
	EndUICommand(sceneId)
	DispatchUICommand(sceneId,selfId, 1000)
	return
	
end
function x006969_check_diemhd(sceneId,selfId,targetId,diemhd )
	local trungthu2013_point = GetMissionData(sceneId,selfId,MD_TRUNGTHU_POINT)
	if trungthu2013_point < diemhd then
		return -1;
	end
	SetMissionData(sceneId,selfId,MD_TRUNGTHU_POINT,trungthu2013_point-diemhd )
	return 1;
end
function x006969_NhanQuaNgauNhien( sceneId, selfId, targetId )
	--edit ok
	local gift_id = x006969_g_quatang[random(getn(x006969_g_quatang))];
	local BagIndex = TryRecieveItem( sceneId, selfId, gift_id, QUALITY_MUST_BE_CHANGE )
	if BagIndex ~= -1 then
		local	bindidx	=LuaFnItemBind( sceneId, selfId, BagIndex)
		if bindidx ~= 1 then
			x006969_NotifyFailTips( sceneId, selfId, "C¯ ð¸nh th¤t bÕi !" )
		else
			x006969_NotifyFailTips( sceneId, selfId,"Chúc m×ng, nh§n ðßþc quà t£ng :   #Y#{_ITEM" ..gift_id.. "}" )
			
			str = format("#cff99cc#{_INFOUSR%s} tham gia sñ ki®n #Y [Giáng Sinh An Lành] #cff99cc trong lúc trang trí #GCây Thông Rñc RÞ #cff99ccnh§n ðßþc #Y#{_ITEM" ..gift_id.. "}  #cff99cc. Th§t là may m¡n!", GetName(sceneId,selfId))
			BroadMsgByChatPipe(sceneId, selfId, str, 0)
			BeginUICommand(sceneId)
			EndUICommand(sceneId)
			DispatchUICommand(sceneId,selfId, 1000)
			return
		end
	end
end
function x006969_Doi_TT_TC( sceneId, selfId, targetId )
	--edit ok
	local gift_id = x006969_ThuCuoi_PET_358[random(getn(x006969_ThuCuoi_PET_358))];
	local BagIndex = TryRecieveItem( sceneId, selfId, gift_id, QUALITY_MUST_BE_CHANGE )
	if BagIndex ~= -1 then
		--local	bindidx	=LuaFnItemBind( sceneId, selfId, BagIndex)
		--if bindidx ~= 1 then
			--x006969_NotifyFailTips( sceneId, selfId, "C¯ ð¸nh th¤t bÕi !" )
		--else
			x006969_NotifyFailTips( sceneId, selfId,"Chúc m×ng, nh§n ðßþc quà t£ng :   #Y#{_ITEM" ..gift_id.. "}" )
			
			str = format("#cff99cc#{_INFOUSR%s} tham gia sñ ki®n #Y [Giáng Sinh An Lành] #cff99cc trong lúc trang trí #GCây Thông Rñc RÞ #cff99ccnh§n ðßþc #Y#{_ITEM" ..gift_id.. "}  #cff99cc. Th§t là may m¡n!", GetName(sceneId,selfId))
			BroadMsgByChatPipe(sceneId, selfId, str, 4)
			BeginUICommand(sceneId)
			EndUICommand(sceneId)
			DispatchUICommand(sceneId,selfId, 1000)
			return
		--end
	end
end
function x006969_Doi_NLLV_TT_TC( sceneId, selfId, targetId )
	--edit ok
	local gift_id = x006969_NLLongVan[random(getn(x006969_NLLongVan))];
	local BagIndex = TryRecieveItem( sceneId, selfId, gift_id, QUALITY_MUST_BE_CHANGE )
	if BagIndex ~= -1 then
		--local	bindidx	=LuaFnItemBind( sceneId, selfId, BagIndex)
		--if bindidx ~= 1 then
		--	x006969_NotifyFailTips( sceneId, selfId, "C¯ ð¸nh th¤t bÕi !" )
		--else
			x006969_NotifyFailTips( sceneId, selfId,"Chúc m×ng, nh§n ðßþc quà t£ng :   #Y#{_ITEM" ..gift_id.. "}" )
			
			str = format("#cff99cc#{_INFOUSR%s} tham gia sñ ki®n #Y [Giáng Sinh An Lành] #cff99cc trong lúc trang trí #GCây Thông Rñc RÞ #cff99ccnh§n ðßþc #Y#{_ITEM" ..gift_id.. "}  #cff99cc. Th§t là may m¡n!", GetName(sceneId,selfId))
			BroadMsgByChatPipe(sceneId, selfId, str, 4)
			BeginUICommand(sceneId)
			EndUICommand(sceneId)
			DispatchUICommand(sceneId,selfId, 1000)
			return
		--end
	end
end
function x006969_YeuQuyetMP( sceneId, selfId, targetId )

	local gift_id = x006969_g_yeuquyet_bt8[random(1,18)];
	local BagIndex = TryRecieveItem( sceneId, selfId, gift_id, QUALITY_MUST_BE_CHANGE )
	if BagIndex ~= -1 then
		--local	bindidx	=LuaFnItemBind( sceneId, selfId, BagIndex)
		--if bindidx ~= 1 then
		--	x006969_NotifyFailTips( sceneId, selfId, "C¯ ð¸nh th¤t bÕi !" )
		--else
			x006969_NotifyFailTips( sceneId, selfId,"Chúc m×ng, nh§n ðßþc quà t£ng:   #Y#{_ITEM" ..gift_id.. "}" )
			
			str = format("#cff99cc#{_INFOUSR%s} tham gia sñ ki®n #Y [Giáng Sinh An Lành] #cff99cc trong lúc trang trí #GCây Thông Rñc RÞ #cff99ccnh§n ðßþc #Y#{_ITEM" ..gift_id.. "}  #cff99cc. Th§t là may m¡n!", GetName(sceneId,selfId))
			BroadMsgByChatPipe(sceneId, selfId, str, 4)
			BeginUICommand(sceneId)
			EndUICommand(sceneId)
			DispatchUICommand(sceneId,selfId, 1000)
			return
		--end
	end
end
function x006969_LucHopLenhBai( sceneId, selfId, targetId )

	local gift_id = x006969_g_LucHopLenhBai[random(1,5)];
	local BagIndex = TryRecieveItem( sceneId, selfId, gift_id, QUALITY_MUST_BE_CHANGE )
	if BagIndex ~= -1 then
		local	bindidx	=LuaFnItemBind( sceneId, selfId, BagIndex)
		if bindidx ~= 1 then
			x006969_NotifyFailTips( sceneId, selfId, "C¯ ð¸nh th¤t bÕi !" )
		else
			x006969_NotifyFailTips( sceneId, selfId,"Chúc m×ng, nh§n ðßþc quà t£ng:   #Y#{_ITEM" ..gift_id.. "}" )
			
			str = format("#cff99cc#{_INFOUSR%s} tham gia sñ ki®n #Y [Giáng Sinh An Lành] #cff99cc trong lúc trang trí #GCây Thông Rñc RÞ #cff99ccnh§n ðßþc #Y#{_ITEM" ..gift_id.. "}  #cff99cc. Th§t là may m¡n!", GetName(sceneId,selfId))
			BroadMsgByChatPipe(sceneId, selfId, str, 4)
			BeginUICommand(sceneId)
			EndUICommand(sceneId)
			DispatchUICommand(sceneId,selfId, 1000)
			return
		end
	end
end


function x006969_NotifyFailBox( sceneId, selfId, targetId, msg )
	BeginEvent( sceneId )
		AddText( sceneId, msg )
	EndEvent( sceneId )
	DispatchEventList( sceneId, selfId, targetId )
end

function x006969_NotifyFailTips( sceneId, selfId, Tip )
	BeginEvent( sceneId )
		AddText( sceneId, Tip )
	EndEvent( sceneId )
	DispatchMissionTips( sceneId, selfId )
end