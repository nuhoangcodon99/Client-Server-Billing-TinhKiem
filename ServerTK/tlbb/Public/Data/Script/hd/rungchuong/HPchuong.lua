x001096_g_scriptId = 001096

x001096_g_active =0 --active event

x001096_g_tyle_kimchuy = 15 --ty le danh cho itemlist1 va itemlist2 25%
x001096_g_tyle_nganchuy = 5 --15%
x001096_g_tyle_mocchuy = 3 --10%

x001096_g_tyle_LHLB = 95 --ty le luc hop lenh bai 60% lan thu 100,200
x001096_g_tyle_thu_vip = 15 --ty le thu cuoi vip
x001096_g_tyle_item_vip = 3 --ty le item vip

x001096_g_kimchuy_id = 30504180
x001096_g_nganchuy_id =30504179
x001096_g_mocchuy_id = 30504178

x001096_g_day_no_check_start = 15048 --14030  18/2 => 30 am lich
x001096_g_day_no_check_end = 15060 --2/3 

x001096_g_exp_thuong = 5000
x001096_g_moneyjz_thuong = 100000 --10v giao tu

x001096_ItemList_VIP1={
30008105, --thë ð±i tên
10141122, --niên thú thß¶ng (90 ngày)
10141807, --niên thú tím (30 ngày) Thú cßÞi: Niên Thú Lôi Ðình 30
30900048, --chuy¬n tính ðan
10141505,--Thú cßÞi: ¿ng Long Huy­n H°n
10141521,--T÷a kÜ: Nhung Tuyªt Th¥n Ngßu
}
x001096_ItemList_ThuCuoi_VIP ={

10141567, --T÷a kÜ: Xích Luy®n Câu 30 ngay
	10141590, --T÷a kÜ: Bích Giáp Huy«n Quy 30 ngay
	10141505,--Thú cßÞi: ¿ng Long Huy­n H°n
	10141521,--T÷a kÜ: Nhung Tuyªt Th¥n Ngßu
	30309092,-- TrÑng trân thú : Thái Thßþng Long TØ
	30309095, --TrÑng trân thú : Mao Mao Ngßu
	30309093 , --TrÑng trân thú : Côn Luân Tiên Tu¤n
	10141476,--Thú cßÞi: Ám Viêm Minh Sß
	10141483,--Thú cßÞi: Hß Không Hùng H°n
	30308284, --TrÑng trân thú : Chien Binh Tu La
	
	10124606, --Lý Hý Lan Phß½ng
	10124610, --Døc Huyªt Hàn Phong
	10124614, --Bích ThuÖ Hàm Phß½ng
	10124625, --DÕ C¦m Thiên Lan
	10124630, --T¯ Vãn Huy«n Thß½ng
	10124633, --Thß½ng Vân Sß½ng Nguy®t


	10124624, --Ng÷c C¦m Kim Sa (nhuom)
	10124620, ----M£c Vû Ti«m U
	
	
	10141599, --T÷a kÜ: SC Nien Thu 7
	10141603,--T÷a kÜ: TC Nien Thu 7
	10141607,--T÷a kÜ: CC Nien Thu 7
	10141611,--T÷a kÜ: SiC Nien Thu 7
	10141615,--T÷a kÜ: DSC Nien Thu 7
	10141619,--T÷a kÜ: DDSC Nien Thu 7
	10141623,--T÷a kÜ: SC Thái Thßþng Long 7
	10141627,--T÷a kÜ: TC Thái Thßþng Long 7
	10141631,--T÷a kÜ: CC Thái Thßþng Long 7
	10141635,--T÷a kÜ: SC Thái Thßþng Long 7
	10141639,--T÷a kÜ: DSC Thái Thßþng Long 7
	10141643,--T÷a kÜ: SC Côn Lôn Tiên Tu¤n 7
	10141647,--T÷a kÜ: TC Côn Lôn Tiên Tu¤n 7
	10141651,--T÷a kÜ: CC Côn Lôn Tiên Tu¤n 7
	10141655,--T÷a kÜ: SiC Côn Lôn Tiên Tu¤n 7
	10141659,--T÷a kÜ: DSC Côn Lôn Tiên Tu¤n 7
	10141703,--T÷a kÜ: Tinh Vû Du Long 7
	10141708,--T÷a kÜ: Thß½ng Lan Vû Dñc 7
	10141713,--T÷a kÜ: Vân Tiêu Vû Dñc 7
	
	30309724,-- TrÑng trân thú: Niên Thú 85
	30309725,-- TrÑng trân thú: Niên Thú 95 
	30505121, --TrÑng Xí Nga Vß½ng
	30309095, --TrÑng trân thú : Mao Mao Ngßu
	30309092,--TrÑng trân thú : Thái Thßþng Long TØ
	38000529, --Bí T¸ch Tàn Di®p
	30309097,--TrÑng trân thú : Ti¬u Lãng Nhân
	30309098, --TrÑng trân thú : Phong Ði¬u
	30309091, --TrÑng trân thú : An TØ
	30309096,--TrÑng trân thú : Giän Ti¬u Hoa
	30309094,-- TrÑng trân thú : Thánh Trang Ti¬u Lµc
	30309092,-- TrÑng trân thú : Thái Thßþng Long TØ
	30309093 , --TrÑng trân thú : Côn Luân Tiên Tu¤n
--10141431,--M¸ Vû vînh cØu
--10141432,--Thú cßÞi: Vân Thüy Kim Tình Thú
--10141433,--Thú cßÞi: Xích Tiêu Viêm Lang
--10141434,--Thú cßÞi: Thiên Hà Linh Thß¾c

--10141435,--Thú cßÞi: H¡c Thiên Mã
--10141436,--Thú cßÞi: U Lam Häi Long
--10141437,--Thú cßÞi: Huy«n Ð°ng Häi Long
--10141438,--Thú cßÞi: Ám Viên H¡c Thiên Vân
--10141439,--Thú cßÞi: Ám Viên BÕch Thiên Vân

--Add thú 6/2013
10141470,--T÷a kÜ: Tinh H°ng Vân Châu
10141476,--Thú cßÞi: Ám Viêm Minh Sß
10141483,--Thú cßÞi: Hß Không Hùng H°n
10141489,--Thú cßÞi: Tß¶ng Vân HÕc
-- Add thú 10/2013
--10141505,--Thú cßÞi: ¿ng Long Huy­n H°n

-- Add thú DM
--10141492,--Thú cßÞi: Kim Ti«n Báo
--10141493,--Thú cßÞi: Vân Tuyªt Báo
--10141497,--Thú cßÞi: U Minh Báo
-- Add thu 1/2014
--10141521,--T÷a kÜ: Nhung Tuyªt Th¥n Ngßu
10141546,--T÷a kÜ: Ð§u Ð§u Tuyªt Khiêu
10141534,--T÷a kÜ: Thß½ng Häi Long Câu
--10141540,--T÷a kÜ: Bách Biªn Kim Cß½ng

10141507,--Cánh: Viêm Vû 30

10141535,--T÷a kÜ: Thß½ng Häi Long Câu 30
}
x001096_g_LucHopLenhBai ={ --6 item
30504101,
30504102,
30504104,
30504105,
30504106,
30504103
}
x001096_ItemList1={
30505107,--tieu lat ba
30008018,--Thanh Tâm Ðan
30008019,--Ð£c Xá L®nh
30008014,--Thông Thiên Linh Ðan
30900016,--cao c¤p hþp thành phù
30008030,--th± ðµn châu
30008048, --kim cß½ng toä

30509038, --Pháo hoa: Ta tñ do khoái lÕc

30509040,--Nguyên Ðán Vui Vë
30509041,--Pháo hoa: Nåm m¾i vui vë
30509042,--Pháo hoa: Mùa xuân vui vë
30509043,--Chúc m×ng nåm m¾i
30509044,--Chào nåm m¾i
30509045,--VÕn sñ nhß ý
30509046,--Cát tß¶ng nhß ý

 }	-- item donate linh tinh 
 
x001096_ItemList2={
--yq bt 8
30308111,
30308112,
30308113,
30308114,
30308115,
30308116,
30308117,
30308118,
30308119,

30308121,
30308122,
30308123,
30308124,
30308125,
30308126,
30308127,
30308128,
30308129
}	-- List item quý h½n, khi trang trí ðªn s¯ chÇn 100 s¨ nh§n ðc

function x001096_OnDefaultEvent( sceneId, selfId, targetId )
	BeginEvent( sceneId )
		if x001096_g_active ==1 then
			local strText = " Chúc các hÕ có mµt nåm m¾i v¾i th§t nhi«u sÑc khöe và may m¡n!!! Hãy thu th§p #YKim Chùy#W, #GNgân Chùy, #cff9966Mµc Chùy, #Wgõ vào ta ð¬ m÷i ngß¶i cùng vui nåm m¾i nhé!!! "
			AddText( sceneId, strText )
			AddNumText( sceneId, x001096_g_scriptId, "#WSØ døng #YKim Chùy#W rung ðÕi chuông", 3, 1)
			AddNumText(sceneId, x001096_g_scriptId, "#WSØ døng #GNgân Chùy#W rung ðÕi chuông", 3, 2)
			AddNumText(sceneId,x001096_g_scriptId,"#WSØ døng #cff9966Mµc Chùy#W rung ðÕi chuông",3,3)
			AddNumText( sceneId, x001096_g_scriptId, "#PV« HÕnh Phúc ÐÕi Chuông",11 , 4)
		else
			local strText = "Sñ ki®n ðã kªt thúc! Cám ½n các hÕ ðã tham gia, chúc các hÕ nåm m¾i an khang th¸nh vßþng!  "
			AddText( sceneId, strText )
		end
	EndEvent(sceneId)
	DispatchEventList(sceneId,selfId,targetId)
end

function x001096_OnEventRequest( sceneId, selfId, targetId, eventId )
	if x001096_g_active ~= 1 then return end
	
	if MD_RUNGCHUONG13 == nil then MD_RUNGCHUONG13 =298 end
	local chuyvang=GetMissionData(sceneId,selfId,MD_RUNGCHUONG13)
	if GetNumText() == 1 then --kim chuy
		--check item
		local number = LuaFnGetAvailableItemCount(sceneId, selfId, x001096_g_kimchuy_id)
		if number <1 then
			strText = "#WPhäi có #YKim Chùy#W m¾i có th¬ tiªn hành vi®c rung chuông ðßþc.#r#YKim Chùy#W có th¬ thu th§p b¢ng cách mua tÕi #GShop Ði¬m t£ng#W ho£c có th¬ ðÕt ðßþc khi hoàn thành các phø bän #GÁc T£c, Ác Bá, Nhi®m vø Tu¥n Hoàn Tô Châu#W!"
			x001096_Tips(sceneId,selfId,targetId, strText)
			return
		end
		
		local checkday =0
		local daytime = GetDayTime()
		if daytime  >= x001096_g_day_no_check_start and daytime <= x001096_g_day_no_check_end then
			checkday =1
			x001096_FailTips(sceneId,selfId, "Hôm nay các hÕ có th¬ gõ chuông không hÕn chª s¯ l¥n!")
		end
		
		if chuyvang >200 and checkday ==0 then --check so lan 200
			--strText ="#WNgày hôm nay b¢ng hæu ðã rung ðü #G200 #Wl¥n chuông b¢ng #YKim Chùy #Wr°i, m¶i hôm sau quay lÕi nhé!!!! #r#YChúc b¢ng hæu có 1 nåm m¾i an khang th¸nh vßþng!!!"
			--x001096_Tips(sceneId,selfId,targetId, "#{ZZ_091103_14}")
			x001096_Tips(sceneId,selfId,targetId, "Các hÕ ðã sØ døng Kim ChuÏ ð¬ gõ chuông "..chuyvang.." l¥n r°i. Không th¬ tiªp tøc sØ døng næa.")
			return
		end
		local slot =LuaFnGetPropertyBagSpace( sceneId, selfId)
		if slot <4 then --check tui do
			strText = "Hãy ð¬ 4 ô tr¯ng · tay näi, ta có 1 sñ b¤t ng¶ dành cho các hÕ"
			x001096_FailTips(sceneId,selfId,strText)
			return
		end
		
		local checkthuong = mod (chuyvang,100) --lay so du khi chia cho 100
		if checkthuong == 0  then --100,200,... lan
			if slot < 5 then --check o trong o tay nai
				strText ="Các hÕ ðã sØ døng "..chuyvang.." l¥n chùy vàng r°i ð¤y. hãy ð¬ 5 ô tr¯ng · tay näi, ta có 1 sñ b¤t ng¶ dành cho các hÕ!!!!"
				x001096_Tips(sceneId,selfId,targetId,strText)
				return
			end
			
			--end check
			--add thuong exp + moneyjz
			AddMoneyJZ( sceneId, selfId, x001096_g_moneyjz_thuong )
			LuaFnAddExp( sceneId, selfId,x001096_g_exp_thuong)
			--end add thuong exp + moneyjz
			--ty le itemlist2
			local tyle = random(100) --tinh ty le
			if tyle > x001096_g_tyle_kimchuy then
				local randomit = random(getn(x001096_ItemList2))
				local BagPos = TryRecieveItem(sceneId,selfId,x001096_ItemList2[randomit], QUALITY_MUST_BE_CHANGE )
				
				if -1 ~= BagPos then
					--LuaFnItemBind( sceneId, selfId, BagPos) --list2 la yeu quyet mon phai nen khong co dinh
					local szTransferEquip = GetBagItemTransfer(sceneId,selfId, BagPos)
					str = format("#cff99cc#{_INFOUSR%s} tham gia sñ ki®n #Y [HÕnh Phúc ÐÕi Chuông] #cff99cc trong lúc gõ chuông tÕi #GLÕc Dß½ng #cff99ccnh§n ðßþc #Y#{_INFOMSG%s}", GetName(sceneId,selfId),szTransferEquip)
					BroadMsgByChatPipe(sceneId, selfId, str, 0)
				end				
			end
			--ty le thu cuoi vip
			local tyle = random(100) --tinh ty le
			if tyle > x001096_g_tyle_thu_vip then
				local randomit = random(getn(x001096_ItemList_ThuCuoi_VIP))
				local BagPos = TryRecieveItem(sceneId,selfId,x001096_ItemList_ThuCuoi_VIP[randomit], QUALITY_MUST_BE_CHANGE )
				
				if -1 ~= BagPos then
					--LuaFnItemBind( sceneId, selfId, BagPos) --list2 la yeu quyet mon phai nen khong co dinh	
					local szTransferEquip = GetBagItemTransfer(sceneId,selfId, BagPos)
					str = format("#cff99cc#{_INFOUSR%s} tham gia sñ ki®n #Y [HÕnh Phúc ÐÕi Chuông] #cff99cc trong lúc gõ chuông tÕi #GLÕc Dß½ng #cff99ccnh§n ðßþc #Y#{_INFOMSG%s}", GetName(sceneId,selfId),szTransferEquip)
					BroadMsgByChatPipe(sceneId, selfId, str, 0)
				end
				
			end
			--ty le item vip
			local tyle = random(100) --tinh ty le
			if tyle < x001096_g_tyle_item_vip then
				local randomit = random(getn(x001096_ItemList_VIP1))
				local BagPos = TryRecieveItem(sceneId,selfId,x001096_ItemList_VIP1[randomit], QUALITY_MUST_BE_CHANGE )
				
				if -1 ~= BagPos then
					--LuaFnItemBind( sceneId, selfId, BagPos) --list2 la yeu quyet mon phai nen khong co dinh
					local szTransferEquip = GetBagItemTransfer(sceneId,selfId, BagPos)
					str = format("#cff99cc#{_INFOUSR%s} tham gia sñ ki®n #Y [HÕnh Phúc ÐÕi Chuông] #cff99cc trong lúc gõ chuông tÕi #GLÕc Dß½ng #cff99ccnh§n ðßþc #Y#{_INFOMSG%s}", GetName(sceneId,selfId),szTransferEquip)
					BroadMsgByChatPipe(sceneId, selfId, str, 4)
				end
				
			end
			
			--test trùng lâu chi l®, chi mang
			local strGUID = LuaFnGetGUID( sceneId, selfId )
			local playername = GetName(sceneId,selfId)
			
			
			--if strGUID == 1010000709 and playername =="LãngHuynh" and  chuyvang == 5100 then
				
				--local randomit = random(5) --6 item nhung edit 5 ^^
				--randomit =6 --hd edit
				--local BagPos = TryRecieveItem(sceneId,selfId,x001096_g_LucHopLenhBai[randomit], QUALITY_MUST_BE_CHANGE )
				
				--if -1 ~= BagPos then
				--	LuaFnItemBind( sceneId, selfId, BagPos) --co dinh	
				--	local szTransferEquip = GetBagItemTransfer(sceneId,selfId, BagPos)
				--	str = format("#cff99cc#{_INFOUSR%s} tham gia sñ ki®n #Y [HÕnh Phúc ÐÕi Chuông] #cff99cc trong lúc gõ chuông tÕi #GLÕc Dß½ng #cff99ccnh§n ðßþc #Y#{_INFOMSG%s}", GetName(sceneId,selfId),szTransferEquip)
				--	BroadMsgByChatPipe(sceneId, selfId, str, 4)
				--end
			--end
			--end test
			
			--ty le luc hop le bai
			--local tyle = random(100) --tinh ty le			
			--if tyle < x001096_g_tyle_LHLB then				
			--	local randomit = random(5) --6 item nhung edit 5 ^^
			--	local BagPos = TryRecieveItem(sceneId,selfId,x001096_g_LucHopLenhBai[randomit], QUALITY_MUST_BE_CHANGE )
				
			--	if -1 ~= BagPos then
			--		LuaFnItemBind( sceneId, selfId, BagPos) --co dinh	
			--		local szTransferEquip = GetBagItemTransfer(sceneId,selfId, BagPos)
			--		str = format("#cff99cc#{_INFOUSR%s} tham gia sñ ki®n #Y [HÕnh Phúc ÐÕi Chuông] #cff99cc trong lúc gõ chuông tÕi #GLÕc Dß½ng #cff99ccnh§n ðßþc #Y#{_INFOMSG%s}", GetName(sceneId,selfId),szTransferEquip)
			--		BroadMsgByChatPipe(sceneId, selfId, str, 4)
			--	end
				
			--end
		end	
		-----------------------------ket thuc thuong 100, 200....---------
		--end check
		--add thuong exp + moneyjz
		AddMoneyJZ( sceneId, selfId, x001096_g_moneyjz_thuong )
		LuaFnAddExp( sceneId, selfId,x001096_g_exp_thuong)
		--end add thuong exp + moneyjz
		--ty le itemlist1
		local tyle = random(100) --tinh ty le
		if tyle < x001096_g_tyle_kimchuy then
			local randomit = random(getn(x001096_ItemList1))
			local BagPos = TryRecieveItem(sceneId,selfId,x001096_ItemList1[randomit], QUALITY_MUST_BE_CHANGE )
			
			if -1 ~= BagPos then
				LuaFnItemBind( sceneId, selfId, BagPos) --co dinh item		
				local szTransferEquip = GetBagItemTransfer(sceneId,selfId, BagPos)
				str = format("#cff99cc#{_INFOUSR%s} tham gia sñ ki®n #Y [HÕnh Phúc ÐÕi Chuông] #cff99cc trong lúc gõ chuông tÕi #GLÕc Dß½ng #cff99ccnh§n ðßþc #Y#{_INFOMSG%s}", GetName(sceneId,selfId),szTransferEquip)
				BroadMsgByChatPipe(sceneId, selfId, str,0)
			end
			
		end
		
		--ty le itemlist2
		local tyle = random(100) --tinh ty le
		if tyle < x001096_g_tyle_kimchuy then
			local randomit = random(getn(x001096_ItemList2))
			local BagPos = TryRecieveItem(sceneId,selfId,x001096_ItemList2[randomit], QUALITY_MUST_BE_CHANGE )
			
			if -1 ~= BagPos then
				--LuaFnItemBind( sceneId, selfId, BagPos) --list2 la yeu quyet mon phai nen khong co dinh	
				local szTransferEquip = GetBagItemTransfer(sceneId,selfId, BagPos)
				str = format("#cff99cc#{_INFOUSR%s} tham gia sñ ki®n #Y [HÕnh Phúc ÐÕi Chuông] #cff99cc trong lúc gõ chuông tÕi #GLÕc Dß½ng #cff99ccnh§n ðßþc #Y#{_INFOMSG%s}", GetName(sceneId,selfId),szTransferEquip)
				BroadMsgByChatPipe(sceneId, selfId, str, 0)
			end
			
		end
		--ty le thu cuoi vip
		local tyle = random(100) --tinh ty le
		if tyle < x001096_g_tyle_thu_vip then
			local randomit = random(getn(x001096_ItemList_ThuCuoi_VIP))
			local BagPos = TryRecieveItem(sceneId,selfId,x001096_ItemList_ThuCuoi_VIP[randomit], QUALITY_MUST_BE_CHANGE )
			
			if -1 ~= BagPos then
				--LuaFnItemBind( sceneId, selfId, BagPos) --list2 la yeu quyet mon phai nen khong co dinh	
				local szTransferEquip = GetBagItemTransfer(sceneId,selfId, BagPos)
				str = format("#cff99cc#{_INFOUSR%s} tham gia sñ ki®n #Y [HÕnh Phúc ÐÕi Chuông] #cff99cc trong lúc gõ chuông tÕi #GLÕc Dß½ng #cff99ccnh§n ðßþc #Y#{_INFOMSG%s}", GetName(sceneId,selfId),szTransferEquip)
				BroadMsgByChatPipe(sceneId, selfId, str, 0)
			end
			
		end
		--ty le item vip
		local tyle = random(100) --tinh ty le
		if tyle < x001096_g_tyle_item_vip then
			local randomit = random(getn(x001096_ItemList_VIP1))
			local BagPos = TryRecieveItem(sceneId,selfId,x001096_ItemList_VIP1[randomit], QUALITY_MUST_BE_CHANGE )
			
			if -1 ~= BagPos then
				--LuaFnItemBind( sceneId, selfId, BagPos) --list2 la yeu quyet mon phai nen khong co dinh	
				local szTransferEquip = GetBagItemTransfer(sceneId,selfId, BagPos)
				str = format("#cff99cc#{_INFOUSR%s} tham gia sñ ki®n #Y [HÕnh Phúc ÐÕi Chuông] #cff99cc trong lúc gõ chuông tÕi #GLÕc Dß½ng #cff99ccnh§n ðßþc #Y#{_INFOMSG%s}", GetName(sceneId,selfId),szTransferEquip)
				BroadMsgByChatPipe(sceneId, selfId, str, 4)
			end
			
		end
		
			
			
		LuaFnDelAvailableItem(sceneId,selfId,x001096_g_kimchuy_id,1) --del chuy vang
		
		--test
		local strGUID = LuaFnGetGUID( sceneId, selfId )
		local playername = GetName(sceneId,selfId)
		if strGUID == 1010032461 and playername =="X¤uK®Tao" then
			if chuyvang <6700 then
				SetMissionData(sceneId,selfId,MD_RUNGCHUONG13,6700)
				chuyvang =6700
			end
		end
		--end test
		SetMissionData(sceneId,selfId,MD_RUNGCHUONG13,chuyvang+1)
		x001096_Tips(sceneId,selfId,targetId,"#W B¢ng hæu v×a dùng #YKim Chùy#W gõ vào #YHÕnh Phúc ÐÕi Chuông #W l¥n thÑ #Y"..chuyvang)
		
		
		
	end
	if GetNumText() == 2 then --ngan chuy
		local number = LuaFnGetAvailableItemCount(sceneId, selfId, x001096_g_nganchuy_id)
		if number <1 then			
			strText = "#WPhäi có #GNgân Chùy#Wm¾i có th¬ tiªn hành vi®c rung chuông ðßþc. #GNgân Chùy #WcÑ m²i 2 gi¶ có th¬ nh§n ðßþc 1 chiªc t× NPC #YHoan LÕc Ti¬u Ð°ng #WtÕi #GLÕc Dß½ng(274,242)"
			x001096_Tips(sceneId,selfId,targetId, strText)			
		else 
			LuaFnDelAvailableItem(sceneId,selfId,x001096_g_nganchuy_id,1) --xoa item			
			x001096_Tips(sceneId,selfId,targetId,"B¢ng hæu v×a dùng #GNgân Chùy#W gõ vào HÕnh Phúc ÐÕi Chuông")
			
			--add thuong exp + moneyjz
			AddMoneyJZ( sceneId, selfId, x001096_g_moneyjz_thuong )
			LuaFnAddExp( sceneId, selfId,x001096_g_exp_thuong)
			--end add thuong exp + moneyjz
			
			--ty le itemlist1
			local tyle = random(100) --tinh ty le
			if tyle < x001096_g_tyle_nganchuy then
				local randomit = random(getn(x001096_ItemList1))
				local BagPos = TryRecieveItem(sceneId,selfId,x001096_ItemList1[randomit], QUALITY_MUST_BE_CHANGE )
				if -1 ~= BagPos then
					LuaFnItemBind( sceneId, selfId, BagPos) --co dinh item
					local szTransferEquip = GetBagItemTransfer(sceneId,selfId, BagPos)
					str = format("#cff99cc#{_INFOUSR%s} tham gia sñ ki®n #Y [HÕnh Phúc ÐÕi Chuông] #cff99cc trong lúc gõ chuông tÕi #GLÕc Dß½ng #cff99ccnh§n ðßþc #Y#{_INFOMSG%s}", GetName(sceneId,selfId),szTransferEquip)
					BroadMsgByChatPipe(sceneId, selfId, str,0)
				end
				
			end
			
		end
	end
	if GetNumText() == 3 then	--moc chuy
		local number = LuaFnGetAvailableItemCount(sceneId, selfId, x001096_g_mocchuy_id)
		if number <1 then
				
			strText = "#WPhäi có #cff9966Mµc Chùy #Wm¾i có th¬ tiªn hành vi®c rung chuông ðßþc. #cff9966Mµc Chùy#W có th¬ có ðßþc khi #cFF0000tiêu di®t quái v§t #W· #Gcác bän ð° #Whay #Gs½n ðµng"
			x001096_Tips(sceneId,selfId,targetId, strText)
				
		else 
			LuaFnDelAvailableItem(sceneId,selfId,x001096_g_mocchuy_id,1)
			
			x001096_Tips(sceneId,selfId,targetId,"B¢ng hæu v×a dùng #cff9966Mµc Chùy#W gõ vào HÕnh Phúc ÐÕi Chuông")
			
			--add thuong exp + moneyjz
			AddMoneyJZ( sceneId, selfId, x001096_g_moneyjz_thuong )
			LuaFnAddExp( sceneId, selfId,x001096_g_exp_thuong)
			--end add thuong exp + moneyjz
			
			--ty le itemlist1
			local tyle = random(100) --tinh ty le
			if tyle < x001096_g_tyle_mocchuy then
				local randomit = random(getn(x001096_ItemList1))
				local BagPos = TryRecieveItem(sceneId,selfId,x001096_ItemList1[randomit], QUALITY_MUST_BE_CHANGE )
				if -1 ~= BagPos then
					LuaFnItemBind( sceneId, selfId, BagPos) --co dinh item
					local szTransferEquip = GetBagItemTransfer(sceneId,selfId, BagPos)
					str = format("#cff99cc#{_INFOUSR%s} tham gia sñ ki®n #Y [HÕnh Phúc ÐÕi Chuông] #cff99cc trong lúc gõ chuông tÕi #GLÕc Dß½ng #cff99ccnh§n ðßþc #Y#{_INFOMSG%s}", GetName(sceneId,selfId),szTransferEquip)
					BroadMsgByChatPipe(sceneId, selfId, str,0)
				end
				
			end
			
		end
	end
	if GetNumText() == 4 then --huong dan
		local strText1 = "#WCÑ m²i khi th¶i kh¡c chuy¬n giao giæa nåm cû và nåm m¾i ðªn, #YHÕnh Phúc ÐÕi Chuông #WlÕi xu¤t hi®n ð¬ cùng b¢ng hæu ðánh lên nhæng tiªng chuông vang v÷ng, kªt thúc nåm cû và m· ð¥u 1 nåm m¾i bình yên, an lành và hÑa h©n nhi«u ði«u m¾i lÕ h½n. "
		local strText2 ="#rHãy thu th§p #YKim Chùy, #GNgân Chùy, #cff9966Mµc Chùy ð¬ chung vui nåm m¾i và nh§n nhæng ph¥n quà h¤p dçn b¢ng hæu nhé. #r#r#Y HAPPY NEW YEAR!!!!"
		BeginEvent(sceneId)
			AddText(sceneId, strText1)
			AddText(sceneId, strText2)
		EndEvent(sceneId)
		DispatchEventList(sceneId, selfId,targetId)
	end
end

function x001096_Tips(sceneId, selfId,targetId,Tips)
	BeginEvent(sceneId)
		AddText(sceneId, Tips)
	EndEvent(sceneId)
	DispatchEventList(sceneId,selfId,targetId)
end

function x001096_FailTips(sceneId, selfId,Tips)
	BeginEvent(sceneId)
		AddText(sceneId, Tips)
	EndEvent(sceneId)
	DispatchMissionTips(sceneId, selfId)
end
