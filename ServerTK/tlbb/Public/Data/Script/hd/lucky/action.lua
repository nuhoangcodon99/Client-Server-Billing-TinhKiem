--Server Vòng quay may m¡n
--Coding: Sói + Vinh

--*********************--
x930038_g_scriptId = 930038
--********************--
x930038_g_XingYunGuo = 30504443								--HÕnh V§n Quä
x930038_g_XingYunZiZhen = 30504444							--HÕnh V§n TØ Châm
--********************--
x930038_g_Client_Server = 20150407
--********************--
x930038_g_Vip_Item_Global={10422016,10423024,10420091,10422155,10423064,10423025,10124518,10157110,10141807,30505908}
--********************--
--Vip tÖ l® là 1/1000
x930038_g_Vip=
{
	{	Index=10422016,		Name="Trùng Lâu Gi¾i",								Number=1,	Icon="set:Ring2 image:Ring2_15"												},
	{	Index=10423024,		Name="Trùng Lâu Ng÷c",								Number=1,	Icon="set:Amulet3 image:Amulet3_5"											},
	{	Index=10420091,		Name="Trùng Lâu.Phän",								Number=1,	Icon="set:Necklace2 image:Necklace2_15"										},
	{	Index=10422155,		Name="Trùng Lâu.Tri®u",								Number=1,	Icon="set:CircularTaskTool17 image:CircularTaskTool17_5"					},
	{	Index=10423064,		Name="Trùng Lâu.Quy",								Number=1,	Icon="set:CircularTaskTool17 image:CircularTaskTool17_6"					},
	{	Index=10423025,		Name="Chân Trùng Lâu Ng÷c",							Number=1,	Icon="set:CircularTaskTool17 image:CircularTaskTool17_6"					},
}
--Normal tÖ l® là tñ ð£t
x930038_g_Normal=
{
	{	Index=10124518,		Name="Ng÷c Vû Thanh Trù",							Number=1,	Icon="set:Cloth15 image:Cloth15_12",						Percent=50 		},
	{	Index=10141507,		Name="Cánh: Viêm Vû(30 ngày)",						Number=1,	Icon="set:RideHeader7 image:RideHeader7_12",				Percent=500 	},
	{	Index=30308282,		Name="TrÑng trân thú: Bách Chiªn Kim Cß½ng",		Number=1,	Icon="set:PetHeader7 image:PetHeader7_13",					Percent=100 	},
	{	Index=30308281,		Name="TrÑng trân thú: Hàm Ð§u Hùng",				Number=1,	Icon="set:PetHeader7 image:PetHeader7_10",					Percent=100 	},
	{	Index=30308283,		Name="TrÑng trân thú: Ti¬u Long Næ",				Number=1,	Icon="set:PetHeader7 image:PetHeader7_14",					Percent=100		},
	{	Index=30308284,		Name="TrÑng trân thú: Chiªn Binh Tu La",			Number=1,	Icon="set:PetHeader7 image:PetHeader7_15",					Percent=100 	},
	{	Index=10141807,		Name="Thú cßÞi: Niên Thú Lôi Ðình",					Number=1,	Icon="set:Ride2 image:Ride2_6",								Percent=100		},
	{	Index=30900048,		Name="Chuy¬n tính ðan",								Number=1,	Icon="set:Charm4 image:Charm4_13",							Percent=100		},
	{	Index=30008105,		Name="Thë ð±i tên",									Number=1,	Icon="set:CircularTaskTool16 image:CircularTaskTool16_4",	Percent=100		},
	{	Index=10141122,		Name="Niên thú thß¶ng",								Number=1,	Icon="set:Ride2 image:Ride2_6",								Percent=100 	},
	{	Index=20310181,		Name="Xuyªt Long ThÕch_Nguyên",						Number=10,	Icon="set:CircularTaskTool32 image:CircularTaskTool32_12",	Percent=200		},
	{	Index=20310182,		Name="Xuyªt Long ThÕch_BÕo",						Number=10,	Icon="set:CircularTaskTool32 image:CircularTaskTool32_10",	Percent=200		},
	{	Index=20310183,		Name="Xuyªt Long ThÕch_Thß½ng",						Number=10,	Icon="set:CircularTaskTool32 image:CircularTaskTool32_11",	Percent=200		},
	{	Index=38000184,		Name="Chú Vån Huyªt Ng÷c",							Number=10,	Icon="set:CircularTaskTool32 image:CircularTaskTool32_13",	Percent=200		},
	{	Index=20310180,		Name="Tinh Vân Thüy",								Number=5,	Icon="set:CircularTaskTool33 image:CircularTaskTool33_1",	Percent=200		},
	{	Index=20310181, 	Name="Xuyªt Long ThÕch_Nguyên",						Number=5,	Icon="set:CircularTaskTool32 image:CircularTaskTool32_12",	Percent=400		},
	{	Index=20310182,		Name="Xuyªt Long ThÕch_BÕo",						Number=5,	Icon="set:CircularTaskTool32 image:CircularTaskTool32_10",	Percent=400		},
	{	Index=20310183,		Name="Xuyªt Long ThÕch_Thß½ng",						Number=5,	Icon="set:CircularTaskTool32 image:CircularTaskTool32_11",	Percent=400		},
	{	Index=38000184,		Name="Chú Vån Huyªt Ng÷c",							Number=5,	Icon="set:CircularTaskTool32 image:CircularTaskTool32_13",	Percent=200		},
	{	Index=20310180,		Name="Tinh Vân Thüy",								Number=1,	Icon="set:CircularTaskTool33 image:CircularTaskTool33_1",	Percent=200		},
	{	Index=10157110,		Name="Long Vån",									Number=1,	Icon="set:CircularTaskTool33 image:CircularTaskTool33_6",	Percent=100		},
	{	Index=30900016, 	Name="Cao c¤p bäo thÕch hþp thành phù",				Number=1,	Icon="set:Cloth3 image:Cloth3_8",							Percent=400		},
	{	Index=50521001,		Name="Hoàng Minh ThÕch(c¤p 5)",						Number=1,	Icon="set:Gemjiankang image:Gemjiankang_2",					Percent=600		},
	{	Index=50521002,		Name="Lam Minh ThÕch (c¤p 5)",						Number=1,	Icon="set:Gemjiankang image:Gemjiankang_14",				Percent=600		},
	{	Index=50521003,		Name="H°ng Minh ThÕch (c¤p 5)",						Number=1,	Icon="set:Gemjiankang image:Gemjiankang_10",				Percent=600		},
	{	Index=50521004,		Name="Løc Minh ThÕch (c¤p 5)",						Number=1,	Icon="set:Gemjiankang image:Gemjiankang_6",					Percent=600		},
	{	Index=50513004,		Name="H°ng Bäo ThÕch (c¤p 5)",						Number=1,	Icon="set:Gem3_2 image:Gem3_2_2",							Percent=600		},
	{	Index=50602005,		Name="Thu¥n t¸nh hoàng tinh thÕch (c¤p 6)",			Number=1,	Icon="set:Gem6_2 image:Gem6_2_5",							Percent=250		},
	{	Index=50602006,		Name="Thu¥n t¸nh lam tinh thÕch (c¤p 6)",			Number=1,	Icon="set:Gem6_2 image:Gem6_2_9",							Percent=250		},
	{	Index=50602007,		Name="Thu¥n t¸nh h°ng tinh thÕch (c¤p 6)",			Number=1,	Icon="set:Gem6_2 image:Gem6_2_13",							Percent=250		},
	{	Index=50602008,		Name="Thu¥n t¸nh løc tinh thÕch (c¤p 6)",			Number=1,	Icon="set:Gem6_2 image:Gem6_2_6",							Percent=250		},
	{	Index=50613004,		Name="H°ng Bäo ThÕch (c¤p 6)",						Number=1,	Icon="set:Gem6_2 image:Gem6_2_2",							Percent=200		},
	{	Index=30008014,		Name="Thông Thiên Linh Ðan",						Number=1,	Icon="set:Cloth3 image:Cloth3_14",							Percent=1000	},
	{	Index=30505107,		Name="Ti¬u LÕt Bá",									Number=5,	Icon="set:Cloth4 image:Cloth4_14",							Percent=1000	},
	{	Index=38000530,		Name="Bí T¸ch Tàn Di®p",							Number=20,	Icon="set:CommonLiveSkill2 image:CommonLiveSkill2_3",		Percent=250		},
	{	Index=38000530,		Name="Bí T¸ch Tàn Di®p",							Number=10,	Icon="set:CommonLiveSkill2 image:CommonLiveSkill2_3",		Percent=500		},
	{	Index=30505076,		Name="ÐÕi Hoàn Ðan",								Number=1,	Icon="set:Medicine4 image:Medicine4_1",						Percent=200		},
	{	Index=30509012,		Name="MÕn Thiên Hoa Vû",							Number=1,	Icon="set:Flower image:Flower_16",							Percent=300		},
	{	Index=30700213,		Name="ºc H°n ThÕch",								Number=20,	Icon="set:Wuhun3 image:Wuhun3_16",							Percent=200		},
	{	Index=30700213,		Name="ºc H°n ThÕch",								Number=10,	Icon="set:Wuhun3 image:Wuhun3_16",							Percent=500		},
	{	Index=20310166,		Name="Kim Tàm Ty",									Number=100,	Icon="set:Tattoo image:Tattoo_1",							Percent=300		},
	{	Index=20310166,		Name="Kim Tàm Ty",									Number=50,	Icon="set:Tattoo image:Tattoo_1",							Percent=600		},
	{	Index=20109101,		Name="Ði¬m Kim Chi Ti­n",							Number=1,	Icon="set:Stiletto1 image:Stiletto1_16",					Percent=450		},
	{	Index=30008018,		Name="Thanh Tâm Ðan",								Number=1,	Icon="set:Cloth8 image:Cloth8_10",							Percent=750		},
	{	Index=30008048,		Name="Kim Cß½ng Töa",								Number=1,	Icon="set:Charm5 image:Charm5_8",							Percent=650		},
	{	Index=30505197,		Name="Thöi Vàng",									Number=10,	Icon="set:MenpaiLiveSkill image:MenpaiLiveSkill_16",		Percent=500		},
	{	Index=30505908,		Name="Th¥n Binh Phù 3",								Number=10,	Icon="set:Shenqi_2 image:Shenqi_2_10",						Percent=100		},
	{	Index=30505908,		Name="Th¥n Binh Phù 3",								Number=5,	Icon="set:Shenqi_2 image:Shenqi_2_10",						Percent=250		},
	{	Index=30503140,		Name="H°ng Di®u ThÕch",								Number=1,	Icon="set:MakeMaterial15 image:MakeMaterial15_15",			Percent=800		},
	{	Index=20501008,		Name="Väi bông c¤p 8",								Number=1,	Icon="set:Ore image:Ore_14",								Percent=300		},
	{	Index=20502008,		Name="Bí Ngân c¤p 8",								Number=1,	Icon="set:Ore image:Ore_13",								Percent=300		},
}
--********************--

--**********************************--
--*            On Update           *--
--**********************************--
function x930038_OnUpdate(sceneId,selfId,Request,Param_1)

	if Request==0 then
		if Param_1==x930038_g_Client_Server then
			x930038_ChooseGift(sceneId,selfId)
		else
			BeginEvent(sceneId)
				AddText(sceneId,"Hành vi phi pháp!")
			EndEvent(sceneId)
			DispatchMissionTips(sceneId,selfId,-1)
		end
	end
	--*********************--
	if Request==1 then
		if Param_1==x930038_g_Client_Server then
			x930038_ChangeItemList(sceneId,selfId)
		else
			BeginEvent(sceneId)
				AddText(sceneId,"Hành vi phi pháp!")
			EndEvent(sceneId)
			DispatchMissionTips(sceneId,selfId,-1)
		end
	end
	--*********************--
	if Request==2 then
		if Param_1==x930038_g_Client_Server then
			x930038_RecieveGift(sceneId,selfId)
		else
			BeginEvent(sceneId)
				AddText(sceneId,"Hành vi phi pháp!")
			EndEvent(sceneId)
			DispatchMissionTips(sceneId,selfId,-1)
		end
	end
	--*********************--
	if Request==3 then
		if Param_1==x930038_g_Client_Server then
			x930038_OpenCircle(sceneId,selfId)
		else
			BeginEvent(sceneId)
				AddText(sceneId,"Hành vi phi pháp!")
			EndEvent(sceneId)
			DispatchMissionTips(sceneId,selfId,-1)
		end
	end
	--*********************--
	
end
--**********************************--
--*         New Item List          *--
--**********************************--
function x930038_NewItemList(sceneId,selfId)

	--*********************--
	--Tính t±ng s¯ item vip
	local Count_Vip,Count_Normal=0,0
	for i,item in x930038_g_Vip do
		Count_Vip=Count_Vip+1
	end
	--Tính t±ng s¯ item bình thß¶ng
	for i,item in x930038_g_Normal do
		Count_Normal=Count_Normal+1
	end
	--Random 2 item vip b¤t kÏ trong List item vip
	local x=random(Count_Vip)
	local y=x
	while x==y do
		y=random(Count_Vip)
	end
	--Random ra 2 v¸ trí b¤t kÏ trong bäng 24 item
	local z=random(24)
	local t=z
	while z==t do
		t=random(24)
	end
	--Xây danh sách mäng g°m 24 item ðßþc ch÷n
	local Plate_List={}
	Plate_List[z]=x
	Plate_List[t]=y
	--Ch÷n danh sách 22 item trong list item bình thß¶ng
	local Select={}
	for i=1,24 do
		if i~=t and i~=z then
			local xx
			repeat
				xx=random(Count_Normal)
			until Select[xx]==nil
			Select[xx]=1
			Plate_List[i]=xx
		end
	end
	--*********************--
	--Mã hóa 2 v§t ph¦m quý vào vòng quay
	local j=tostring(x)
	while strlen(j)<3 do
		j="0"..j
	end
	local jj=tostring(y)
	while strlen(jj)<3 do
		jj="0"..jj
	end
	SetMissionData(sceneId,selfId,MD_LUCKY_VIP,tonumber(j..jj))
	local j=tostring(z)
	while strlen(j)<3 do
		j="0"..j
	end
	local jj=tostring(t)
	while strlen(jj)<3 do
		jj="0"..jj
	end
	SetMissionData(sceneId,selfId,MD_LUCKY_VIP_POS,tonumber(j..jj))
	--Mã hóa các v§t ph¦m trong vòng quay vào 8 biªn MissionData
	local j=""
	for i=1,3 do
		local jj=tostring(Plate_List[i])
		while strlen(jj)<3 do
			jj="0"..jj
		end
		j=j..jj
	end
	SetMissionData(sceneId,selfId,MD_LUCKY_NUM_1,tonumber(j))
	local j=""
	for i=4,6 do
		local jj=tostring(Plate_List[i])
		while strlen(jj)<3 do
			jj="0"..jj
		end
		j=j..jj
	end
	SetMissionData(sceneId,selfId,MD_LUCKY_NUM_2,tonumber(j))
	local j=""
	for i=7,9 do
		local jj=tostring(Plate_List[i])
		while strlen(jj)<3 do
			jj="0"..jj
		end
		j=j..jj
	end
	SetMissionData(sceneId,selfId,MD_LUCKY_NUM_3,tonumber(j))
	local j=""
	for i=10,12 do
		local jj=tostring(Plate_List[i])
		while strlen(jj)<3 do
			jj="0"..jj
		end
		j=j..jj
	end
	SetMissionData(sceneId,selfId,MD_LUCKY_NUM_4,tonumber(j))
	local j=""
	for i=13,15 do
		local jj=tostring(Plate_List[i])
		while strlen(jj)<3 do
			jj="0"..jj
		end
		j=j..jj
	end
	SetMissionData(sceneId,selfId,MD_LUCKY_NUM_5,tonumber(j))
	local j=""
	for i=16,18 do
		local jj=tostring(Plate_List[i])
		while strlen(jj)<3 do
			jj="0"..jj
		end
		j=j..jj
	end
	SetMissionData(sceneId,selfId,MD_LUCKY_NUM_6,tonumber(j))
	local j=""
	for i=19,21 do
		local jj=tostring(Plate_List[i])
		while strlen(jj)<3 do
			jj="0"..jj
		end
		j=j..jj
	end
	SetMissionData(sceneId,selfId,MD_LUCKY_NUM_7,tonumber(j))
	local j=""
	for i=22,24 do
		local jj=tostring(Plate_List[i])
		while strlen(jj)<3 do
			jj="0"..jj
		end
		j=j..jj
	end
	SetMissionData(sceneId,selfId,MD_LUCKY_NUM_8,tonumber(j))
	--*********************--
	
end
--**********************************--
--*     Choose An Random Item      *--
--**********************************--
function x930038_ChooseAnRandomItem(sceneId,selfId)

	--*********************--
	local a={}
	a[1]=tostring(GetMissionData(sceneId,selfId,MD_LUCKY_NUM_1))
	a[2]=tostring(GetMissionData(sceneId,selfId,MD_LUCKY_NUM_2))
	a[3]=tostring(GetMissionData(sceneId,selfId,MD_LUCKY_NUM_3))
	a[4]=tostring(GetMissionData(sceneId,selfId,MD_LUCKY_NUM_4))
	a[5]=tostring(GetMissionData(sceneId,selfId,MD_LUCKY_NUM_5))
	a[6]=tostring(GetMissionData(sceneId,selfId,MD_LUCKY_NUM_6))
	a[7]=tostring(GetMissionData(sceneId,selfId,MD_LUCKY_NUM_7))
	a[8]=tostring(GetMissionData(sceneId,selfId,MD_LUCKY_NUM_8))
	a[9]=tostring(GetMissionData(sceneId,selfId,MD_LUCKY_VIP))
	a[10]=tostring(GetMissionData(sceneId,selfId,MD_LUCKY_VIP_POS))
	for i=1,8 do
		while strlen(a[i])<9 do 
			a[i]="0"..a[i]
		end
	end
	while strlen(a[9])<6 do 
		a[9]="0"..a[9]
	end
	while strlen(a[10])<6 do 
		a[10]="0"..a[10]
	end
	--*********************--
	local x,y=tonumber(strsub(a[9],1,3)),tonumber(strsub(a[9],4,6))
	local z,t=tonumber(strsub(a[10],1,3)),tonumber(strsub(a[10],4,6))
	--*********************--
	local PlateItemPercent={}
	local Item_Index={}
	local j=0
	for i=1,8 do
		local ii,jj,kk=tonumber(strsub(a[i],1,3)),tonumber(strsub(a[i],4,6)),tonumber(strsub(a[i],7,9))
		j=j+1
		if j~=z and z~=t then
			Item_Index[j]=ii
			PlateItemPercent[j]=x930038_g_Normal[ii].Percent
		end
		j=j+1
		if j~=z and z~=t then
			Item_Index[j]=jj
			PlateItemPercent[j]=x930038_g_Normal[jj].Percent
		end
		j=j+1
		if j~=z and z~=t then
			Item_Index[j]=kk
			PlateItemPercent[j]=x930038_g_Normal[kk].Percent
		end
	end
	--*********************--
	local NUM,item,number
	--Random ch÷n ra có ðßþc nh§n Item vip không
	local xx=random(1000)
	local yy=random(1000)
	if xx==yy then
		local u=random(2)
		if u==1 then
			NUM=z
			item=x930038_g_Vip[x].Index
			number=x930038_g_Vip[y].Number
		else
			NUM=t
			item=x930038_g_Vip[y].Index
			number=x930038_g_Vip[y].Number
		end
		SetMissionData(sceneId,selfId,MD_LUCKY_GIFT,item)
		SetMissionData(sceneId,selfId,MD_LUCKY_GIFT_NUMBER,number)
		return NUM
	end
	--Ch÷n item ph¥n tråm cao nh¤t trong ðám item thß¶ng
	x=1
	y=0
	for i=1,24 do
		if i~=t and i~=z and x<PlateItemPercent[i] then
			y=i
			x=PlateItemPercent[i]
		end
	end
	--Ch¡c ch¡n ðã có mµt item ðßþc ch÷n v¾i tÖ l® cao nh¤t
	NUM=y
	local Choosen={}
	local c=0
	--Random trong các item thß¶ng
	for i=1,24 do
		if i~=t and i~=z then
			local u=PlateItemPercent[i]
			local v=random(1000)
			if v<=u then
				c=c+1
				Choosen[c]=i
			end
		end
	end
	--Ch÷n item ngçu nhiên trong list ðã li®t kê
	NUM=Choosen[random(c)]
	item=x930038_g_Normal[Item_Index[NUM]].Index
	--*********************--
	SetMissionData(sceneId,selfId,MD_LUCKY_GIFT,item)
	SetMissionData(sceneId,selfId,MD_LUCKY_GIFT_NUMBER,x930038_g_Normal[Item_Index[NUM]].Number)
	--*********************--
	return NUM
	--*********************--
	
end
--**********************************--
--*          Choose Gift           *--
--**********************************--
function x930038_ChooseGift(sceneId,selfId)

	--*********************--
	if GetMissionData(sceneId,selfId,MD_LUCKY_GIFT)~=0 then
		BeginEvent(sceneId)
			AddText(sceneId,"Các hÕ có ph¥n thß·ng chßa nh§n!")
		EndEvent(sceneId)
		DispatchMissionTips(sceneId,selfId,-1)
		return
	end
	--*********************--
	if LuaFnDelAvailableItem(sceneId,selfId,x930038_g_XingYunZiZhen,1)<1 then
		BeginEvent(sceneId)
			AddText(sceneId,"Các hÕ không có HÕnh V§n TØ Châm!")
		EndEvent(sceneId)
		DispatchMissionTips(sceneId,selfId,-1)
		return
	end
	--*********************--
	local Pos=x930038_ChooseAnRandomItem(sceneId,selfId)
	--*********************--
	BeginUICommand(sceneId)
		UICommand_AddInt(sceneId,Pos)
	EndUICommand(sceneId)
	DispatchUICommand(sceneId,selfId,2012816)
	--*********************--
	
end
--**********************************--
--*        Change Item List        *--
--**********************************--
function x930038_ChangeItemList(sceneId,selfId)

	--*********************--
	if GetMissionData(sceneId,selfId,MD_LUCKY_GIFT)~=0 then
		BeginEvent(sceneId)
			AddText(sceneId,"Các hÕ có ph¥n thß·ng chßa nh§n!")
		EndEvent(sceneId)
		DispatchMissionTips(sceneId,selfId,-1)
		return
	end
	--*********************--
	if LuaFnDelAvailableItem(sceneId,selfId,x930038_g_XingYunGuo,1)<1 then
		BeginEvent(sceneId)
			AddText(sceneId,"Các hÕ không có HÕnh V§n Quä!")
		EndEvent(sceneId)
		DispatchMissionTips(sceneId,selfId,-1)
		return
	end
	--*********************--
	x930038_NewItemList(sceneId,selfId)
	--*********************--
	BeginEvent(sceneId)
		AddText(sceneId,"Làm m¾i v§t ph¦m thành công!")
	EndEvent(sceneId)
	DispatchMissionTips(sceneId,selfId,-1)
	--*********************--
	BeginUICommand(sceneId)
		UICommand_AddInt(sceneId,GetMissionData(sceneId,selfId,MD_LUCKY_NUM_1))
		UICommand_AddInt(sceneId,GetMissionData(sceneId,selfId,MD_LUCKY_NUM_2))
		UICommand_AddInt(sceneId,GetMissionData(sceneId,selfId,MD_LUCKY_NUM_3))
		UICommand_AddInt(sceneId,GetMissionData(sceneId,selfId,MD_LUCKY_NUM_4))
		UICommand_AddInt(sceneId,GetMissionData(sceneId,selfId,MD_LUCKY_NUM_5))
		UICommand_AddInt(sceneId,GetMissionData(sceneId,selfId,MD_LUCKY_NUM_6))
		UICommand_AddInt(sceneId,GetMissionData(sceneId,selfId,MD_LUCKY_NUM_7))
		UICommand_AddInt(sceneId,GetMissionData(sceneId,selfId,MD_LUCKY_NUM_8))
		UICommand_AddInt(sceneId,GetMissionData(sceneId,selfId,MD_LUCKY_VIP))
		UICommand_AddInt(sceneId,GetMissionData(sceneId,selfId,MD_LUCKY_VIP_POS))
	EndUICommand(sceneId)
	DispatchUICommand(sceneId,selfId,20120817)
	--*********************--
	
end
--**********************************--
--*          Open Circle           *--
--**********************************--
function x930038_OpenCircle(sceneId,selfId)

	--*********************--
	SetMissionData(sceneId,selfId,MD_LUCKY_GIFT,0)
	--*********************--
	if LuaFnDelAvailableItem(sceneId,selfId,x930038_g_XingYunGuo,1)<1 then
		BeginEvent(sceneId)
			AddText(sceneId,"Các hÕ không có HÕnh V§n Quä!")
		EndEvent(sceneId)
		DispatchMissionTips(sceneId,selfId,-1)
		return
	end
	--*********************--
	x930038_NewItemList(sceneId,selfId)
	--*********************--

	BeginUICommand(sceneId)
		UICommand_AddInt(sceneId,GetMissionData(sceneId,selfId,MD_LUCKY_NUM_1))
		UICommand_AddInt(sceneId,GetMissionData(sceneId,selfId,MD_LUCKY_NUM_2))
		UICommand_AddInt(sceneId,GetMissionData(sceneId,selfId,MD_LUCKY_NUM_3))
		UICommand_AddInt(sceneId,GetMissionData(sceneId,selfId,MD_LUCKY_NUM_4))
		UICommand_AddInt(sceneId,GetMissionData(sceneId,selfId,MD_LUCKY_NUM_5))
		UICommand_AddInt(sceneId,GetMissionData(sceneId,selfId,MD_LUCKY_NUM_6))
		UICommand_AddInt(sceneId,GetMissionData(sceneId,selfId,MD_LUCKY_NUM_7))
		UICommand_AddInt(sceneId,GetMissionData(sceneId,selfId,MD_LUCKY_NUM_8))
		UICommand_AddInt(sceneId,GetMissionData(sceneId,selfId,MD_LUCKY_VIP))
		UICommand_AddInt(sceneId,GetMissionData(sceneId,selfId,MD_LUCKY_VIP_POS))
	EndUICommand(sceneId)
	DispatchUICommand(sceneId,selfId,20120817)
	--*********************--
	
end
--**********************************--
--*          Recieve Gift          *--
--**********************************--
function x930038_RecieveGift(sceneId,selfId)

	--*********************--
	local Item_ID=GetMissionData(sceneId,selfId,MD_LUCKY_GIFT)
	local Item_Number=GetMissionData(sceneId,selfId,MD_LUCKY_GIFT_NUMBER)
	--*********************--
	if GetMissionData(sceneId,selfId,MD_LUCKY_GIFT)==0 then
		BeginEvent(sceneId)
			AddText(sceneId,"Các hÕ không có ph¥n thß·ng có th¬ nh§n!")
		EndEvent(sceneId)
		DispatchMissionTips(sceneId,selfId,-1)
		return
	elseif LuaFnGetMaterialBagSpace(sceneId,selfId)<1 or LuaFnGetPropertyBagSpace(sceneId,selfId)<1 then
		BeginEvent(sceneId)
			AddText(sceneId,"Hãy s¡p xªp lÕi mµt khoäng tr¯ng trong ô nguyên li®u và ðÕo cø!")
		EndEvent(sceneId)
		DispatchMissionTips(sceneId,selfId,-1)
		return
	end
	--*********************--
	local Item_Pos=TryRecieveItem(sceneId,selfId,Item_ID,1)
	for i=1,Item_Number-1 do
		TryRecieveItem(sceneId,selfId,Item_ID,1)
	end
	--*********************--
	for i,item in x930038_g_Vip_Item_Global do
		if item==Item_ID then
			local Item_Infor=GetBagItemTransfer(sceneId,selfId,Item_Pos)
			local Player_Name=GetName(sceneId,selfId)
			local str=format("#cff99ccTrong sñ ki®n #GVòng Quay May M¡n#cff99cc, #G#{_INFOUSR%s}#cff99cc ðã tham gia và may m¡n nh§n ðßþc #G#{_INFOMSG%s}#cff99cc, m÷i ngß¶i cùng chúc m×ng b¢ng hæu ¤y nào!",Player_Name,Item_Infor)
			AddGlobalCountNews(sceneId,str)
			break
		end
	end
	--*********************--
	BeginEvent(sceneId)
		AddText(sceneId,"Các hÕ nh§n ðßþc "..Item_Number.." cái "..GetItemName(sceneId,Item_ID).."!")
	EndEvent(sceneId)
	DispatchMissionTips(sceneId,selfId,-1)
	--*********************--
	SetMissionData(sceneId,selfId,MD_LUCKY_GIFT,0)
	--*********************--
	
end