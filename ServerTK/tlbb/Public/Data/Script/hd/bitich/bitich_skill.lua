--½Å±¾ºÅ
x000581_g_scriptId = 000581

x000581_g_ImpactList = {}	
x000581_g_ImpactList[31705]={mijiId = 1914, objId = 2, afterId = 1852, OutImpact = {31706,31707,31708,31709,31710,31711,31712,31713,31714,31715,31716}}
x000581_g_ImpactList[31717]={mijiId = 1914, objId = 2, afterId = 1853, OutImpact = {31718,31719,31720,31721,31722,31723,31724,31725,31726,31727,31728}}
x000581_g_ImpactList[31740]={mijiId = 1914, objId = 1, afterId = -1, OutImpact = {31741,31742,31743,31744,31745,31746,31747,31748,31749,31750,31751}}

x000581_g_ImpactList[31752]={mijiId = 1915, objId = 2, afterId = 1855, OutImpact = {31753,31754,31755,31756,31757,31758,31759,31760,31761,31762,31763}}
x000581_g_ImpactList[31764]={mijiId = 1915, objId = 2, afterId = 1856, OutImpact = {31765,31766,31767,31768,31769,31770,31771,31772,31773,31774,31775}}
x000581_g_ImpactList[31787]={mijiId = 1915, objId = 1, afterId = -1, OutImpact = {31788,31789,31790,31791,31792,31793,31794,31795,31796,31797,31798}}

x000581_g_ImpactList[31799]={mijiId = 1916, objId = 2, afterId = 1858, OutImpact = {31800,31801,31802,31803,31804,31805,31806,31807,31808,31809,31810}}
x000581_g_ImpactList[31811]={mijiId = 1916, objId = 2, afterId = 1859, OutImpact = {31812,31813,31814,31815,31816,31817,31818,31819,31820,31821,31822}}
x000581_g_ImpactList[31834]={mijiId = 1916, objId = 1, afterId = -1, OutImpact = {31835,31836,31837,31838,31839,31840,31841,31842,31843,31844,31845}}

x000581_g_ImpactList[31846]={mijiId = 1917, objId = 2, afterId = 1861, OutImpact = {31847,31848,31849,31850,31851,31852,31853,31854,31855,31856,31857}}
x000581_g_ImpactList[31858]={mijiId = 1917, objId = 2, afterId = 1862, OutImpact = {31859,31860,31861,31862,31863,31864,31865,31866,31867,31868,31869}}
x000581_g_ImpactList[31881]={mijiId = 1917, objId = 1, afterId = -1, OutImpact = {31882,31883,31884,31885,31886,31887,31888,31889,31890,31891,31892}}

x000581_g_ImpactList[31893]={mijiId = 1918, objId = 2, afterId = 1864, OutImpact = {31894,31895,31896,31897,31898,31899,31900,31901,31902,31903,31904}}
x000581_g_ImpactList[31905]={mijiId = 1918, objId = 2, afterId = 1865, OutImpact = {31906,31907,31908,31909,31910,31911,31912,31913,31914,31915,31916}}
x000581_g_ImpactList[31928]={mijiId = 1918, objId = 1, afterId = -1, OutImpact = {31929,31930,31931,31932,31933,31934,31935,31936,31937,31938,31939}}
-------------------------------------------------
x000581_g_ImpactList[26163]={mijiId = 1919, objId = 2, afterId = 1867, OutImpact = {26178,26179,26180,26181,26182,26183,26184,26185,26186,26187,26188},OutImpact2 = {}}
x000581_g_ImpactList[26164]={mijiId = 1919, objId = 3, afterId = 1868, OutImpact = {26288,26289,26290,26291,26292,26293,26294,26295,26296,26297,26298,},OutImpact2 = {26343,26344,26345,26346,26347,26348,26349,26350,26351,26352,26353}}
x000581_g_ImpactList[26165]={mijiId = 1919, objId = 4, afterId = -1, OutImpact = {26398,26399,26400,26401,26402,26403,26404,26405,26406,26407,26408}, OutImpact2 = {26409,26410,26411,26412,26413,26414,26415,26416,26417,26418,26419}}

x000581_g_ImpactList[26166]={mijiId = 1920, objId = 2, afterId = 1870, OutImpact = {26189,26190,26191,26192,26193,26194,26195,26196,26197,26198,26199}, OutImpact2 = {}}
x000581_g_ImpactList[26167]={mijiId = 1920, objId = 3, afterId = 1871, OutImpact = {26299,26300,26301,26302,26303,26304,26305,26306,26307,26308,26309},OutImpact2 = {26354,26355,26356,26357,26358,26359,26360,26361,26362,26363,26364}}
x000581_g_ImpactList[26168]={mijiId = 1920, objId = 4, afterId = -1, OutImpact = {26398,26399,26400,26401,26402,26403,26404,26405,26406,26407,26408},OutImpact2 = {26420,26421,26422,26423,26424,26425,26426,26427,26428,26429,26430}}

x000581_g_ImpactList[26169]={mijiId = 1921, objId = 2, afterId = 1873, OutImpact = {26200,26201,26202,26203,26204,26205,26206,26207,26208,26209,26210},OutImpact2 = {}}
x000581_g_ImpactList[26170]={mijiId = 1921, objId = 3, afterId = 1874, OutImpact = {26310,26311,26312,26313,26314,26315,26316,26317,26318,26319,26320},OutImpact2 = {26365,26366,26367,26368,26369,26370,26371,26372,26373,26374,26375}}
x000581_g_ImpactList[26171]={mijiId = 1921, objId = 4, afterId = -1, OutImpact = {26398,26399,26400,26401,26402,26403,26404,26405,26406,26407,26408},OutImpact2 = {26431,26432,26433,26434,26435,26436,26437,26438,26439,26440,26441}}

x000581_g_ImpactList[26172]={mijiId = 1922, objId = 2, afterId = 1876, OutImpact = {26211,26212,26213,26214,26215,26216,26217,26218,26219,26220,26221},OutImpact2 = {}}
x000581_g_ImpactList[26173]={mijiId = 1922, objId = 3, afterId = 1877, OutImpact = {26321,26322,26323,26324,26325,26326,26327,26328,26329,26330,26331},OutImpact2 = {26376,26377,26378,26379,26380,26381,26382,26383,26384,26385,26386}}
x000581_g_ImpactList[26174]={mijiId = 1922, objId = 4, afterId = -1, OutImpact = {26398,26399,26400,26401,26402,26403,26404,26405,26406,26407,26408},OutImpact2 = {26442,26443,26444,26445,26446,26447,26448,26449,26450,26451,26452}}

x000581_g_ImpactList[26175]={mijiId = 1923, objId = 2, afterId = 1879, OutImpact = {26222,26223,26224,26225,26226,26227,26228,26229,26230,26231,26232},OutImpact2 = {}}
x000581_g_ImpactList[26176]={mijiId = 1923, objId = 3, afterId = 1880, OutImpact = {26332,26333,26334,26335,26336,26337,26338,26339,26340,26341,26342},OutImpact2 = {26387,26388,26389,26390,26391,26392,26393,26394,26395,26396,26397}}
x000581_g_ImpactList[26177]={mijiId = 1923, objId = 4, afterId = -1, OutImpact = {26398,26399,26400,26401,26402,26403,26404,26405,26406,26407,26408},OutImpact2 = {26453,26454,26455,26456,26457,26458,26459,26460,26461,26462,26463}}

x000581_g_TuviTable={3743,17701,55410,132931,267952,319509,427774,533938,669321,728279,868279}
x000581_g_TuluyenTable1={0,61,64,68,74,81,90,100,111,124,138,153,170,188,207,228,249,272,296,322,348,376,405,435,467,499,533,568,604,641,680,719,760,802,845,889,934,981,1028,1077,1127,1178,1230,1283,1337,1393,1449,1507,1566,1625,1686,1748,1811,1876,1941,2007,2075,2143,2213,2283,2355,2428,2502,2577,2653,2730,2808,2887,2967,3049,3131,3215,3299,3385,3471,3559,3648,3737,3828,3920,4013,4107,4202,4297,4394,4493,4592,4692,4793,4895,4998,5102,5208,5314,5421,5529,5639,5749,5860,0}
x000581_g_TuluyenTable2={0,101,105,112,121,134,151,171,196,223,255,291,331,376,424,477,534,596,662,732,807,887,971,1060,1154,1253,1356,1464,1577,1695,1818,1946,2079,2217,2360,2508,2661,2819,2983,3151,3325,3505,3689,3879,4074,4274,4480,4691,4908,5130,5358,5591,5829,6073,6323,6578,6839,7105,7377,7654,7938,8226,8521,8821,9127,9439,9757,10080,10409,10744,11085,11431,11784,12142,12506,12876,13252,13634,14022,14416,14816,15222,15633,16051,16475,16905,17341,17783,18231,18686,19146,19612,20085,20564,21049,21540,22037,22541,23051,0}
x000581_g_TuluyenTable3={0,121,126,134,147,165,189,219,256,299,350,407,473,546,627,717,815,922,1038,1162,1297,1440,1593,1756,1929,2112,2305,2508,2722,2947,3183,3429,3686,3955,4235,4526,4829,5143,5470,5808,6158,6520,6895,7282,7681,8093,8517,8954,9404,9867,10343,10832,11335,11850,12379,12922,13478,14048,14631,15229,15840,16465,17105,17758,18426,19108,19805,20516,21242,21982,22737,23507,24292,25092,25907,26737,27582,28442,29318,30209,31116,32038,32975,33929,34898,35883,36884,37901,38934,39983,41048,42129,43227,44341,45471,46618,47781,48961,50158,0}
function x000581_OnImpactFadeOut( sceneId, selfId, impactId )
	--x000581_Tips(sceneId, selfId, "1213")
	if GetHp( sceneId, selfId ) == 0 then
		return
	end
	local targetId = LuaFnGetTargetObjID(sceneId, selfId)
	if selfId == targetId then return end
	--x000581_Tips(sceneId, targetId, "1111")
	local ImpactIDx = x000581_g_ImpactList[impactId]
	--local TAMDAC = GetMissionData(sceneId,selfId,MD_MJ_TAMDAC) 
	local BookLevel = GetMissionData(sceneId,selfId,MD_MJ_BOOKLV)	--xx--yy--zz
	local BookVT = GetMissionData(sceneId,selfId,MD_MJ_BOOKVT)	--xxx-yyy-zzz
	local BookVTBT = {1000+floor(BookVT/1000000),1000-floor(BookVT/1000000)*1000+floor(BookVT/1000),1000+mod(BookVT,1000)}
	--x000581_Tips(sceneId, selfId, " "..BookVTBT[1])
	local Active = 0
	local BookLV = {}
	BookLV[1] = floor(BookLevel/10000)
	BookLV[2] = floor(BookLevel/100)-BookLV[1]*100
	BookLV[3] = mod(BookLevel,100)
	local SumBook1,SumBook2, SumBook3 = 0,0,0
	local TuviLevel = 0
	for i=1,BookLV[1] do
		SumBook1 = SumBook1+x000581_g_TuluyenTable1[i]
	end
	for i=1,BookLV[2] do
		SumBook2 = SumBook2+x000581_g_TuluyenTable2[i]
	end
	for i=1,BookLV[3] do
		SumBook3 = SumBook3+x000581_g_TuluyenTable3[i]
	end
	local SumBook = SumBook1+SumBook2+SumBook3
	for i=1,11 do
		if i==11 then -- Nªu TH so sánh ðªn lv cu¯i mà ko < thì là lv cu¯i
			TuviLevel = 11
			break
		end
		local tem = 0
		for j=1,i do
			tem = tem+x000581_g_TuviTable[j]
		end
		if SumBook < tem then	-- Nªu g£p Th < thì là lv i
			TuviLevel = i
			break
		end
	end
	if TuviLevel == 0 then TuviLevel = 1 end
	if ImpactIDx.objId == 1 then
		LuaFnSendSpecificImpactToUnit( sceneId, selfId, selfId, selfId, ImpactIDx.OutImpact[TuviLevel], 0 )
	elseif ImpactIDx.objId == 2 then 
		LuaFnSendSpecificImpactToUnit( sceneId, selfId, selfId, targetId, ImpactIDx.OutImpact[TuviLevel], 0 )
	elseif ImpactIDx.objId == 3 then 
		LuaFnSendSpecificImpactToUnit( sceneId, selfId, selfId, selfId, ImpactIDx.OutImpact2[TuviLevel], 0 )
		LuaFnSendSpecificImpactToUnit( sceneId, selfId, selfId, targetId, ImpactIDx.OutImpact[TuviLevel], 0 )
	elseif ImpactIDx.objId == 4 then 
		LuaFnSendSpecificImpactToUnit( sceneId, selfId, selfId, targetId, ImpactIDx.OutImpact2[TuviLevel], 0 )
		LuaFnSendSpecificImpactToUnit( sceneId, selfId, selfId, targetId, ImpactIDx.OutImpact[TuviLevel], 0 )
	end
	if ImpactIDx.afterId == -1 then
		return
	end
	for i=1,3 do
		if ImpactIDx.mijiId == BookVTBT[i] then	-- xác ð¸nh xem n¢m · quy¬n bt thÑ m¤y
			Active = BookLV[i]			-- gán tÖ l® kích hoÕt
			break
		end
	end
--x000581_Tips(sceneId, selfId, " "..BookVT)
--x000581_Tips(sceneId, selfId, " "..Active)
	if random(100) <= Active then
		--if HaveSkill(sceneId)
		BeginUICommand( sceneId )
			UICommand_AddInt( sceneId, ImpactIDx.afterId )
		EndUICommand( sceneId )
		DispatchUICommand( sceneId, selfId, 4000002 )
	end
end

function x000581_Tips(sceneId, selfId, msg)
	BeginEvent( sceneId )
		AddText( sceneId, msg)
	EndEvent( sceneId )
	DispatchMissionTips( sceneId, selfId )
end