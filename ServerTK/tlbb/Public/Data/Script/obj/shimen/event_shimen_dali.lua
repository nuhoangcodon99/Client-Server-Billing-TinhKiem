 -- ¶√≈»ŒŒÒ

--MisDescBegin
--Ω≈±æ∫≈
x229004_g_ScriptId = 229004

--Ω” ‹»ŒŒÒNPC Ù–‘
x229004_g_Position_X=95.9574
x229004_g_Position_Z=88.6181
x229004_g_SceneID=13
x229004_g_AccomplishNPC_Name="B‰n Ph‡m "

--«∞Ã·»ŒŒÒ
--g_MissionIdPre =

--»ŒŒÒƒø±Ínpc
x229004_g_Name	= "B‰n Ph‡m "

--»ŒŒÒ∫≈
x229004_g_MissionId = 1080

--»ŒŒÒπÈ¿‡
x229004_g_MissionKind = 24

--»ŒŒÒµ»º∂
x229004_g_MissionLevel = 10000

-- «∑Ò «æ´”¢»ŒŒÒ
x229004_g_IfMissionElite = 0

--œ¬√Êº∏œÓ «∂ØÃ¨œ‘ æµƒƒ⁄»›£¨”√”⁄‘⁄»ŒŒÒ¡–±Ì÷–∂ØÃ¨œ‘ æ»ŒŒÒ«Èøˆ**********************
--»ŒŒÒ «∑Ò“—æ≠ÕÍ≥…
x229004_g_IsMissionOkFail = 0		--±‰¡øµƒµ⁄0Œª

--“‘…œ «∂ØÃ¨**************************************************************

--»ŒŒÒ±‰¡øµ⁄“ªŒª”√¿¥¥Ê¥¢ÀÊª˙µ√µΩµƒΩ≈±æ∫≈

--»ŒŒÒŒƒ±æ√Ë ˆ
x229004_g_MissionName="NhiÆm v¯ sﬂ mÙn"
x229004_g_MissionInfo=""  --»ŒŒÒ√Ë ˆ
x229004_g_MissionTarget = "%f"
x229004_g_ContinueInfo="L‡m tØt l°m"		--Œ¥ÕÍ≥…»ŒŒÒµƒnpc∂‘ª∞
x229004_g_MissionComplete="ViÆc ta giao „ ho‡n th‡nh chﬂa?"					--ÕÍ≥…»ŒŒÒnpcÀµª∞µƒª∞
x229004_g_MissionRound=17

x229004_g_DoubleExp = 48
x229004_g_AccomplishCircumstance = 1

x229004_g_ShimenTypeIndex = 1
x229004_g_Parameter_Kill_AllRandom={{id=7,numa=3,numb=3,bytenuma=0,bytenumb=1}}
x229004_g_Parameter_Item_IDRandom={{id=6,num=5}}
x229004_g_NpcIdIndicator={{key=2,npcIdIndex=5},{key=9,npcIdIndex=7}}

--”√¿¥±£¥Ê◊÷∑˚¥Æ∏Ò ΩªØµƒ ˝æ›
x229004_g_FormatList = {
								"L‚u l°m khÙng g£p %n r∞i, nhæ qu· i. –‚y l‡ %s, ch˙t lÚng th‡nh c¸a ta, xin ngﬂΩi h„y giao gi˙p ta. #R #e00f000Nh°c nhˆ: #e000000#r NgﬂΩi cÛ th¨ ™n ThiÍn Long TÒ tÏm #RPh· S‚n #W#{_INFOAIM99,120,13, v}, h„y nh∂ Ùng ta ﬂa ngﬂΩi tæi c·c th‡nh th∏ læn.",
								"%i c¸a ta sao khÙng th§y ‚u? N™u ngﬂΩi cÛ th¨ gi˙p ta tÏm l’i, ta s® khÙng b’c „i ngﬂΩi. #R #e00f000Nh°c nhˆ: #e000000#r NgﬂΩi cÛ th¨ ™n ThiÍn Long TÒ tÏm #RPh· S‚n #W#{_INFOAIM99,120,13, Ph· S‚n}, h„y nh∂ Ùng ta ﬂa ngﬂΩi tæi c·c th‡nh th∏ læn.",
								"%n l‡m i´u ·c, ta ph‰i i d’y b‰o, ·ng ti™c khÙng cÛ th∂i gian, ngﬂΩi cÛ th¨ l‡m thay ﬂ˛c khÙng? #R #e00f000Nh°c nhˆ: #e000000#r NgﬂΩi cÛ th¨ ™n ThiÍn Long TÒ tÏm #RPh· S‚n #W#{_INFOAIM99,120,13, Ph· S‚n}, h„y nh∂ Ùng ta ﬂa ngﬂΩi tæi c·c th‡nh th∏ læn.",
								"Xin ngﬂΩi h„y ∑ %s, ThiÍn Long TÒ tÏm th§y %s, ∑ g•n Û sÿ d¯ng %s ¨ thÿ luyÆn nÂng lÒc c¸a ngﬂΩi. #R #e00f000Nh°c nhˆ: #e000000#r khi ngﬂΩi tæi g•n ch≤ –∞ng Nh‚n yÍu c•u thÿ luyÆn, §n #gfff0f0Alt+A#g000000cÛ th¨ m∑ m¯c vßt ph¶m, §n v‡o #gfff0f0\" nhiÆm v¯\"#g000000giao diÆn cÛ th¨ m∑ ra m¯c vßt ph¶m nhiÆm v¯, nh§p phÌm ph‰i#gfff0f0kim v‡ng d˘ng trong y h˜c#g000000, l‡ cÛ th¨ ho‡n th‡nh thÿ luyÆn.",
								"Xin ngﬂΩi h„y i tÏm %s, Ùng ta s® ﬂa ngﬂΩi i thÿ chi™n %s . #R #e00f000Nh°c nhˆ: #e000000#r B±n Tﬂæng ’i sﬂ ∑ ThiÍn Long TÒ #{_INFOAIM35,86,13, B±n Tﬂæng}. ",
								"Xin ngﬂΩi h„y b°t cho ta mµt con %p v´. #R #e00f000Nh°c nhˆ: #e000000#r V‚n H‡m Nhi ∑ th‡nh L’c DﬂΩng #{_INFOAIM183,155,0, V‚n H‡m Nhi} cÛ th¨ ﬂa ngﬂΩi tæi Huy´n V˚ –‰o, nhﬂng Huy´n V˚ –‰o cÛ 1 con ﬂ∂ng mÚn thÙng qua Th·nh Th˙ SΩn. NgﬂΩi cÛ th¨ b°t tr‚n th˙ m‡ ta c•n ∑ Huy´n V˚ –‰o ho£c ∑ Th·nh Th˙ SΩn.",
								"Xin ngﬂΩi h„y ∑ ThiÍn Long TÒ ki¨m tra bØn phÌa, tÏm cho ta 5 %s.#r #e00f000Nh°c nhˆ: #e000000#r NgﬂΩi cÛ th¨ tÏm th§y n˙t v‡ng trong b‰n ∞ nhˆ ∑ gÛc ph‰i m‡n hÏnh.",
								"H„y ﬂa %s tæi 1 c·i %i, l‡m xong, ta s® hßu thﬂ∑ng cho ngﬂΩi! #R #e00f000Nh°c nhˆ: #e000000#r Ng˚ Trung –’i Nh‚n ∑ ThiÍn Long TÒ #{_INFOAIM94,126,13, Ng˚ Trung}. #R L‚m QuØc Thanh –’i Nh‚n ∑ ThiÍn Long TÒ #{_INFOAIM96,126,13, L‚m QuØc Thanh}. #R T´ Qui –iÆp phu nh‚n ∑ ThiÍn Long TÒ #{_INFOAIM154,115,13, T´ Qui –iÆp}. ",
								"–i gi™t ch™t %s %s %n.",
							}

--∏Ò Ω◊÷∑˚¥Æ÷–µƒÀ˜“˝, ±Ì æ¥”4ø™ º,∫Û∂‡…ŸŒª ”SetMissionByIndex(...)µƒ∂‡…Ÿ∂¯∂®
x229004_g_StrForePart=4

x229004_g_StrList = {
						"Y d¯ng kim ch‚m ",
						"khu ∞ng nh‚n kinh m’ch",
						"khu ∞ng nh‚n kinh m’ch",
						"khu ∞ng nh‚n kinh m’ch",
						"khu ∞ng nh‚n kinh m’ch",
						"B‰n Tﬂæng",
						"Th·p ™ ph¯ b‰n",
						"M„n nguyÆt",
						"Nh„n nhi m∏",
						"H∞ng trang tØ kho‰",
						"Ng˚ Trung",
						"L‚m QuØc Thanh",
						"T◊ Qui –iÆp",
						"S‡i MiÍu D„ Sinh",
						"Th¸ Th·i ¬m Ph™ Kinh –∞ng Nh‚n",
						"Ngﬂ∂i ∞ng th¸ dﬂΩng minh ’i trﬂ∂ng kinh",
						"T˙c DﬂΩng Minh V∏ Kinh –∞ng Nh‚n",
						"T˙c Th·i ¬m TÏ Kinh –∞ng Nh‚n",
						"0",
						"1",
						"2",
						"3",
						"4",
						"5",
						"6",
						"7",
						"8",
						"9",
						}
--MisDescEnd
            

--/////////////////////////////////////////////////////////////////////////////////////////////////////

--◊”»ŒŒÒµƒ¿‡–Õ¥˙∫≈∂®“Â
x229004_g_SubMissionTypeEnum = {XunWu=1, SongXin=2, DingDianYinDao=3, FuBenZhanDou=4, BuZhuo=5, ShouJi=6, KaiGuang=7, otherMenpaiFuben=8, killMonster=9,}

--∂®µ„“˝µº
x229004_g_DingDianYinDaoList = {
											 {menpai=MP_DALI     , itemId=40003024, itemName="Y d¯ng kim ch‚m ", scene=13, AreaName="khu ∞ng nh‚n kinh m’ch", subAreaName="Th¸ Th·i ¬m Ph™ Kinh –∞ng Nh‚n", posx1=54, posz1=87, posx2=75, posz2=99},
											 {menpai=MP_DALI     , itemId=40003024, itemName="Y d¯ng kim ch‚m ", scene=13, AreaName="khu ∞ng nh‚n kinh m’ch", subAreaName="Ngﬂ∂i ∞ng th¸ dﬂΩng minh ’i trﬂ∂ng kinh", posx1=81, posz1=82, posx2=90, posz2=88},
											 {menpai=MP_DALI     , itemId=40003024, itemName="Y d¯ng kim ch‚m ", scene=13, AreaName="khu ∞ng nh‚n kinh m’ch", subAreaName="T˙c DﬂΩng Minh V∏ Kinh –∞ng Nh‚n", posx1=101, posz1=81, posx2=110, posz2=88},
											 {menpai=MP_DALI     , itemId=40003024, itemName="Y d¯ng kim ch‚m ", scene=13, AreaName="khu ∞ng nh‚n kinh m’ch", subAreaName="T˙c Th·i ¬m TÏ Kinh –∞ng Nh‚n", posx1=120, posz1=85, posx2=140, posz2=100},
											}



--∏±±æ¡–±Ì
x229004_g_FuBen_List = {
								{menpai=MP_DALI     , NpcName="B‰n Tﬂæng", scene=13, posx=35, posz=86, FubenName="Th·p ™ ph¯ b‰n"},
								}       

-- ’ºØ
x229004_g_ShouJiList = {
								{menpai=MP_DALI     , scene=13, itemId=40003000, itemName="M„n nguyÆt"},-- count=5},
								{menpai=MP_DALI     , scene=13, itemId=40003001, itemName="Nh„n nhi m∏"},-- count=5},
								{menpai=MP_DALI     , scene=13, itemId=40003002, itemName="H∞ng trang tØ kho‰"},-- count=5},
							}	



--ÀÕ…˙ªÓººƒ‹npc¡–±Ì
x229004_g_AbilityNpcList = {
                    {menpai=MP_DALI     ,npcList={{name="Ng˚ Trung", scene=13, x=94, z=126},
                                                  {name="L‚m QuØc Thanh", scene=13, x=96, z=126},
                                                  {name="T◊ Qui –iÆp", scene=13, x=154, z=115}}
										},
									}

										
--≤∂≥Ë¡–±Ì
x229004_g_PetList = {
						{petDataId=3000, petName="S‡i MiÍu D„ Sinh", takeLevel=10},
												}

x229004_g_Xin_ItemId = 40002121
x229004_g_ShimenPet_Index = 1


--…±π÷œ‡πÿ
x229004_g_MenpaiYiWuList = {
								{menpainame="Thi™u L‚m", menpai=MP_SHAOLIN  , itemName="–µ iÆp c¸a Thi™u L‚m Æ tÿ", scene=9,  itemId=40004306},
								{menpainame="ThiÍn Long", menpai=MP_DALI     , itemName="Ñn chﬂΩng c¸a ThiÍn Long Æ tÿ", scene=13, itemId=40004312},
								{menpainame="Nga My", menpai=MP_EMEI     , itemName="Ki™m tuÆ c¸a Nga My Æ tÿ", scene=15, itemId=40004310},
								{menpainame="C·i Bang", menpai=MP_GAIBANG  , itemName="T˙i v‰i c¸a C·i Bang Æ tÿ", scene=10, itemId=40004307},
								{menpainame="Minh Gi·o", menpai=MP_MINGJIAO , itemName="Hˆa lÆnh c¸a Minh Gi·o Æ tÿ", scene=11, itemId=40004308},
								{menpainame="ThiÍn SΩn", menpai=MP_TIANSHAN , itemName="BÂng b‡i c¸a ThiÍn SΩn Æ tÿ", scene=17, itemId=40004314},
								{menpainame="Vı –ang", menpai=MP_WUDANG   , itemName="Ph§t tr•n c¸a Vı –ang Æ tÿ", scene=12, itemId=40004309},
								{menpainame="TiÍu Dao", menpai=MP_XIAOYAO  , itemName="TiÍu trÏ c¸a TiÍu Dao Æ tÿ", scene=14, itemId=40004313},
								{menpainame="Tinh T˙c", menpai=MP_XINGSU   , itemName="C± m„nh c¸a Tinh T˙c Æ tÿ", scene=16, itemId=40004311},
							}
	
--π÷ŒÔµÙ¬‰“≈ŒÔµƒº∏¬ ≈‰÷√±Ì
x229004_g_RateOfDropYiWuTable = {
							{playerLevel=20, dropRate=30},
							{playerLevel=30, dropRate=30},
							{playerLevel=40, dropRate=25},
							{playerLevel=50, dropRate=25},
							{playerLevel=60, dropRate=25},
							{playerLevel=70, dropRate=20},
							{playerLevel=80, dropRate=20},
							{playerLevel=90, dropRate=20},
							{playerLevel=100, dropRate=20},
							{playerLevel=110, dropRate=20},
							{playerLevel=120, dropRate=20},
							{playerLevel=130, dropRate=20},
							{playerLevel=140, dropRate=20},
							{playerLevel=150, dropRate=20},
						}
 
x229004_g_DemandKillcountTable = 	{
							{levelBegin=10, levelEnd=19, killcount=20},
							{levelBegin=20, levelEnd=39, killcount=25},
							{levelBegin=40, levelEnd=59, killcount=30},
							{levelBegin=60, levelEnd=79, killcount=35},
							{levelBegin=80, levelEnd=99, killcount=40},
							{levelBegin=100, levelEnd=109, killcount=45},
							{levelBegin=110, levelEnd=119, killcount=50},
							{levelBegin=120, levelEnd=150, killcount=55},
}						
 
--//////////////////////////////////////////////////////
--…±π÷œ‡πÿ
function x229004_GetMenpaiYiWuInfo(sceneId, selfId)
	for i, v in x229004_g_MenpaiYiWuList do
		if v.menpai == GetMenPai(sceneId, selfId) then
			return v.menpainame, v.itemName, v.itemId
		end
	end
end

function x229004_GetRateOfDropYiWu(sceneId, selfId)
	local playerLevel = GetLevel(sceneId, selfId)
	for i, v in x229004_g_RateOfDropYiWuTable do
		if v.playerLevel >= playerLevel and playerLevel < v.playerLevel then
			return v.dropRate
		end
	end
end

function x229004_GetDemandKillCount(sceneId, selfId)
	local playerLevel = GetLevel(sceneId, selfId)
	for i, v in x229004_g_DemandKillcountTable do
		if playerLevel >= v.levelBegin and playerLevel <= v.levelEnd then
			return v.killcount
		end
	end
end

function x229004_KillMonster_Accept(sceneId, selfId)--…±π÷
		
	local nMonsterId, strMonsterName, strMonsterScene, nScene, nPosX, nPosZ, strDesc, nSex, level
	local playerLevel = GetLevel(sceneId, selfId)
	for i=1, 100 do
		nMonsterId, strMonsterName, strMonsterScene, nScene, nPosX, nPosZ, strDesc, nSex, level = GetOneMissionNpc(43)
		if abs(level - playerLevel) < 3 then
			break
		end
		if i == 100 then
			--Õ≥Õ≥ÀÕ–≈»•:((
			x229004_SongXin_Accept(sceneId, selfId)
			return
		end
	end	
	
	--º”»Î»ŒŒÒµΩÕÊº“¡–±Ì
	local bAdd = AddMission( sceneId,selfId, x229004_g_MissionId, x229004_g_ScriptId, 1, 0, 1 )
	if bAdd < 1 then
		return
	end	
	local killcount = x229004_GetDemandKillCount(sceneId, selfId)
	local countpart1 = x229004_GetStrIndexByStrValue(tostring(floor(killcount / 10)) )
	local countpart2 = x229004_GetStrIndexByStrValue(tostring(floor(mod(killcount, 10))) )
	
	--µ√µΩ»ŒŒÒ‘⁄20∏ˆ»ŒŒÒ÷–µƒ–Ú¡–∫≈
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229004_g_MissionId)
	
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --…Ë÷√»ŒŒÒ «∑ÒÕÍ≥…£®Œ¥ÕÍ≥…£©
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229004_g_SubMissionTypeEnum.killMonster)
	
	SetMissionParamByIndexEx(sceneId, selfId, misIndex, 3, 0, killcount) --“™«Û…±À¿µƒmonster◊‹ ˝£¨ œ÷‘⁄ªπ√ª”–∏≥÷µ
	SetMissionParamByIndexEx(sceneId, selfId, misIndex, 3, 1, 0) --“—æ≠…±À¿µƒmonster ˝¡ø
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart, 8)--formet◊÷∑˚¥ÆÀ˜“˝
	SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart+1, countpart1)
	SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart+2, countpart2)
	SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart+3, nMonsterId)
		
	Msg2Player(  sceneId, selfId,"#YNhßn nhiÆm v¯#W: NhiÆm v¯ sﬂ mÙn", MSG2PLAYER_PARA )
	CallScriptFunction( SCENE_SCRIPT_ID, "AskThePos", sceneId, selfId, nScene, nPosX, nPosZ, strMonsterName)
	
	local strMissionTarget = format("G•n ‚y ∑ khu vÒc %s %s thﬂ∂ng qu§y nhi≠u cﬂ d‚n xung quanh, ngﬂΩi h„y nhßn lÆnh i tr◊ng ph’t ch˙ng", 
						strMonsterScene, strMonsterName)
	AddText(sceneId, strMissionTarget)

end

--//////////////////////////////////////////////////////

function x229004_GetStrIndexByStrValue(stringV)
	for i, v in x229004_g_StrList do
		if v == stringV then
				return i-1
		end
	end
	local strText = format("C•n ph‰i %s Âng kÌ StrList trong", stringV)
	PrintStr(strText)
	return 0;
end

--/////////////////////////////////////////////////////////////////////////////////////////////////////
--ªÒ»°æﬂÃÂitemµƒœÍœ∏–≈œ¢
function x229004_GetItemDetailInfo(itemId)
	local itemId, itemName, itemDesc = GetItemInfoByItemId(itemId)
	if itemId == -1 then
		local strText = format("%s Vßt ph¶m ∑ 'MissionItem_HashTable.txt' khÙng tÏm th§y!!", itemName)
		PrintStr(strText)
	end
	return itemId, itemName, itemDesc
end	
--/////////////////////////////////////////////////////////////////////////////////////////////////////
--∏˘æ›ÕÊº“µ»º∂µ√µΩ∂‘”¶MissionItem_HashTable.txt÷–µƒµ•‘™À˜“˝
function x229004_GetMissionItemIndex(sceneId, selfId)
	local nPlayerLevel  = GetLevel(sceneId, selfId)
	if nPlayerLevel >= 10 and nPlayerLevel < 20 then
		return 0;
	elseif nPlayerLevel >= 20 and nPlayerLevel < 30 then
		return 1;
	elseif nPlayerLevel >= 30 and nPlayerLevel < 40 then
		return 2;
	elseif nPlayerLevel >= 40 and nPlayerLevel < 60 then
		return 3;
	elseif nPlayerLevel >= 60 and nPlayerLevel < 80 then
		return 4;
	elseif nPlayerLevel >= 80 and nPlayerLevel < 100 then
		return 5;
	elseif nPlayerLevel >= 100 and nPlayerLevel < 120 then
		return 167;
	elseif nPlayerLevel >= 100 then
		return 168;
	end
end

--∏˘æ›ÕÊº“µ»º∂µ√µΩ∂‘”¶µƒ ¶√≈»ŒŒÒµƒΩ◊∂Œ
--∏˘æ›ÕÊº“µ»º∂µ√µΩ∂‘”¶MissionNPC_HashTable.txt÷–µƒµ•‘™À˜“˝
function x229004_GetShiMenPhaseByPlayerLevel(sceneId, selfId)
	local nPlayerLevel  = GetLevel(sceneId, selfId)
	if nPlayerLevel >= 10 and nPlayerLevel < 20 then
		return 0
	elseif nPlayerLevel >= 20 and nPlayerLevel < 40 then
		return 1
	elseif nPlayerLevel >= 40 and nPlayerLevel < 60 then
		return 2
	elseif nPlayerLevel >= 60 and nPlayerLevel < 80 then 
		return 3
	elseif nPlayerLevel >= 80 and nPlayerLevel < 100 then 
		return 4
	elseif nPlayerLevel >= 100 and nPlayerLevel < 120 then 
		return 243
	elseif nPlayerLevel >= 120 then
		return 244
	end
end
--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229004_RandomSubMission(sceneId, selfId)
 
	--—∞ŒÔ£®1/4£©°¢ÀÕ–≈£®1/16£©°¢ ’ºØ£®1/16£©°¢ø™π‚£®1/16£©°¢∂®µ„“˝µº£®1/16£©°¢’Ω∂∑∏±±æ£®1/4£©°¢≤∂◊Ω£®1/4£©
	local nRet = 1 + LuaFnGetHumanShimenRandom(sceneId, selfId);
	if nRet then
		if nRet <= 4 then
			x229004_XunWu_Accept(sceneId, selfId)
		elseif nRet <= 5 then
			x229004_SongXin_Accept(sceneId, selfId)
		elseif nRet <= 6 then
			x229004_ShouJi_Accept(sceneId, selfId)
		elseif nRet <= 7 then
			x229004_SongXin_Accept(sceneId, selfId)
		elseif nRet <= 8 then
			x229004_DingDianYinDao_Accept(sceneId, selfId)
		elseif nRet <= 12 then
			x229004_FuBenZhanDou_Accept(sceneId, selfId)
		elseif nRet <= 16 then
			x229004_BuZhuo_Accept(sceneId, selfId)
		else
			return -1
		end
	else
		return -1;
	end
end
--**********************************
--∏˘æ›ÕÊº“µ»º∂µ√≥ˆ»ŒŒÒµƒµ»º∂Ω◊∂Œ(1~5)
--**********************************
function x229004_DoSomethingByPlayerLevel(sceneId, selfId)
	CallScriptFunction(229000, "DoSomethingByPlayerLevel", sceneId, selfId, x229004_g_ScriptId)
end

--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229004_XunWu_Accept(sceneId, selfId)--—∞ŒÔ
	----PrintStr("XunWu_Accept..")
	--º”»Î»ŒŒÒµΩÕÊº“¡–±Ì
	local bCanAdd = AddMission( sceneId,selfId, x229004_g_MissionId, x229004_g_ScriptId, 0, 0, 1 )
	if bCanAdd < 1 then
		return
	end	
	
	local nitemId, strItemName, strItemDesc = GetOneMissionItem(x229004_GetMissionItemIndex(sceneId, selfId))
	Msg2Player(sceneId, selfId, "#YNhßn nhiÆm v¯#W: NhiÆm v¯ sﬂ mÙn", MSG2PLAYER_PARA )
	--print(nitemId, strItemName, strItemDesc)
	--µ√µΩ»ŒŒÒ‘⁄20∏ˆ»ŒŒÒ÷–µƒ–Ú¡–∫≈
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229004_g_MissionId)
	
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --…Ë÷√»ŒŒÒ «∑ÒÕÍ≥…£®Œ¥ÕÍ≥…£©
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229004_g_SubMissionTypeEnum.XunWu)
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart, 1)--formet◊÷∑˚¥ÆÀ˜“˝
	SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart+1, nitemId)
	
	local strMissionTarget = format("%s c¸a ta sao khÙng th§y ‚u? N™u ngﬂΩi cÛ th¨ gi˙p ta tÏm l’i, ta s® khÙng b’c „i ngﬂΩi", strItemName)
	AddText(sceneId, strMissionTarget)
	
	--ºÏ≤‚ÕÊº“…Ì…œµƒµ¿æﬂ «∑Ò“—æ≠¬˙◊„ÕÍ≥…Ãıº˛
	local bHaveItem = HaveItem(sceneId, selfId, nitemId)
	if bHaveItem == 1 then
		SetMissionByIndex(sceneId,selfId,misIndex,0,1)					--∞—»ŒŒÒÕÍ≥…±Í÷æ÷√Œ™1
		ResetMissionEvent(sceneId, selfId, x229004_g_MissionId, 2)
	end	
	
end	

--/////////////////////////////////////////////////////////////////////////////////////////////////////

function x229004_SongXin_Accept(sceneId, selfId)--ÀÕ–≈
	
  local roll = random(3)
	--ÀÊª˙—°≥ˆ±æ√≈≈…µƒÃÿ≤˙±‡∫≈£¨√ø∏ˆ√≈≈…3÷÷Ãÿ≤˙
	local shoujiItemId = x229004_g_ShouJiList[ roll ].itemId
		
	--»ŒŒÒΩ±¿¯œ‡πÿ			
	BeginAddItem(sceneId)
		AddItem(sceneId, shoujiItemId, 1)
	local bAdd = EndAddItem(sceneId, selfId)
	if bAdd < 1 then
		return 
	end	
	
	--º”»Î»ŒŒÒµΩÕÊº“¡–±Ì
	bAdd = AddMission( sceneId,selfId, x229004_g_MissionId, x229004_g_ScriptId, 0, 0, 0 )
	if bAdd < 1 then
		return
	end	
	AddItemListToHuman(sceneId, selfId)
	--—∞ŒÔ, ÀÕ–≈‘Ú…Ë÷√À¯∂®ƒø±ÍNPCµƒ ¬º˛Flag
	SetMissionEvent(sceneId, selfId, x229004_g_MissionId, 4)

	local nPhase = x229004_GetShiMenPhaseByPlayerLevel(sceneId, selfId)
	local nNpcId, strNpcName, strNpcScene, nSceneId, nPosX, nPosZ, strNPCDesc = GetOneMissionNpc(nPhase)
	--print(nNpcId, strNpcName, strNpcScene, nSceneId, nPosX, nPosZ, strNPCDesc)
	Msg2Player(  sceneId, selfId,"#YNhßn nhiÆm v¯#W: NhiÆm v¯ sﬂ mÙn", MSG2PLAYER_PARA )
	CallScriptFunction( SCENE_SCRIPT_ID, "AskTheWay", sceneId, selfId, nSceneId, nPosX, nPosZ, strNpcName)
		
	--µ√µΩ»ŒŒÒ‘⁄20∏ˆ»ŒŒÒ÷–µƒ–Ú¡–∫≈
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229004_g_MissionId)
	
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --…Ë÷√»ŒŒÒ «∑ÒÕÍ≥…£®Œ¥ÕÍ≥…£©
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229004_g_SubMissionTypeEnum.SongXin)
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart, 0)--formet◊÷∑˚¥ÆÀ˜“˝
	SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart+1, nNpcId)

	local ListIndex = x229004_GetStrIndexByStrValue( x229004_g_ShouJiList[ roll ].itemName )
	SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart+2, ListIndex )

  SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart+3, shoujiItemId )

	local strMissionTarget = format("L‚u l°m khÙng g£p %s %s, ngﬂΩi h„y gi˙p ta em %s giao cho ngﬂ∂i §y", strNpcScene, strNpcName, x229004_g_ShouJiList[ roll ].itemName )
	AddText(sceneId, strMissionTarget)
	
end

--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229004_DingDianYinDao_Accept(sceneId, selfId)--∂®µ„“˝µº
	--ªÒµ√ÕÊº“µƒ√≈≈…
	local playerMenpai = GetMenPai(sceneId, selfId)
	local a = {}
	local index = 1
	--”√“ª∏ˆ¡Ÿ ±±Ì¿¥¥Ê¥¢∂‘”¶√≈≈…‘⁄x229004_g_DingDianYinDaoList÷–µƒ»´≤øÀ˜“˝
	for i, v in x229004_g_DingDianYinDaoList do
		if v.menpai == playerMenpai then
			a[index] = i
			index = index + 1
		end
	end
	
	local ct = getn(a)
	if ct <= 0 then
		return 0
	end
		
	local ret = random(ct)
	BeginAddItem(sceneId)
		AddItem(sceneId, x229004_g_DingDianYinDaoList[a[ret]].itemId, 1)
	local bAdd = EndAddItem(sceneId, selfId)
	if bAdd < 1 then
		return 
	end	
	
	--º”»Î»ŒŒÒµΩÕÊº“¡–±Ì
	bAdd = AddMission( sceneId,selfId, x229004_g_MissionId, x229004_g_ScriptId, 0, 0, 0 )
	if bAdd < 1 then
		return 
	end	
	AddItemListToHuman(sceneId, selfId)
	Msg2Player(  sceneId, selfId,"#YNgﬂΩi „ ’t ﬂ˛c 1 chi™c#W" .. x229004_g_DingDianYinDaoList[a[ret]].itemName, MSG2PLAYER_PARA )
	
	local strIndex_Area = x229004_GetStrIndexByStrValue(x229004_g_DingDianYinDaoList[a[ret]].AreaName)
	local strIndex_Item = x229004_GetStrIndexByStrValue(x229004_g_DingDianYinDaoList[a[ret]].itemName)
	local strIndex_subArea = x229004_GetStrIndexByStrValue(x229004_g_DingDianYinDaoList[a[ret]].subAreaName)
	
	local x1 = x229004_g_DingDianYinDaoList[a[ret]].posx1
	local x2 = x229004_g_DingDianYinDaoList[a[ret]].posx2
	local z1 = x229004_g_DingDianYinDaoList[a[ret]].posz1
	local z2 = x229004_g_DingDianYinDaoList[a[ret]].posz2
	local scene = x229004_g_DingDianYinDaoList[a[ret]].scene
	local tip = x229004_g_DingDianYinDaoList[a[ret]].AreaName .. x229004_g_DingDianYinDaoList[a[ret]].subAreaName
	local x = x1 + (x2-x1)/2
	local z = z1 + (z2-z1)/2
	
	--µ√µΩ»ŒŒÒ‘⁄20∏ˆ»ŒŒÒ÷–µƒ–Ú¡–∫≈
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229004_g_MissionId)
		
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --…Ë÷√»ŒŒÒ «∑ÒÕÍ≥…£®Œ¥ÕÍ≥…£©
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229004_g_SubMissionTypeEnum.DingDianYinDao)
	SetMissionByIndex(sceneId, selfId, misIndex, 2, a[ret]) --…Ë÷√∂®µ„“˝µº¡–±Ì÷–µƒÀ˜“˝
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart, 3)--formet◊÷∑˚¥ÆÀ˜“˝
	SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart+1, strIndex_Area)
	SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart+2, strIndex_subArea)
	SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart+3, strIndex_Item)
	
	Msg2Player(  sceneId, selfId,"#YNhßn nhiÆm v¯#W: NhiÆm v¯ sﬂ mÙn", MSG2PLAYER_PARA )
	CallScriptFunction( SCENE_SCRIPT_ID, "AskThePos", sceneId, selfId, scene, x, z, tip)
	
	local strMissionTarget = format("Xin ngﬂΩi h„y ∑ ThiÍn Long TÒ %s tÏm %s, ∑ g•n Û sÿ d¯ng %s ¨ thÿ luyÆn nÂng lÒc c¸a ngﬂΩi", 
		x229004_g_DingDianYinDaoList[a[ret]].AreaName, 
		x229004_g_DingDianYinDaoList[a[ret]].subAreaName, 
		x229004_g_DingDianYinDaoList[a[ret]].itemName)
		
	AddText(sceneId, strMissionTarget)
	
end

--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229004_FuBenZhanDou_Accept(sceneId, selfId)--’Ω∂∑∏±±æ
	local playerMenpai = GetMenPai(sceneId, selfId)
	if playerMenpai == MP_WUMENPAI then
		return 0
	end	

	local npcName, fubenName, nSceneId, posx, posz
	for i, v in x229004_g_FuBen_List do
		if v.menpai == GetMenPai(sceneId, selfId) then
			npcName =  v.NpcName
			fubenName =  v.FubenName
			nSceneId = v.scene
			posx = v.posx
			posz = v.posz
			break
		end
	end

	--º”»Î»ŒŒÒµΩÕÊº“¡–±Ì
	local bAdd = AddMission( sceneId,selfId, x229004_g_MissionId, x229004_g_ScriptId, 0, 0, 0 )
	if bAdd < 1 then
		return
	end
	
	local nFormatIndex = GetMissionCacheData(sceneId, selfId, 0)
	local i = GetMissionCacheData(sceneId, selfId, 2)
	local NpcNameIndex = x229004_GetStrIndexByStrValue(npcName)
	local FubenNameIndex = x229004_GetStrIndexByStrValue(fubenName)
	
	--µ√µΩ»ŒŒÒ‘⁄20∏ˆ»ŒŒÒ÷–µƒ–Ú¡–∫≈
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229004_g_MissionId)
		
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --…Ë÷√»ŒŒÒ «∑ÒÕÍ≥…£®Œ¥ÕÍ≥…£©
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229004_g_SubMissionTypeEnum.FuBenZhanDou)
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart, 4)
	SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart+1, NpcNameIndex)
	SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart+2, FubenNameIndex)
	
	Msg2Player(  sceneId, selfId,"#YNhßn nhiÆm v¯#W: NhiÆm v¯ sﬂ mÙn", MSG2PLAYER_PARA )
	CallScriptFunction( SCENE_SCRIPT_ID, "AskTheWay", sceneId, selfId, nSceneId, posx, posz, npcName)

	local strMissionTarget = format("Xin ngﬂΩi h„y i tÏm %s, ngﬂ∂i s® ﬂa ngﬂΩi i thÿ chi™n %s", npcName, fubenName)
	AddText(sceneId, strMissionTarget)
end

--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229004_BuZhuo_Accept(sceneId, selfId)--≤∂◊Ω
	local playerLevel = GetLevel(sceneId, selfId)
	local petId, petName, petDesc, takeLevel
	local petHashIndex = CallScriptFunction(229000, "GetMissionPetIndex", sceneId, selfId)
	for i = 1, 100 do
		petId, petName, petDesc = GetOneMissionPet(petHashIndex)
		takeLevel = GetPetTakeLevel(petId)
		if playerLevel > takeLevel then
			break
		end
		if i == 100 then
			--Õ≥Õ≥ÀÕ–≈»•:((
			x229004_SongXin_Accept(sceneId, selfId)
			return
		end
	end	
	--º”»Î»ŒŒÒµΩÕÊº“¡–±Ì
	local bAdd =	AddMission( sceneId,selfId, x229004_g_MissionId, x229004_g_ScriptId, 0, 0, 0 )
	if bAdd < 1 then
		return
	end	

	SetMissionEvent(sceneId, selfId, x229004_g_MissionId, 3)
	
	--µ√µΩ»ŒŒÒ‘⁄20∏ˆ»ŒŒÒ÷–µƒ–Ú¡–∫≈
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229004_g_MissionId)
	
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --…Ë÷√»ŒŒÒ «∑ÒÕÍ≥…£®Œ¥ÕÍ≥…£©
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229004_g_SubMissionTypeEnum.BuZhuo)
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart, 5)--formet◊÷∑˚¥ÆÀ˜“˝
	SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart+1, petId)
		
	Msg2Player(  sceneId, selfId,"#YNhßn nhiÆm v¯#W: NhiÆm v¯ sﬂ mÙn", MSG2PLAYER_PARA )
	
	local strMissionTarget = format("Xin ngﬂΩi h„y b°t cho ta mµt con %s v´", petName)
	AddText(sceneId, strMissionTarget)
	
	--ºÏ≤‚ÕÊº“…Ì…œµƒµ¿æﬂ «∑Ò“—æ≠¬˙◊„ÕÍ≥…Ãıº˛
	for i=0, 6 do
		local petDataId = LuaFnGetPet_DataID(sceneId,selfId,i)
		if petDataId == petId then
			SetMissionByIndex(sceneId,selfId,misIndex,0,1)					--∞—»ŒŒÒÕÍ≥…±Í÷æ÷√Œ™1

			ResetMissionEvent(sceneId, selfId, x229004_g_MissionId, 3)
			break
		end	
	end	

end
--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229004_ShouJi_Accept(sceneId, selfId)-- ’ºØ
	--PrintStr("ShouJi_Accept...")
	local playerMenpai = GetMenPai(sceneId, selfId)
	if playerMenpai == MP_WUMENPAI then
		return 0
	end	
	--PrintStr("playerMenpai="..playerMenpai)
	local a = {}
	local index = 1
	for i, v in x229004_g_ShouJiList do
		if v.menpai == playerMenpai then
			--PrintStr("find...")
			a[index] = i
			index = index + 1
		end	
	end
	local ct = getn(a)
	--PrintStr("ct="..ct)
	if ct <= 0 then
		return 0
	end
	
	local ret = random(ct)
	--º”»Î»ŒŒÒµΩÕÊº“¡–±Ì
	local bAdd = AddMission( sceneId,selfId, x229004_g_MissionId, x229004_g_ScriptId, 0, 0, 1 )
	if bAdd < 1 then
		return
	end	

	
	local itemNameIndex = x229004_GetStrIndexByStrValue(x229004_g_ShouJiList[a[ret]].itemName)
	--µ√µΩ»ŒŒÒ‘⁄20∏ˆ»ŒŒÒ÷–µƒ–Ú¡–∫≈
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229004_g_MissionId)
	
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --…Ë÷√»ŒŒÒ «∑ÒÕÍ≥…£®Œ¥ÕÍ≥…£©
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229004_g_SubMissionTypeEnum.ShouJi)
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart, 6)--formet◊÷∑˚¥ÆÀ˜“˝
	SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart+1, itemNameIndex)
	SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart+2, x229004_g_ShouJiList[a[ret]].itemId)
		
	Msg2Player(  sceneId, selfId,"#YNhßn nhiÆm v¯#W: NhiÆm v¯ sﬂ mÙn", MSG2PLAYER_PARA )
	
	local strMissionTarget = format("Xin ngﬂΩi h„y gi˙p ta ki™m 5 %s v´", x229004_g_ShouJiList[a[ret]].itemName)
	AddText(sceneId, strMissionTarget)
end
--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229004_Ability_Accept(sceneId, selfId)--ø™π‚
	--PrintStr("Ability_Accept...")
	--local nPhase = x229004_GetShiMenPhaseByPlayerLevel(sceneId, selfId)
	--local nNpcId, strNpcName, strNpcScene, nSceneId, nPosX, nPosZ, strNPCDesc = GetOneMissionNpc(nPhase-1)
	local strNpcName, scene, x, z
	for i, v in x229004_g_AbilityNpcList do
		if v.menpai == GetMenPai(sceneId, selfId) then
			local ct = getn(v.npcList)
			local index =	random(ct)
			strNpcName = v.npcList[index].name
			scene = v.npcList[index].scene
			x = v.npcList[index].x
			z = v.npcList[index].z
		end
	end
	--PrintStr(strNpcName)
	
	local strNpcIndex = x229004_GetStrIndexByStrValue(strNpcName)
	--PrintNum(strNpcIndex)
	local itemId, itemName = GetMenpaiItem(sceneId, selfId)


	----PrintStr("itemId="..itemId.."  itemName="..itemName)
	--º”»Î»ŒŒÒµΩÕÊº“¡–±Ì
	local bAdd = AddMission( sceneId,selfId, x229004_g_MissionId, x229004_g_ScriptId, 0, 0, 0 )
	if bAdd < 1 then	
		return
	end
	
	SetMissionEvent(sceneId, selfId, x229004_g_MissionId, 2)
	SetMissionEvent(sceneId, selfId, x229004_g_MissionId, 4)
	
	--µ√µΩ»ŒŒÒ‘⁄20∏ˆ»ŒŒÒ÷–µƒ–Ú¡–∫≈
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229004_g_MissionId)
	
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --…Ë÷√»ŒŒÒ «∑ÒÕÍ≥…£®Œ¥ÕÍ≥…£©
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229004_g_SubMissionTypeEnum.KaiGuang)
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart, 7)--formet◊÷∑˚¥ÆÀ˜“˝
	SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart+1, strNpcIndex)
	SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart+2, itemId)
		
	Msg2Player(  sceneId, selfId,"#YNhßn nhiÆm v¯#W: NhiÆm v¯ sﬂ mÙn", MSG2PLAYER_PARA )
	CallScriptFunction( SCENE_SCRIPT_ID, "AskTheWay", sceneId, selfId, scene, x, z, strNpcName)
	
	local strMissionTarget = format("H„y ﬂa %scho%s, ta s® hßu „i ngﬂΩi!", strNpcName, itemName)
	AddText(sceneId, strMissionTarget)

end
--/////////////////////////////////////////////////////////////////////////////////////////////////////
--**********************************
--»ŒŒÒ»Îø⁄∫Ø ˝
--**********************************
function x229004_OnDefaultEvent( sceneId, selfId, targetId )	--µ„ª˜∏√»ŒŒÒ∫Û÷¥––¥ÀΩ≈±æ
	----PrintStr("OnDefaultEvent...")
	--∑¢ÀÕ»ŒŒÒ–Ë«Ûµƒ–≈œ¢
	if IsHaveMission(sceneId,selfId,x229004_g_MissionId) > 0 then
		if GetName(sceneId, targetId) == x229004_g_Name then
			--∑¢ÀÕ»ŒŒÒ–Ë«Ûµƒ–≈œ¢
			BeginEvent(sceneId)
				AddText(sceneId, x229004_g_MissionName)
				AddText(sceneId, "ViÆc ta giao „ ho‡n th‡nh chﬂa?")
			EndEvent( )
			bDone = x229004_CheckSubmit( sceneId, selfId )
			DispatchMissionDemandInfo(sceneId, selfId, targetId, x229004_g_ScriptId, x229004_g_MissionId, bDone)
		else
			local misIndex = GetMissionIndexByID(sceneId,selfId,x229004_g_MissionId)
			
			local demandItemId =0
			local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
			if missionType == x229004_g_SubMissionTypeEnum.SongXin then
			    demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229004_g_StrForePart+3)
			else
			    demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229004_g_StrForePart+2)
			end	
			
			local _, strDemandItemName, _ = x229004_GetItemDetailInfo(demandItemId)
			
			local bHaveItem = HaveItem(sceneId, selfId, demandItemId)
			if bHaveItem == 1 then
				if LuaFnGetAvailableItemCount(sceneId, selfId, demandItemId) >= 1 then
				DelItem(sceneId, selfId, demandItemId, 1)
				BeginEvent(sceneId)
					AddText(sceneId, "Xin c·c h’ quay v´ nÛi væi Sﬂ ph¯ c¸a c·c h’, t’i h’ r§t nhæ sﬂ ph¯ c¸a c·c h’, r§t c‰m Ωn sﬂ ph¯ c¸a c·c h’ t£ng mÛn qu‡ n‡y cho t’i h’, ‚y l‡ th— m‡ t’i h’ ang muØn cÛ ﬂ˛c.")
				EndEvent()
				DispatchEventList(sceneId, selfId, targetId)	
				--…Ë÷√»ŒŒÒ“—æ≠ÕÍ≥…
				SetMissionByIndex(sceneId, selfId, misIndex, 0, 1)
				ResetMissionEvent(sceneId, selfId, x229004_g_MissionId, 4)
				return 1;
			else
				BeginEvent(sceneId)
						AddText(sceneId, "Vßt ph¶m c¸a c·c h’ hiÆn khÙng d˘ng ﬂ˛c ho£c „ b∏ khÛa")
					EndEvent( )
					DispatchMissionTips(sceneId,selfId)		
					return 0;				
				end
			else
				BeginEvent(sceneId)
					AddText(sceneId, "–„ mang tæi th— ta c•n chﬂa?")
				EndEvent()
				DispatchEventList(sceneId, selfId, targetId)	
				return 1;					
			end
		end
	elseif x229004_CheckAccept(sceneId,selfId) > 0 then
		BeginEvent(sceneId)
		
			AddText(sceneId,x229004_g_MissionName)
			AddText(sceneId,x229004_g_MissionInfo)
			AddText(sceneId,"#{M_MUBIAO}#r")
			
			x229004_DoSomethingByPlayerLevel(sceneId, selfId)
			--±£÷§µ⁄“ª¥ŒΩ”µΩµƒ»ŒŒÒ◊‹ «πÃ∂®≤ª±‰µƒ
			--ResetMissionCacheData(sceneId, selfId)
			--SetMissionCacheData(sceneId, selfId, 0, 0) --formet◊÷∑˚¥ÆÀ˜“˝
			--SetMissionCacheData(sceneId, selfId, 1, x229004_g_SubMissionTypeEnum.SongXin)
			--SetMissionCacheData(sceneId, selfId, 2, 100001) --…Ë÷√human…Ì…œµ⁄0Œªª∫¥Ê ˝æ›
			--SetMissionCacheData(sceneId, selfId, 7, 1) -- «∑Ò «µ⁄“ª¥Œ
			
			--strMissionTarget = format("∫√æ√√ª”–º˚%s¡À£¨«Î¥˙Œ“Œ ∫Ú“ªœ¬À˚»•", "frankwu")
			--AddText(sceneId, strMissionTarget)

			--º”»Î»ŒŒÒµΩÕÊº“¡–±Ì
			--AddMission( sceneId,selfId, x229004_g_MissionId, x229004_g_ScriptId, 0, 0, 0 )
			--—∞ŒÔ, ÀÕ–≈‘Ú…Ë÷√À¯∂®ƒø±ÍNPCµƒ ¬º˛Flag
			--SetMissionEvent(sceneId, selfId, x229004_g_MissionId, 4)

			--local _, strNpcName, strNpcScene, PosX, PosZ, _ = GetNpcInfoByNpcId(sceneId,100001)
			--Msg2Player(  sceneId, selfId,"#YΩ” ‹»ŒŒÒ£∫ ¶√≈»ŒŒÒ", MSG2PLAYER_PARA )
			--CallScriptFunction( SCENE_SCRIPT_ID, "AskTheWay", sceneId, selfId, nSceneId, PosX, PosZ, strNpcName)
				
			--µ√µΩ»ŒŒÒ‘⁄20∏ˆ»ŒŒÒ÷–µƒ–Ú¡–∫≈
			--local misIndex = GetMissionIndexByID(sceneId,selfId,x229004_g_MissionId)
			
			--SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --…Ë÷√»ŒŒÒ «∑ÒÕÍ≥…£®Œ¥ÕÍ≥…£©
			--SetMissionByIndex(sceneId, selfId, misIndex, 1, x229004_g_SubMissionTypeEnum.SongXin)
			
			--SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart, 0)--formet◊÷∑˚¥ÆÀ˜“˝
			--SetMissionByIndex(sceneId, selfId, misIndex, x229004_g_StrForePart+1, 100001)
		
			
		EndEvent( )
		DispatchEventList(sceneId,selfId,targetId)
	end
	
end

--**********************************
--¡–æŸ ¬º˛
--**********************************
function x229004_OnEnumerate( sceneId, selfId, targetId )
	----PrintStr("807002...OnEnumerate")
--»Áπ˚ÕÊº“ÕÍ≥…π˝’‚∏ˆ»ŒŒÒ
	if IsMissionHaveDone(sceneId,selfId,x229004_g_MissionId) > 0 then
  	return
--¬˙◊„»ŒŒÒΩ” ’Ãıº˛
	elseif IsHaveMission(sceneId,selfId,x229004_g_MissionId) > 0 then
		local strNpcName = x229004_g_Name -- temp code
		if GetName(sceneId,targetId) == strNpcName then
			AddNumText(sceneId, x229004_g_ScriptId,x229004_g_MissionName,4,-1);
		end
--¬˙◊„»ŒŒÒΩ” ’Ãıº˛
  elseif x229004_CheckAccept(sceneId,selfId) > 0 then
		if GetName(sceneId,targetId) == x229004_g_Name then
			AddNumText(sceneId,x229004_g_ScriptId,x229004_g_MissionName,3,-1);
		end
  end
end
--**********************************
--Ω” ‹
--**********************************
function x229004_OnAccept( sceneId, selfId )
	--PrintStr("OnAccept...")
	--local nMissionType = GetMissionCacheData(sceneId, selfId, 1)
	--if nMissionType == x229004_g_SubMissionTypeEnum.XunWu then
	--	x229004_XunWu_Accept(sceneId, selfId)
	--elseif nMissionType == x229004_g_SubMissionTypeEnum.SongXin then
	--	x229004_SongXin_Accept(sceneId, selfId)
	--elseif nMissionType == x229004_g_SubMissionTypeEnum.DingDianYinDao then
	--	x229004_DingDianYinDao_Accept(sceneId, selfId)
	--elseif nMissionType == x229004_g_SubMissionTypeEnum.FuBenZhanDou then
	--	x229004_FuBenZhanDou_Accept(sceneId, selfId)
	--elseif nMissionType == x229004_g_SubMissionTypeEnum.BuZhuo then
	--	x229004_BuZhuo_Accept(sceneId, selfId)
	--end
end

--**********************************
--ºÏ≤‚Ω” ‹Ãıº˛
--**********************************
function x229004_CheckAccept( sceneId, selfId )
	local nLevel = GetLevel(sceneId, selfId)
	--ÕÊº“µ»º∂>=10º∂
	if nLevel < 10 then
		return 0
	else
		local playerMenpai = GetMenPai(sceneId, selfId)
		if playerMenpai ~= MP_DALI then
			return 0
		end	
	end
	return 1;
end

--**********************************
--∑≈∆˙
--**********************************
function x229004_OnAbandon( sceneId, selfId )
	----PrintStr("OnAbandon...")
	if IsHaveMission(sceneId, selfId, x229004_g_MissionId) > 0 then	
		local misIndex = GetMissionIndexByID(sceneId,selfId,x229004_g_MissionId)		--µ√µΩ»ŒŒÒ‘⁄20∏ˆ»ŒŒÒ÷–µƒ–Ú¡–∫≈
		local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
		
		if missionType == x229004_g_SubMissionTypeEnum.SongXin then
			local missionItem = GetMissionParam(sceneId, selfId, misIndex,x229004_g_StrForePart+3)    
			if HaveItem(sceneId, selfId, missionItem) == 1 then
			if LuaFnGetAvailableItemCount(sceneId, selfId, missionItem) >= 1 then
			DelItem(sceneId, selfId, missionItem, 1)		
			else
				BeginEvent(sceneId)
					AddText(sceneId, "Vßt ph¶m c¸a c·c h’ hiÆn khÙng d˘ng ﬂ˛c ho£c „ b∏ khÛa")
				EndEvent( )
				DispatchMissionTips(sceneId,selfId)	
				return	
			end
			end
		elseif missionType == x229004_g_SubMissionTypeEnum.DingDianYinDao	then
			local index = GetMissionParam(sceneId, selfId, misIndex,2)
			if HaveItem(sceneId, selfId, x229004_g_DingDianYinDaoList[index].itemId) == 1 then			
			if LuaFnGetAvailableItemCount(sceneId, selfId, x229004_g_DingDianYinDaoList[index].itemId) >= 1 then
			DelItem(sceneId, selfId,x229004_g_DingDianYinDaoList[index].itemId,1)
			else
				BeginEvent(sceneId)
					AddText(sceneId, "Vßt ph¶m c¸a c·c h’ hiÆn khÙng d˘ng ﬂ˛c ho£c „ b∏ khÛa")
				EndEvent( )
				DispatchMissionTips(sceneId,selfId)	
				return	
			end
			end
		elseif missionType == x229004_g_SubMissionTypeEnum.ShouJi then
			local itemId = GetMissionParam(sceneId, selfId, misIndex, x229004_g_StrForePart+2)
			if HaveItem(sceneId, selfId, itemId) == 1 then			
			if LuaFnGetAvailableItemCount(sceneId, selfId, itemId) >= 1 then
			DelItem(sceneId, selfId,itemId,5)
			else
				BeginEvent(sceneId)
					AddText(sceneId, "Vßt ph¶m c¸a c·c h’ hiÆn khÙng d˘ng ﬂ˛c ho£c „ b∏ khÛa")
				EndEvent( )
				DispatchMissionTips(sceneId,selfId)	
				return	
			end
		end
		end
		--…æ≥˝ÕÊº“»ŒŒÒ¡–±Ì÷–∂‘”¶µƒ»ŒŒÒ
	  DelMission( sceneId, selfId, x229004_g_MissionId )
	  SetMissionData(sceneId,selfId,MD_SHIMEN_HUAN,0)	--ª∑ ˝«Â0
	end	
 	--µ˜”√Õ®”√∑≈∆˙Ω”ø⁄
	------------------------------------------------------------------
	 CallScriptFunction( 500501, "Abandon_Necessary", sceneId, selfId )
	-------------------------------------------------------------------
end

--**********************************
--ºÃ–¯
--**********************************
function x229004_OnContinue( sceneId, selfId, targetId )
	----PrintStr("OnContinue...")
	if x229004_CheckAccept(sceneId,selfId) > 0 then
		BeginEvent(sceneId)
		
			AddText(sceneId,x229004_g_MissionName)
			AddText(sceneId,x229004_g_MissionComplete)
			
		  --x229004_DoSomethingByPlayerLevel(sceneId, selfId)
		  
		EndEvent( )
		DispatchMissionContinueInfo(sceneId, selfId, targetId, x229004_g_ScriptId, x229004_g_MissionId)
	end	
end

--**********************************
--ºÏ≤‚ «∑Òø…“‘Ã·Ωª
--**********************************
function x229004_CheckSubmit( sceneId, selfId )
	if IsHaveMission( sceneId, selfId, x229004_g_MissionId ) <= 0 then
		return 0
	end

	--‘⁄¥À≈–∂œÃ·ΩªÃıº˛ «∑Ò∑˚∫œ£¨≤¢∏¯”Ëœ‡”¶Ω±¿¯
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229004_g_MissionId)
	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
	
	if missionType == x229004_g_SubMissionTypeEnum.XunWu then
		local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229004_g_StrForePart+1)
		if GetItemCount(sceneId,selfId,demandItemId) <= 0 then --√ª”–À˜“™µƒŒÔ∆∑
			return 0
		end
		if IsEquipItem(demandItemId) == 1 and IsWhiteEquip(demandItemId) ~= 1 then
			return 2
		else
			return 1
		end		
	elseif missionType == x229004_g_SubMissionTypeEnum.ShouJi then
	 	local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229004_g_StrForePart+2)
	 	if GetItemCount(sceneId,selfId,demandItemId) < 5 then --√ª”–À˜“™µƒŒÔ∆∑
	 		return 0
	 	else
	 		return 1	
	 	end
	elseif missionType == x229004_g_SubMissionTypeEnum.BuZhuo then
		return 2
	elseif GetMissionParam(sceneId, selfId, misIndex, 0) > 0 then	--≤Ïø¥»ŒŒÒ «∑ÒÕÍ≥…
		return 1
	end

	return 0
end

function x229004_OnLockedTarget(sceneId, selfId, objId )
	--PrintStr("OnLockedTarget...")
	if GetName(sceneId, objId) == x229004_g_Name  then
		return 0
	end
	-- ≈–∂œ «≤ª «À¯∂®µƒNpc
	if IsHaveMission(sceneId, selfId, x229004_g_MissionId) > 0 then
		local misIndex = GetMissionIndexByID(sceneId,selfId,x229004_g_MissionId)		--µ√µΩ»ŒŒÒ‘⁄20∏ˆ»ŒŒÒ÷–µƒ–Ú¡–∫≈
		local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
		
		local nNpcId, strNpcName, strNpcScene, PosX, PosZ, desc
		if missionType == x229004_g_SubMissionTypeEnum.KaiGuang then
			nNpcIndex = GetMissionParam(sceneId, selfId, misIndex, x229004_g_StrForePart+1)
			strNpcName = x229004_g_StrList[nNpcIndex+1]
		else
			nNpcId = GetMissionParam(sceneId, selfId, misIndex, x229004_g_StrForePart+1)
			nNpcId, strNpcName, strNpcScene, PosX, PosZ, desc = GetNpcInfoByNpcId(sceneId,nNpcId)
		end
			 
		--PrintStr(GetName(sceneId, objId))
		--PrintStr(strNpcName)
		if GetName(sceneId, objId) == strNpcName then
			TAddNumText(sceneId,x229004_g_ScriptId,x229004_g_MissionName,4,-1,x229004_g_ScriptId);
		end
			
	end
	
	return 0;

end

function x229004_CheckCondition_UseItem( sceneId, selfId, targetId, eventId )
	------PrintStr("OnUseItem...")
	local misIndex = GetMissionIndexByID(sceneId, selfId, x229004_g_MissionId)

	--ªÒµ√∏√»ŒŒÒµƒ»ŒŒÒ¿‡–Õ
	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
	if missionType ~= x229004_g_SubMissionTypeEnum.DingDianYinDao then
		return 0
	end
	
	local index = GetMissionParam(sceneId, selfId, misIndex, 2)
	local targetSceneId = x229004_g_DingDianYinDaoList[index].scene
	--PrintNum(sceneId)
	if sceneId ~= targetSceneId then
		BeginEvent(sceneId)

			AddText(sceneId,"HÏnh nhﬂ ∑ ‚y khÙng ﬂ˛c b°n")

		EndEvent(sceneId)

		DispatchMissionTips(sceneId,selfId)

		return 0
	end
	
	local posx1 = x229004_g_DingDianYinDaoList[index].posx1
	local posz1 = x229004_g_DingDianYinDaoList[index].posz1
	local posx2 = x229004_g_DingDianYinDaoList[index].posx2
	local posz2 = x229004_g_DingDianYinDaoList[index].posz2

	--»°µ√ÕÊº“µ±«∞◊¯±Í

	local PlayerX = GetHumanWorldX(sceneId,selfId)

	local PlayerZ = GetHumanWorldZ(sceneId,selfId)

	
	--º∆À„ÕÊº“”Îƒø±Íµ„µƒæ‡¿Î
	if PlayerX >= posx1 and PlayerX < posx2 then
		------PrintStr("PlayerX >= posx1 and PlayerX < posx2...")
		if PlayerZ >= posz1 and PlayerZ < posz2 then
			------PrintStr("PlayerZ >= posz1 and PlayerZ < posz2...")
			return 1
		end
	end	

	BeginEvent(sceneId)

		AddText(sceneId, "ChÔ ﬂ˛c sÿ d¯ng trong khu vÒc chÔ ∏nh!")

	EndEvent(sceneId)

	DispatchMissionTips(sceneId,selfId)
	return 0

end

--**********************************
--µ¿æﬂ π”√
--**********************************
function x229004_Active_UseItem( sceneId, selfId, param0 )
	local misIndex = GetMissionIndexByID(sceneId, selfId, x229004_g_MissionId)

	--ªÒµ√∏√»ŒŒÒµƒ»ŒŒÒ¿‡–Õ
	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
	if missionType ~= x229004_g_SubMissionTypeEnum.DingDianYinDao then
		return 0
	end
	
	local index = GetMissionParam(sceneId, selfId, misIndex, 2)
	if LuaFnGetAvailableItemCount(sceneId, selfId, x229004_g_DingDianYinDaoList[index].itemId) >= 1 then
		DelItem( sceneId, selfId, x229004_g_DingDianYinDaoList[index].itemId, 1 )
	--∞—»ŒŒÒ◊¥Ã¨±‰¡ø…Ë÷√Œ™1,±Ì æ“—æ≠ÕÍ≥…
	SetMissionByIndex(sceneId,selfId,misIndex,0,1)
	else	
		BeginEvent(sceneId)
			AddText(sceneId, "Vßt ph¶m c¸a c·c h’ hiÆn khÙng d˘ng ﬂ˛c ho£c „ b∏ khÛa")
		EndEvent( )
		DispatchMissionTips(sceneId,selfId)	
		return	
	end	
	
end

--**********************************
--µ¿æﬂ∏ƒ±‰
--**********************************
function x229004_OnItemChanged( sceneId, selfId, itemdataId )
	--PrintStr("OnItemChanged")
	local misIndex = GetMissionIndexByID(sceneId, selfId, x229004_g_MissionId)

	--ªÒµ√∏√»ŒŒÒµƒ»ŒŒÒ¿‡–Õ
	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
	
	if missionType == x229004_g_SubMissionTypeEnum.XunWu then
		local _, strItemName, _ = x229004_GetItemDetailInfo(itemdataId)
		local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229004_g_StrForePart+1)
		local _, strDemandItemName, _ = x229004_GetItemDetailInfo(demandItemId)
		
		if strItemName == strDemandItemName then
			BeginEvent(sceneId)
				strText = format("–„ ’t ﬂ˛c %s", strItemName)
				AddText(sceneId,strText)
			EndEvent(sceneId)

			DispatchMissionTips(sceneId,selfId)
			SetMissionByIndex(sceneId,selfId,misIndex,0,1)
			ResetMissionEvent(sceneId, selfId, x229004_g_MissionId, 2)
		end
	elseif missionType == x229004_g_SubMissionTypeEnum.KaiGuang then
		local _, strItemName, _ = x229004_GetItemDetailInfo(itemdataId)
		local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229004_g_StrForePart+2)
		local _, strDemandItemName, _ = x229004_GetItemDetailInfo(demandItemId)
		
		if strItemName == strDemandItemName then
			BeginEvent(sceneId)
				strText = format("–„ ’t ﬂ˛c %s", strItemName)
				AddText(sceneId,strText)
			EndEvent(sceneId)
			DispatchMissionTips(sceneId,selfId)
			ResetMissionEvent(sceneId, selfId, x229004_g_MissionId, 2)
		end
	elseif missionType == x229004_g_SubMissionTypeEnum.ShouJi then
		local itemCount = GetItemCount(sceneId,selfId,itemdataId)
		local _, strItemName, _ = x229004_GetItemDetailInfo(itemdataId)
		local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229004_g_StrForePart+2)
		local _, strDemandItemName, _ = x229004_GetItemDetailInfo(demandItemId)
		
		if strItemName == strDemandItemName then
			BeginEvent(sceneId)
				local _, strItemName, _ = x229004_GetItemDetailInfo(itemdataId)
				strText = format("–„ ’t ﬂ˛c %s%d/5", strItemName, itemCount)
				AddText(sceneId,strText)
			EndEvent(sceneId)
			DispatchMissionTips(sceneId,selfId)
			
			if itemCount == 5 then
				SetMissionByIndex(sceneId,selfId,misIndex,0,1)
				ResetMissionEvent(sceneId, selfId, x229004_g_MissionId, 2)
			end
		end
	elseif missionType == x229004_g_SubMissionTypeEnum.killMonster then
		local _, _, itemId = x229004_GetMenpaiYiWuInfo(sceneId, selfId)
		if itemdataId == itemId  then
			SetMissionByIndex(sceneId,selfId,misIndex,0,1)
			ResetMissionEvent(sceneId, selfId, x229004_g_MissionId, 0)
			ResetMissionEvent(sceneId, selfId, x229004_g_MissionId, 2)
		end
	end

end

--**********************************
--’‰ ﬁ∏ƒ±‰
--**********************************
function x229004_OnPetChanged( sceneId, selfId, petDataId)
	----PrintStr("OnPetChanged...")
	local misIndex = GetMissionIndexByID(sceneId, selfId, x229004_g_MissionId)

	--ªÒµ√∏√»ŒŒÒµƒ»ŒŒÒ¿‡–Õ
	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
	if missionType == x229004_g_SubMissionTypeEnum.BuZhuo then
		local demandPetDataId = GetMissionParam(sceneId, selfId, misIndex, x229004_g_StrForePart+1)
		
		if petDataId == demandPetDataId then
			BeginEvent(sceneId)
				local strText = format("–„ ’t ﬂ˛c %s", GetPetName(petDataId))
				AddText(sceneId,strText)
			EndEvent(sceneId)

			DispatchMissionTips(sceneId,selfId)
			SetMissionByIndex(sceneId,selfId,misIndex,0,1)
			ResetMissionEvent(sceneId, selfId, x229004_g_MissionId, 3)
		end
	end
end
--**********************************
--Ã·Ωª
--**********************************
function x229004_OnSubmit( sceneId, selfId, targetId, selectRadioId )
	----PrintStr("OnSubmit...")
	local misIndex = GetMissionIndexByID(sceneId, selfId, x229004_g_MissionId)

	if x229004_CheckSubmit( sceneId, selfId, selectRadioId ) >=1 then

		local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
		if missionType == x229004_g_SubMissionTypeEnum.XunWu then
			local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229004_g_StrForePart+1)
			--PrintStr("demandItemId"..demandItemId)
			if LuaFnGetAvailableItemCount(sceneId, selfId, demandItemId) >= 1 then
			local ret = DelItem(sceneId, selfId, demandItemId, 1)
			if ret <= 0 then
				BeginEvent(sceneId)
					AddText(sceneId, "KhÙng ¸ vßt ph¶m c•n, nhiÆm v¯ khÙng th¨ giao")
				EndEvent()
				DispatchMissionTips(sceneId, selfId)
				return
			end
			else
				BeginEvent(sceneId)
					AddText(sceneId, "Vßt ph¶m c¸a c·c h’ hiÆn khÙng d˘ng ﬂ˛c ho£c „ b∏ khÛa")
				EndEvent( )
				DispatchMissionTips(sceneId,selfId)	
				return	
			end
--		elseif missionType == x229004_g_SubMissionTypeEnum.killMonster then
--			local _, _, demandItemId  = x229004_GetMenpaiYiWuInfo(sceneId, selfId)
--			local ret = DelItem(sceneId, selfId, demandItemId, 1)
--			if ret <= 0 then
--				BeginEvent(sceneId)
--					AddText(sceneId, "√ª”–◊„πªµƒÀ˘–ËŒÔ∆∑£¨»ŒŒÒŒﬁ∑®Ã·Ωª")
--				EndEvent()
--				DispatchMissionTips(sceneId, selfId)
--				return
--			end
		elseif missionType == x229004_g_SubMissionTypeEnum.ShouJi then
			local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229004_g_StrForePart+2)
			if LuaFnGetAvailableItemCount(sceneId, selfId, demandItemId) >= 1 then
			local ret = DelItem(sceneId, selfId, demandItemId, 5)
			if ret <= 0 then
				BeginEvent(sceneId)
					AddText(sceneId, "KhÙng ¸ vßt ph¶m c•n, nhiÆm v¯ khÙng th¨ giao")
				EndEvent()
				DispatchMissionTips(sceneId, selfId)
				return
			end
			else
				BeginEvent(sceneId)
					AddText(sceneId, "Vßt ph¶m c¸a c·c h’ hiÆn khÙng d˘ng ﬂ˛c ho£c „ b∏ khÛa")
				EndEvent( )
				DispatchMissionTips(sceneId,selfId)	
				return	
			end	
		end

		DelMission( sceneId, selfId, x229004_g_MissionId )
		--µ˜”√Õ®”√Ã·Ωª»ŒŒÒΩ”ø⁄Ω”ø⁄

		------------------------------------------------------------------
		local Reward_Append, MissionRound = CallScriptFunction( 500501, "OnSubmit_Necessary", sceneId, selfId, targetId )
		if Reward_Append == 2 and MissionRound == 20 then
			CallScriptFunction(229010, "AddOtherMenpaiFubenMission", sceneId, selfId, x229004_g_MissionId, targetId)
		end
		-------------------------------------------------------------------

		--x229004_OnDefaultEvent( sceneId, selfId, targetId )
		
	end
end

function x229004_OnMissionCheck( sceneId, selfId, npcid, scriptId, index1, index2, index3, petindex )
  if x229004_CheckSubmit( sceneId, selfId) < 1 then
    return 0
  end

	--PrintStr("OnMissionCheck...")
	print(sceneId, selfId, npcid, scriptId, index1, index2, index3, petindex)
	local misIndex = GetMissionIndexByID(sceneId, selfId, x229004_g_MissionId)

	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
	if missionType == x229004_g_SubMissionTypeEnum.XunWu then
		local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229004_g_StrForePart+1)
		local _, strDemandItemName, _ = x229004_GetItemDetailInfo(demandItemId)
		--PrintStr("strDemandItemName="..strDemandItemName)
		--µ˜”√Õ®”√Ã·Ωª»ŒŒÒΩ”ø⁄Ω”ø⁄

		------------------------------------------------------------------

		local find = CallScriptFunction( 500501, "OnMissionCheck_NecessaryEx", sceneId, selfId, index1, index2, index3, demandItemId )

		-------------------------------------------------------------------


		if find <= 0 then

			BeginEvent(sceneId)

				local strText = format("Sao ngﬂΩi vÁn chﬂa em %s v´ ﬂ˛c m‡ „ quay v´?", strDemandItemName)
				AddText(sceneId,strText)
				AddItemBonus( sceneId, demandItemId, 1 )
			EndEvent(sceneId)

			DispatchEventList(sceneId,selfId,-1)

			return
		end
		
		local ret = EraseItem( sceneId, selfId, find )
		if	ret > 0 then

			DelMission( sceneId, selfId, x229004_g_MissionId )

			--µ˜”√Õ®”√Ã·Ωª»ŒŒÒΩ”ø⁄Ω”ø⁄

			------------------------------------------------------------------
		local Reward_Append, MissionRound = CallScriptFunction( 500501, "OnSubmit_Necessary", sceneId, selfId, -1 )
		if Reward_Append == 2 and MissionRound == 20 then
			CallScriptFunction(229010, "AddOtherMenpaiFubenMission", sceneId, selfId, x229004_g_MissionId)
		end
			-------------------------------------------------------------------

		else
			BeginEvent(sceneId)

				local strText = format("Sao ngﬂΩi vÁn chﬂa em %s v´ ﬂ˛c m‡ „ quay v´?", strDemandItemName)
				AddText(sceneId,strText)
				AddItemBonus( sceneId, demandItemId, 1 )
			EndEvent(sceneId)

			DispatchEventList(sceneId,selfId,-1)
		end	
	elseif missionType == x229004_g_SubMissionTypeEnum.BuZhuo then
		----PrintStr("OnMissionCheck...BuZhuo...")
		local demandPetId = GetMissionParam(sceneId, selfId, misIndex, x229004_g_StrForePart+1)
		local petId = LuaFnGetPet_DataID(sceneId, selfId, petindex)
		if petId == demandPetId then
			if LuaFnIsPetAvailable(sceneId, selfId, petindex) >= 1 then
				LuaFnDeletePet(sceneId, selfId, petindex)
				----PrintStr("DeletePet"..petId..demandPetId)
				DelMission( sceneId, selfId, x229004_g_MissionId )

				--µ˜”√Õ®”√Ã·Ωª»ŒŒÒΩ”ø⁄Ω”ø⁄

				------------------------------------------------------------------
				local Reward_Append, MissionRound = CallScriptFunction( 500501, "OnSubmit_Necessary", sceneId, selfId, -1 )
				if Reward_Append == 2 and MissionRound == 20 then
					CallScriptFunction(229010, "AddOtherMenpaiFubenMission", sceneId, selfId, x229004_g_MissionId)
				end
				-------------------------------------------------------------------
      end   		
		else
			BeginEvent(sceneId)
				AddText(sceneId, "Sao ngﬂΩi vÁn chﬂa em tr‚n th˙ m‡ ta c•n v´ ﬂ˛c m‡ „ quay v´?")
			EndEvent(sceneId)

			DispatchEventList(sceneId,selfId,-1)

		end

	end -- endif
	
end

--**********************************
--…±À¿π÷ŒÔªÚÕÊº“
--**********************************
function x229004_OnKillObject( sceneId, selfId, objdataId ,objId)--≤Œ ˝“‚Àº£∫≥°æ∞∫≈°¢ÕÊº“objId°¢π÷ŒÔ±ÌŒª÷√∫≈°¢π÷ŒÔ
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229004_g_MissionId)
	local nMonsterId = GetMissionParam(sceneId, selfId, misIndex, x229004_g_StrForePart+3)
	local _, strMonsterName = GetNpcInfoByNpcId(sceneId,nMonsterId)
	local monsterName = GetMonsterNamebyDataId(objdataId)
	
	if strMonsterName == monsterName  then
		local num = GetMonsterOwnerCount(sceneId,objId)
		for i=0,num-1  do
			-- »°µ√”µ”–∑÷≈‰»®µƒ»ÀµƒobjId
			local humanObjId = GetMonsterOwnerID(sceneId,objId,i)
			--PrintStr("humanObjId=" .. humanObjId)
			-- ø¥’‚∏ˆ»À «≤ª «”–’‚∏ˆ»ŒŒÒ
			if IsHaveMission(sceneId, humanObjId, x229004_g_MissionId) > 0 then
				-- œ»≈–∂œ «≤ª «“—æ≠¬˙◊„¡ÀÕÍ≥…±Í÷æ
				local misIndex = GetMissionIndexByID(sceneId,humanObjId,x229004_g_MissionId)
				if GetMissionParam(sceneId, humanObjId, misIndex, 0) <=0  then
					local demandKillCount = GetMissionParamEx(sceneId, humanObjId, misIndex, 3, 0)
					--PrintStr("demandKillCount=" .. demandKillCount)
					local killedCount =	GetMissionParamEx(sceneId, humanObjId, misIndex, 3, 1)
					killedCount = killedCount + 1
					SetMissionParamByIndexEx(sceneId, humanObjId, misIndex, 3, 1, killedCount)
					--PrintStr("killedCount=" .. killedCount)
					BeginEvent(sceneId)
						local str = format("–„ gi™t ch™t %d/%d%s", killedCount, demandKillCount, monsterName)
						AddText(sceneId, str)
					EndEvent()
					DispatchMissionTips(sceneId, humanObjId)
					if killedCount >= demandKillCount then
						SetMissionByIndex(sceneId, humanObjId, misIndex, 0, 1)
		end
				end --if
			end --if
		end --for				
	end

end


--**********************************
--Õ¨√≈œ‡÷˙....÷±Ω”ÕÍ≥…µ±«∞ª∑....
--**********************************
function x229004_HelpFinishOneHuan( sceneId, selfId, targetId )

	-- «∑Ò «±æ√≈≈…µ‹◊”....
	if MP_DALI ~= GetMenPai( sceneId, selfId ) then
		return
	end

	-- «∑ÒΩ”¡À ¶√≈»ŒŒÒ....
	if IsHaveMission(sceneId,selfId,x229004_g_MissionId) <= 0 then
		return
	end

	--ºÏ≤‚≤¢ø€≥˝Õ¨√≈œ‡÷˙À˘–Ëµƒ ¶√≈π±œ◊....
	local ret = CallScriptFunction( 229011, "CheckAndDepleteHelpFinishMenPaiPoint", sceneId, selfId, targetId )
	if ret == 0 then
		return
	end

	--ªÒ»° ¶√≈»ŒŒÒµƒ¿‡–Õ....
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229004_g_MissionId)
	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)

	--«Â≥˝»ŒŒÒŒÔ∆∑....
	local itemId = -1
	local itemCount = -1

	if missionType == x229004_g_SubMissionTypeEnum.SongXin then
		itemId = GetMissionParam(sceneId, selfId, misIndex,x229004_g_StrForePart+3)
		itemCount = LuaFnGetAvailableItemCount(sceneId, selfId, itemId)
		if itemCount >= 1 then
			DelItem(sceneId, selfId, itemId, 1)
		end
	elseif missionType == x229004_g_SubMissionTypeEnum.DingDianYinDao	then
		local index = GetMissionParam(sceneId, selfId, misIndex,2)
		itemId = x229004_g_DingDianYinDaoList[index].itemId
		itemCount = LuaFnGetAvailableItemCount(sceneId, selfId, itemId)
		if itemCount >= 1 then
			DelItem(sceneId, selfId, itemId, 1)	
		end
	elseif missionType == x229004_g_SubMissionTypeEnum.ShouJi then
		itemId = GetMissionParam(sceneId, selfId, misIndex, x229004_g_StrForePart+2)
		itemCount = LuaFnGetAvailableItemCount(sceneId, selfId, itemId)
		if itemCount > 5 then
			itemCount = 5
		end
		if itemCount > 0 then
			DelItem(sceneId, selfId, itemId, itemCount)
		end
	end

	--…æ≥˝ÕÊº“»ŒŒÒ¡–±Ì÷–∂‘”¶µƒ»ŒŒÒ....
	DelMission( sceneId, selfId, x229004_g_MissionId )

	--µ˜”√Õ®”√Ã·Ωª»ŒŒÒΩ”ø⁄Ω”ø⁄....
	local Reward_Append, MissionRound = CallScriptFunction( 500501, "OnSubmit_Necessary", sceneId, selfId, targetId, 1 )

	if Reward_Append == 2 and MissionRound == 20 then
		--Ω±¿¯ÕÊº““ª∏ˆ»•±µƒ√≈≈…∏±±æµƒ ¶√≈»ŒŒÒ....
		CallScriptFunction(229010, "AddOtherMenpaiFubenMission", sceneId, selfId, x229004_g_MissionId, targetId)
	end

end
